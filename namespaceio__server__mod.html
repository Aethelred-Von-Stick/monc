<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MONC: io_server_mod Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MONC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">io_server_mod Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The main IO server functionality which handles waiting for commands and data both of which are delt with. The lower level details of the communication, configuration parsing etc are all held elsewhere. The server can be thought of similar to a bus, with command and data channels. The command gives context to what is on the data channel and not all commands require data (such as deregistration of MONC process)  
<a href="namespaceio__server__mod.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ac818aa1985977c9887acda6315139114"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114">io_server_run</a> (options_database, io_communicator_arg, provided_threading, total_global_processes, continuation_run, io_configuration_file)</td></tr>
<tr class="memdesc:ac818aa1985977c9887acda6315139114"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called to start the IO server and once this subroutine returns then it indicates that the IO server has finished. The runtime is spent in here awaiting commands and then dealing with them. Termination occurs when all MONC processes have deregistered, note that to trigger this then at least one MONC process must first register.  <a href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114">More...</a><br /></td></tr>
<tr class="separator:ac818aa1985977c9887acda6315139114"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9d8dbafb475aaceb37d8a332c238448"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#ae9d8dbafb475aaceb37d8a332c238448">check_for_condi_conflict</a> (raw_contents, options_database)</td></tr>
<tr class="memdesc:ae9d8dbafb475aaceb37d8a332c238448"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle potential conditional diagnostics conflict Provides a more helpful error in the case where conditional diagnostics are requested as output, but their components are not enabled. We check this by searching the io_xml_configuration.  <a href="namespaceio__server__mod.html#ae9d8dbafb475aaceb37d8a332c238448">More...</a><br /></td></tr>
<tr class="separator:ae9d8dbafb475aaceb37d8a332c238448"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada1b8581f80d696dc8aa636405c73aea"><td class="memItemLeft" align="right" valign="top">logical function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#ada1b8581f80d696dc8aa636405c73aea">await_command</a> (command, source, data_buffer)</td></tr>
<tr class="memdesc:ada1b8581f80d696dc8aa636405c73aea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Awaits a command or shutdown from MONC processes and other IO servers.  <a href="namespaceio__server__mod.html#ada1b8581f80d696dc8aa636405c73aea">More...</a><br /></td></tr>
<tr class="separator:ada1b8581f80d696dc8aa636405c73aea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7fdb4e13556857668bb0b29fa719624"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#ab7fdb4e13556857668bb0b29fa719624">termination_callback</a> (<a class="el" href="namespaceio__server__mod.html#a7cc63c3947de770f7e0e7fe76103fc9b">io_configuration</a>, values, field_name, timestep)</td></tr>
<tr class="memdesc:ab7fdb4e13556857668bb0b29fa719624"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is the termination callback which is called once all MONCs have deregistered, no sends are active by inter IO communications and all threads are idle. This shuts down the inter IO listening and kickstarts finalisation and closure.  <a href="namespaceio__server__mod.html#ab7fdb4e13556857668bb0b29fa719624">More...</a><br /></td></tr>
<tr class="separator:ab7fdb4e13556857668bb0b29fa719624"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab843eee74fe31492952c1c88304730d7"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7">handle_command_message</a> (command, source, data_buffer)</td></tr>
<tr class="memdesc:ab843eee74fe31492952c1c88304730d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called to handle a specific command that has been recieved.  <a href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7">More...</a><br /></td></tr>
<tr class="separator:ab843eee74fe31492952c1c88304730d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a092b3e8e2be8304436b72ffa5e4955e8"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a092b3e8e2be8304436b72ffa5e4955e8">handle_inter_io_communication_command</a> (arguments, data_buffer)</td></tr>
<tr class="memdesc:a092b3e8e2be8304436b72ffa5e4955e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles inter IO server communications.  <a href="namespaceio__server__mod.html#a092b3e8e2be8304436b72ffa5e4955e8">More...</a><br /></td></tr>
<tr class="separator:a092b3e8e2be8304436b72ffa5e4955e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1067b04bf298bdec22d1c55144f3a8d5"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a1067b04bf298bdec22d1c55144f3a8d5">free_individual_registered_monc_aspects</a> ()</td></tr>
<tr class="memdesc:a1067b04bf298bdec22d1c55144f3a8d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees up the memory associated with individual registered MONCs. This is done at the end for all MONCs as we can't deallocate dynamically in a threaded environment without excessive ordering and locking in case some data processing is queued or in progress.  <a href="namespaceio__server__mod.html#a1067b04bf298bdec22d1c55144f3a8d5">More...</a><br /></td></tr>
<tr class="separator:a1067b04bf298bdec22d1c55144f3a8d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08e13af9d8118b7f90eab2435fc2c086"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a08e13af9d8118b7f90eab2435fc2c086">handle_deregistration_command</a> (arguments, data_buffer)</td></tr>
<tr class="memdesc:a08e13af9d8118b7f90eab2435fc2c086"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deregisteres a specific MONC source process.  <a href="namespaceio__server__mod.html#a08e13af9d8118b7f90eab2435fc2c086">More...</a><br /></td></tr>
<tr class="separator:a08e13af9d8118b7f90eab2435fc2c086"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a153d99e94dcccfaea63104af86095dce"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce">pull_back_data_message_and_handle</a> (source, data_set)</td></tr>
<tr class="memdesc:a153d99e94dcccfaea63104af86095dce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool to actually process We do it this way to enforce ordering between the command (including the data set ID) and the raw data itself.  <a href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce">More...</a><br /></td></tr>
<tr class="separator:a153d99e94dcccfaea63104af86095dce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96c2285d5c9b5badb426a0e065abdf4a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a">handle_data_message</a> (arguments, data_buffer)</td></tr>
<tr class="memdesc:a96c2285d5c9b5badb426a0e065abdf4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the command for data download from a specific process. This will allocate the receive buffer and then call to get the data. Once it has been received then the data is run against handling rules.  <a href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a">More...</a><br /></td></tr>
<tr class="separator:a96c2285d5c9b5badb426a0e065abdf4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95f289d7a2a91f45be0accb5328cc178"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a95f289d7a2a91f45be0accb5328cc178">handle_monc_registration</a> (arguments, data_buffer)</td></tr>
<tr class="memdesc:a95f289d7a2a91f45be0accb5328cc178"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles registration from some MONC process. The source process sends some data description to this IO server which basically tells the IO server the size of the array datas (which might be different on different processes in the case of uneven decomposition.) Based upon this a communication (MPI) data type is constructed and the data size in bytes determined.  <a href="namespaceio__server__mod.html#a95f289d7a2a91f45be0accb5328cc178">More...</a><br /></td></tr>
<tr class="separator:a95f289d7a2a91f45be0accb5328cc178"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af165fa2c9ad4d8d48537ee997432fdaa"><td class="memItemLeft" align="right" valign="top">integer function, dimension(2)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#af165fa2c9ad4d8d48537ee997432fdaa">send_configuration_to_registree</a> (source)</td></tr>
<tr class="memdesc:af165fa2c9ad4d8d48537ee997432fdaa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the data and field descriptions to the MONC process that just registered with the IO server.  <a href="namespaceio__server__mod.html#af165fa2c9ad4d8d48537ee997432fdaa">More...</a><br /></td></tr>
<tr class="separator:af165fa2c9ad4d8d48537ee997432fdaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e5c9b6be433b4b2bebbfa01ddf0bec0"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a5e5c9b6be433b4b2bebbfa01ddf0bec0">init_data_definition</a> (source, monc_defn)</td></tr>
<tr class="memdesc:a5e5c9b6be433b4b2bebbfa01ddf0bec0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the sizing of data definitions from a MONC process. The IO server determines, from configuration, the structure of each data definition but the size of the arrays depends upon the MONC process (due to uneven distribution of data etc...) This receives the sizing message and then builds the MPI datatype for each data definition that the IO server will receive from that specific MONC process. The field sizings are for all fields in every data definition, and these are applied to each data definition which will simply ignore non matching fields.  <a href="namespaceio__server__mod.html#a5e5c9b6be433b4b2bebbfa01ddf0bec0">More...</a><br /></td></tr>
<tr class="separator:a5e5c9b6be433b4b2bebbfa01ddf0bec0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefce42fc11a68cb3783f1eb0f2c18610"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#aefce42fc11a68cb3783f1eb0f2c18610">get_monc_information_data</a> (source)</td></tr>
<tr class="memdesc:aefce42fc11a68cb3783f1eb0f2c18610"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves MONC information data, this is sent by MONC (and received) regardless, but only actioned if the data has not already been set.  <a href="namespaceio__server__mod.html#aefce42fc11a68cb3783f1eb0f2c18610">More...</a><br /></td></tr>
<tr class="separator:aefce42fc11a68cb3783f1eb0f2c18610"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75db617985efd39b9db284a0dc512d34"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a75db617985efd39b9db284a0dc512d34">register_present_field_names_to_federators</a> (data_description, recv_count)</td></tr>
<tr class="memdesc:a75db617985efd39b9db284a0dc512d34"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers with the writer federator the set of fields (prognostic and diagnostic) that are available, this is based on the array/optional fields present from MONC and the non-optional scalars. This is quite an expensive operation, so only done once.  <a href="namespaceio__server__mod.html#a75db617985efd39b9db284a0dc512d34">More...</a><br /></td></tr>
<tr class="separator:a75db617985efd39b9db284a0dc512d34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bd8b641a945346aa2cfe1813bb3af34"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a9bd8b641a945346aa2cfe1813bb3af34">handle_monc_dimension_information</a> (data_description, monc_defn)</td></tr>
<tr class="memdesc:a9bd8b641a945346aa2cfe1813bb3af34"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles the provided local MONC dimension and data layout information.  <a href="namespaceio__server__mod.html#a9bd8b641a945346aa2cfe1813bb3af34">More...</a><br /></td></tr>
<tr class="separator:a9bd8b641a945346aa2cfe1813bb3af34"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a02af53b3696bff6b7089a3a176d0f676"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a02af53b3696bff6b7089a3a176d0f676">mpi_type_data_sizing_description</a></td></tr>
<tr class="memdesc:a02af53b3696bff6b7089a3a176d0f676"><td class="mdescLeft">&#160;</td><td class="mdescRight">The MPI type for field sizing (i.e. array size etc send when MONCs register)  <a href="namespaceio__server__mod.html#a02af53b3696bff6b7089a3a176d0f676">More...</a><br /></td></tr>
<tr class="separator:a02af53b3696bff6b7089a3a176d0f676"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1508901e86e2ca48b8c0b9a2a766a24d"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a1508901e86e2ca48b8c0b9a2a766a24d">mpi_type_definition_description</a></td></tr>
<tr class="memdesc:a1508901e86e2ca48b8c0b9a2a766a24d"><td class="mdescLeft">&#160;</td><td class="mdescRight">The MPI data type for data descriptions sent to MONCs.  <a href="namespaceio__server__mod.html#a1508901e86e2ca48b8c0b9a2a766a24d">More...</a><br /></td></tr>
<tr class="separator:a1508901e86e2ca48b8c0b9a2a766a24d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab074f894b4344602107d18810aa00a15"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#ab074f894b4344602107d18810aa00a15">mpi_type_field_description</a></td></tr>
<tr class="memdesc:ab074f894b4344602107d18810aa00a15"><td class="mdescLeft">&#160;</td><td class="mdescRight">The MPI data type for field descriptions sent to MONCs.  <a href="namespaceio__server__mod.html#ab074f894b4344602107d18810aa00a15">More...</a><br /></td></tr>
<tr class="separator:ab074f894b4344602107d18810aa00a15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cc63c3947de770f7e0e7fe76103fc9b"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), save, volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a7cc63c3947de770f7e0e7fe76103fc9b">io_configuration</a></td></tr>
<tr class="memdesc:a7cc63c3947de770f7e0e7fe76103fc9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal representation of the IO configuration.  <a href="namespaceio__server__mod.html#a7cc63c3947de770f7e0e7fe76103fc9b">More...</a><br /></td></tr>
<tr class="separator:a7cc63c3947de770f7e0e7fe76103fc9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88118b683c49ba93c1ea0e9e88f3364e"><td class="memItemLeft" align="right" valign="top">logical, volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a88118b683c49ba93c1ea0e9e88f3364e">contine_poll_messages</a></td></tr>
<tr class="memdesc:a88118b683c49ba93c1ea0e9e88f3364e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether to continue waiting command messages from any MONC processes.  <a href="namespaceio__server__mod.html#a88118b683c49ba93c1ea0e9e88f3364e">More...</a><br /></td></tr>
<tr class="separator:a88118b683c49ba93c1ea0e9e88f3364e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cdbf4ecf3cca70a7bc7c77fb18a1dbb"><td class="memItemLeft" align="right" valign="top">logical, volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a6cdbf4ecf3cca70a7bc7c77fb18a1dbb">initialised_present_data</a></td></tr>
<tr class="separator:a6cdbf4ecf3cca70a7bc7c77fb18a1dbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46bd252ea44716a24f3fcf5d7f408392"><td class="memItemLeft" align="right" valign="top">logical, volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a46bd252ea44716a24f3fcf5d7f408392">contine_poll_interio_messages</a></td></tr>
<tr class="separator:a46bd252ea44716a24f3fcf5d7f408392"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a18c5d2e99cc876d36f8c4a866dc98f10"><td class="memItemLeft" align="right" valign="top">logical, volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a18c5d2e99cc876d36f8c4a866dc98f10">already_registered_finishing_call</a></td></tr>
<tr class="separator:a18c5d2e99cc876d36f8c4a866dc98f10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeac6944459809f6ad57a28ec75e7fd22"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structio__server__client__mod_1_1field__description__type.html">field_description_type</a>), dimension(:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#aeac6944459809f6ad57a28ec75e7fd22">registree_field_descriptions</a></td></tr>
<tr class="separator:aeac6944459809f6ad57a28ec75e7fd22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accae499eb3bda8ea4fe462c9d66fe5d0"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structio__server__client__mod_1_1definition__description__type.html">definition_description_type</a>), dimension(:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#accae499eb3bda8ea4fe462c9d66fe5d0">registree_definition_descriptions</a></td></tr>
<tr class="separator:accae499eb3bda8ea4fe462c9d66fe5d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04b4dd1167e6396f87a52612773a4429"><td class="memItemLeft" align="right" valign="top">integer, volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceio__server__mod.html#a04b4dd1167e6396f87a52612773a4429">monc_registration_lock</a></td></tr>
<tr class="separator:a04b4dd1167e6396f87a52612773a4429"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The main IO server functionality which handles waiting for commands and data both of which are delt with. The lower level details of the communication, configuration parsing etc are all held elsewhere. The server can be thought of similar to a bus, with command and data channels. The command gives context to what is on the data channel and not all commands require data (such as deregistration of MONC process) </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ada1b8581f80d696dc8aa636405c73aea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada1b8581f80d696dc8aa636405c73aea">&#9670;&nbsp;</a></span>await_command()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical function io_server_mod::await_command </td>
          <td>(</td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character, dimension(:), allocatable&#160;</td>
          <td class="paramname"><em>data_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Awaits a command or shutdown from MONC processes and other IO servers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">command</td><td>The command received is output </td></tr>
    <tr><td class="paramname">source</td><td>The source process received is output </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether to continue polling for commands (and whether to process the current output) </dd></dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00166">166</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(out)</span> :: command, source</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordtype">character</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: data_buffer</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordtype">logical</span> :: completed, inter_io_complete</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    completed=.false.</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    await_command=.false.</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span>(.not. completed)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keywordflow">if</span> (.not. contine_poll_messages .and. .not. contine_poll_interio_messages) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordflow">if</span> (contine_poll_messages) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">if</span> (test_for_command(command, source)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;          await_command=.true.</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">if</span> (contine_poll_interio_messages .and. <span class="keyword">allocated</span>(io_configuration%inter_io_communications)) <span class="keywordflow">then</span>       </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        inter_io_complete=test_for_inter_io(io_configuration%inter_io_communications, &amp;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;             io_configuration%number_inter_io_communications, io_configuration%io_communicator, command, source, data_buffer) </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">if</span> (inter_io_complete) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          await_command=.true.</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          <span class="keywordflow">return</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordflow">if</span> (.not. contine_poll_messages .and. .not. already_registered_finishing_call) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">if</span> (check_diagnostic_federator_for_completion(io_configuration) .and. threadpool_is_idle()) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;          already_registered_finishing_call=.true.          </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;          <span class="keyword">call </span>perform_global_callback(io_configuration, <span class="stringliteral">&quot;termination&quot;</span>, 1, termination_callback)          </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keywordflow">      end if</span>  </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordflow">if</span> (.not. completed) <span class="keyword">call </span>pause_for_mpi_interleaving()</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keywordflow">    end do</span>    </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_ada1b8581f80d696dc8aa636405c73aea_cgraph.png" border="0" usemap="#anamespaceio__server__mod_ada1b8581f80d696dc8aa636405c73aea_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_ada1b8581f80d696dc8aa636405c73aea_cgraph" id="anamespaceio__server__mod_ada1b8581f80d696dc8aa636405c73aea_cgraph">
<area shape="rect" title="Awaits a command or shutdown from MONC processes and other IO servers." alt="" coords="5,1928,149,1969"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ac193bf96ef5cbd37745e615516e8517c" title="Checks whether the diagnostics federator has completed or not, this is really checking all the underl..." alt="" coords="200,1427,372,1483"/>
<area shape="rect" href="namespacempi__communication__mod.html#aee6d81060fcad11a466f823627234e7c" title="Pauses for a specific number of ms to allow for MPI interleaving, this is to avoid starvation." alt="" coords="1578,1724,1765,1765"/>
<area shape="rect" href="namespaceglobal__callback__inter__io__mod.html#ad475780629e2db0ae4b68f3e395e418d" title="Performs a global callback." alt="" coords="205,1507,367,1563"/>
<area shape="rect" href="namespaceio__server__mod.html#ab7fdb4e13556857668bb0b29fa719624" title="This is the termination callback which is called once all MONCs have deregistered,..." alt="" coords="197,2936,375,2977"/>
<area shape="rect" href="namespacempi__communication__mod.html#af9ae866733dedd5129dac4361d17e720" title="Tests for a command message based upon the request already registered." alt="" coords="1095,1819,1266,1860"/>
<area shape="rect" href="namespacempi__communication__mod.html#a4e6c15cbcdc2763a82c34491328c4742" title="Tests for inter IO server communication." alt="" coords="1347,1987,1517,2028"/>
<area shape="rect" href="namespacethreadpool__mod.html#a2a87c0e0335c727f6b9fa99c54aac83a" title="Determines whether the thread pool is idle or not (i.e. all threads are idle and waiting for work)" alt="" coords="1581,2565,1761,2607"/>
<area shape="rect" href="namespaceallreduction__inter__io__mod.html#afb8d154fff5a46e854337bb4f0c2cfd3" title="Performs the all reduction inter IO reduction." alt="" coords="423,1507,576,1563"/>
<area shape="rect" href="namespaceallreduction__inter__io__mod.html#ab62e69d3dfe81df807aada1fc908554c" title="Adds an all reduce information to the status if it does not exist." alt="" coords="1102,205,1259,261"/>
<area shape="rect" href="namespaceallreduction__inter__io__mod.html#a467bb14ad72911d3695efc951233470e" title="Internal completion, called after the reduce has completed (on root) and calls out to broadcast." alt="" coords="624,1037,803,1093"/>
<area shape="rect" href="namespacebroadcast__inter__io__mod.html#a9c49585e6986ed7104ecc35a71347e78" title="Performs an inter IO broadcast of data from the root to all other IO servers. Note that this is on th..." alt="" coords="868,2018,1004,2074"/>
<area shape="rect" href="namespacereduction__inter__io__mod.html#afbd4c0a62bdef47841ccb4731a0c96e8" title="Actually handles the processing for this data wrt the vertical reduction." alt="" coords="645,1775,781,1831"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="1823,1279,1977,1320"/>
<area shape="rect" href="namespaceallreduction__inter__io__mod.html#ad21c851cc3b9d3ed52466bad4c2e2434" title="Finds an all reduce status information based on the field name and timestep, or returns null if none ..." alt="" coords="1354,205,1510,261"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="1590,459,1753,500"/>
<area shape="rect" href="namespaceforthread__mod.html#ab60b7d18e1d948f6b63c6cb893fad182" title=" " alt="" coords="1590,733,1753,775"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="2029,1286,2172,1313"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="2220,1279,2387,1320"/>
<area shape="rect" href="namespaceforthread__mod.html#ace3f16636de24b1fc62de549d67476dc" title=" " alt="" coords="1590,1069,1753,1111"/>
<area shape="rect" href="namespaceallreduction__inter__io__mod.html#a103a1d6876fa756eacc45db88c8febaa" title="Removes an all reduce status information based on the field name and timestep." alt="" coords="1343,335,1521,391"/>
<area shape="rect" href="namespacebroadcast__inter__io__mod.html#ad2566335f2b2e7bccb878a1d35fb97b4" title="Calls out to do a broadcast progress clean if needed (i.e. every n steps.)" alt="" coords="1103,1935,1258,1991"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="1819,2301,1981,2343"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="1819,2700,1981,2741"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="1586,1789,1757,1831"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="1586,1855,1757,1896"/>
<area shape="rect" href="namespaceinter__io__specifics__mod.html#aac6ab6e44250b1a2997e23aa4cbbe66c" title="Locates a the index of an inter IO entry from the operator name or returns 0 if none is found." alt="" coords="1607,2153,1736,2209"/>
<area shape="rect" href="namespacebroadcast__inter__io__mod.html#aabce3a8dfe788e5f00583999b3688f80" title="Locates and returns or adds and returns a specific broadcast item representing a timestep and field." alt="" coords="1069,964,1292,1005"/>
<area shape="rect" href="namespacebroadcast__inter__io__mod.html#a231ba532141420ad11d921c509a5a06a" title="Issues the call into the thread pool to call the completion procedure, this runs in a seperate thread..." alt="" coords="1351,2435,1513,2491"/>
<area shape="rect" href="namespaceinter__io__specifics__mod.html#a62c05cf83d67d1dd5d4a7414fd21be48" title="Packages up fields into an io binary message (allocated here) which is used for sending." alt="" coords="1574,3037,1769,3093"/>
<area shape="rect" href="namespacebroadcast__inter__io__mod.html#a68cd14e8efbb15c0bb5129e82140cdeb" title="Performs a clean of the broadcast progresses that no longer need to be stored." alt="" coords="1355,1519,1509,1575"/>
<area shape="rect" href="namespaceforthread__mod.html#a34912c5c002de467e6b116d65d917881" title=" " alt="" coords="1819,1548,1981,1589"/>
<area shape="rect" href="namespaceforthread__mod.html#aecdd575526686417bde58b7ae8f73735" title=" " alt="" coords="1590,1388,1753,1429"/>
<area shape="rect" href="namespacebroadcast__inter__io__mod.html#a676b7e1500cb206a945de3f3508d4497" title="Locates a broadcast item within a mapentry or null if none exists." alt="" coords="1572,1607,1771,1648"/>
<area shape="rect" href="namespacebroadcast__inter__io__mod.html#a46e749703e2e791961b93a72fc517664" title="Finds a specific broadcast item or null if none is found." alt="" coords="1344,1019,1520,1060"/>
<area shape="rect" href="namespaceforthread__mod.html#ab29785b28c1d6bcf13e844b8d1230846" title=" " alt="" coords="1351,851,1513,892"/>
<area shape="rect" href="namespacebroadcast__inter__io__mod.html#aa3e19e373e1f3520f836197cd9516519" title="Called by the thread pool, this will call onto the completion procedure before cleaning up @arguments..." alt="" coords="1601,2486,1742,2542"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a8ffb596e1dfa516877825fbcc1da77b2" title="Packs an array field into the sending buffer." alt="" coords="1827,3011,1973,3052"/>
<area shape="rect" href="namespaceio__server__client__mod.html#aa9aee7e6e5918193184b77962ba3b12e" title="Packs the data of a scalar field into a buffer." alt="" coords="1827,3076,1973,3117"/>
<area shape="rect" href="namespacereduction__inter__io__mod.html#ad0bf6811584fdb36107b4d2e1c185d69" title=" " alt="" coords="862,1819,1010,1860"/>
<area shape="rect" href="namespacereduction__inter__io__mod.html#a2ed33f2a10ddbfc3d66a54abb6db3687" title="Finds or adds a specific reduction progress based upon the timestep and reduction operator...." alt="" coords="1087,633,1274,689"/>
<area shape="rect" href="namespacereduction__inter__io__mod.html#adb8512d99c36d96498328af7e47194cb" title="Handles the case where the local MONC processes have completed their collective operation for a speci..." alt="" coords="1343,2051,1521,2107"/>
<area shape="rect" href="namespacereduction__inter__io__mod.html#ab41f299ba351aa0bb6895b884e99aa3a" title="Integrates the collective values from another IO server into the currently stored values." alt="" coords="851,1739,1021,1795"/>
<area shape="rect" href="namespacereduction__inter__io__mod.html#a7d635793eb07832a7420bf579526cdca" title="Checks all the reduction progresses and will remove any that have completed. This is designed to be c..." alt="" coords="1100,1302,1261,1358"/>
<area shape="rect" href="namespacereduction__inter__io__mod.html#a392694a236f09728ae9e72400017d606" title="Helper function to retrieve the reduction progress from a mapentry." alt="" coords="1351,1186,1513,1242"/>
<area shape="rect" href="namespacempi__communication__mod.html#a6ed06ee79c19ff1f57a344de48e53806" title="Waits for a specific MPI request to complete, either by managing thread safety and interleaving or ju..." alt="" coords="1347,1651,1517,1692"/>
<area shape="rect" href="namespacereduction__inter__io__mod.html#a77d19aa56a2f87228010cfc74bf7677c" title="Locates a specific reduction progress based upon the timestep, operator and field name." alt="" coords="1362,567,1502,623"/>
<area shape="rect" href="namespacereduction__inter__io__mod.html#a58c1e46c1eea51c17d72cd35b75b86b9" title="Generates the lookup key that is used for the map storage of reduction progresses." alt="" coords="1573,639,1770,680"/>
<area shape="rect" href="namespacereduction__inter__io__mod.html#a458a37210e06eb9d9b370eee7be082ec" title="Handles the situation where collective communication for a specific reduction has completed across al..." alt="" coords="1591,2022,1751,2078"/>
<area shape="rect" href="namespacempi__communication__mod.html#aaec64bef427565b6e469af564d9d32d6" title="Registers a request for receiving a command from any MONC process on the command channel." alt="" coords="1340,1819,1524,1860"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_ada1b8581f80d696dc8aa636405c73aea_icgraph.png" border="0" usemap="#anamespaceio__server__mod_ada1b8581f80d696dc8aa636405c73aea_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_ada1b8581f80d696dc8aa636405c73aea_icgraph" id="anamespaceio__server__mod_ada1b8581f80d696dc8aa636405c73aea_icgraph">
<area shape="rect" title="Awaits a command or shutdown from MONC processes and other IO servers." alt="" coords="244,5,388,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,13,196,39"/>
</map>
</div>

</div>
</div>
<a id="ae9d8dbafb475aaceb37d8a332c238448"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9d8dbafb475aaceb37d8a332c238448">&#9670;&nbsp;</a></span>check_for_condi_conflict()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::check_for_condi_conflict </td>
          <td>(</td>
          <td class="paramtype">character, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>raw_contents</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcollections__mod_1_1hashmap__type.html">hashmap_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>options_database</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handle potential conditional diagnostics conflict Provides a more helpful error in the case where conditional diagnostics are requested as output, but their components are not enabled. We check this by searching the io_xml_configuration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">raw_contents,intended</td><td>to be the io_xml_configuration character array </td></tr>
    <tr><td class="paramname">options_database</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00145">145</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordtype">character</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: raw_contents</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordtype">type</span>(hashmap_type), <span class="keywordtype">intent(inout)</span> :: options_database</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">character(len=size(raw_contents))</span> :: string_to_process</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">if</span> (.not. options_get_logical(options_database, <span class="stringliteral">&quot;conditional_diagnostics_column_enabled&quot;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="keywordflow">do</span> i=1, <span class="keyword">size</span>(raw_contents)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        string_to_process(i:i)=raw_contents(i)</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordflow">if</span> (index(string_to_process,<span class="stringliteral">&quot;CondDiags_&quot;</span>) .ne. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, &amp;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="stringliteral">&quot;Conditional diagnostics are DISABLED but requested via xml.  Enable or remove request to resolve.&quot;</span>)</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_ae9d8dbafb475aaceb37d8a332c238448_cgraph.png" border="0" usemap="#anamespaceio__server__mod_ae9d8dbafb475aaceb37d8a332c238448_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_ae9d8dbafb475aaceb37d8a332c238448_cgraph" id="anamespaceio__server__mod_ae9d8dbafb475aaceb37d8a332c238448_cgraph">
<area shape="rect" title="Handle potential conditional diagnostics conflict Provides a more helpful error in the case where con..." alt="" coords="5,48,153,89"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="205,19,347,46"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#aa3f0213d8028773523e6194a0ddf8e18" title="Retrieves a logical value from the database that matches the provided key." alt="" coords="201,77,351,119"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="399,5,565,47"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#a13bbeb6272c82308e3d4a42f7c36c862" title="Determines whether a specific options key exists in the database or not, if it doesn&#39;t then this resu..." alt="" coords="407,70,557,126"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#ab4f16a670bed755586806647da3cfa8d" title="Gets a key corresponding to the correct options key and index combination." alt="" coords="403,149,561,191"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#a4b187d310f786ed3c207a3060e09b156" title="Determines whether a specific key is in the database." alt="" coords="613,77,763,119"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_ae9d8dbafb475aaceb37d8a332c238448_icgraph.png" border="0" usemap="#anamespaceio__server__mod_ae9d8dbafb475aaceb37d8a332c238448_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_ae9d8dbafb475aaceb37d8a332c238448_icgraph" id="anamespaceio__server__mod_ae9d8dbafb475aaceb37d8a332c238448_icgraph">
<area shape="rect" title="Handle potential conditional diagnostics conflict Provides a more helpful error in the case where con..." alt="" coords="244,5,392,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,13,196,39"/>
</map>
</div>

</div>
</div>
<a id="a1067b04bf298bdec22d1c55144f3a8d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1067b04bf298bdec22d1c55144f3a8d5">&#9670;&nbsp;</a></span>free_individual_registered_monc_aspects()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::free_individual_registered_monc_aspects</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Frees up the memory associated with individual registered MONCs. This is done at the end for all MONCs as we can't deallocate dynamically in a threaded environment without excessive ordering and locking in case some data processing is queued or in progress. </p>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00250">250</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordtype">integer</span> :: i, specific_monc_data_type</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordtype">type</span>(iterator_type) :: types_iterator</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">do</span> i=1, <span class="keyword">size</span>(io_configuration%registered_moncs)</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      types_iterator=c_get_iterator(io_configuration%registered_moncs(i)%registered_monc_types)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(types_iterator))</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        specific_monc_data_type=c_get_integer(c_next_mapentry(types_iterator))</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keyword">call </span>free_mpi_type(specific_monc_data_type)</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="keywordflow">      end do</span>      </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(io_configuration%registered_moncs(i)%field_start_locations)) &amp;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;           <span class="keyword">deallocate</span>(io_configuration%registered_moncs(i)%field_start_locations)</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(io_configuration%registered_moncs(i)%field_end_locations)) &amp;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;           <span class="keyword">deallocate</span>(io_configuration%registered_moncs(i)%field_end_locations)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(io_configuration%registered_moncs(i)%definition_names)) &amp;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;           <span class="keyword">deallocate</span>(io_configuration%registered_moncs(i)%definition_names)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(io_configuration%registered_moncs(i)%dimensions)) <span class="keyword">deallocate</span>(io_configuration%registered_moncs(i)%dimensions)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a1067b04bf298bdec22d1c55144f3a8d5_cgraph.png" border="0" usemap="#anamespaceio__server__mod_a1067b04bf298bdec22d1c55144f3a8d5_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_a1067b04bf298bdec22d1c55144f3a8d5_cgraph" id="anamespaceio__server__mod_a1067b04bf298bdec22d1c55144f3a8d5_cgraph">
<area shape="rect" title="Frees up the memory associated with individual registered MONCs. This is done at the end for all MONC..." alt="" coords="5,5,152,61"/>
<area shape="rect" href="namespacempi__communication__mod.html#ae9569a173fd13c6772b5dfc8495c715b" title="Frees an MPI type, used in clean up." alt="" coords="200,13,371,54"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a1067b04bf298bdec22d1c55144f3a8d5_icgraph.png" border="0" usemap="#anamespaceio__server__mod_a1067b04bf298bdec22d1c55144f3a8d5_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_a1067b04bf298bdec22d1c55144f3a8d5_icgraph" id="anamespaceio__server__mod_a1067b04bf298bdec22d1c55144f3a8d5_icgraph">
<area shape="rect" title="Frees up the memory associated with individual registered MONCs. This is done at the end for all MONC..." alt="" coords="244,5,391,61"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,20,196,47"/>
</map>
</div>

</div>
</div>
<a id="aefce42fc11a68cb3783f1eb0f2c18610"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefce42fc11a68cb3783f1eb0f2c18610">&#9670;&nbsp;</a></span>get_monc_information_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::get_monc_information_data </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>source</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves MONC information data, this is sent by MONC (and received) regardless, but only actioned if the data has not already been set. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>MONC source process </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00468">468</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: source</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordtype">character</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: buffer</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span> :: q_field_name, cd_field_name</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordtype">integer</span> :: buffer_size, z_size, num_q_fields, n, current_point, recv_count</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordtype">type</span>(data_sizing_description_type) :: field_description</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: dreal</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordtype">logical</span> :: field_found</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    z_size=c_get_integer(io_configuration%dimension_sizing, <span class="stringliteral">&quot;z&quot;</span>)</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    num_q_fields=c_get_integer(io_configuration%dimension_sizing, <span class="stringliteral">&quot;qfields&quot;</span>)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    buffer_size=(kind(dreal)*z_size)*2 + (string_length * num_q_fields) &amp;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                 + 2*ncond*string_length + 2*ndiag*string_length </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keyword">allocate</span>(buffer(buffer_size))</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    recv_count=data_receive(mpi_byte, buffer_size, source, buffer)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">if</span> (.not. io_configuration%general_info_set) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(io_configuration%general_info_mutex))</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordflow">if</span> (.not. io_configuration%general_info_set) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        io_configuration%general_info_set=.true.</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keyword">allocate</span>(io_configuration%zn_field(z_size))</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keyword">allocate</span>(io_configuration%z_field(z_size))</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        io_configuration%zn_field=transfer(buffer(1:kind(dreal)*z_size), io_configuration%zn_field)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        current_point=(kind(dreal)*z_size)</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keywordflow">if</span> (num_q_fields .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;          <span class="keywordflow">do</span> n=1, num_q_fields</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            q_field_name=transfer(buffer(current_point+1:current_point+string_length), q_field_name)</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            current_point=current_point+string_length</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keyword">call </span>replace_character(q_field_name, <span class="stringliteral">&quot; &quot;</span>, <span class="stringliteral">&quot;_&quot;</span>)</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="keyword">call </span>c_add_string(io_configuration%q_field_names, q_field_name)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        io_configuration%z_field=transfer(buffer(current_point+1:current_point+kind(dreal)*z_size), &amp;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                                          io_configuration%z_field)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        current_point=current_point+(kind(dreal)*z_size)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="keywordflow">do</span> n=1,ncond</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;          cond_request(n)=transfer(buffer(current_point+1:current_point+string_length), cd_field_name)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;          current_point=current_point+string_length</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;          cond_long(n)=transfer(buffer(current_point+1:current_point+string_length), cd_field_name)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;          current_point=current_point+string_length</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">do</span> n=1,ndiag</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;          diag_request(n)=transfer(buffer(current_point+1:current_point+string_length), cd_field_name)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;          current_point=current_point+string_length</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          diag_long(n)=transfer(buffer(current_point+1:current_point+string_length), cd_field_name)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;          current_point=current_point+string_length</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keyword">call </span>provide_q_field_names_to_writer_federator(io_configuration%q_field_names)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(io_configuration%general_info_mutex))</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keyword">deallocate</span>(buffer)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_aefce42fc11a68cb3783f1eb0f2c18610_cgraph.png" border="0" usemap="#anamespaceio__server__mod_aefce42fc11a68cb3783f1eb0f2c18610_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_aefce42fc11a68cb3783f1eb0f2c18610_cgraph" id="anamespaceio__server__mod_aefce42fc11a68cb3783f1eb0f2c18610_cgraph">
<area shape="rect" title="Retrieves MONC information data, this is sent by MONC (and received) regardless, but only actioned if..." alt="" coords="5,257,169,298"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="893,42,1048,83"/>
<area shape="rect" href="namespacempi__communication__mod.html#aa9da81a3b60ef8507b3eabdbd19a8f89" title="Awaits some data on the data channel. This is of the type, size from the source provided and can eith..." alt="" coords="217,141,388,182"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="889,254,1052,295"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="889,134,1052,175"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a468cf6121ebcfc23b1389528744d998c" title="Provides the Q field names to the write federator, this is required as on initialisation we don&#39;t kno..." alt="" coords="223,340,383,396"/>
<area shape="rect" href="namespacestring__utils__mod.html#ad8b27e4313b52162f03c809668954104" title="Replaces all occurances of a character in a string with another character." alt="" coords="220,419,385,461"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="1100,49,1243,76"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1291,42,1457,83"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="663,173,833,214"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="663,42,833,83"/>
<area shape="rect" href="namespacempi__communication__mod.html#a6ed06ee79c19ff1f57a344de48e53806" title="Waits for a specific MPI request to complete, either by managing thread safety and interleaving or ju..." alt="" coords="436,110,607,151"/>
<area shape="rect" href="namespacempi__communication__mod.html#aee6d81060fcad11a466f823627234e7c" title="Pauses for a specific number of ms to allow for MPI interleaving, this is to avoid starvation." alt="" coords="655,107,841,149"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9379ee9a358faa87a63d2f2459f202b9" title="Retrieves the index of the next writer which uses a specific field. If none is found then returns fal..." alt="" coords="449,340,593,396"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_aefce42fc11a68cb3783f1eb0f2c18610_icgraph.png" border="0" usemap="#anamespaceio__server__mod_aefce42fc11a68cb3783f1eb0f2c18610_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_aefce42fc11a68cb3783f1eb0f2c18610_icgraph" id="anamespaceio__server__mod_aefce42fc11a68cb3783f1eb0f2c18610_icgraph">
<area shape="rect" title="Retrieves MONC information data, this is sent by MONC (and received) regardless, but only actioned if..." alt="" coords="820,5,984,47"/>
<area shape="rect" href="namespaceio__server__mod.html#a5e5c9b6be433b4b2bebbfa01ddf0bec0" title="Initialise the sizing of data definitions from a MONC process. The IO server determines,..." alt="" coords="641,5,772,47"/>
<area shape="rect" href="namespaceio__server__mod.html#a95f289d7a2a91f45be0accb5328cc178" title="Handles registration from some MONC process. The source process sends some data description to this I..." alt="" coords="443,5,593,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="244,5,395,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,13,196,39"/>
</map>
</div>

</div>
</div>
<a id="ab843eee74fe31492952c1c88304730d7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab843eee74fe31492952c1c88304730d7">&#9670;&nbsp;</a></span>handle_command_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::handle_command_message </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character, dimension(:), intent(inout), allocatable&#160;</td>
          <td class="paramname"><em>data_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called to handle a specific command that has been recieved. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">command</td><td>The command which has been received from some process </td></tr>
    <tr><td class="paramname">source</td><td>The PID of the source (MONC) process </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00218">218</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: command, source</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordtype">character</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">intent(inout)</span> :: data_buffer</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">if</span> (command == register_command) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="keyword">call </span>threadpool_start_thread(handle_monc_registration, (/ source /))</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command == deregister_command) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <span class="keyword">call </span>threadpool_start_thread(handle_deregistration_command, (/ source /))</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command == inter_io_communication) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keyword">call </span>threadpool_start_thread(handle_inter_io_communication_command, (/ source /), data_buffer=data_buffer)      </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <span class="keyword">deallocate</span>(data_buffer)</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command .ge. data_command_start) <span class="keywordflow">then</span>      </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keyword">call </span>pull_back_data_message_and_handle(source, command-data_command_start)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keywordflow">    end if</span>    </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_ab843eee74fe31492952c1c88304730d7_cgraph.png" border="0" usemap="#anamespaceio__server__mod_ab843eee74fe31492952c1c88304730d7_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_ab843eee74fe31492952c1c88304730d7_cgraph" id="anamespaceio__server__mod_ab843eee74fe31492952c1c88304730d7_cgraph">
<area shape="rect" title="Called to handle a specific command that has been recieved." alt="" coords="5,1160,156,1202"/>
<area shape="rect" href="namespaceio__server__mod.html#a08e13af9d8118b7f90eab2435fc2c086" title="Deregisteres a specific MONC source process." alt="" coords="1107,1076,1278,1118"/>
<area shape="rect" href="namespaceio__server__mod.html#a092b3e8e2be8304436b72ffa5e4955e8" title="Handles inter IO server communications." alt="" coords="204,1088,371,1144"/>
<area shape="rect" href="namespaceio__server__mod.html#a95f289d7a2a91f45be0accb5328cc178" title="Handles registration from some MONC process. The source process sends some data description to this I..." alt="" coords="212,815,363,856"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="629,1249,807,1305"/>
<area shape="rect" href="namespacethreadpool__mod.html#a66a9d51f29634430ca4ed121947b0132" title="Starts an idle thread from the pool to execute a specific procedure with some data...." alt="" coords="1343,2107,1523,2148"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="1579,902,1733,943"/>
<area shape="rect" href="namespaceforthread__mod.html#a9456090af3f2762f4f542d232fb7adc0" title=" " alt="" coords="1352,1119,1515,1160"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="1575,1879,1737,1920"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="1575,1306,1737,1347"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="1352,1302,1515,1343"/>
<area shape="rect" href="namespaceforthread__mod.html#ab60b7d18e1d948f6b63c6cb893fad182" title=" " alt="" coords="1352,1054,1515,1095"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#ae5be635b15f2c5670d91275e34c74105" title="A helper function to get the location of a MONC&#39;s configuration in the IO data structure." alt="" coords="1349,1236,1518,1278"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="1787,909,1930,936"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1980,902,2147,943"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#ae783b7b280960df234c0a0d715ff3f62" title="Extends the data definitions array from the current size to the current size + data size stride." alt="" coords="419,924,581,980"/>
<area shape="rect" href="namespaceforthread__mod.html#abe5eeb944b76d5a9578e1fbf646446ac" title=" " alt="" coords="419,222,581,263"/>
<area shape="rect" href="namespaceforthread__mod.html#ab29785b28c1d6bcf13e844b8d1230846" title=" " alt="" coords="419,407,581,448"/>
<area shape="rect" href="namespaceio__server__mod.html#a5e5c9b6be433b4b2bebbfa01ddf0bec0" title="Initialise the sizing of data definitions from a MONC process. The IO server determines,..." alt="" coords="435,287,565,328"/>
<area shape="rect" href="namespaceio__server__mod.html#af165fa2c9ad4d8d48537ee997432fdaa" title="Sends the data and field descriptions to the MONC process that just registered with the IO server." alt="" coords="1104,858,1281,899"/>
<area shape="rect" href="namespacempi__communication__mod.html#a272f44aa1ed340d3e6efd306d075100b" title="Waits for all MPI requests to complete, either by managing thread safety and interleaving or just a c..." alt="" coords="1107,792,1279,834"/>
<area shape="rect" href="namespacempi__communication__mod.html#a94ec3fc73dd4cba3a1aa1b09f4d8e0af" title="Builds the MPI type that corresponds to the data which will be received from a specific MONC process...." alt="" coords="1107,224,1278,266"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a5c91dd79c12db74da24c9e318d750f02" title="Look up the data description that corresponds to a specific field keyed by its name." alt="" coords="1359,86,1507,142"/>
<area shape="rect" href="namespacempi__communication__mod.html#aa9da81a3b60ef8507b3eabdbd19a8f89" title="Awaits some data on the data channel. This is of the type, size from the source provided and can eith..." alt="" coords="865,756,1035,798"/>
<area shape="rect" href="namespaceio__server__mod.html#aefce42fc11a68cb3783f1eb0f2c18610" title="Retrieves MONC information data, this is sent by MONC (and received) regardless, but only actioned if..." alt="" coords="636,582,800,623"/>
<area shape="rect" href="namespaceio__server__mod.html#a9bd8b641a945346aa2cfe1813bb3af34" title="Handles the provided local MONC dimension and data layout information." alt="" coords="1093,28,1292,70"/>
<area shape="rect" href="namespaceio__server__mod.html#a75db617985efd39b9db284a0dc512d34" title="Registers with the writer federator the set of fields (prognostic and diagnostic) that are available,..." alt="" coords="635,276,801,332"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a84bf9d6a41f5f7fea53b4b62c166a77f" title="Appends the MPI datatype details to the block counts, old types and offsets arrays...." alt="" coords="1356,224,1511,266"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="1348,858,1519,899"/>
<area shape="rect" href="namespaceio__server__client__mod.html#ae78f9ba9a1846fdf7a7b873057b06a36" title="Provides the type extents of the types that we are using in construction of the MPI data type...." alt="" coords="1341,290,1526,331"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="1348,727,1519,768"/>
<area shape="rect" href="namespacempi__communication__mod.html#a6ed06ee79c19ff1f57a344de48e53806" title="Waits for a specific MPI request to complete, either by managing thread safety and interleaving or ju..." alt="" coords="1107,727,1278,768"/>
<area shape="rect" href="namespacempi__communication__mod.html#aee6d81060fcad11a466f823627234e7c" title="Pauses for a specific number of ms to allow for MPI interleaving, this is to avoid starvation." alt="" coords="1340,792,1527,834"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a468cf6121ebcfc23b1389528744d998c" title="Provides the Q field names to the write federator, this is required as on initialisation we don&#39;t kno..." alt="" coords="870,574,1030,630"/>
<area shape="rect" href="namespacestring__utils__mod.html#ad8b27e4313b52162f03c809668954104" title="Replaces all occurances of a character in a string with another character." alt="" coords="867,458,1033,499"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a5b55ebfb6f9bf71a42f716fc9d6dad8c" title="Determines the diagnostics fields that are available based upon the input MONC fields on registration..." alt="" coords="855,196,1045,252"/>
<area shape="rect" href="namespacewriter__federator__mod.html#aff9121d09086fc4867afe57e0262f4a0" title="Informs the writer federator that specific fields are present and should be reflected in the diagnost..." alt="" coords="869,276,1031,332"/>
<area shape="rect" href="namespaceforthread__mod.html#ace3f16636de24b1fc62de549d67476dc" title=" " alt="" coords="1352,1852,1515,1894"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="875,1548,1025,1590"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="1109,1722,1276,1763"/>
<area shape="rect" href="namespaceforthread__mod.html#acdd75cd6d34e33c09165306eef31f159" title=" " alt="" coords="1575,1966,1737,2007"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a5c407f4433b36fa8e9fefda57fc32252" title=" " alt="" coords="1112,1396,1273,1452"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a471607fc4ee8c3a1ce66d31dc68e5522" title="Entry point into the diagnostics federator this runs the diagnostics, executing the defined rules bas..." alt="" coords="1116,1642,1269,1698"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1106,1786,1279,1842"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a487e87f6d515f5d7ae565b5553b8eb5b" title="Retrieves a specific data definition from the configuration which matches a key." alt="" coords="1096,1578,1289,1619"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="1361,1552,1506,1594"/>
<area shape="rect" href="namespacedata__utils__mod.html#a56c7a3c668c3abef4e4d43fea2f73b5b" title="Retrieves a single integer element (scalar) from the data dump." alt="" coords="1342,1670,1525,1711"/>
<area shape="rect" href="namespacedata__utils__mod.html#a29da67d2bfdfc17765e1105f9295c6be" title="Retrieves a single logical element (scalar) from the data dump." alt="" coords="1343,1735,1523,1776"/>
<area shape="rect" href="namespacethreadpool__mod.html#a79c1c7faaf752ec1681acc2bfcce7e16" title="Finds an idle thread, if one is not available then will block until one becomes free." alt="" coords="1586,2107,1726,2148"/>
<area shape="rect" href="namespacethreadpool__mod.html#a46884c3dda1e63c2cbaffb985835e64b" title="Specifically gets the index of the next idle thread or &#45;1 if they are all busy. This starts from a ne..." alt="" coords="1785,2107,1932,2148"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_ab843eee74fe31492952c1c88304730d7_icgraph.png" border="0" usemap="#anamespaceio__server__mod_ab843eee74fe31492952c1c88304730d7_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_ab843eee74fe31492952c1c88304730d7_icgraph" id="anamespaceio__server__mod_ab843eee74fe31492952c1c88304730d7_icgraph">
<area shape="rect" title="Called to handle a specific command that has been recieved." alt="" coords="244,5,395,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,13,196,39"/>
</map>
</div>

</div>
</div>
<a id="a96c2285d5c9b5badb426a0e065abdf4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96c2285d5c9b5badb426a0e065abdf4a">&#9670;&nbsp;</a></span>handle_data_message()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::handle_data_message </td>
          <td>(</td>
          <td class="paramtype">integer, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>arguments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character, dimension(:), intent(inout), optional, allocatable&#160;</td>
          <td class="paramname"><em>data_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handles the command for data download from a specific process. This will allocate the receive buffer and then call to get the data. Once it has been received then the data is run against handling rules. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arguments,element</td><td>1 is the source &amp; element 2 is the data_set </td></tr>
    <tr><td class="paramname">data_buffer</td><td>The actual data from MONC read from the data channel </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00322">322</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: arguments</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordtype">character</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">optional</span> :: data_buffer</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordtype">integer</span> :: monc_location, data_set, source, matched_datadefn_index</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    source=arguments(1)</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    data_set=arguments(2)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_rdlock(monc_registration_lock))</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    monc_location=get_monc_location(io_configuration, source)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(io_configuration%registered_moncs(monc_location)%active_mutex))</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    io_configuration%registered_moncs(monc_location)%active_threads=&amp;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;         io_configuration%registered_moncs(monc_location)%active_threads+1</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(io_configuration%registered_moncs(monc_location)%active_mutex))</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    matched_datadefn_index=retrieve_data_definition(io_configuration, &amp;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;         io_configuration%registered_moncs(monc_location)%definition_names(data_set))</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> (matched_datadefn_index .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keyword">call </span>inform_writer_federator_time_point(io_configuration, source, data_set, data_buffer)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keyword">call </span>pass_fields_to_diagnostics_federator(io_configuration, source, data_set, data_buffer)</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keyword">call </span>provide_monc_data_to_writer_federator(io_configuration, source, data_set, data_buffer)</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keyword">call </span>check_writer_for_trigger(io_configuration, source, data_set, data_buffer)</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">log_warn</a>, <span class="stringliteral">&quot;IO server can not find matching data definition with name &quot;</span>&amp;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;           //io_configuration%registered_moncs(monc_location)%definition_names(data_set))</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="keywordflow">    end if</span>    </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(io_configuration%registered_moncs(monc_location)%active_mutex))</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    io_configuration%registered_moncs(monc_location)%active_threads=&amp;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;         io_configuration%registered_moncs(monc_location)%active_threads-1</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_cond_signal(io_configuration%registered_moncs(monc_location)%deactivate_condition_variable))</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(io_configuration%registered_moncs(monc_location)%active_mutex))</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_unlock(monc_registration_lock))</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a96c2285d5c9b5badb426a0e065abdf4a_cgraph.png" border="0" usemap="#anamespaceio__server__mod_a96c2285d5c9b5badb426a0e065abdf4a_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_a96c2285d5c9b5badb426a0e065abdf4a_cgraph" id="anamespaceio__server__mod_a96c2285d5c9b5badb426a0e065abdf4a_cgraph">
<area shape="rect" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="5,419,156,460"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="975,195,1130,236"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="1193,785,1336,812"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="217,478,384,519"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="971,316,1134,358"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="971,446,1134,487"/>
<area shape="rect" href="namespaceforthread__mod.html#acdd75cd6d34e33c09165306eef31f159" title=" " alt="" coords="219,360,382,402"/>
<area shape="rect" href="namespaceforthread__mod.html#ace3f16636de24b1fc62de549d67476dc" title=" " alt="" coords="474,112,637,154"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="474,178,637,219"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#ae5be635b15f2c5670d91275e34c74105" title="A helper function to get the location of a MONC&#39;s configuration in the IO data structure." alt="" coords="216,543,385,584"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a5c407f4433b36fa8e9fefda57fc32252" title=" " alt="" coords="220,281,381,337"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a471607fc4ee8c3a1ce66d31dc68e5522" title="Entry point into the diagnostics federator this runs the diagnostics, executing the defined rules bas..." alt="" coords="224,1417,377,1473"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="214,696,387,752"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a487e87f6d515f5d7ae565b5553b8eb5b" title="Retrieves a specific data definition from the configuration which matches a key." alt="" coords="204,2004,397,2046"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1384,778,1551,819"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="483,360,628,402"/>
<area shape="rect" href="namespacedata__utils__mod.html#a56c7a3c668c3abef4e4d43fea2f73b5b" title="Retrieves a single integer element (scalar) from the data dump." alt="" coords="464,608,647,650"/>
<area shape="rect" href="namespacedata__utils__mod.html#a29da67d2bfdfc17765e1105f9295c6be" title="Retrieves a single logical element (scalar) from the data dump." alt="" coords="465,674,645,715"/>
<area shape="rect" href="namespacedata__utils__mod.html#ae97bbc021128cf42a987facc1c1e7fee" title="Retreives a scalar real with a corresponding key from the raw data dump." alt="" coords="473,478,637,519"/>
<area shape="rect" href="namespacedata__utils__mod.html#ac64f12e860548e106a50f9be09a7bcb8" title=" " alt="" coords="492,543,619,584"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="741,224,885,266"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a27f423ed92a9bd09acce659a23e3defa" title="Registers a pending file write which will be actioned later on." alt="" coords="722,290,903,331"/>
<area shape="rect" href="namespacedata__utils__mod.html#ab248d898201d14574800dd321c8a5dde" title="Retrieves a single integer element (scalar) from the data dump." alt="" coords="745,654,880,695"/>
<area shape="rect" href="namespacedata__utils__mod.html#a07f32dc1887f01ab3b818c89dd5e34f7" title="Retrieves a single logical element (scalar) from the data dump." alt="" coords="745,719,880,760"/>
<area shape="rect" href="namespacedata__utils__mod.html#a15c2c4edba1f23d89fd83d173b54774d" title="Retreives a scalar real with a corresponding key from the raw data dump." alt="" coords="745,588,880,630"/>
<area shape="rect" href="namespaceforthread__mod.html#ab60b7d18e1d948f6b63c6cb893fad182" title=" " alt="" coords="474,295,637,336"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#adcd05cf714b11815d87be556954d5d35" title="Checks all pending activities against the completed fields and runs them if the required fields are n..." alt="" coords="468,1193,643,1249"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a3a57c70da8b58d633fdafedc4010719a" title="Checks the outstanding fields of a time step entry against the data recieved from MONC and moves any ..." alt="" coords="471,1417,639,1473"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#aee7c2e6b24616cd79159ff8cdec96e0e" title="Cleans the diagnostic states if required (based on the timestep period)" alt="" coords="477,1522,634,1578"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#afb86d57115a32c34cdfb03dacf573e05" title="Locates or registers a new (if it does not exist) time step entry based upon the timestep and source ..." alt="" coords="481,1718,629,1774"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a9cb374b99d120fa5f27485256d6349e0" title="Retrieves the diagnostics list (each MONC source) at a specific timestep." alt="" coords="977,1848,1128,1904"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ac72eade80d986df91f8008af3873a22e" title="Issues any inter io communucation calls that are appropriate based upon the data recieved from MONC." alt="" coords="445,1352,665,1394"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a6dd07cccfe88be5418168241b19f2b10" title="Determines whether the fields required for an activity are available so that activity can be run." alt="" coords="726,1033,899,1089"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a10c82e5e43f4e3f306baf250bbda6df5" title="Generates a unique key for an activity within a diagnostic, which is unique amongst all diagnostics a..." alt="" coords="733,1193,892,1249"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ab25878578b48aaac7c3841a560b67497" title="Handles completion of a diagnostic calculation and will then pass this onto interested parties." alt="" coords="731,1113,895,1169"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ae02876dfa818535426c6d0be66696404" title="Handles the completion of the operator." alt="" coords="737,953,889,1009"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a137b3e2865e5dd85e2352afbf6c12de6" title="Performs the actual inter IO communication by calling out to the appropriate inter IO module." alt="" coords="736,1273,889,1329"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a7951029c07b91b6398c93636f9442dfa" title="Retrieves the next activity in a collection being iterated over by an iterator." alt="" coords="721,1352,904,1394"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ac9a188fde5ea81a9d9b3e9ced68b058a" title="Retrieves the next MONC timestep entry from the all diagnostics based upon a collections iterator." alt="" coords="960,1548,1145,1604"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ab9ef4878802571ca765b6fd34b90607b" title="Retrieves a value from the communicated MONC data. If this was an integer then converts to a real." alt="" coords="738,1417,887,1473"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ae91e4630f78c985e6cf8a9815e313aee" title="Deallocates all the diagnostics at a specific timestep, this removes all the individual MONC timestep..." alt="" coords="717,1613,909,1669"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a7b2a93ef33d3a40c357b408e116d3d75" title="Retrieves the all diagnostics at a specific timestep from its map entry." alt="" coords="725,1496,901,1538"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a94a3c0584d150d32aaf9c066295cd400" title="Creates a timestep entry and processes all members, determining activities their required fields etc...." alt="" coords="719,1758,907,1799"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a650167911efdc3cde6e7e22650dce8a3" title="Finds or adds diagnostics by timestep. This is used to maintain a list of all diagnostic entries for ..." alt="" coords="713,1822,912,1878"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a7bebd63c0c83c5f7428c276a22d2f9e2" title="Retrieves the timestep at a specific timestep and source MONC." alt="" coords="727,1692,898,1734"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#af479a611799a55972a738e3da695f0fe" title="Retrieves a value from the communicated MONC data. If this was an integer then converts to a real." alt="" coords="481,790,630,846"/>
<area shape="rect" href="namespacewriter__federator__mod.html#ac6aefade0899178fd2ba9c7c723af5d1" title="Determines whether a field is split on Q or not." alt="" coords="483,870,627,911"/>
<area shape="rect" href="namespacewriter__federator__mod.html#ab10af49e026b9e11d113f702bb7f3113" title="Determines whether a field is used by the writer federator or not." alt="" coords="474,934,637,990"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="737,406,888,462"/>
<area shape="rect" href="namespacedata__utils__mod.html#ae3451c3a141c979be42ec6dc9dfd3010" title="Retreives an array of doubles with a corresponding key from the raw data dump. The size depends on th..." alt="" coords="725,836,900,878"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a96c2285d5c9b5badb426a0e065abdf4a_icgraph.png" border="0" usemap="#anamespaceio__server__mod_a96c2285d5c9b5badb426a0e065abdf4a_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_a96c2285d5c9b5badb426a0e065abdf4a_icgraph" id="anamespaceio__server__mod_a96c2285d5c9b5badb426a0e065abdf4a_icgraph">
<area shape="rect" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="668,13,819,54"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="443,5,620,61"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="244,13,395,54"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,20,196,47"/>
</map>
</div>

</div>
</div>
<a id="a08e13af9d8118b7f90eab2435fc2c086"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08e13af9d8118b7f90eab2435fc2c086">&#9670;&nbsp;</a></span>handle_deregistration_command()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::handle_deregistration_command </td>
          <td>(</td>
          <td class="paramtype">integer, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>arguments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character, dimension(:), intent(inout), optional, allocatable&#160;</td>
          <td class="paramname"><em>data_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Deregisteres a specific MONC source process. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>The MONC process PID that we are deregistering </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00272">272</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: arguments</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordtype">character</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">optional</span> :: data_buffer</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordtype">integer</span> :: monc_location, source</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    source=arguments(1)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    monc_location=get_monc_location(io_configuration, source)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(io_configuration%registered_moncs(monc_location)%active_mutex))</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (io_configuration%registered_moncs(monc_location)%active_threads .gt. 0)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_cond_wait(io_configuration%registered_moncs(monc_location)%deactivate_condition_variable,&amp;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;             io_configuration%registered_moncs(monc_location)%active_mutex))</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(io_configuration%registered_moncs(monc_location)%active_mutex))</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_wrlock(monc_registration_lock))</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    io_configuration%active_moncs=io_configuration%active_moncs-1</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (io_configuration%active_moncs==0) contine_poll_messages=.false.</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_unlock(monc_registration_lock))</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a08e13af9d8118b7f90eab2435fc2c086_cgraph.png" border="0" usemap="#anamespaceio__server__mod_a08e13af9d8118b7f90eab2435fc2c086_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_a08e13af9d8118b7f90eab2435fc2c086_cgraph" id="anamespaceio__server__mod_a08e13af9d8118b7f90eab2435fc2c086_cgraph">
<area shape="rect" title="Deregisteres a specific MONC source process." alt="" coords="5,201,176,243"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="231,5,386,47"/>
<area shape="rect" href="namespaceforthread__mod.html#a9456090af3f2762f4f542d232fb7adc0" title=" " alt="" coords="227,71,390,112"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="227,136,390,177"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="227,201,390,243"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="227,267,390,308"/>
<area shape="rect" href="namespaceforthread__mod.html#ab60b7d18e1d948f6b63c6cb893fad182" title=" " alt="" coords="227,332,390,373"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#ae5be635b15f2c5670d91275e34c74105" title="A helper function to get the location of a MONC&#39;s configuration in the IO data structure." alt="" coords="224,397,393,439"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="441,13,584,39"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="632,5,799,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a08e13af9d8118b7f90eab2435fc2c086_icgraph.png" border="0" usemap="#anamespaceio__server__mod_a08e13af9d8118b7f90eab2435fc2c086_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_a08e13af9d8118b7f90eab2435fc2c086_icgraph" id="anamespaceio__server__mod_a08e13af9d8118b7f90eab2435fc2c086_icgraph">
<area shape="rect" title="Deregisteres a specific MONC source process." alt="" coords="443,5,613,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="244,5,395,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,13,196,39"/>
</map>
</div>

</div>
</div>
<a id="a092b3e8e2be8304436b72ffa5e4955e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a092b3e8e2be8304436b72ffa5e4955e8">&#9670;&nbsp;</a></span>handle_inter_io_communication_command()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::handle_inter_io_communication_command </td>
          <td>(</td>
          <td class="paramtype">integer, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>arguments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character, dimension(:), intent(inout), optional, allocatable&#160;</td>
          <td class="paramname"><em>data_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handles inter IO server communications. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arguments</td><td>The thread based arguments, this is the index of the inter IO server description </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00236">236</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: arguments</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">character</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">optional</span> :: data_buffer</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordtype">integer</span> :: source</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    source=arguments(1)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keyword">call </span>io_configuration%inter_io_communications(source)%handling_procedure(io_configuration, data_buffer, source)</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a092b3e8e2be8304436b72ffa5e4955e8_icgraph.png" border="0" usemap="#anamespaceio__server__mod_a092b3e8e2be8304436b72ffa5e4955e8_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_a092b3e8e2be8304436b72ffa5e4955e8_icgraph" id="anamespaceio__server__mod_a092b3e8e2be8304436b72ffa5e4955e8_icgraph">
<area shape="rect" title="Handles inter IO server communications." alt="" coords="443,5,609,61"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="244,13,395,54"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,20,196,47"/>
</map>
</div>

</div>
</div>
<a id="a9bd8b641a945346aa2cfe1813bb3af34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bd8b641a945346aa2cfe1813bb3af34">&#9670;&nbsp;</a></span>handle_monc_dimension_information()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::handle_monc_dimension_information </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structio__server__client__mod_1_1data__sizing__description__type.html">data_sizing_description_type</a>), dimension(:)&#160;</td>
          <td class="paramname"><em>data_description</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__registered__monc__type.html">io_configuration_registered_monc_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>monc_defn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handles the provided local MONC dimension and data layout information. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data_description</td><td>The data descriptions sent over from MONC </td></tr>
    <tr><td class="paramname">monc_defn</td><td>The corresponding MONC definition data structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00562">562</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordtype">type</span>(io_configuration_registered_monc_type), <span class="keywordtype">intent(inout)</span> :: monc_defn</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordtype">type</span>(data_sizing_description_type), <span class="keywordtype">dimension(:)</span> :: data_description</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordtype">type</span>(data_sizing_description_type) :: field_description</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordtype">logical</span> :: field_found</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    field_found=get_data_description_from_name(data_description, local_sizes_key, field_description)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">if</span> (.not. field_found) <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Malformed MONC registration, no local size information&quot;</span>)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordflow">do</span> i=1,3</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      monc_defn%local_dim_sizes(i)=field_description%dim_sizes(i)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    field_found=get_data_description_from_name(data_description, local_start_points_key, field_description)</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">if</span> (.not. field_found) <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Malformed MONC registration, no local start point information&quot;</span>)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">do</span> i=1,3</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      monc_defn%local_dim_starts(i)=field_description%dim_sizes(i)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    field_found=get_data_description_from_name(data_description, local_end_points_key, field_description)</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> (.not. field_found) <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Malformed MONC registration, no local end point information&quot;</span>)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">do</span> i=1,3</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      monc_defn%local_dim_ends(i)=field_description%dim_sizes(i)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a9bd8b641a945346aa2cfe1813bb3af34_cgraph.png" border="0" usemap="#anamespaceio__server__mod_a9bd8b641a945346aa2cfe1813bb3af34_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_a9bd8b641a945346aa2cfe1813bb3af34_cgraph" id="anamespaceio__server__mod_a9bd8b641a945346aa2cfe1813bb3af34_cgraph">
<area shape="rect" title="Handles the provided local MONC dimension and data layout information." alt="" coords="5,46,204,87"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a5c91dd79c12db74da24c9e318d750f02" title="Look up the data description that corresponds to a specific field keyed by its name." alt="" coords="252,5,400,61"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="255,85,397,112"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="448,78,615,119"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a9bd8b641a945346aa2cfe1813bb3af34_icgraph.png" border="0" usemap="#anamespaceio__server__mod_a9bd8b641a945346aa2cfe1813bb3af34_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_a9bd8b641a945346aa2cfe1813bb3af34_icgraph" id="anamespaceio__server__mod_a9bd8b641a945346aa2cfe1813bb3af34_icgraph">
<area shape="rect" title="Handles the provided local MONC dimension and data layout information." alt="" coords="820,5,1019,47"/>
<area shape="rect" href="namespaceio__server__mod.html#a5e5c9b6be433b4b2bebbfa01ddf0bec0" title="Initialise the sizing of data definitions from a MONC process. The IO server determines,..." alt="" coords="641,5,772,47"/>
<area shape="rect" href="namespaceio__server__mod.html#a95f289d7a2a91f45be0accb5328cc178" title="Handles registration from some MONC process. The source process sends some data description to this I..." alt="" coords="443,5,593,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="244,5,395,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,13,196,39"/>
</map>
</div>

</div>
</div>
<a id="a95f289d7a2a91f45be0accb5328cc178"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95f289d7a2a91f45be0accb5328cc178">&#9670;&nbsp;</a></span>handle_monc_registration()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::handle_monc_registration </td>
          <td>(</td>
          <td class="paramtype">integer, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>arguments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character, dimension(:), intent(inout), optional, allocatable&#160;</td>
          <td class="paramname"><em>data_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handles registration from some MONC process. The source process sends some data description to this IO server which basically tells the IO server the size of the array datas (which might be different on different processes in the case of uneven decomposition.) Based upon this a communication (MPI) data type is constructed and the data size in bytes determined. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>The PID of the MONC process that is registering itself </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00364">364</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: arguments</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordtype">character</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">optional</span> :: data_buffer</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordtype">integer</span> :: configuration_send_request(2), ierr, number_data_definitions, this_monc_index, source</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    source=arguments(1)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    configuration_send_request=send_configuration_to_registree(source)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    number_data_definitions=io_configuration%number_of_data_definitions</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_wrlock(monc_registration_lock))</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    io_configuration%number_of_moncs=io_configuration%number_of_moncs+1</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    this_monc_index=io_configuration%number_of_moncs</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> (io_configuration%number_of_moncs .gt. <span class="keyword">size</span>(io_configuration%registered_moncs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;You have a high ratio of computational cores to IO servers, the limit is currently 100&quot;</span>)</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      <span class="comment">! The extension of the MONC registration array is broken as the pointers involved in the map does not get copied across</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <span class="comment">! we could manually do this, but that is for another day! If you need to extend these limits either increase the constants</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="comment">! or fix the extension, I don&#39;t think it will be too hard to fix the extension bit (copy the maps manually)</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <span class="keyword">call </span>extend_registered_moncs_array(io_configuration)      </div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    io_configuration%active_moncs=io_configuration%active_moncs+1</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_unlock(monc_registration_lock))</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keyword">call </span>c_put_integer(io_configuration%monc_to_index, conv_to_string(source), this_monc_index)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_init(io_configuration%registered_moncs(this_monc_index)%active_mutex, -1))</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_cond_init(&amp;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;         io_configuration%registered_moncs(this_monc_index)%deactivate_condition_variable, -1))</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    io_configuration%registered_moncs(this_monc_index)%active_threads=0</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    io_configuration%registered_moncs(this_monc_index)%source_id=source</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keyword">allocate</span>(io_configuration%registered_moncs(this_monc_index)%field_start_locations(number_data_definitions), &amp;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;         io_configuration%registered_moncs(this_monc_index)%field_end_locations(number_data_definitions), &amp;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;         io_configuration%registered_moncs(this_monc_index)%definition_names(number_data_definitions), &amp;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;         io_configuration%registered_moncs(this_monc_index)%dimensions(number_data_definitions))</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">! Wait for configuration to have been sent to registree</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keyword">call </span>waitall_for_mpi_requests(configuration_send_request, 2)</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keyword">call </span>init_data_definition(source, io_configuration%registered_moncs(this_monc_index))</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a95f289d7a2a91f45be0accb5328cc178_cgraph.png" border="0" usemap="#anamespaceio__server__mod_a95f289d7a2a91f45be0accb5328cc178_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_a95f289d7a2a91f45be0accb5328cc178_cgraph" id="anamespaceio__server__mod_a95f289d7a2a91f45be0accb5328cc178_cgraph">
<area shape="rect" title="Handles registration from some MONC process. The source process sends some data description to this I..." alt="" coords="5,283,156,325"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="1353,346,1508,387"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="1560,848,1703,875"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#ae783b7b280960df234c0a0d715ff3f62" title="Extends the data definitions array from the current size to the current size + data size stride." alt="" coords="204,105,367,161"/>
<area shape="rect" href="namespaceforthread__mod.html#abe5eeb944b76d5a9578e1fbf646446ac" title=" " alt="" coords="204,185,367,226"/>
<area shape="rect" href="namespaceforthread__mod.html#ab29785b28c1d6bcf13e844b8d1230846" title=" " alt="" coords="204,250,367,291"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="204,315,367,357"/>
<area shape="rect" href="namespaceforthread__mod.html#ab60b7d18e1d948f6b63c6cb893fad182" title=" " alt="" coords="204,381,367,422"/>
<area shape="rect" href="namespaceio__server__mod.html#a5e5c9b6be433b4b2bebbfa01ddf0bec0" title="Initialise the sizing of data definitions from a MONC process. The IO server determines,..." alt="" coords="220,750,351,791"/>
<area shape="rect" href="namespaceio__server__mod.html#af165fa2c9ad4d8d48537ee997432fdaa" title="Sends the data and field descriptions to the MONC process that just registered with the IO server." alt="" coords="879,405,1056,446"/>
<area shape="rect" href="namespacempi__communication__mod.html#a272f44aa1ed340d3e6efd306d075100b" title="Waits for all MPI requests to complete, either by managing thread safety and interleaving or just a c..." alt="" coords="881,222,1053,263"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1751,841,1917,882"/>
<area shape="rect" href="namespacempi__communication__mod.html#a94ec3fc73dd4cba3a1aa1b09f4d8e0af" title="Builds the MPI type that corresponds to the data which will be received from a specific MONC process...." alt="" coords="882,833,1053,874"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a5c91dd79c12db74da24c9e318d750f02" title="Look up the data description that corresponds to a specific field keyed by its name." alt="" coords="1134,899,1282,955"/>
<area shape="rect" href="namespacempi__communication__mod.html#aa9da81a3b60ef8507b3eabdbd19a8f89" title="Awaits some data on the data channel. This is of the type, size from the source provided and can eith..." alt="" coords="639,389,810,430"/>
<area shape="rect" href="namespaceio__server__mod.html#aefce42fc11a68cb3783f1eb0f2c18610" title="Retrieves MONC information data, this is sent by MONC (and received) regardless, but only actioned if..." alt="" coords="416,506,580,547"/>
<area shape="rect" href="namespaceio__server__mod.html#a9bd8b641a945346aa2cfe1813bb3af34" title="Handles the provided local MONC dimension and data layout information." alt="" coords="868,965,1067,1006"/>
<area shape="rect" href="namespaceio__server__mod.html#a75db617985efd39b9db284a0dc512d34" title="Registers with the writer federator the set of fields (prognostic and diagnostic) that are available,..." alt="" coords="415,743,581,799"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a84bf9d6a41f5f7fea53b4b62c166a77f" title="Appends the MPI datatype details to the block counts, old types and offsets arrays...." alt="" coords="1131,769,1285,810"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="1123,346,1293,387"/>
<area shape="rect" href="namespaceio__server__client__mod.html#ae78f9ba9a1846fdf7a7b873057b06a36" title="Provides the type extents of the types that we are using in construction of the MPI data type...." alt="" coords="1115,834,1301,875"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="1123,411,1293,453"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a8d816b12c995d04f289de4f8d03a4d3d" title="Gets the MPI datatype from out internal representation of the field data type (as in the configuratio..." alt="" coords="1349,768,1512,824"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="1349,434,1512,475"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="1349,543,1512,585"/>
<area shape="rect" href="namespacempi__communication__mod.html#a6ed06ee79c19ff1f57a344de48e53806" title="Waits for a specific MPI request to complete, either by managing thread safety and interleaving or ju..." alt="" coords="882,287,1053,329"/>
<area shape="rect" href="namespacempi__communication__mod.html#aee6d81060fcad11a466f823627234e7c" title="Pauses for a specific number of ms to allow for MPI interleaving, this is to avoid starvation." alt="" coords="1115,251,1301,293"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a468cf6121ebcfc23b1389528744d998c" title="Provides the Q field names to the write federator, this is required as on initialisation we don&#39;t kno..." alt="" coords="645,623,805,679"/>
<area shape="rect" href="namespacestring__utils__mod.html#ad8b27e4313b52162f03c809668954104" title="Replaces all occurances of a character in a string with another character." alt="" coords="642,506,807,547"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9379ee9a358faa87a63d2f2459f202b9" title="Retrieves the index of the next writer which uses a specific field. If none is found then returns fal..." alt="" coords="1136,629,1280,685"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a5b55ebfb6f9bf71a42f716fc9d6dad8c" title="Determines the diagnostics fields that are available based upon the input MONC fields on registration..." alt="" coords="629,783,820,839"/>
<area shape="rect" href="namespacewriter__federator__mod.html#aff9121d09086fc4867afe57e0262f4a0" title="Informs the writer federator that specific fields are present and should be reflected in the diagnost..." alt="" coords="644,703,805,759"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a7951029c07b91b6398c93636f9442dfa" title="Retrieves the next activity in a collection being iterated over by an iterator." alt="" coords="876,767,1059,809"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a0c151f31e747242202c9328f70207055" title="Enables a specific field by its name, this will locate all the fields with this name and enable them." alt="" coords="894,688,1041,744"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a95f289d7a2a91f45be0accb5328cc178_icgraph.png" border="0" usemap="#anamespaceio__server__mod_a95f289d7a2a91f45be0accb5328cc178_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_a95f289d7a2a91f45be0accb5328cc178_icgraph" id="anamespaceio__server__mod_a95f289d7a2a91f45be0accb5328cc178_icgraph">
<area shape="rect" title="Handles registration from some MONC process. The source process sends some data description to this I..." alt="" coords="443,5,593,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="244,5,395,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,13,196,39"/>
</map>
</div>

</div>
</div>
<a id="a5e5c9b6be433b4b2bebbfa01ddf0bec0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e5c9b6be433b4b2bebbfa01ddf0bec0">&#9670;&nbsp;</a></span>init_data_definition()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::init_data_definition </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__registered__monc__type.html">io_configuration_registered_monc_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>monc_defn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialise the sizing of data definitions from a MONC process. The IO server determines, from configuration, the structure of each data definition but the size of the arrays depends upon the MONC process (due to uneven distribution of data etc...) This receives the sizing message and then builds the MPI datatype for each data definition that the IO server will receive from that specific MONC process. The field sizings are for all fields in every data definition, and these are applied to each data definition which will simply ignore non matching fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>The source MONC PID </td></tr>
    <tr><td class="paramname">monc_defn</td><td>The corresponding MONC definition data structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00433">433</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: source</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordtype">type</span>(io_configuration_registered_monc_type), <span class="keywordtype">intent(inout)</span> :: monc_defn</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordtype">type</span>(data_sizing_description_type) :: data_description(io_configuration%number_of_distinct_data_fields+4)</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordtype">integer</span> :: created_mpi_type, data_size, recv_count, i</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordtype">type</span>(data_sizing_description_type) :: field_description</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordtype">logical</span> :: field_found</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    recv_count=data_receive(mpi_type_data_sizing_description, io_configuration%number_of_distinct_data_fields+4, &amp;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;         source, description_data=data_description)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="keyword">call </span>handle_monc_dimension_information(data_description, monc_defn)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;     </div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="keywordflow">do</span> i=1, io_configuration%number_of_data_definitions</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      created_mpi_type=build_mpi_datatype(io_configuration%data_definitions(i), data_description, data_size, &amp;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;           monc_defn%field_start_locations(i), monc_defn%field_end_locations(i), monc_defn%dimensions(i))            </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="keyword">call </span>c_put_integer(monc_defn%registered_monc_types, conv_to_string(i), created_mpi_type)</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="keyword">call </span>c_put_integer(monc_defn%registered_monc_buffer_sizes, conv_to_string(i), data_size)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      monc_defn%definition_names(i)=io_configuration%data_definitions(i)%name</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keywordflow">if</span> (.not. initialised_present_data) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      initialised_present_data=.true.</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      field_found=get_data_description_from_name(data_description, number_q_indicies_key, field_description)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keyword">call </span>c_put_integer(io_configuration%dimension_sizing, <span class="stringliteral">&quot;active_q_indicies&quot;</span>, field_description%dim_sizes(1))</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keyword">call </span>register_present_field_names_to_federators(data_description, recv_count)</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keyword">call </span>get_monc_information_data(source)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a5e5c9b6be433b4b2bebbfa01ddf0bec0_cgraph.png" border="0" usemap="#anamespaceio__server__mod_a5e5c9b6be433b4b2bebbfa01ddf0bec0_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_a5e5c9b6be433b4b2bebbfa01ddf0bec0_cgraph" id="anamespaceio__server__mod_a5e5c9b6be433b4b2bebbfa01ddf0bec0_cgraph">
<area shape="rect" title="Initialise the sizing of data definitions from a MONC process. The IO server determines,..." alt="" coords="5,303,136,345"/>
<area shape="rect" href="namespacempi__communication__mod.html#a94ec3fc73dd4cba3a1aa1b09f4d8e0af" title="Builds the MPI type that corresponds to the data which will be received from a specific MONC process...." alt="" coords="651,157,822,198"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a5c91dd79c12db74da24c9e318d750f02" title="Look up the data description that corresponds to a specific field keyed by its name." alt="" coords="903,201,1051,257"/>
<area shape="rect" href="namespacempi__communication__mod.html#aa9da81a3b60ef8507b3eabdbd19a8f89" title="Awaits some data on the data channel. This is of the type, size from the source provided and can eith..." alt="" coords="409,391,579,433"/>
<area shape="rect" href="namespaceio__server__mod.html#aefce42fc11a68cb3783f1eb0f2c18610" title="Retrieves MONC information data, this is sent by MONC (and received) regardless, but only actioned if..." alt="" coords="185,573,349,614"/>
<area shape="rect" href="namespaceio__server__mod.html#a9bd8b641a945346aa2cfe1813bb3af34" title="Handles the provided local MONC dimension and data layout information." alt="" coords="637,274,836,315"/>
<area shape="rect" href="namespaceio__server__mod.html#a75db617985efd39b9db284a0dc512d34" title="Registers with the writer federator the set of fields (prognostic and diagnostic) that are available,..." alt="" coords="184,827,351,883"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a84bf9d6a41f5f7fea53b4b62c166a77f" title="Appends the MPI datatype details to the block counts, old types and offsets arrays...." alt="" coords="900,15,1055,57"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="892,333,1063,374"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="1329,281,1472,308"/>
<area shape="rect" href="namespaceio__server__client__mod.html#ae78f9ba9a1846fdf7a7b873057b06a36" title="Provides the type extents of the types that we are using in construction of the MPI data type...." alt="" coords="885,137,1070,178"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="892,398,1063,439"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a8d816b12c995d04f289de4f8d03a4d3d" title="Gets the MPI datatype from out internal representation of the field data type (as in the configuratio..." alt="" coords="1119,5,1281,61"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="1123,353,1277,394"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="1119,458,1281,499"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1520,274,1687,315"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="1119,603,1281,645"/>
<area shape="rect" href="namespacempi__communication__mod.html#a6ed06ee79c19ff1f57a344de48e53806" title="Waits for a specific MPI request to complete, either by managing thread safety and interleaving or ju..." alt="" coords="651,391,822,433"/>
<area shape="rect" href="namespacempi__communication__mod.html#aee6d81060fcad11a466f823627234e7c" title="Pauses for a specific number of ms to allow for MPI interleaving, this is to avoid starvation." alt="" coords="884,463,1071,505"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a468cf6121ebcfc23b1389528744d998c" title="Provides the Q field names to the write federator, this is required as on initialisation we don&#39;t kno..." alt="" coords="414,747,574,803"/>
<area shape="rect" href="namespacestring__utils__mod.html#ad8b27e4313b52162f03c809668954104" title="Replaces all occurances of a character in a string with another character." alt="" coords="411,682,577,723"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9379ee9a358faa87a63d2f2459f202b9" title="Retrieves the index of the next writer which uses a specific field. If none is found then returns fal..." alt="" coords="905,829,1049,885"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a5b55ebfb6f9bf71a42f716fc9d6dad8c" title="Determines the diagnostics fields that are available based upon the input MONC fields on registration..." alt="" coords="399,827,589,883"/>
<area shape="rect" href="namespacewriter__federator__mod.html#aff9121d09086fc4867afe57e0262f4a0" title="Informs the writer federator that specific fields are present and should be reflected in the diagnost..." alt="" coords="413,907,575,963"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a7951029c07b91b6398c93636f9442dfa" title="Retrieves the next activity in a collection being iterated over by an iterator." alt="" coords="645,834,828,875"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a0c151f31e747242202c9328f70207055" title="Enables a specific field by its name, this will locate all the fields with this name and enable them." alt="" coords="663,903,810,959"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a5e5c9b6be433b4b2bebbfa01ddf0bec0_icgraph.png" border="0" usemap="#anamespaceio__server__mod_a5e5c9b6be433b4b2bebbfa01ddf0bec0_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_a5e5c9b6be433b4b2bebbfa01ddf0bec0_icgraph" id="anamespaceio__server__mod_a5e5c9b6be433b4b2bebbfa01ddf0bec0_icgraph">
<area shape="rect" title="Initialise the sizing of data definitions from a MONC process. The IO server determines,..." alt="" coords="641,5,772,47"/>
<area shape="rect" href="namespaceio__server__mod.html#a95f289d7a2a91f45be0accb5328cc178" title="Handles registration from some MONC process. The source process sends some data description to this I..." alt="" coords="443,5,593,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="244,5,395,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,13,196,39"/>
</map>
</div>

</div>
</div>
<a id="ac818aa1985977c9887acda6315139114"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac818aa1985977c9887acda6315139114">&#9670;&nbsp;</a></span>io_server_run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public io_server_mod::io_server_run </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structcollections__mod_1_1hashmap__type.html">hashmap_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>options_database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>io_communicator_arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>provided_threading</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>total_global_processes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>continuation_run</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=long_string_length), intent(in)&#160;</td>
          <td class="paramname"><em>io_configuration_file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called to start the IO server and once this subroutine returns then it indicates that the IO server has finished. The runtime is spent in here awaiting commands and then dealing with them. Termination occurs when all MONC processes have deregistered, note that to trigger this then at least one MONC process must first register. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io_communicator_arg</td><td>The IO communicator containing just the IO servers </td></tr>
    <tr><td class="paramname">io_xml_configuration</td><td>Textual XML configuration that is used to set up the IO server </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00066">66</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordtype">type</span>(hashmap_type), <span class="keywordtype">intent(inout)</span> :: options_database</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: io_communicator_arg, provided_threading, total_global_processes</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: continuation_run</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordtype">character(len=LONG_STRING_LENGTH)</span>, <span class="keywordtype">intent(in)</span> :: io_configuration_file</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordtype">integer</span> :: command, source, my_rank, ierr</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordtype">character</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: data_buffer, io_xml_configuration</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordtype">type</span>(hashmap_type) :: diagnostic_generation_frequency</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span> (continuation_run) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="comment">! Handle case where we need to allocate this due to no IO server config</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keyword">call </span>read_io_server_configuration(options_get_string(options_database, <span class="stringliteral">&quot;checkpoint&quot;</span>), &amp;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;           io_xml_configuration, io_communicator_arg)</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span> (.not. <span class="keyword">allocated</span>(io_xml_configuration)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      io_xml_configuration=get_io_xml(io_configuration_file)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">if</span> (continuation_run) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keyword">call </span>mpi_comm_rank(io_communicator_arg, my_rank, ierr)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">if</span> (my_rank == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">log_warn</a>, <span class="stringliteral">&quot;No IO server configuration in checkpoint file - starting from XML provided file instead&quot;</span>)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keywordflow">      end if</span>      </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keywordflow">    end if</span>    </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keyword">call </span>check_for_condi_conflict(io_xml_configuration, options_database)</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keyword">call </span>configuration_parse(options_database, io_xml_configuration, io_configuration)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keyword">deallocate</span>(io_xml_configuration)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keyword">call </span>threadpool_init(io_configuration)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keyword">call </span>initialise_mpi_communication(provided_threading)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_init(monc_registration_lock, -1))</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_init(io_configuration%general_info_mutex, -1))</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    initialised_present_data=.false.</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    contine_poll_messages=.true.</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    contine_poll_interio_messages=.true.</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    already_registered_finishing_call=.false.</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    io_configuration%io_communicator=io_communicator_arg</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    io_configuration%number_of_io_servers=get_number_io_servers(io_communicator_arg)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    io_configuration%number_of_global_moncs=total_global_processes-io_configuration%number_of_io_servers</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    io_configuration%my_io_rank=get_my_io_rank(io_communicator_arg)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keyword">call </span>initialise_logging(io_configuration%my_io_rank)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    registree_definition_descriptions=build_definition_description_type_from_configuration(io_configuration)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    registree_field_descriptions=build_field_description_type_from_configuration(io_configuration)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    diagnostic_generation_frequency=initialise_diagnostic_federator(io_configuration)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keyword">call </span>initialise_writer_federator(io_configuration, diagnostic_generation_frequency, continuation_run)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keyword">call </span>c_free(diagnostic_generation_frequency)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keyword">call </span>initialise_writer_field_manager(io_configuration, continuation_run)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    mpi_type_data_sizing_description=build_mpi_type_data_sizing_description()</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    mpi_type_definition_description=build_mpi_type_definition_description()</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    mpi_type_field_description=build_mpi_type_field_description()</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keyword">call </span>register_command_receive()</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (await_command(command, source, data_buffer))      </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keyword">call </span>handle_command_message(command, source, data_buffer)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keyword">call </span>threadpool_deactivate()</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keyword">call </span>finalise_writer_field_manager()</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keyword">call </span>finalise_writer_federator()</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keyword">call </span>finalise_diagnostic_federator(io_configuration)</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_destroy(monc_registration_lock))</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keyword">call </span>free_individual_registered_monc_aspects()</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keyword">call </span>cancel_requests()</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keyword">call </span>free_mpi_type(mpi_type_data_sizing_description)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keyword">call </span>free_mpi_type(mpi_type_definition_description)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keyword">call </span>free_mpi_type(mpi_type_field_description)    </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keyword">call </span>threadpool_finalise()</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_ac818aa1985977c9887acda6315139114_cgraph.png" border="0" usemap="#anamespaceio__server__mod_ac818aa1985977c9887acda6315139114_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_ac818aa1985977c9887acda6315139114_cgraph" id="anamespaceio__server__mod_ac818aa1985977c9887acda6315139114_cgraph">
<area shape="rect" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,1587,196,1614"/>
<area shape="rect" href="namespaceio__server__mod.html#ada1b8581f80d696dc8aa636405c73aea" title="Awaits a command or shutdown from MONC processes and other IO servers." alt="" coords="274,251,418,292"/>
<area shape="rect" href="namespacempi__communication__mod.html#aaec64bef427565b6e469af564d9d32d6" title="Registers a request for receiving a command from any MONC process on the command channel." alt="" coords="759,475,943,516"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="774,1157,929,1199"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="1012,889,1155,915"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a6882dfd6fdabbee70fb796e7d809c91d" title="Builds up the data definition description type from the structured definitions in the IO configuratio..." alt="" coords="268,1807,424,1877"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a81e51d2549d27e36ab9fe7f5a721b7a4" title="Builds up the field definition description type from the structured definitions in the IO configurati..." alt="" coords="253,1902,439,1958"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a05abfd87c59b29bcf2bf898be0e49d6b" title="Builds the MPI type used for sending to the IO server a description of the data, namely the size of t..." alt="" coords="273,1982,419,2038"/>
<area shape="rect" href="namespaceio__server__client__mod.html#adeb31c46d94cae90c66fe89adae6cf45" title="Builds the MPI data type for sending data descriptions to registree MONCs." alt="" coords="260,2062,432,2118"/>
<area shape="rect" href="namespaceio__server__client__mod.html#a5d72fe60200c623e96aac835eb09c606" title="Builds the MPI data type for sending field descriptions to registree MONCs." alt="" coords="273,2142,419,2198"/>
<area shape="rect" href="namespacempi__communication__mod.html#a7852c937574e58b245148b6d9db923e4" title="Cancels all outstanding communication requests." alt="" coords="261,2221,431,2263"/>
<area shape="rect" href="namespaceio__server__mod.html#ae9d8dbafb475aaceb37d8a332c238448" title="Handle potential conditional diagnostics conflict Provides a more helpful error in the case where con..." alt="" coords="519,1965,667,2007"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a8c234c5373b5a6919483d973a46642e9" title="This will parse an XML string into the IO configuration." alt="" coords="260,1689,432,1731"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ae2b10b5d2cd3d99855d3abb64dd45e29" title="Finalises the diagnostics federator, waiting for all outstanding requests and then freeing data." alt="" coords="263,2286,429,2342"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a350033966b51a20a8a69d092a20ba774" title="Finalises the write federator and the manipulations." alt="" coords="263,961,429,1003"/>
<area shape="rect" href="namespaceforthread__mod.html#a1ba0d6ac9839191688aeea507ae27ec8" title=" " alt="" coords="770,783,933,824"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a8a6d32479542864e64f1f15714fd0b15" title="Finalises the writer field manager." alt="" coords="523,743,664,799"/>
<area shape="rect" href="namespaceforthread__mod.html#ab29785b28c1d6bcf13e844b8d1230846" title=" " alt="" coords="512,1237,675,1279"/>
<area shape="rect" href="namespaceforthread__mod.html#a84f66d5153e8adc21918d4b4d627087f" title=" " alt="" coords="512,1405,675,1447"/>
<area shape="rect" href="namespaceio__server__mod.html#a1067b04bf298bdec22d1c55144f3a8d5" title="Frees up the memory associated with individual registered MONCs. This is done at the end for all MONC..." alt="" coords="273,2366,419,2422"/>
<area shape="rect" href="namespacempi__communication__mod.html#ae9569a173fd13c6772b5dfc8495c715b" title="Frees an MPI type, used in clean up." alt="" coords="508,2405,679,2447"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a9a7a03163db539e810a51ceb06fcfac6" title="Reads in textual data from a file and returns this, used to read the IO server XML configuration file..." alt="" coords="782,543,921,584"/>
<area shape="rect" href="namespacempi__communication__mod.html#aa524bcd4b7d0001d02dc3a324788610c" title="Retrieves my IO server rank out of the number of IO servers that are running." alt="" coords="261,2497,431,2539"/>
<area shape="rect" href="namespacempi__communication__mod.html#abf62d60a03e5dd2a80a15ddd183e2668" title="Retrieves the number of IO servers that are running in total." alt="" coords="261,2563,431,2604"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="271,2628,421,2669"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a808b726c916d9dc52e2020eacbe2be0f" title="Initialises the diagnostics action and sets up the diagnostics master definitions." alt="" coords="259,1261,433,1317"/>
<area shape="rect" href="namespacelogging__mod.html#aad2930401b20710ee3d15366c98004b2" title="Initialises the logging. This is done to make it easier for master logging only, so that we don&#39;t hav..." alt="" coords="272,2693,420,2735"/>
<area shape="rect" href="namespacempi__communication__mod.html#a51ffdc1413aeb89e7f9ea1c8ad5ed24c" title="Initialises MPI communication." alt="" coords="247,1144,445,1185"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7b31bb8f9d0fb8c0768252e819b20985" title="Initialises the write federator and configures it based on the user configuration...." alt="" coords="260,1340,432,1381"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a061c34fe0697d9639defd2f0926e2e74" title="Initialises the writer field manager." alt="" coords="273,1457,419,1513"/>
<area shape="rect" href="namespaceio__server__state__reader__mod.html#abed991a38346a4f13146d92cea1b801e" title="Reads the IO server configuration, which is the XML configuration initially run with and stored in th..." alt="" coords="739,615,964,656"/>
<area shape="rect" href="namespacethreadpool__mod.html#a046d2df1c16a8ca4876b6dbc4d51d323" title="This waits for all busy threads to complete and then shuts all the pthreads down. The deactivation an..." alt="" coords="503,1573,683,1615"/>
<area shape="rect" href="namespacethreadpool__mod.html#ad29d0b56c938fe741ebaef345cb86fe7" title="Finalises the thread pool." alt="" coords="503,1639,683,1680"/>
<area shape="rect" href="namespacethreadpool__mod.html#a05129ab692ec724d569ff6836d12c876" title="Initialises the thread pool and marks each thread as idle." alt="" coords="244,1093,448,1119"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ac193bf96ef5cbd37745e615516e8517c" title="Checks whether the diagnostics federator has completed or not, this is really checking all the underl..." alt="" coords="507,135,679,191"/>
<area shape="rect" href="namespacempi__communication__mod.html#aee6d81060fcad11a466f823627234e7c" title="Pauses for a specific number of ms to allow for MPI interleaving, this is to avoid starvation." alt="" coords="500,215,687,256"/>
<area shape="rect" href="namespaceglobal__callback__inter__io__mod.html#ad475780629e2db0ae4b68f3e395e418d" title="Performs a global callback." alt="" coords="512,279,675,335"/>
<area shape="rect" href="namespaceio__server__mod.html#ab7fdb4e13556857668bb0b29fa719624" title="This is the termination callback which is called once all MONCs have deregistered,..." alt="" coords="505,359,682,400"/>
<area shape="rect" href="namespacempi__communication__mod.html#af9ae866733dedd5129dac4361d17e720" title="Tests for a command message based upon the request already registered." alt="" coords="508,5,679,47"/>
<area shape="rect" href="namespacempi__communication__mod.html#a4e6c15cbcdc2763a82c34491328c4742" title="Tests for inter IO server communication." alt="" coords="508,424,679,465"/>
<area shape="rect" href="namespacethreadpool__mod.html#a2a87c0e0335c727f6b9fa99c54aac83a" title="Determines whether the thread pool is idle or not (i.e. all threads are idle and waiting for work)" alt="" coords="503,71,683,112"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a48521fe7b4d49d40444f968012ccd756" title="Retrieves the total number of fields held in all data definitions." alt="" coords="513,2030,673,2086"/>
<area shape="rect" href="namespacempi__communication__mod.html#a56d4d49458bbf60e4d6b59b050273d62" title="Cancels a specific communication request." alt="" coords="508,2221,679,2263"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#aa3f0213d8028773523e6194a0ddf8e18" title="Retrieves a logical value from the database that matches the provided key." alt="" coords="777,1837,926,1879"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a8b9b1204c6fb4375ab4ef21e08699228" title=" " alt="" coords="508,1769,679,1811"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a2a47d1df068739175beaad6546996e32" title="XML element end (closing) call back." alt="" coords="499,1835,688,1876"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a859d85a92494d30909ef8e4f248fac26" title="XML element start (opening) call back. This handles most of the configuration parsing." alt="" coords="496,1900,691,1941"/>
<area shape="rect" href="namespacesax__xml__parser__mod.html#aa863a4b1a757b8b693441a0fb8250b2e" title="Parses some raw XML raw_contents The raw (unparsed) XML string start_element_callback Subroutine to c..." alt="" coords="521,1704,665,1745"/>
<area shape="rect" href="namespaceinstantaneous__time__manipulation__mod.html#a9e6df294e2e60b5d2640511b434bd8d0" title="Finalises the instantaneous time manipulation." alt="" coords="498,954,689,1010"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a4267425ddfb057cab9dc7c4d08087669" title="Finalises the NetCDF writing functionality." alt="" coords="521,874,665,930"/>
</map>
</div>

</div>
</div>
<a id="a153d99e94dcccfaea63104af86095dce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a153d99e94dcccfaea63104af86095dce">&#9670;&nbsp;</a></span>pull_back_data_message_and_handle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::pull_back_data_message_and_handle </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>data_set</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool to actually process We do it this way to enforce ordering between the command (including the data set ID) and the raw data itself. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>Source PID of the MONC process </td></tr>
    <tr><td class="paramname">data_set</td><td>ID of the data set being communicated </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00296">296</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: source, data_set</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordtype">integer</span> :: specific_monc_data_type, specific_monc_buffer_size, recv_count, monc_location</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordtype">character</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: data_buffer</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_rdlock(monc_registration_lock))</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    monc_location=get_monc_location(io_configuration, source)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    specific_monc_data_type=c_get_integer(io_configuration%registered_moncs(monc_location)%registered_monc_types, &amp;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;         conv_to_string(data_set))</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    specific_monc_buffer_size=c_get_integer(io_configuration%registered_moncs(monc_location)%registered_monc_buffer_sizes, &amp;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;         conv_to_string(data_set))</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keyword">allocate</span>(data_buffer(specific_monc_buffer_size))</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    recv_count=data_receive(specific_monc_data_type, 1, source, dump_data=data_buffer, data_dump_id=data_set)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_unlock(monc_registration_lock))</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keyword">call </span>threadpool_start_thread(handle_data_message, (/ source,  data_set /), data_buffer=data_buffer)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keyword">deallocate</span>(data_buffer)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a153d99e94dcccfaea63104af86095dce_cgraph.png" border="0" usemap="#anamespaceio__server__mod_a153d99e94dcccfaea63104af86095dce_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_a153d99e94dcccfaea63104af86095dce_cgraph" id="anamespaceio__server__mod_a153d99e94dcccfaea63104af86095dce_cgraph">
<area shape="rect" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="5,1715,183,1771"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="1177,1208,1332,1249"/>
<area shape="rect" href="namespacempi__communication__mod.html#aa9da81a3b60ef8507b3eabdbd19a8f89" title="Awaits some data on the data channel. This is of the type, size from the source provided and can eith..." alt="" coords="441,885,611,926"/>
<area shape="rect" href="namespaceforthread__mod.html#ace3f16636de24b1fc62de549d67476dc" title=" " alt="" coords="699,1766,862,1808"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="699,1832,862,1873"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#ae5be635b15f2c5670d91275e34c74105" title="A helper function to get the location of a MONC&#39;s configuration in the IO data structure." alt="" coords="441,1722,611,1764"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="231,1390,381,1432"/>
<area shape="rect" href="namespacethreadpool__mod.html#a66a9d51f29634430ca4ed121947b0132" title="Starts an idle thread from the pool to execute a specific procedure with some data...." alt="" coords="942,112,1122,153"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="1386,1082,1529,1108"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1579,1074,1745,1116"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="947,860,1117,901"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="947,729,1117,770"/>
<area shape="rect" href="namespacempi__communication__mod.html#a6ed06ee79c19ff1f57a344de48e53806" title="Waits for a specific MPI request to complete, either by managing thread safety and interleaving or ju..." alt="" coords="695,856,866,897"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="1173,921,1336,962"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="1173,761,1336,802"/>
<area shape="rect" href="namespacempi__communication__mod.html#aee6d81060fcad11a466f823627234e7c" title="Pauses for a specific number of ms to allow for MPI interleaving, this is to avoid starvation." alt="" coords="939,794,1125,836"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="443,1358,609,1400"/>
<area shape="rect" href="namespaceforthread__mod.html#acdd75cd6d34e33c09165306eef31f159" title=" " alt="" coords="1173,21,1336,62"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a5c407f4433b36fa8e9fefda57fc32252" title=" " alt="" coords="445,1540,607,1596"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a471607fc4ee8c3a1ce66d31dc68e5522" title="Entry point into the diagnostics federator this runs the diagnostics, executing the defined rules bas..." alt="" coords="449,564,603,620"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="439,1244,613,1300"/>
<area shape="rect" href="namespaceconfiguration__parser__mod.html#a487e87f6d515f5d7ae565b5553b8eb5b" title="Retrieves a specific data definition from the configuration which matches a key." alt="" coords="429,1424,623,1465"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="708,1284,853,1325"/>
<area shape="rect" href="namespacedata__utils__mod.html#a56c7a3c668c3abef4e4d43fea2f73b5b" title="Retrieves a single integer element (scalar) from the data dump." alt="" coords="689,1401,872,1442"/>
<area shape="rect" href="namespacedata__utils__mod.html#a29da67d2bfdfc17765e1105f9295c6be" title="Retrieves a single logical element (scalar) from the data dump." alt="" coords="691,1218,871,1260"/>
<area shape="rect" href="namespacedata__utils__mod.html#ae97bbc021128cf42a987facc1c1e7fee" title="Retreives a scalar real with a corresponding key from the raw data dump." alt="" coords="699,1532,863,1573"/>
<area shape="rect" href="namespacedata__utils__mod.html#ac64f12e860548e106a50f9be09a7bcb8" title=" " alt="" coords="717,1466,844,1508"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="960,1225,1104,1266"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a27f423ed92a9bd09acce659a23e3defa" title="Registers a pending file write which will be actioned later on." alt="" coords="941,1290,1123,1332"/>
<area shape="rect" href="namespacedata__utils__mod.html#ab248d898201d14574800dd321c8a5dde" title="Retrieves a single integer element (scalar) from the data dump." alt="" coords="965,1458,1099,1500"/>
<area shape="rect" href="namespacedata__utils__mod.html#a07f32dc1887f01ab3b818c89dd5e34f7" title="Retrieves a single logical element (scalar) from the data dump." alt="" coords="965,1108,1099,1149"/>
<area shape="rect" href="namespacedata__utils__mod.html#a15c2c4edba1f23d89fd83d173b54774d" title="Retreives a scalar real with a corresponding key from the raw data dump." alt="" coords="965,1532,1099,1573"/>
<area shape="rect" href="namespaceforthread__mod.html#ab60b7d18e1d948f6b63c6cb893fad182" title=" " alt="" coords="699,1649,862,1690"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#adcd05cf714b11815d87be556954d5d35" title="Checks all pending activities against the completed fields and runs them if the required fields are n..." alt="" coords="693,404,868,460"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a3a57c70da8b58d633fdafedc4010719a" title="Checks the outstanding fields of a time step entry against the data recieved from MONC and moves any ..." alt="" coords="697,484,865,540"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#aee7c2e6b24616cd79159ff8cdec96e0e" title="Cleans the diagnostic states if required (based on the timestep period)" alt="" coords="702,564,859,620"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#afb86d57115a32c34cdfb03dacf573e05" title="Locates or registers a new (if it does not exist) time step entry based upon the timestep and source ..." alt="" coords="707,644,855,700"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a9cb374b99d120fa5f27485256d6349e0" title="Retrieves the diagnostics list (each MONC source) at a specific timestep." alt="" coords="705,724,856,780"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ac72eade80d986df91f8008af3873a22e" title="Issues any inter io communucation calls that are appropriate based upon the data recieved from MONC." alt="" coords="671,340,891,381"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a6dd07cccfe88be5418168241b19f2b10" title="Determines whether the fields required for an activity are available so that activity can be run." alt="" coords="945,490,1119,546"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a10c82e5e43f4e3f306baf250bbda6df5" title="Generates a unique key for an activity within a diagnostic, which is unique amongst all diagnostics a..." alt="" coords="953,410,1111,466"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ab25878578b48aaac7c3841a560b67497" title="Handles completion of a diagnostic calculation and will then pass this onto interested parties." alt="" coords="950,570,1114,626"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#ae02876dfa818535426c6d0be66696404" title="Handles the completion of the operator." alt="" coords="956,650,1108,706"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a137b3e2865e5dd85e2352afbf6c12de6" title="Performs the actual inter IO communication by calling out to the appropriate inter IO module." alt="" coords="955,330,1109,386"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#af479a611799a55972a738e3da695f0fe" title="Retrieves a value from the communicated MONC data. If this was an integer then converts to a real." alt="" coords="1180,1356,1329,1412"/>
<area shape="rect" href="namespacewriter__federator__mod.html#ac6aefade0899178fd2ba9c7c723af5d1" title="Determines whether a field is split on Q or not." alt="" coords="709,1153,853,1194"/>
<area shape="rect" href="namespacewriter__federator__mod.html#ab10af49e026b9e11d113f702bb7f3113" title="Determines whether a field is used by the writer federator or not." alt="" coords="699,1074,862,1130"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="957,976,1107,1032"/>
<area shape="rect" href="namespacethreadpool__mod.html#a79c1c7faaf752ec1681acc2bfcce7e16" title="Finds an idle thread, if one is not available then will block until one becomes free." alt="" coords="1185,86,1325,128"/>
<area shape="rect" href="namespacethreadpool__mod.html#a46884c3dda1e63c2cbaffb985835e64b" title="Specifically gets the index of the next idle thread or &#45;1 if they are all busy. This starts from a ne..." alt="" coords="1384,86,1531,128"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a153d99e94dcccfaea63104af86095dce_icgraph.png" border="0" usemap="#anamespaceio__server__mod_a153d99e94dcccfaea63104af86095dce_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_a153d99e94dcccfaea63104af86095dce_icgraph" id="anamespaceio__server__mod_a153d99e94dcccfaea63104af86095dce_icgraph">
<area shape="rect" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="443,5,620,61"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="244,13,395,54"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,20,196,47"/>
</map>
</div>

</div>
</div>
<a id="a75db617985efd39b9db284a0dc512d34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75db617985efd39b9db284a0dc512d34">&#9670;&nbsp;</a></span>register_present_field_names_to_federators()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::register_present_field_names_to_federators </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structio__server__client__mod_1_1data__sizing__description__type.html">data_sizing_description_type</a>), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>data_description</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>recv_count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Registers with the writer federator the set of fields (prognostic and diagnostic) that are available, this is based on the array/optional fields present from MONC and the non-optional scalars. This is quite an expensive operation, so only done once. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data_description</td><td>Array of data descriptions from MONC </td></tr>
    <tr><td class="paramname">recv_count</td><td>Number of data descriptions </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00531">531</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordtype">type</span>(data_sizing_description_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: data_description</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: recv_count</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordtype">type</span>(hashset_type) :: present_field_names</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordtype">type</span>(hashmap_type) :: diagnostics_field_names_and_roots</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordtype">integer</span> :: i, j</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">do</span> i=1, recv_count</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keyword">call </span>c_add_string(present_field_names, data_description(i)%field_name)</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">do</span> i=1, io_configuration%number_of_data_definitions</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">do</span> j=1, io_configuration%data_definitions(i)%number_of_data_fields</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">if</span> (io_configuration%data_definitions(i)%fields(j)%field_type == scalar_field_type .and. .not. &amp;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;             io_configuration%data_definitions(i)%fields(j)%optional) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          <span class="keyword">call </span>c_add_string(present_field_names, io_configuration%data_definitions(i)%fields(j)%name)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="keywordflow">        end if</span>        </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="keywordflow">      end do</span>      </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keyword">call </span>c_add_string(present_field_names, <span class="stringliteral">&quot;time&quot;</span>)</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keyword">call </span>c_add_string(present_field_names, <span class="stringliteral">&quot;timestep&quot;</span>)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keyword">call </span>inform_writer_federator_fields_present(io_configuration, present_field_names)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    diagnostics_field_names_and_roots=determine_diagnostics_fields_available(present_field_names)</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keyword">call </span>inform_writer_federator_fields_present(io_configuration, diag_field_names_and_roots=diagnostics_field_names_and_roots)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keyword">call </span>c_free(present_field_names)</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keyword">call </span>c_free(diagnostics_field_names_and_roots)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a75db617985efd39b9db284a0dc512d34_cgraph.png" border="0" usemap="#anamespaceio__server__mod_a75db617985efd39b9db284a0dc512d34_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_a75db617985efd39b9db284a0dc512d34_cgraph" id="anamespaceio__server__mod_a75db617985efd39b9db284a0dc512d34_cgraph">
<area shape="rect" title="Registers with the writer federator the set of fields (prognostic and diagnostic) that are available,..." alt="" coords="5,45,172,101"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a5b55ebfb6f9bf71a42f716fc9d6dad8c" title="Determines the diagnostics fields that are available based upon the input MONC fields on registration..." alt="" coords="220,5,411,61"/>
<area shape="rect" href="namespacewriter__federator__mod.html#aff9121d09086fc4867afe57e0262f4a0" title="Informs the writer federator that specific fields are present and should be reflected in the diagnost..." alt="" coords="235,85,396,141"/>
<area shape="rect" href="namespacediagnostic__federator__mod.html#a7951029c07b91b6398c93636f9442dfa" title="Retrieves the next activity in a collection being iterated over by an iterator." alt="" coords="459,13,641,54"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a0c151f31e747242202c9328f70207055" title="Enables a specific field by its name, this will locate all the fields with this name and enable them." alt="" coords="477,85,623,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9379ee9a358faa87a63d2f2459f202b9" title="Retrieves the index of the next writer which uses a specific field. If none is found then returns fal..." alt="" coords="689,85,833,141"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_a75db617985efd39b9db284a0dc512d34_icgraph.png" border="0" usemap="#anamespaceio__server__mod_a75db617985efd39b9db284a0dc512d34_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_a75db617985efd39b9db284a0dc512d34_icgraph" id="anamespaceio__server__mod_a75db617985efd39b9db284a0dc512d34_icgraph">
<area shape="rect" title="Registers with the writer federator the set of fields (prognostic and diagnostic) that are available,..." alt="" coords="820,5,987,61"/>
<area shape="rect" href="namespaceio__server__mod.html#a5e5c9b6be433b4b2bebbfa01ddf0bec0" title="Initialise the sizing of data definitions from a MONC process. The IO server determines,..." alt="" coords="641,13,772,54"/>
<area shape="rect" href="namespaceio__server__mod.html#a95f289d7a2a91f45be0accb5328cc178" title="Handles registration from some MONC process. The source process sends some data description to this I..." alt="" coords="443,13,593,54"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="244,13,395,54"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,20,196,47"/>
</map>
</div>

</div>
</div>
<a id="af165fa2c9ad4d8d48537ee997432fdaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af165fa2c9ad4d8d48537ee997432fdaa">&#9670;&nbsp;</a></span>send_configuration_to_registree()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function, dimension(2) io_server_mod::send_configuration_to_registree </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>source</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends the data and field descriptions to the MONC process that just registered with the IO server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>The MPI rank (MPI_COMM_WORLD) of the registree </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The nonblocking send request handles which can be waited for completion later (overlap compute and communication) </dd></dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00410">410</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: source</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordtype">integer</span> :: send_configuration_to_registree(2)</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordtype">integer</span> :: ierr, srequest(2)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keyword">call </span>mpi_isend(registree_definition_descriptions, <span class="keyword">size</span>(registree_definition_descriptions), mpi_type_definition_description, &amp;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;         source, data_tag, mpi_comm_world, srequest(1), ierr)</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keyword">call </span>mpi_isend(registree_field_descriptions, <span class="keyword">size</span>(registree_field_descriptions), mpi_type_field_description, &amp;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;         source, data_tag, mpi_comm_world, srequest(2), ierr)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    send_configuration_to_registree=srequest    </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_af165fa2c9ad4d8d48537ee997432fdaa_cgraph.png" border="0" usemap="#anamespaceio__server__mod_af165fa2c9ad4d8d48537ee997432fdaa_cgraph" alt=""/></div>
<map name="namespaceio__server__mod_af165fa2c9ad4d8d48537ee997432fdaa_cgraph" id="anamespaceio__server__mod_af165fa2c9ad4d8d48537ee997432fdaa_cgraph">
<area shape="rect" title="Sends the data and field descriptions to the MONC process that just registered with the IO server." alt="" coords="5,72,183,113"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="231,39,401,80"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="231,104,401,145"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="453,71,608,112"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="449,5,612,47"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="660,78,803,105"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="851,71,1017,112"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="449,136,612,177"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_af165fa2c9ad4d8d48537ee997432fdaa_icgraph.png" border="0" usemap="#anamespaceio__server__mod_af165fa2c9ad4d8d48537ee997432fdaa_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_af165fa2c9ad4d8d48537ee997432fdaa_icgraph" id="anamespaceio__server__mod_af165fa2c9ad4d8d48537ee997432fdaa_icgraph">
<area shape="rect" title="Sends the data and field descriptions to the MONC process that just registered with the IO server." alt="" coords="641,5,819,47"/>
<area shape="rect" href="namespaceio__server__mod.html#a95f289d7a2a91f45be0accb5328cc178" title="Handles registration from some MONC process. The source process sends some data description to this I..." alt="" coords="443,5,593,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="244,5,395,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,13,196,39"/>
</map>
</div>

</div>
</div>
<a id="ab7fdb4e13556857668bb0b29fa719624"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7fdb4e13556857668bb0b29fa719624">&#9670;&nbsp;</a></span>termination_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine io_server_mod::termination_callback </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>io_configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(default_precision), dimension(:)&#160;</td>
          <td class="paramname"><em>values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=string_length)&#160;</td>
          <td class="paramname"><em>field_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>timestep</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This is the termination callback which is called once all MONCs have deregistered, no sends are active by inter IO communications and all threads are idle. This shuts down the inter IO listening and kickstarts finalisation and closure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io_configuration</td><td>The IO server configuration </td></tr>
    <tr><td class="paramname">values</td><td>Values (ignored) </td></tr>
    <tr><td class="paramname">field_name</td><td>Field name identifier </td></tr>
    <tr><td class="paramname">timestep</td><td>Timestep identifier </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00206">206</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">intent(inout)</span> :: io_configuration</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keywordtype">    real</span>(DEFAULT_PRECISION), <span class="keywordtype">dimension(:)</span> :: values</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span> :: field_name</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordtype">integer</span> :: timestep</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    contine_poll_interio_messages=.false.</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespaceio__server__mod_ab7fdb4e13556857668bb0b29fa719624_icgraph.png" border="0" usemap="#anamespaceio__server__mod_ab7fdb4e13556857668bb0b29fa719624_icgraph" alt=""/></div>
<map name="namespaceio__server__mod_ab7fdb4e13556857668bb0b29fa719624_icgraph" id="anamespaceio__server__mod_ab7fdb4e13556857668bb0b29fa719624_icgraph">
<area shape="rect" title="This is the termination callback which is called once all MONCs have deregistered,..." alt="" coords="436,5,613,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ada1b8581f80d696dc8aa636405c73aea" title="Awaits a command or shutdown from MONC processes and other IO servers." alt="" coords="244,5,388,47"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="5,13,196,39"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a18c5d2e99cc876d36f8c4a866dc98f10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a18c5d2e99cc876d36f8c4a866dc98f10">&#9670;&nbsp;</a></span>already_registered_finishing_call</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical, volatile io_server_mod::already_registered_finishing_call</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00052">52</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>

</div>
</div>
<a id="a46bd252ea44716a24f3fcf5d7f408392"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46bd252ea44716a24f3fcf5d7f408392">&#9670;&nbsp;</a></span>contine_poll_interio_messages</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical, volatile io_server_mod::contine_poll_interio_messages</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00052">52</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">volatile</span> :: contine_poll_interio_messages, already_registered_finishing_call</div>
</div><!-- fragment -->
</div>
</div>
<a id="a88118b683c49ba93c1ea0e9e88f3364e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88118b683c49ba93c1ea0e9e88f3364e">&#9670;&nbsp;</a></span>contine_poll_messages</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical, volatile io_server_mod::contine_poll_messages</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Whether to continue waiting command messages from any MONC processes. </p>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00050">50</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">volatile</span> :: contine_poll_messages, &amp; !&lt; Whether to continue waiting command messages from any MONC processes</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;       initialised_present_data</div>
</div><!-- fragment -->
</div>
</div>
<a id="a6cdbf4ecf3cca70a7bc7c77fb18a1dbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cdbf4ecf3cca70a7bc7c77fb18a1dbb">&#9670;&nbsp;</a></span>initialised_present_data</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical, volatile io_server_mod::initialised_present_data</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00050">50</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>

</div>
</div>
<a id="a7cc63c3947de770f7e0e7fe76103fc9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cc63c3947de770f7e0e7fe76103fc9b">&#9670;&nbsp;</a></span>io_configuration</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), save, volatile io_server_mod::io_configuration</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Internal representation of the IO configuration. </p>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00049">49</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">volatile</span>, <span class="keywordtype">save</span> :: io_configuration</div>
</div><!-- fragment -->
</div>
</div>
<a id="a04b4dd1167e6396f87a52612773a4429"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04b4dd1167e6396f87a52612773a4429">&#9670;&nbsp;</a></span>monc_registration_lock</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, volatile io_server_mod::monc_registration_lock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00056">56</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">volatile</span> :: monc_registration_lock</div>
</div><!-- fragment -->
</div>
</div>
<a id="a02af53b3696bff6b7089a3a176d0f676"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02af53b3696bff6b7089a3a176d0f676">&#9670;&nbsp;</a></span>mpi_type_data_sizing_description</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer io_server_mod::mpi_type_data_sizing_description</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The MPI type for field sizing (i.e. array size etc send when MONCs register) </p>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00046">46</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">integer</span> :: mpi_type_data_sizing_description, &amp; !&lt; The MPI type for field sizing (i.e. array size etc send when MONCs register)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;       mpi_type_definition_description, &amp; !&lt; The MPI data type for data descriptions sent to MONCs</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;       mpi_type_field_description</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1508901e86e2ca48b8c0b9a2a766a24d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1508901e86e2ca48b8c0b9a2a766a24d">&#9670;&nbsp;</a></span>mpi_type_definition_description</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer io_server_mod::mpi_type_definition_description</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The MPI data type for data descriptions sent to MONCs. </p>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00046">46</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>

</div>
</div>
<a id="ab074f894b4344602107d18810aa00a15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab074f894b4344602107d18810aa00a15">&#9670;&nbsp;</a></span>mpi_type_field_description</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer io_server_mod::mpi_type_field_description</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The MPI data type for field descriptions sent to MONCs. </p>

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00046">46</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>

</div>
</div>
<a id="accae499eb3bda8ea4fe462c9d66fe5d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accae499eb3bda8ea4fe462c9d66fe5d0">&#9670;&nbsp;</a></span>registree_definition_descriptions</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structio__server__client__mod_1_1definition__description__type.html">definition_description_type</a>), dimension(:), allocatable io_server_mod::registree_definition_descriptions</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00054">54</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="keywordtype">type</span>(definition_description_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: registree_definition_descriptions</div>
</div><!-- fragment -->
</div>
</div>
<a id="aeac6944459809f6ad57a28ec75e7fd22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeac6944459809f6ad57a28ec75e7fd22">&#9670;&nbsp;</a></span>registree_field_descriptions</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structio__server__client__mod_1_1field__description__type.html">field_description_type</a>), dimension(:), allocatable io_server_mod::registree_field_descriptions</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ioserver_8F90_source.html#l00053">53</a> of file <a class="el" href="ioserver_8F90_source.html">ioserver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordtype">type</span>(field_description_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: registree_field_descriptions</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<div class="ttc" id="anamespacelogging__mod_html_ad68309846cd8f9e77edaa6abd02f65a0"><div class="ttname"><a href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">logging_mod::log_error</a></div><div class="ttdeci">integer, parameter, public log_error</div><div class="ttdoc">Only log ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00011">logging.F90:11</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_a10e28447dd10ef9f92d205bc98fb26d3"><div class="ttname"><a href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">logging_mod::log_warn</a></div><div class="ttdeci">integer, parameter, public log_warn</div><div class="ttdoc">Log WARNING and ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00012">logging.F90:12</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ac4f13ac385499c85190cb184030e4f45"><div class="ttname"><a href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">logging_mod::log_log</a></div><div class="ttdeci">subroutine, public log_log(level, message, str)</div><div class="ttdoc">Logs a message at the specified level. If the level is above the current level then the message is ig...</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00074">logging.F90:75</a></div></div>
<div class="ttc" id="anamespacedatadefn__mod_html_a39b79f8cc843d236d3b47f5c81b64368"><div class="ttname"><a href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">datadefn_mod::default_precision</a></div><div class="ttdeci">integer, parameter, public default_precision</div><div class="ttdoc">MPI communication type which we use for the prognostic and calculation data.</div><div class="ttdef"><b>Definition:</b> <a href="datadefn_8F90_source.html#l00017">datadefn.F90:17</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>

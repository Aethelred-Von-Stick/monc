<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MONC: cfltest_mod Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MONC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">cfltest_mod Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This contains the CFL test. It will perform the local advective CFL and Galilean transfromation calculations, compute the global values of these, then check the cfl criterion and determine an absolute new dtm. Depending upon the maximum and increment values this is then smoothed into a new dtm value. The value of dtm is physically set to this new value at the start of the next timestep.  
<a href="namespacecfltest__mod.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ad497f1c406a9c4e356ac57eeed2c7868"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structmonc__component__mod_1_1component__descriptor__type.html">component_descriptor_type</a>) function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#ad497f1c406a9c4e356ac57eeed2c7868">cfltest_get_descriptor</a> ()</td></tr>
<tr class="memdesc:ad497f1c406a9c4e356ac57eeed2c7868"><td class="mdescLeft">&#160;</td><td class="mdescRight">Provides the descriptor back to the caller and is used in component registration.  <a href="namespacecfltest__mod.html#ad497f1c406a9c4e356ac57eeed2c7868">More...</a><br /></td></tr>
<tr class="separator:ad497f1c406a9c4e356ac57eeed2c7868"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae76869491a25c005b968fcd414369ef9"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#ae76869491a25c005b968fcd414369ef9">initialisation_callback</a> (current_state)</td></tr>
<tr class="memdesc:ae76869491a25c005b968fcd414369ef9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called at initialisation, will read in configuration and use either configured or default values.  <a href="namespacecfltest__mod.html#ae76869491a25c005b968fcd414369ef9">More...</a><br /></td></tr>
<tr class="separator:ae76869491a25c005b968fcd414369ef9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2b945006854311a179cd5f02369baf4"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#af2b945006854311a179cd5f02369baf4">timestep_callback</a> (current_state)</td></tr>
<tr class="memdesc:af2b945006854311a179cd5f02369baf4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called at each timestep, this will only do the CFL computation every nncfl timesteps (or every timestep up to nncfl) but will ratchet up to the absolute (target) dtm as needed.  <a href="namespacecfltest__mod.html#af2b945006854311a179cd5f02369baf4">More...</a><br /></td></tr>
<tr class="separator:af2b945006854311a179cd5f02369baf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba53a3eb29dbc3e9159bf6c961fd090c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#aba53a3eb29dbc3e9159bf6c961fd090c">update_dtm_based_on_absolute</a> (current_state, cfl_number)</td></tr>
<tr class="memdesc:aba53a3eb29dbc3e9159bf6c961fd090c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the (new) dtm value, which is actioned after time step completion, based upon the absolute value. This is incremented towards the absolute if that is too large a step, and even if the absolute value has not been updated in this timestep, this ratcheting will still occur if needed.  <a href="namespacecfltest__mod.html#aba53a3eb29dbc3e9159bf6c961fd090c">More...</a><br /></td></tr>
<tr class="separator:aba53a3eb29dbc3e9159bf6c961fd090c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a195e3069e29e4400d360377eb8d22351"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#a195e3069e29e4400d360377eb8d22351">perform_cfl_and_galilean_transformation_calculation</a> (current_state)</td></tr>
<tr class="memdesc:a195e3069e29e4400d360377eb8d22351"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs the CFL and Galilean transformation calculations. First locally and then will determine the global value of each calculation. If U, V or W are not active then these are set to 0 and the calculation use these values.  <a href="namespacecfltest__mod.html#a195e3069e29e4400d360377eb8d22351">More...</a><br /></td></tr>
<tr class="separator:a195e3069e29e4400d360377eb8d22351"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcc5f85849feb60d3003294b75459985"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#abcc5f85849feb60d3003294b75459985">get_global_values</a> (local_zumin, local_zumax, local_zvmin, local_zvmax, local_cvel_z, local_cvis, global_zumin, global_zumax, global_zvmin, global_zvmax, global_cvel_z, global_cvis, parallel_state)</td></tr>
<tr class="memdesc:abcc5f85849feb60d3003294b75459985"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the global reduction values based upon the local contributions of CFL and Galilean transformations provided.  <a href="namespacecfltest__mod.html#abcc5f85849feb60d3003294b75459985">More...</a><br /></td></tr>
<tr class="separator:abcc5f85849feb60d3003294b75459985"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a7c80332b84cf6efe87e3dd2249bfa02b"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#a7c80332b84cf6efe87e3dd2249bfa02b">tollerance</a></td></tr>
<tr class="separator:a7c80332b84cf6efe87e3dd2249bfa02b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac85e8a6add7460a28a2f2f447f5ef1fd"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#ac85e8a6add7460a28a2f2f447f5ef1fd">cvismax</a></td></tr>
<tr class="separator:ac85e8a6add7460a28a2f2f447f5ef1fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76e2a4ba5e2c82fc5124cb69345d4cd8"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#a76e2a4ba5e2c82fc5124cb69345d4cd8">cvelmax</a></td></tr>
<tr class="separator:a76e2a4ba5e2c82fc5124cb69345d4cd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0155095ca22fb0129f0e9bec50e49d71"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#a0155095ca22fb0129f0e9bec50e49d71">dtmmax</a></td></tr>
<tr class="separator:a0155095ca22fb0129f0e9bec50e49d71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2863083b5264fa5ca5c79a34d27ce1ea"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#a2863083b5264fa5ca5c79a34d27ce1ea">dtmmin</a></td></tr>
<tr class="separator:a2863083b5264fa5ca5c79a34d27ce1ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28fd8990dca53176bd8515629de6709c"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#a28fd8990dca53176bd8515629de6709c">rincmax</a></td></tr>
<tr class="separator:a28fd8990dca53176bd8515629de6709c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a196afbf830d531114323de5a8a12dc49"><td class="memItemLeft" align="right" valign="top">logical&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacecfltest__mod.html#a196afbf830d531114323de5a8a12dc49">l_monitor_cfl</a></td></tr>
<tr class="separator:a196afbf830d531114323de5a8a12dc49"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This contains the CFL test. It will perform the local advective CFL and Galilean transfromation calculations, compute the global values of these, then check the cfl criterion and determine an absolute new dtm. Depending upon the maximum and increment values this is then smoothed into a new dtm value. The value of dtm is physically set to this new value at the start of the next timestep. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ad497f1c406a9c4e356ac57eeed2c7868"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad497f1c406a9c4e356ac57eeed2c7868">&#9670;&nbsp;</a></span>cfltest_get_descriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structmonc__component__mod_1_1component__descriptor__type.html">component_descriptor_type</a>) function, public cfltest_mod::cfltest_get_descriptor</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Provides the descriptor back to the caller and is used in component registration. </p>
<dl class="section return"><dt>Returns</dt><dd>The termination check component descriptor </dd></dl>

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00031">31</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    cfltest_get_descriptor%name=<span class="stringliteral">&quot;cfltest&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    cfltest_get_descriptor%version=0.1</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    cfltest_get_descriptor%initialisation=&gt;initialisation_callback</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    cfltest_get_descriptor%timestep=&gt;timestep_callback</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacecfltest__mod_ad497f1c406a9c4e356ac57eeed2c7868_cgraph.png" border="0" usemap="#anamespacecfltest__mod_ad497f1c406a9c4e356ac57eeed2c7868_cgraph" alt=""/></div>
<map name="namespacecfltest__mod_ad497f1c406a9c4e356ac57eeed2c7868_cgraph" id="anamespacecfltest__mod_ad497f1c406a9c4e356ac57eeed2c7868_cgraph">
<area shape="rect" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,39,136,80"/>
<area shape="rect" href="namespacecfltest__mod.html#ae76869491a25c005b968fcd414369ef9" title="Called at initialisation, will read in configuration and use either configured or default values." alt="" coords="184,5,347,47"/>
<area shape="rect" href="namespacecfltest__mod.html#af2b945006854311a179cd5f02369baf4" title="Called at each timestep, this will only do the CFL computation every nncfl timesteps (or every timest..." alt="" coords="193,71,338,112"/>
<area shape="rect" href="namespacecfltest__mod.html#a195e3069e29e4400d360377eb8d22351" title="Performs the CFL and Galilean transformation calculations. First locally and then will determine the ..." alt="" coords="395,27,605,83"/>
<area shape="rect" href="namespacecfltest__mod.html#aba53a3eb29dbc3e9159bf6c961fd090c" title="Updates the (new) dtm value, which is actioned after time step completion, based upon the absolute va..." alt="" coords="415,107,585,148"/>
<area shape="rect" href="namespacecfltest__mod.html#abcc5f85849feb60d3003294b75459985" title="Gets the global reduction values based upon the local contributions of CFL and Galilean transformatio..." alt="" coords="653,35,808,76"/>
</map>
</div>

</div>
</div>
<a id="abcc5f85849feb60d3003294b75459985"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcc5f85849feb60d3003294b75459985">&#9670;&nbsp;</a></span>get_global_values()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine cfltest_mod::get_global_values </td>
          <td>(</td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>local_zumin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>local_zumax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>local_zvmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>local_zvmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>local_cvel_z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>local_cvis</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(out)&#160;</td>
          <td class="paramname"><em>global_zumin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(out)&#160;</td>
          <td class="paramname"><em>global_zumax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(out)&#160;</td>
          <td class="paramname"><em>global_zvmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(out)&#160;</td>
          <td class="paramname"><em>global_zvmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(out)&#160;</td>
          <td class="paramname"><em>global_cvel_z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(out)&#160;</td>
          <td class="paramname"><em>global_cvis</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1parallel__state__type.html">parallel_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>parallel_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the global reduction values based upon the local contributions of CFL and Galilean transformations provided. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">local_zumin</td><td>Local contribution to ZU minimum </td></tr>
    <tr><td class="paramname">local_zumax</td><td>Local contribution to ZU maximum </td></tr>
    <tr><td class="paramname">local_zvmin</td><td>Local contribution to ZV minimum </td></tr>
    <tr><td class="paramname">local_zvmax</td><td>Local contribution to ZV maximum </td></tr>
    <tr><td class="paramname">local_cvel_z</td><td>Local contribution to component of Courant number in z </td></tr>
    <tr><td class="paramname">local_cvis</td><td>Local contribution to viscous Courant number </td></tr>
    <tr><td class="paramname">global_zumin</td><td>Globally reduced value of ZU minimum </td></tr>
    <tr><td class="paramname">global_zumax</td><td>Globally reduced value of ZU maximum </td></tr>
    <tr><td class="paramname">global_zvmin</td><td>Globally reduced value of ZV minimum </td></tr>
    <tr><td class="paramname">global_zvmax</td><td>Globally reduced value of ZV maximum </td></tr>
    <tr><td class="paramname">global_cvel_z</td><td>Globally reduced value of contribution to component of Courant number in z </td></tr>
    <tr><td class="paramname">global_cvis</td><td>Globally reduced value of contribution to viscous Courant number </td></tr>
    <tr><td class="paramname">parallel_state</td><td>The parallel state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00200">200</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordtype">type</span>(parallel_state_type), <span class="keywordtype">intent(inout)</span> :: parallel_state</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">intent(in)</span> :: local_zumin, local_zumax, local_zvmin, local_zvmax, local_cvel_z, local_cvis</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">intent(out)</span> :: global_zumin, global_zumax, global_zvmin, global_zvmax, global_cvel_z, global_cvis</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordtype">integer</span> :: ierr</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keyword">call </span>mpi_allreduce(local_zumax, global_zumax, 1, precision_type, mpi_max, parallel_state%monc_communicator, ierr)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keyword">call </span>mpi_allreduce(local_zvmax, global_zvmax, 1, precision_type, mpi_max, parallel_state%monc_communicator, ierr)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keyword">call </span>mpi_allreduce(local_cvel_z, global_cvel_z, 1, precision_type, mpi_max, parallel_state%monc_communicator, ierr)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keyword">call </span>mpi_allreduce(local_cvis, global_cvis, 1, precision_type, mpi_max, parallel_state%monc_communicator, ierr)</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">call </span>mpi_allreduce(local_zumin, global_zumin, 1, precision_type, mpi_min, parallel_state%monc_communicator, ierr)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keyword">call </span>mpi_allreduce(local_zvmin, global_zvmin, 1, precision_type, mpi_min, parallel_state%monc_communicator, ierr)</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacecfltest__mod_abcc5f85849feb60d3003294b75459985_icgraph.png" border="0" usemap="#anamespacecfltest__mod_abcc5f85849feb60d3003294b75459985_icgraph" alt=""/></div>
<map name="namespacecfltest__mod_abcc5f85849feb60d3003294b75459985_icgraph" id="anamespacecfltest__mod_abcc5f85849feb60d3003294b75459985_icgraph">
<area shape="rect" title="Gets the global reduction values based upon the local contributions of CFL and Galilean transformatio..." alt="" coords="636,13,791,54"/>
<area shape="rect" href="namespacecfltest__mod.html#a195e3069e29e4400d360377eb8d22351" title="Performs the CFL and Galilean transformation calculations. First locally and then will determine the ..." alt="" coords="377,5,588,61"/>
<area shape="rect" href="namespacecfltest__mod.html#af2b945006854311a179cd5f02369baf4" title="Called at each timestep, this will only do the CFL computation every nncfl timesteps (or every timest..." alt="" coords="184,13,329,54"/>
<area shape="rect" href="namespacecfltest__mod.html#ad497f1c406a9c4e356ac57eeed2c7868" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,13,136,54"/>
</map>
</div>

</div>
</div>
<a id="ae76869491a25c005b968fcd414369ef9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae76869491a25c005b968fcd414369ef9">&#9670;&nbsp;</a></span>initialisation_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine cfltest_mod::initialisation_callback </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called at initialisation, will read in configuration and use either configured or default values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00040">40</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">target</span> :: current_state</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    current_state%cfl_frequency=options_get_integer(current_state%options_database, <span class="stringliteral">&quot;cfl_frequency&quot;</span>)</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    tollerance=options_get_real(current_state%options_database, <span class="stringliteral">&quot;cfl_tollerance&quot;</span>)</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    cvismax=options_get_real(current_state%options_database, <span class="stringliteral">&quot;cfl_cvismax&quot;</span>)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    cvelmax=options_get_real(current_state%options_database, <span class="stringliteral">&quot;cfl_cvelmax&quot;</span>)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    dtmmax=options_get_real(current_state%options_database, <span class="stringliteral">&quot;cfl_dtmmax&quot;</span>)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    dtmmin=options_get_real(current_state%options_database, <span class="stringliteral">&quot;cfl_dtmmin&quot;</span>)</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    rincmax=options_get_real(current_state%options_database, <span class="stringliteral">&quot;cfl_rincmax&quot;</span>)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    l_monitor_cfl = options_get_logical(current_state%options_database,<span class="stringliteral">&quot;cfl_monitor&quot;</span>)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">allocate</span>(current_state%abswmax(current_state%local_grid%local_domain_end_index(z_index)))</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacecfltest__mod_ae76869491a25c005b968fcd414369ef9_icgraph.png" border="0" usemap="#anamespacecfltest__mod_ae76869491a25c005b968fcd414369ef9_icgraph" alt=""/></div>
<map name="namespacecfltest__mod_ae76869491a25c005b968fcd414369ef9_icgraph" id="anamespacecfltest__mod_ae76869491a25c005b968fcd414369ef9_icgraph">
<area shape="rect" title="Called at initialisation, will read in configuration and use either configured or default values." alt="" coords="184,5,347,47"/>
<area shape="rect" href="namespacecfltest__mod.html#ad497f1c406a9c4e356ac57eeed2c7868" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,136,47"/>
</map>
</div>

</div>
</div>
<a id="a195e3069e29e4400d360377eb8d22351"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a195e3069e29e4400d360377eb8d22351">&#9670;&nbsp;</a></span>perform_cfl_and_galilean_transformation_calculation()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine cfltest_mod::perform_cfl_and_galilean_transformation_calculation </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Performs the CFL and Galilean transformation calculations. First locally and then will determine the global value of each calculation. If U, V or W are not active then these are set to 0 and the calculation use these values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00138">138</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">target</span> :: current_state</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordtype">integer</span> :: k</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: global_zumin, global_zumax, global_zvmin, &amp;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;         global_zvmax, global_cvel_z, global_cvis</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">#ifdef U_ACTIVE</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor"></span>    current_state%local_zumin=current_state%local_zumin+current_state%ugal               <span class="comment">! _undo Gal-trfm                        </span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    current_state%local_zumax=current_state%local_zumax+current_state%ugal</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor"></span>    current_state%local_zumin=0.0_default_precision</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    current_state%local_zumax=0.0_default_precision</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef V_ACTIVE</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor"></span>    current_state%local_zvmin=current_state%local_zvmin+current_state%vgal               <span class="comment">! _undo Gal-trfm                        </span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    current_state%local_zvmax=current_state%local_zvmax+current_state%vgal</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="preprocessor"></span>    current_state%local_zvmin=0.0_default_precision</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    current_state%local_zvmax=0.0_default_precision</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef W_ACTIVE</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor"></span>    current_state%local_cvel_z=current_state%cvel_z</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">do</span> k=2,current_state%local_grid%local_domain_end_index(z_index)-1</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="comment">!  CVELZ will be multiplied by DTM in TESTCFL</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      current_state%local_cvel_z=max(current_state%local_cvel_z, &amp;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;           current_state%abswmax(k)*current_state%global_grid%configuration%vertical%rdzn(k+1))</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="preprocessor"></span>    current_state%local_cvel_z=0.0_default_precision</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>get_global_values(current_state%local_zumin, current_state%local_zumax, current_state%local_zvmin, &amp;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;         current_state%local_zvmax, current_state%local_cvel_z, current_state%cvis, &amp;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;         global_zumin, global_zumax, global_zvmin, global_zvmax, global_cvel_z, global_cvis, current_state%parallel)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">if</span> (current_state%galilean_transformation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">if</span> (.not.current_state%fix_ugal)current_state%ugal=0.5_default_precision*(global_zumin+global_zumax)</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keywordflow">if</span> (.not.current_state%fix_vgal)current_state%vgal=0.5_default_precision*(global_zvmin+global_zvmax)</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      current_state%ugal=0.0_default_precision</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      current_state%vgal=0.0_default_precision</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    current_state%cvel_z=global_cvel_z</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    current_state%cvel_x=max(abs(global_zumax-current_state%ugal), abs(global_zumin-current_state%ugal))</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    current_state%cvel_y=max(abs(global_zvmax-current_state%vgal), abs(global_zvmin-current_state%vgal))</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    current_state%cvis=global_cvis</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacecfltest__mod_a195e3069e29e4400d360377eb8d22351_cgraph.png" border="0" usemap="#anamespacecfltest__mod_a195e3069e29e4400d360377eb8d22351_cgraph" alt=""/></div>
<map name="namespacecfltest__mod_a195e3069e29e4400d360377eb8d22351_cgraph" id="anamespacecfltest__mod_a195e3069e29e4400d360377eb8d22351_cgraph">
<area shape="rect" title="Performs the CFL and Galilean transformation calculations. First locally and then will determine the ..." alt="" coords="5,5,216,61"/>
<area shape="rect" href="namespacecfltest__mod.html#abcc5f85849feb60d3003294b75459985" title="Gets the global reduction values based upon the local contributions of CFL and Galilean transformatio..." alt="" coords="264,13,419,54"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacecfltest__mod_a195e3069e29e4400d360377eb8d22351_icgraph.png" border="0" usemap="#anamespacecfltest__mod_a195e3069e29e4400d360377eb8d22351_icgraph" alt=""/></div>
<map name="namespacecfltest__mod_a195e3069e29e4400d360377eb8d22351_icgraph" id="anamespacecfltest__mod_a195e3069e29e4400d360377eb8d22351_icgraph">
<area shape="rect" title="Performs the CFL and Galilean transformation calculations. First locally and then will determine the ..." alt="" coords="377,5,588,61"/>
<area shape="rect" href="namespacecfltest__mod.html#af2b945006854311a179cd5f02369baf4" title="Called at each timestep, this will only do the CFL computation every nncfl timesteps (or every timest..." alt="" coords="184,13,329,54"/>
<area shape="rect" href="namespacecfltest__mod.html#ad497f1c406a9c4e356ac57eeed2c7868" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,13,136,54"/>
</map>
</div>

</div>
</div>
<a id="af2b945006854311a179cd5f02369baf4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2b945006854311a179cd5f02369baf4">&#9670;&nbsp;</a></span>timestep_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine cfltest_mod::timestep_callback </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called at each timestep, this will only do the CFL computation every nncfl timesteps (or every timestep up to nncfl) but will ratchet up to the absolute (target) dtm as needed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00059">59</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">target</span> :: current_state</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: cfl_number</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">if</span> (mod(current_state%timestep, current_state%cfl_frequency) == 1 .or. &amp;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;         current_state%timestep-current_state%start_timestep .le. current_state%cfl_frequency) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      current_state%cvel=0.0_default_precision</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      current_state%cvel_x=0.0_default_precision</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      current_state%cvel_y=0.0_default_precision</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;      current_state%cvel_z=0.0_default_precision</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="keyword">call </span>perform_cfl_and_galilean_transformation_calculation(current_state)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      current_state%cvel=(current_state%cvel_x*current_state%global_grid%configuration%horizontal%cx+current_state%cvel_y*&amp;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;           current_state%global_grid%configuration%horizontal%cy+current_state%cvel_z)*current_state%dtm</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      current_state%cvis=current_state%cvis*(current_state%dtm * 4)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      cfl_number=current_state%cvis/cvismax+current_state%cvel/cvelmax</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      current_state%absolute_new_dtm=current_state%dtm</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      current_state%update_dtm=.false.</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;      <span class="keywordflow">if</span> (cfl_number .gt. 0.0_default_precision) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">if</span> (cfl_number .lt. (1.0_default_precision-tollerance) .or. cfl_number .gt. (1.0_default_precision+tollerance)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;          current_state%absolute_new_dtm=current_state%dtm/cfl_number</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">call </span>update_dtm_based_on_absolute(current_state, cfl_number)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    current_state%cvis=0.0_default_precision</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacecfltest__mod_af2b945006854311a179cd5f02369baf4_cgraph.png" border="0" usemap="#anamespacecfltest__mod_af2b945006854311a179cd5f02369baf4_cgraph" alt=""/></div>
<map name="namespacecfltest__mod_af2b945006854311a179cd5f02369baf4_cgraph" id="anamespacecfltest__mod_af2b945006854311a179cd5f02369baf4_cgraph">
<area shape="rect" title="Called at each timestep, this will only do the CFL computation every nncfl timesteps (or every timest..." alt="" coords="5,49,151,90"/>
<area shape="rect" href="namespacecfltest__mod.html#a195e3069e29e4400d360377eb8d22351" title="Performs the CFL and Galilean transformation calculations. First locally and then will determine the ..." alt="" coords="199,5,409,61"/>
<area shape="rect" href="namespacecfltest__mod.html#aba53a3eb29dbc3e9159bf6c961fd090c" title="Updates the (new) dtm value, which is actioned after time step completion, based upon the absolute va..." alt="" coords="219,85,389,126"/>
<area shape="rect" href="namespacecfltest__mod.html#abcc5f85849feb60d3003294b75459985" title="Gets the global reduction values based upon the local contributions of CFL and Galilean transformatio..." alt="" coords="457,13,612,54"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacecfltest__mod_af2b945006854311a179cd5f02369baf4_icgraph.png" border="0" usemap="#anamespacecfltest__mod_af2b945006854311a179cd5f02369baf4_icgraph" alt=""/></div>
<map name="namespacecfltest__mod_af2b945006854311a179cd5f02369baf4_icgraph" id="anamespacecfltest__mod_af2b945006854311a179cd5f02369baf4_icgraph">
<area shape="rect" title="Called at each timestep, this will only do the CFL computation every nncfl timesteps (or every timest..." alt="" coords="184,5,329,47"/>
<area shape="rect" href="namespacecfltest__mod.html#ad497f1c406a9c4e356ac57eeed2c7868" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,136,47"/>
</map>
</div>

</div>
</div>
<a id="aba53a3eb29dbc3e9159bf6c961fd090c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba53a3eb29dbc3e9159bf6c961fd090c">&#9670;&nbsp;</a></span>update_dtm_based_on_absolute()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine cfltest_mod::update_dtm_based_on_absolute </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>cfl_number</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Updates the (new) dtm value, which is actioned after time step completion, based upon the absolute value. This is incremented towards the absolute if that is too large a step, and even if the absolute value has not been updated in this timestep, this ratcheting will still occur if needed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00095">95</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">target</span> :: current_state</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">intent(in)</span>      :: cfl_number</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">if</span> (current_state%dtm .ne. current_state%absolute_new_dtm .and. &amp;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;         (current_state%dtm .ne. dtmmax .or. current_state%absolute_new_dtm .lt. dtmmax)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      current_state%update_dtm=.true.</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      current_state%dtm_new=min(current_state%dtm*(1.0_default_precision+rincmax), current_state%absolute_new_dtm, dtmmax)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="comment">!! --- Diagnostic Writing -----------------</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="keywordflow">if</span> (current_state%parallel%my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacelogging__mod.html#ae0d255e756059bc76b2f4291825e59c9">log_get_logging_level</a>() .eq. <a class="code" href="namespacelogging__mod.html#aca1c925af27b4d533d548bfe69a819f3">log_debug</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#aca1c925af27b4d533d548bfe69a819f3">log_debug</a>, <span class="stringliteral">&quot;dtm changed from &quot;</span>//trim(conv_to_string(current_state%dtm, 5))//<span class="stringliteral">&quot; to &quot;</span>//&amp;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;               trim(conv_to_string(current_state%dtm_new, 5)))</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">if</span> (current_state%dtm_new .lt. dtmmin) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Timestep too small, dtmnew=&quot;</span>//trim(conv_to_string(current_state%dtm_new, 5))//&amp;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;               <span class="stringliteral">&quot; dtmmin=&quot;</span>//trim(conv_to_string(dtmmin, 5)))</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">if</span> (l_monitor_cfl) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ac7d5c1fcb00d54277580c10556aa78a8">log_info</a>, <span class="stringliteral">&quot; --- CFL Monitoring Information --- &quot;</span>)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ac7d5c1fcb00d54277580c10556aa78a8">log_info</a>, <span class="stringliteral">&quot;dtm changed from &quot;</span>//trim(conv_to_string(current_state%dtm, 5))//<span class="stringliteral">&quot; to &quot;</span>//&amp;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                 trim(conv_to_string(current_state%dtm_new, 5)))</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;          <span class="keywordflow">if</span> (cfl_number .gt. 0.0) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ac7d5c1fcb00d54277580c10556aa78a8">log_info</a>, <span class="stringliteral">&quot;cfl_number :  &quot;</span>//trim(conv_to_string(cfl_number))//<span class="stringliteral">&quot;  (change divisor)&quot;</span>)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ac7d5c1fcb00d54277580c10556aa78a8">log_info</a>, <span class="stringliteral">&quot;cvis       :  &quot;</span>//trim(conv_to_string(current_state%cvis)) )</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ac7d5c1fcb00d54277580c10556aa78a8">log_info</a>, <span class="stringliteral">&quot;cvel       :  &quot;</span>//trim(conv_to_string(current_state%cvel)) )</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ac7d5c1fcb00d54277580c10556aa78a8">log_info</a>, <span class="stringliteral">&quot;dtm change due to ratcheting only. Target dtm unchanged.&quot;</span>)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ac7d5c1fcb00d54277580c10556aa78a8">log_info</a>, <span class="stringliteral">&quot;target dtm :  &quot;</span>//trim(conv_to_string(current_state%absolute_new_dtm)) )</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;          <span class="keyword">call </span>log_newline()</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordflow">        end if</span> <span class="comment">! l_monitor_cfl</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keywordflow">      end if</span> <span class="comment">! Diagnostic Writing</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacecfltest__mod_aba53a3eb29dbc3e9159bf6c961fd090c_icgraph.png" border="0" usemap="#anamespacecfltest__mod_aba53a3eb29dbc3e9159bf6c961fd090c_icgraph" alt=""/></div>
<map name="namespacecfltest__mod_aba53a3eb29dbc3e9159bf6c961fd090c_icgraph" id="anamespacecfltest__mod_aba53a3eb29dbc3e9159bf6c961fd090c_icgraph">
<area shape="rect" title="Updates the (new) dtm value, which is actioned after time step completion, based upon the absolute va..." alt="" coords="377,5,548,47"/>
<area shape="rect" href="namespacecfltest__mod.html#af2b945006854311a179cd5f02369baf4" title="Called at each timestep, this will only do the CFL computation every nncfl timesteps (or every timest..." alt="" coords="184,5,329,47"/>
<area shape="rect" href="namespacecfltest__mod.html#ad497f1c406a9c4e356ac57eeed2c7868" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,136,47"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a76e2a4ba5e2c82fc5124cb69345d4cd8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76e2a4ba5e2c82fc5124cb69345d4cd8">&#9670;&nbsp;</a></span>cvelmax</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision) cfltest_mod::cvelmax</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00023">23</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>

</div>
</div>
<a id="ac85e8a6add7460a28a2f2f447f5ef1fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac85e8a6add7460a28a2f2f447f5ef1fd">&#9670;&nbsp;</a></span>cvismax</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision) cfltest_mod::cvismax</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00023">23</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>

</div>
</div>
<a id="a0155095ca22fb0129f0e9bec50e49d71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0155095ca22fb0129f0e9bec50e49d71">&#9670;&nbsp;</a></span>dtmmax</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision) cfltest_mod::dtmmax</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00023">23</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>

</div>
</div>
<a id="a2863083b5264fa5ca5c79a34d27ce1ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2863083b5264fa5ca5c79a34d27ce1ea">&#9670;&nbsp;</a></span>dtmmin</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision) cfltest_mod::dtmmin</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00023">23</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>

</div>
</div>
<a id="a196afbf830d531114323de5a8a12dc49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a196afbf830d531114323de5a8a12dc49">&#9670;&nbsp;</a></span>l_monitor_cfl</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical cfltest_mod::l_monitor_cfl</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00024">24</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordtype">logical</span> l_monitor_cfl</div>
</div><!-- fragment -->
</div>
</div>
<a id="a28fd8990dca53176bd8515629de6709c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28fd8990dca53176bd8515629de6709c">&#9670;&nbsp;</a></span>rincmax</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision) cfltest_mod::rincmax</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00023">23</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>

</div>
</div>
<a id="a7c80332b84cf6efe87e3dd2249bfa02b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c80332b84cf6efe87e3dd2249bfa02b">&#9670;&nbsp;</a></span>tollerance</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision) cfltest_mod::tollerance</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cfltest_8F90_source.html#l00023">23</a> of file <a class="el" href="cfltest_8F90_source.html">cfltest.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keywordtype">  real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: tollerance, cvismax, cvelmax, dtmmax, dtmmin, rincmax</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<div class="ttc" id="anamespacelogging__mod_html_ad68309846cd8f9e77edaa6abd02f65a0"><div class="ttname"><a href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">logging_mod::log_error</a></div><div class="ttdeci">integer, parameter, public log_error</div><div class="ttdoc">Only log ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00011">logging.F90:11</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ac7d5c1fcb00d54277580c10556aa78a8"><div class="ttname"><a href="namespacelogging__mod.html#ac7d5c1fcb00d54277580c10556aa78a8">logging_mod::log_info</a></div><div class="ttdeci">integer, parameter, public log_info</div><div class="ttdoc">Log INFO, WARNING and ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00013">logging.F90:13</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ac4f13ac385499c85190cb184030e4f45"><div class="ttname"><a href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">logging_mod::log_log</a></div><div class="ttdeci">subroutine, public log_log(level, message, str)</div><div class="ttdoc">Logs a message at the specified level. If the level is above the current level then the message is ig...</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00074">logging.F90:75</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ae0d255e756059bc76b2f4291825e59c9"><div class="ttname"><a href="namespacelogging__mod.html#ae0d255e756059bc76b2f4291825e59c9">logging_mod::log_get_logging_level</a></div><div class="ttdeci">integer function, public log_get_logging_level()</div><div class="ttdoc">Retrieves the current logging level.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00121">logging.F90:122</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_aca1c925af27b4d533d548bfe69a819f3"><div class="ttname"><a href="namespacelogging__mod.html#aca1c925af27b4d533d548bfe69a819f3">logging_mod::log_debug</a></div><div class="ttdeci">integer, parameter, public log_debug</div><div class="ttdoc">Log DEBUG, INFO, WARNING and ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00014">logging.F90:14</a></div></div>
<div class="ttc" id="anamespacedatadefn__mod_html_a39b79f8cc843d236d3b47f5c81b64368"><div class="ttname"><a href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">datadefn_mod::default_precision</a></div><div class="ttdeci">integer, parameter, public default_precision</div><div class="ttdoc">MPI communication type which we use for the prognostic and calculation data.</div><div class="ttdef"><b>Definition:</b> <a href="datadefn_8F90_source.html#l00017">datadefn.F90:17</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>

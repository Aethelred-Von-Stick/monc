<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MONC: gridmanager_mod Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MONC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">gridmanager_mod Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Manages the grid based upon the model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a>.  
<a href="namespacegridmanager__mod.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ad1594b9175d56289645df4961045ce14"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structmonc__component__mod_1_1component__descriptor__type.html">component_descriptor_type</a>) function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14">gridmanager_get_descriptor</a> ()</td></tr>
<tr class="memdesc:ad1594b9175d56289645df4961045ce14"><td class="mdescLeft">&#160;</td><td class="mdescRight">Provides the descriptor back to the caller and is used in component registration.  <a href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14">More...</a><br /></td></tr>
<tr class="separator:ad1594b9175d56289645df4961045ce14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accbda17db8d0527f3465f22de5befd1f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f">initialise_callback</a> (current_state)</td></tr>
<tr class="memdesc:accbda17db8d0527f3465f22de5befd1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called during initialisation and will initialise the horizontal and vertical grid configurations Note that the model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> (from a checkpoint or external file) must have been initialised already.  <a href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f">More...</a><br /></td></tr>
<tr class="separator:accbda17db8d0527f3465f22de5befd1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba6cf6e19cbef2f1bd32083ab240af35"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#aba6cf6e19cbef2f1bd32083ab240af35">finalise_callback</a> (current_state)</td></tr>
<tr class="memdesc:aba6cf6e19cbef2f1bd32083ab240af35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called as MONC exits, for good practice this will deallocate the memory used for the grids.  <a href="namespacegridmanager__mod.html#aba6cf6e19cbef2f1bd32083ab240af35">More...</a><br /></td></tr>
<tr class="separator:aba6cf6e19cbef2f1bd32083ab240af35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb240afc3ced768c76ca5a87db0bf765"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765">initialise_verticalgrid_configuration_type</a> (current_state)</td></tr>
<tr class="memdesc:adb240afc3ced768c76ca5a87db0bf765"><td class="mdescLeft">&#160;</td><td class="mdescRight">Will initialise the vertical grid configuration.  <a href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765">More...</a><br /></td></tr>
<tr class="separator:adb240afc3ced768c76ca5a87db0bf765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4db48ff47153c3be2595066a0cfe302c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c">set_vertical_reference_profile</a> (current_state, vertical_grid, kkp)</td></tr>
<tr class="memdesc:a4db48ff47153c3be2595066a0cfe302c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up the vertical grid reference profile at each point.  <a href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c">More...</a><br /></td></tr>
<tr class="separator:a4db48ff47153c3be2595066a0cfe302c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c89fcab80ba1019407877e035e99e96"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a3c89fcab80ba1019407877e035e99e96">calculate_initial_profiles</a> (current_state, vertical_grid)</td></tr>
<tr class="memdesc:a3c89fcab80ba1019407877e035e99e96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the initial profiles for U, V, TH &amp; Q if required.  <a href="namespacegridmanager__mod.html#a3c89fcab80ba1019407877e035e99e96">More...</a><br /></td></tr>
<tr class="separator:a3c89fcab80ba1019407877e035e99e96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8be24cf4b5ebf1cbbfe56a074926b3f2"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a8be24cf4b5ebf1cbbfe56a074926b3f2">calculate_mixing_length_for_neutral_case</a> (current_state, vertical_grid, kkp)</td></tr>
<tr class="memdesc:a8be24cf4b5ebf1cbbfe56a074926b3f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the mixing length for the neutral case.  <a href="namespacegridmanager__mod.html#a8be24cf4b5ebf1cbbfe56a074926b3f2">More...</a><br /></td></tr>
<tr class="separator:a8be24cf4b5ebf1cbbfe56a074926b3f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab284abd10a4ca93aa7fc592fcacace02"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#ab284abd10a4ca93aa7fc592fcacace02">set_buoyancy_coefficient</a> (current_state, vertical_grid, kkp)</td></tr>
<tr class="memdesc:ab284abd10a4ca93aa7fc592fcacace02"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the buoyancy coefficient from the grid configuration and configuration.  <a href="namespacegridmanager__mod.html#ab284abd10a4ca93aa7fc592fcacace02">More...</a><br /></td></tr>
<tr class="separator:ab284abd10a4ca93aa7fc592fcacace02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9f6591616fcf44968eb27608ab3e793"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#ae9f6591616fcf44968eb27608ab3e793">setup_reference_state_liquid_water_temperature_and_saturation</a> (current_state, vertical_grid, kkp)</td></tr>
<tr class="memdesc:ae9f6591616fcf44968eb27608ab3e793"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setting up reference state liquid water temperature and saturation mixing ratio on main levels.  <a href="namespacegridmanager__mod.html#ae9f6591616fcf44968eb27608ab3e793">More...</a><br /></td></tr>
<tr class="separator:ae9f6591616fcf44968eb27608ab3e793"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a644550580a73a9f92ffcdfbb3e1e037e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a644550580a73a9f92ffcdfbb3e1e037e">set_up_vertical_reference_properties</a> (current_state, vertical_grid, kkp)</td></tr>
<tr class="memdesc:a644550580a73a9f92ffcdfbb3e1e037e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up the reference properties for the vertical grid at each point.  <a href="namespacegridmanager__mod.html#a644550580a73a9f92ffcdfbb3e1e037e">More...</a><br /></td></tr>
<tr class="separator:a644550580a73a9f92ffcdfbb3e1e037e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a528bb773c3a3d670aae00cce7a19d56a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a528bb773c3a3d670aae00cce7a19d56a">set_up_and_smooth_grid</a> (vertical_grid, kgd, hgd, ninitp, kkp, zztop, nsmth, origional_setup, continuation_run)</td></tr>
<tr class="memdesc:a528bb773c3a3d670aae00cce7a19d56a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up and smooths the vertical grid. This is based upon the grid configuration already read in.  <a href="namespacegridmanager__mod.html#a528bb773c3a3d670aae00cce7a19d56a">More...</a><br /></td></tr>
<tr class="separator:a528bb773c3a3d670aae00cce7a19d56a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05f22855870eb71f65d8f178a6df5db7"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a05f22855870eb71f65d8f178a6df5db7">original_vertical_grid_setup</a> (vertical_grid, kgd, hgd, ninitp, kkp, zztop, nsmth)</td></tr>
<tr class="memdesc:a05f22855870eb71f65d8f178a6df5db7"><td class="mdescLeft">&#160;</td><td class="mdescRight">The original vertical grid setup and smoothing as per the LEM.  <a href="namespacegridmanager__mod.html#a05f22855870eb71f65d8f178a6df5db7">More...</a><br /></td></tr>
<tr class="separator:a05f22855870eb71f65d8f178a6df5db7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43acffd915e44ba2a4ee85c35201258c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a43acffd915e44ba2a4ee85c35201258c">new_vertical_grid_setup</a> (vertical_grid, kgd, kkp, zztop)</td></tr>
<tr class="memdesc:a43acffd915e44ba2a4ee85c35201258c"><td class="mdescLeft">&#160;</td><td class="mdescRight">The newer vertical grid setup routine.  <a href="namespacegridmanager__mod.html#a43acffd915e44ba2a4ee85c35201258c">More...</a><br /></td></tr>
<tr class="separator:a43acffd915e44ba2a4ee85c35201258c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9cfe0c92dec4ecc2104d9dedf421d7c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#af9cfe0c92dec4ecc2104d9dedf421d7c">create_linear_grid</a> (vertical_grid, kgd, hgd, ninitp, kkp, zztop)</td></tr>
<tr class="memdesc:af9cfe0c92dec4ecc2104d9dedf421d7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates the linear vertical grid based upon the configuration properties.  <a href="namespacegridmanager__mod.html#af9cfe0c92dec4ecc2104d9dedf421d7c">More...</a><br /></td></tr>
<tr class="separator:af9cfe0c92dec4ecc2104d9dedf421d7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3206ebfbd969e132b9bb0da141e2c4a"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#af3206ebfbd969e132b9bb0da141e2c4a">allocate_vertical_grid_data</a> (vertical_grid, n, nq)</td></tr>
<tr class="memdesc:af3206ebfbd969e132b9bb0da141e2c4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates the data required for the vertical grid configuration.  <a href="namespacegridmanager__mod.html#af3206ebfbd969e132b9bb0da141e2c4a">More...</a><br /></td></tr>
<tr class="separator:af3206ebfbd969e132b9bb0da141e2c4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeee220119e02496171725a55e4fda143"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#aeee220119e02496171725a55e4fda143">initialise_horizontalgrid_configuration_types</a> (current_state)</td></tr>
<tr class="memdesc:aeee220119e02496171725a55e4fda143"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialises the horizontal grid configurations.  <a href="namespacegridmanager__mod.html#aeee220119e02496171725a55e4fda143">More...</a><br /></td></tr>
<tr class="separator:aeee220119e02496171725a55e4fda143"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a718c3a9ed0280fd54eae4e006f1f85e0"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a718c3a9ed0280fd54eae4e006f1f85e0">set_anelastic_pressure</a> (current_state)</td></tr>
<tr class="memdesc:a718c3a9ed0280fd54eae4e006f1f85e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set reference profile of potential temperature for the Boussinesq/Anelastic approximation Note that this is not in general the same as the profile defining the initial vertical distribution of potential temperature for the integration. In particular, while the later may contain sharp changes in gradient representing a capping inversion or the tropopause, for example, the reference profile should be smooth.  <a href="namespacegridmanager__mod.html#a718c3a9ed0280fd54eae4e006f1f85e0">More...</a><br /></td></tr>
<tr class="separator:a718c3a9ed0280fd54eae4e006f1f85e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a505b54357dac9e98045ca14eb17e1c2f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a505b54357dac9e98045ca14eb17e1c2f">compute_anelastic_pressure_profile_only</a> (current_state)</td></tr>
<tr class="memdesc:a505b54357dac9e98045ca14eb17e1c2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the anelastic pressure only - if we are using Boussinesq approximation.  <a href="namespacegridmanager__mod.html#a505b54357dac9e98045ca14eb17e1c2f">More...</a><br /></td></tr>
<tr class="separator:a505b54357dac9e98045ca14eb17e1c2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6d17b932809a5c15d314e9cd266298b"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#ae6d17b932809a5c15d314e9cd266298b">compute_anelastic_pressure_profile_and_density</a> (current_state)</td></tr>
<tr class="memdesc:ae6d17b932809a5c15d314e9cd266298b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the anelastic pressure and density - if we are using Anelastic approximation.  <a href="namespacegridmanager__mod.html#ae6d17b932809a5c15d314e9cd266298b">More...</a><br /></td></tr>
<tr class="separator:ae6d17b932809a5c15d314e9cd266298b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99b4427e1d4243af039b6ab0e40424bd"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a99b4427e1d4243af039b6ab0e40424bd">check_top</a> (zztop, z, info)</td></tr>
<tr class="separator:a99b4427e1d4243af039b6ab0e40424bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0802299155d2b12297fc904d30d32c61"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a0802299155d2b12297fc904d30d32c61">check_input_levels</a> (z_levels, field_levels, field)</td></tr>
<tr class="separator:a0802299155d2b12297fc904d30d32c61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa00d0ec2e1c1ec0d5e065004cd1d6b9f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#aa00d0ec2e1c1ec0d5e065004cd1d6b9f">set_qv_init_from_rh</a> (current_state)</td></tr>
<tr class="separator:aa00d0ec2e1c1ec0d5e065004cd1d6b9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0225dc0ad66fd99af71fb8b5e963bb40"><td class="memItemLeft" align="right" valign="top">integer, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a0225dc0ad66fd99af71fb8b5e963bb40">anelastic_profile_mode</a> =4</td></tr>
<tr class="separator:a0225dc0ad66fd99af71fb8b5e963bb40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af41ba8e0a62fd8dbc010bc4a24dee544"><td class="memItemLeft" align="right" valign="top">real, parameter&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#af41ba8e0a62fd8dbc010bc4a24dee544">default_spacing</a> = 1.E9</td></tr>
<tr class="memdesc:af41ba8e0a62fd8dbc010bc4a24dee544"><td class="mdescLeft">&#160;</td><td class="mdescRight">The default spacing used if no grid is active in a specific dimension.  <a href="namespacegridmanager__mod.html#af41ba8e0a62fd8dbc010bc4a24dee544">More...</a><br /></td></tr>
<tr class="separator:af41ba8e0a62fd8dbc010bc4a24dee544"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bcdfdb1f24895751f2d8adb360f5cc6"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision), dimension(:,:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacegridmanager__mod.html#a0bcdfdb1f24895751f2d8adb360f5cc6">qinit</a></td></tr>
<tr class="separator:a0bcdfdb1f24895751f2d8adb360f5cc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Manages the grid based upon the model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a>. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="af3206ebfbd969e132b9bb0da141e2c4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3206ebfbd969e132b9bb0da141e2c4a">&#9670;&nbsp;</a></span>allocate_vertical_grid_data()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::allocate_vertical_grid_data </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocates the data required for the vertical grid configuration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid that we are working with </td></tr>
    <tr><td class="paramname">n</td><td>The number of grid points in the vertical </td></tr>
    <tr><td class="paramname">nq</td><td>The number of q fields </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00648">648</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: n</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nq</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keyword">allocate</span>(vertical_grid%dz(n), vertical_grid%dzn(n),&amp;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;         vertical_grid%czb(n), vertical_grid%cza(n), vertical_grid%czg(n), vertical_grid%czh(n),&amp;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;         vertical_grid%rdz(n), vertical_grid%rdzn(n), vertical_grid%tzc1(n), vertical_grid%tzc2(n),&amp;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;         vertical_grid%tzd1(n), vertical_grid%tzd2(n), vertical_grid%theta_init(n), vertical_grid%temp_init(n), &amp;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;         vertical_grid%rh_init(n), &amp;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;         vertical_grid%tref(n), vertical_grid%prefn(n), vertical_grid%pdiff(n), vertical_grid%prefrcp(n), &amp;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;         vertical_grid%rprefrcp(n), vertical_grid%rho(n), vertical_grid%rhon(n), vertical_grid%tstarpr(n), &amp;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;         vertical_grid%qsat(n), vertical_grid%dqsatdt(n), vertical_grid%qsatfac(n), vertical_grid%dthref(n), &amp;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;         vertical_grid%rneutml(n), vertical_grid%rneutml_sq(n), vertical_grid%buoy_co(n), &amp;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;         vertical_grid%u_init(n), vertical_grid%v_init(n), vertical_grid%theta_rand(n), vertical_grid%w_rand(n), &amp;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;         vertical_grid%w_subs(n), vertical_grid%u_force(n), vertical_grid%v_force(n), vertical_grid%theta_force(n))</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">if</span> (.not. <span class="keyword">allocated</span>(vertical_grid%thref)) <span class="keyword">allocate</span>(vertical_grid%thref(n))</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">if</span> (.not. <span class="keyword">allocated</span>(vertical_grid%z)) <span class="keyword">allocate</span>(vertical_grid%z(n))</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">if</span> (.not. <span class="keyword">allocated</span>(vertical_grid%zn)) <span class="keyword">allocate</span>(vertical_grid%zn(n))</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160; </div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keyword">allocate</span>(vertical_grid%q_rand(n,nq), vertical_grid%q_init(n,nq), vertical_grid%q_force(n,nq))</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_af3206ebfbd969e132b9bb0da141e2c4a_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_af3206ebfbd969e132b9bb0da141e2c4a_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_af3206ebfbd969e132b9bb0da141e2c4a_icgraph" id="anamespacegridmanager__mod_af3206ebfbd969e132b9bb0da141e2c4a_icgraph">
<area shape="rect" title="Allocates the data required for the vertical grid configuration." alt="" coords="733,5,909,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a3c89fcab80ba1019407877e035e99e96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c89fcab80ba1019407877e035e99e96">&#9670;&nbsp;</a></span>calculate_initial_profiles()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::calculate_initial_profiles </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculates the initial profiles for U, V, TH &amp; Q if required. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid that we are working on </td></tr>
    <tr><td class="paramname">kkp</td><td>Number of grid points in a vertical column </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00164">164</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordtype">integer</span> :: nq_init <span class="comment">! The number of q fields to initialize</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordtype">integer</span> :: nzq     <span class="comment">! The number of input levels for q_init</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordtype">integer</span> :: i,j,n, k <span class="comment">! loop counters</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordtype">integer</span> :: iq  <span class="comment">! temporary q varible index</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">allocatable</span> :: f_init_pl_q       <span class="comment">! Initial node values for q variables</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: z_init_pl_q      <span class="comment">! Initial node height values for q variables</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: f_init_pl_theta  <span class="comment">! Initial node values for potential temperature variable</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: z_init_pl_theta  <span class="comment">! Initial node height values for potential temperature variable</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: f_init_pl_u      <span class="comment">! Initial node values for u variable</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: z_init_pl_u      <span class="comment">! Initial node height values for u variable</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: f_init_pl_v      <span class="comment">! Initial node values for v variable</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: z_init_pl_v      <span class="comment">! Initial node height values for v variable</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160; </div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: f_thref   <span class="comment">! Initial node values for thref</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: z_thref   <span class="comment">! Initial node height values for thref</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordtype">logical</span> :: l_init_pl_u     <span class="comment">! if .true. then initialize u field</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordtype">logical</span> :: l_init_pl_v     <span class="comment">! if .true. then initialize v field</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">logical</span> :: l_init_pl_theta <span class="comment">! if .true. then initialize potential temperature field</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">logical</span> :: l_init_pl_rh    <span class="comment">! if .true. then initialize relative humidity field</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">logical</span> :: l_init_pl_q     <span class="comment">! if .true. then initialize q fields</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">logical</span> :: l_thref         <span class="comment">! if .true. then initialize thref profile (overrides thref0)</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">logical</span> :: l_matchthref    <span class="comment">! if .true. then initialize thref to be the same as theta_init</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: names_init_pl_q <span class="comment">! names of q variables to initialize</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">allocatable</span> :: f_init_pl_q_tmp(:) <span class="comment">!temporary 1D storage of initial q field</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">allocatable</span> :: zgrid(:)  <span class="comment">! z grid to use in interpolation</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: zztop <span class="comment">! top of the domain</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: qsat</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keyword">allocate</span>(zgrid(current_state%local_grid%local_domain_end_index(z_index)))</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    zztop = current_state%global_grid%top(z_index)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">! Initialize everything to zero.  This won&#39;t make sense for theta.</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    vertical_grid%q_init = 0.0_default_precision</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    vertical_grid%u_init = 0.0_default_precision</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    vertical_grid%v_init = 0.0_default_precision</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    vertical_grid%theta_init = 0.0_default_precision</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    l_init_pl_theta=options_get_logical(current_state%options_database, <span class="stringliteral">&quot;l_init_pl_theta&quot;</span>)</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    l_init_pl_rh=options_get_logical(current_state%options_database, <span class="stringliteral">&quot;l_init_pl_rh&quot;</span>) </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    l_init_pl_q=options_get_logical(current_state%options_database, <span class="stringliteral">&quot;l_init_pl_q&quot;</span>)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">if</span> (l_init_pl_q) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keyword">allocate</span>(names_init_pl_q(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;names_init_pl_q&quot;</span>)))</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keyword">call </span>options_get_string_array(current_state%options_database, <span class="stringliteral">&quot;names_init_pl_q&quot;</span>, names_init_pl_q)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">do</span> n = 1,<span class="keyword">size</span>(names_init_pl_q)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;         <span class="keywordflow">if</span> (trim(names_init_pl_q(n)) .eq. <span class="stringliteral">&#39;vapour&#39;</span> .and. l_init_pl_rh) <span class="keywordflow">then</span> </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">log_master_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Initialisation of vapour and RH - STOP&quot;</span>)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keywordflow">         endif</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    l_init_pl_u=options_get_logical(current_state%options_database, <span class="stringliteral">&quot;l_init_pl_u&quot;</span>)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    l_init_pl_v=options_get_logical(current_state%options_database, <span class="stringliteral">&quot;l_init_pl_v&quot;</span>)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    l_thref=options_get_logical(current_state%options_database, <span class="stringliteral">&quot;l_thref&quot;</span>)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    l_matchthref=options_get_logical(current_state%options_database, <span class="stringliteral">&quot;l_matchthref&quot;</span>)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span> (l_thref)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordflow">if</span> (.not. l_matchthref)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keyword">allocate</span>(z_thref(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;z_thref&quot;</span>)), &amp;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;             f_thref(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;f_thref&quot;</span>)))</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;z_thref&quot;</span>, z_thref)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;f_thref&quot;</span>, f_thref)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keyword">call </span>check_top(zztop, z_thref(<span class="keyword">size</span>(z_thref)), <span class="stringliteral">&#39;z_thref&#39;</span>)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        zgrid=current_state%global_grid%configuration%vertical%zn(:)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keyword">call </span>piecewise_linear_1d(z_thref(1:<span class="keyword">size</span>(z_thref)), f_thref(1:<span class="keyword">size</span>(f_thref)), zgrid, &amp;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;           current_state%global_grid%configuration%vertical%thref)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keyword">deallocate</span>(z_thref, f_thref)</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      current_state%global_grid%configuration%vertical%thref(:)=current_state%thref0</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">if</span> (l_init_pl_theta)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keyword">allocate</span>(z_init_pl_theta(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;z_init_pl_theta&quot;</span>)), &amp;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;             f_init_pl_theta(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;f_init_pl_theta&quot;</span>)))</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;z_init_pl_theta&quot;</span>, z_init_pl_theta)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;f_init_pl_theta&quot;</span>, f_init_pl_theta)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <span class="keyword">call </span>check_top(zztop, z_init_pl_theta(<span class="keyword">size</span>(z_init_pl_theta)), <span class="stringliteral">&#39;z_init_pl_theta&#39;</span>)</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keyword">call </span>check_input_levels(<span class="keyword">size</span>(z_init_pl_theta), <span class="keyword">size</span>(f_init_pl_theta), <span class="stringliteral">&quot;f_init_pl_theta&quot;</span>)</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      zgrid=current_state%global_grid%configuration%vertical%zn(:)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="keyword">call </span>piecewise_linear_1d(z_init_pl_theta(1:<span class="keyword">size</span>(z_init_pl_theta)), f_init_pl_theta(1:<span class="keyword">size</span>(f_init_pl_theta)), zgrid, &amp;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;         current_state%global_grid%configuration%vertical%theta_init)</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keywordflow">if</span> (l_matchthref) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;         <span class="keywordflow">if</span>(.not. current_state%use_anelastic_equations) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;           <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">log_master_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Non-anelastic equation set and l_maththref are incompatible&quot;</span>)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keywordflow">         end if</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;         current_state%global_grid%configuration%vertical%thref = current_state%global_grid%configuration%vertical%theta_init</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <span class="keywordflow">if</span> (.not. current_state%continuation_run) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">do</span> i=current_state%local_grid%local_domain_start_index(x_index), current_state%local_grid%local_domain_end_index(x_index)</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;          <span class="keywordflow">do</span> j=current_state%local_grid%local_domain_start_index(y_index), current_state%local_grid%local_domain_end_index(y_index)</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            current_state%th%data(:,j,i) = current_state%global_grid%configuration%vertical%theta_init(:) - &amp;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                 current_state%global_grid%configuration%vertical%thref(:) </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="keyword">deallocate</span>(z_init_pl_theta, f_init_pl_theta)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">if</span> (l_init_pl_u)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keyword">allocate</span>(z_init_pl_u(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;z_init_pl_u&quot;</span>)), &amp;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;             f_init_pl_u(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;f_init_pl_u&quot;</span>)))</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;z_init_pl_u&quot;</span>, z_init_pl_u)</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;f_init_pl_u&quot;</span>, f_init_pl_u)</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keyword">call </span>check_top(zztop, z_init_pl_u(<span class="keyword">size</span>(z_init_pl_u)), <span class="stringliteral">&#39;z_init_pl_u&#39;</span>)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <span class="keyword">call </span>check_input_levels(<span class="keyword">size</span>(z_init_pl_u), <span class="keyword">size</span>(f_init_pl_u), <span class="stringliteral">&quot;f_init_pl_u&quot;</span>)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      zgrid=current_state%global_grid%configuration%vertical%zn(:)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keyword">call </span>piecewise_linear_1d(z_init_pl_u(1:<span class="keyword">size</span>(z_init_pl_u)), f_init_pl_u(1:<span class="keyword">size</span>(f_init_pl_u)), &amp;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;         zgrid, current_state%global_grid%configuration%vertical%u_init)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordflow">if</span> (.not. current_state%continuation_run) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">do</span> i=current_state%local_grid%local_domain_start_index(x_index), current_state%local_grid%local_domain_end_index(x_index)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;          <span class="keywordflow">do</span> j=current_state%local_grid%local_domain_start_index(y_index), current_state%local_grid%local_domain_end_index(y_index)</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            current_state%u%data(:,j,i) = current_state%global_grid%configuration%vertical%u_init(:)</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keyword">deallocate</span>(z_init_pl_u, f_init_pl_u)</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">if</span> (l_init_pl_v)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <span class="keyword">allocate</span>(z_init_pl_v(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;z_init_pl_v&quot;</span>)), &amp;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;             f_init_pl_v(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;f_init_pl_v&quot;</span>)))</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;z_init_pl_v&quot;</span>, z_init_pl_v)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;f_init_pl_v&quot;</span>, f_init_pl_v)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keyword">call </span>check_top(zztop, z_init_pl_v(<span class="keyword">size</span>(z_init_pl_v)), <span class="stringliteral">&#39;z_init_pl_v&#39;</span>)</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keyword">call </span>check_input_levels(<span class="keyword">size</span>(z_init_pl_v), <span class="keyword">size</span>(f_init_pl_v), <span class="stringliteral">&quot;f_init_pl_v&quot;</span>)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      zgrid=current_state%global_grid%configuration%vertical%zn(:)</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keyword">call </span>piecewise_linear_1d(z_init_pl_v(1:<span class="keyword">size</span>(z_init_pl_v)), f_init_pl_v(1:<span class="keyword">size</span>(f_init_pl_v)), &amp;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;         zgrid, current_state%global_grid%configuration%vertical%v_init)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <span class="keywordflow">if</span> (.not. current_state%continuation_run) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordflow">do</span> i=current_state%local_grid%local_domain_start_index(x_index), current_state%local_grid%local_domain_end_index(x_index)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          <span class="keywordflow">do</span> j=current_state%local_grid%local_domain_start_index(y_index), current_state%local_grid%local_domain_end_index(y_index)</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            current_state%v%data(:,j,i) = current_state%global_grid%configuration%vertical%v_init(:)</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keyword">deallocate</span>(z_init_pl_v, f_init_pl_v)</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordflow">if</span> (l_init_pl_q)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      nq_init=<span class="keyword">size</span>(names_init_pl_q)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      <span class="keyword">allocate</span>(z_init_pl_q(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;z_init_pl_q&quot;</span>)))</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;z_init_pl_q&quot;</span>, z_init_pl_q)</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      nzq=<span class="keyword">size</span>(z_init_pl_q)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keyword">call </span>check_top(zztop, z_init_pl_q(nzq), <span class="stringliteral">&#39;z_init_pl_q&#39;</span>)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      zgrid=current_state%global_grid%configuration%vertical%zn(:)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="keyword">allocate</span>(f_init_pl_q_tmp(nq_init*nzq))</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;f_init_pl_q&quot;</span>, f_init_pl_q_tmp)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="comment">!call check_input_levels(size(z_init_pl_q), size(f_init_pl_q_tmp), &quot;f_init_pl_q_tmp&quot;)</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keyword">allocate</span>(f_init_pl_q(nzq, nq_init))</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      f_init_pl_q(1:nzq, 1:nq_init)=reshape(f_init_pl_q_tmp, (/nzq, nq_init/))</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">do</span> n=1, nq_init</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;         iq=get_q_index(trim(names_init_pl_q(n)), <span class="stringliteral">&#39;piecewise_initialization&#39;</span>)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;         <span class="keyword">call </span>check_input_levels(<span class="keyword">size</span>(z_init_pl_q), <span class="keyword">size</span>(f_init_pl_q(1:nzq,n)), <span class="stringliteral">&quot;f_init_pl_q&quot;</span>)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keyword">call </span>piecewise_linear_1d(z_init_pl_q(1:nzq), f_init_pl_q(1:nzq,n), zgrid, &amp;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;           current_state%global_grid%configuration%vertical%q_init(:,iq))</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">if</span> (.not. current_state%continuation_run) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;          <span class="keywordflow">do</span> i=current_state%local_grid%local_domain_start_index(x_index), &amp;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;               current_state%local_grid%local_domain_end_index(x_index)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordflow">do</span> j=current_state%local_grid%local_domain_start_index(y_index), &amp;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                 current_state%local_grid%local_domain_end_index(y_index)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;              current_state%q(iq)%data(:,j,i) = current_state%global_grid%configuration%vertical%q_init(:, iq)</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="keywordflow">            end do</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keyword">deallocate</span>(f_init_pl_q_tmp, z_init_pl_q, f_init_pl_q, names_init_pl_q)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keyword">deallocate</span>(zgrid)      </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a3c89fcab80ba1019407877e035e99e96_cgraph.png" border="0" usemap="#anamespacegridmanager__mod_a3c89fcab80ba1019407877e035e99e96_cgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a3c89fcab80ba1019407877e035e99e96_cgraph" id="anamespacegridmanager__mod_a3c89fcab80ba1019407877e035e99e96_cgraph">
<area shape="rect" title="Calculates the initial profiles for U, V, TH &amp; Q if required." alt="" coords="5,35,188,76"/>
<area shape="rect" href="namespacegridmanager__mod.html#a0802299155d2b12297fc904d30d32c61" title=" " alt="" coords="248,5,415,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a99b4427e1d4243af039b6ab0e40424bd" title=" " alt="" coords="236,71,427,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a3c89fcab80ba1019407877e035e99e96_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a3c89fcab80ba1019407877e035e99e96_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a3c89fcab80ba1019407877e035e99e96_icgraph" id="anamespacegridmanager__mod_a3c89fcab80ba1019407877e035e99e96_icgraph">
<area shape="rect" title="Calculates the initial profiles for U, V, TH &amp; Q if required." alt="" coords="955,5,1137,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,5,907,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a8be24cf4b5ebf1cbbfe56a074926b3f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8be24cf4b5ebf1cbbfe56a074926b3f2">&#9670;&nbsp;</a></span>calculate_mixing_length_for_neutral_case()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::calculate_mixing_length_for_neutral_case </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>kkp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculates the mixing length for the neutral case. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid that we are working on </td></tr>
    <tr><td class="paramname">kkp</td><td>Number of grid points in a vertical column </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00348">348</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: kkp</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordtype">integer</span> :: k</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">do</span> k=2, kkp-1</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      vertical_grid%rneutml(k)=sqrt(1.0_default_precision/(1.0_default_precision/(von_karman_constant*&amp;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;           (vertical_grid%z(k)+z0))**2+1.0_default_precision/current_state%rmlmax**2) )</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      vertical_grid%rneutml_sq(k)=vertical_grid%rneutml(k)*vertical_grid%rneutml(k)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="keywordflow">    end do</span>    </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a8be24cf4b5ebf1cbbfe56a074926b3f2_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a8be24cf4b5ebf1cbbfe56a074926b3f2_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a8be24cf4b5ebf1cbbfe56a074926b3f2_icgraph" id="anamespacegridmanager__mod_a8be24cf4b5ebf1cbbfe56a074926b3f2_icgraph">
<area shape="rect" title="Calculates the mixing length for the neutral case." alt="" coords="955,5,1165,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,5,907,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a0802299155d2b12297fc904d30d32c61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0802299155d2b12297fc904d30d32c61">&#9670;&nbsp;</a></span>check_input_levels()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::check_input_levels </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>z_levels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>field_levels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(*), intent(in)&#160;</td>
          <td class="paramname"><em>field</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00854">854</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: z_levels</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: field_levels</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keywordtype">character(*)</span>, <span class="keywordtype">intent(in)</span> :: field</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160; </div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordflow">if</span> (z_levels /= field_levels)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">log_master_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Input levels not equal for &quot;</span>//trim(field)//<span class="stringliteral">&quot;, z_levels = &quot;</span>// &amp;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            trim(conv_to_string(z_levels))//<span class="stringliteral">&quot; field_levels = &quot;</span>//conv_to_string(field_levels))</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160; </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a0802299155d2b12297fc904d30d32c61_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a0802299155d2b12297fc904d30d32c61_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a0802299155d2b12297fc904d30d32c61_icgraph" id="anamespacegridmanager__mod_a0802299155d2b12297fc904d30d32c61_icgraph">
<area shape="rect" title=" " alt="" coords="1185,39,1352,80"/>
<area shape="rect" href="namespacegridmanager__mod.html#a3c89fcab80ba1019407877e035e99e96" title="Calculates the initial profiles for U, V, TH &amp; Q if required." alt="" coords="955,5,1137,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#aa00d0ec2e1c1ec0d5e065004cd1d6b9f" title=" " alt="" coords="971,71,1121,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,39,907,80"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,39,685,80"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,39,435,80"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,39,208,80"/>
</map>
</div>

</div>
</div>
<a id="a99b4427e1d4243af039b6ab0e40424bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99b4427e1d4243af039b6ab0e40424bd">&#9670;&nbsp;</a></span>check_top()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::check_top </td>
          <td>(</td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>zztop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(*), intent(in)&#160;</td>
          <td class="paramname"><em>info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00843">843</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">intent(in)</span> :: zztop</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">intent(in)</span> :: z</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordtype">character(*)</span>, <span class="keywordtype">intent(in)</span> :: info</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">if</span> (z&lt;zztop)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">log_master_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Top of input profile is below the top of the domain:&quot;</span>//trim(info))</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160; </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a99b4427e1d4243af039b6ab0e40424bd_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a99b4427e1d4243af039b6ab0e40424bd_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a99b4427e1d4243af039b6ab0e40424bd_icgraph" id="anamespacegridmanager__mod_a99b4427e1d4243af039b6ab0e40424bd_icgraph">
<area shape="rect" title=" " alt="" coords="1185,46,1376,73"/>
<area shape="rect" href="namespacegridmanager__mod.html#a3c89fcab80ba1019407877e035e99e96" title="Calculates the initial profiles for U, V, TH &amp; Q if required." alt="" coords="955,5,1137,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#aa00d0ec2e1c1ec0d5e065004cd1d6b9f" title=" " alt="" coords="971,71,1121,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,39,907,80"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,39,685,80"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,39,435,80"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,39,208,80"/>
</map>
</div>

</div>
</div>
<a id="ae6d17b932809a5c15d314e9cd266298b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6d17b932809a5c15d314e9cd266298b">&#9670;&nbsp;</a></span>compute_anelastic_pressure_profile_and_density()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::compute_anelastic_pressure_profile_and_density </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Computes the anelastic pressure and density - if we are using Anelastic approximation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00764">764</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordtype">integer</span> :: ipass, k</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) ::    p0    &amp;<span class="comment">!pressure at z=0 adjustments made after 1st iteration so P0=PSF after 2nd iteration</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        ,   ptop  &amp;<span class="comment">!pressure at z=ZN(KKP)</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        ,   thfactor <span class="comment">!factor for multiplying TH profile (if IADJANELP=2)</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160; </div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    ptop=0.0_default_precision</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    current_state%global_grid%configuration%vertical%pdiff(current_state%local_grid%size(z_index))=0.0_default_precision</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">do</span> ipass=1,2 <span class="comment">! _after first pass, may adjust basic states</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keywordflow">if</span> (ipass .eq. 1 .or. anelastic_profile_mode .gt. 1) <span class="keywordflow">then</span>                                     </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            current_state%global_grid%configuration%vertical%prefn(current_state%local_grid%size(z_index))=&amp;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                 (ptop/current_state%surface_reference_pressure)**r_over_cp</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <span class="keywordflow">do</span> k=current_state%local_grid%size(z_index)-1,1,-1</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                current_state%global_grid%configuration%vertical%pdiff(k)=g*&amp;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                     current_state%global_grid%configuration%vertical%dzn(k+1)/(0.5_default_precision*cp*&amp;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                     (current_state%global_grid%configuration%vertical%thref(k)+&amp;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                     current_state%global_grid%configuration%vertical%thref(k+1)))                </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="keywordflow">            end do</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            <span class="keywordflow">do</span> k=current_state%local_grid%size(z_index)-1,1,-1</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                current_state%global_grid%configuration%vertical%prefn(k)=&amp;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                     current_state%global_grid%configuration%vertical%prefn(k+1)+&amp;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                     current_state%global_grid%configuration%vertical%pdiff(k)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="keywordflow">            end do</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <span class="keywordflow">do</span> k=current_state%local_grid%size(z_index),1,-1</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                current_state%global_grid%configuration%vertical%prefn(k)=current_state%surface_reference_pressure*&amp;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                     current_state%global_grid%configuration%vertical%prefn(k)**(1.0_default_precision/r_over_cp)</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="keywordflow">            end do</span>           </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="keywordflow">        end if</span>                                                                    </div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        p0=0.5_default_precision*(current_state%global_grid%configuration%vertical%prefn(1)+&amp;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;             current_state%global_grid%configuration%vertical%prefn(2))</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="comment">!       !-------------------------------------------------------------</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="comment">!       ! _If IADJANELP&gt;1 we adjust the basic states to ensure P0=PSF,</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="comment">!       !                                as follows:</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="comment">!       !    IADJANELP=2     adjust THREF profile by constant factor</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="comment">!       !    IADJANELP=3     adjust PSF</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="comment">!       !    IADJANELP=4     adjust PTOP</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="comment">!       ! _Option 3 tends to give rather large changes in PSF, so</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="comment">!       !   I prefer 2 or 4 for most purposes</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="comment">!       !-------------------------------------------------------------</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">if</span> (ipass .eq. 1 .and. anelastic_profile_mode .eq. 2) <span class="keywordflow">then</span>                                    </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="comment">!             ! _adjust THREF profile by constant factor to enforce</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="comment">!             !    P0 = (fixed) PSF</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            thfactor=((p0/current_state%surface_reference_pressure)**r_over_cp-(ptop/current_state%surface_reference_pressure)**&amp;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                 r_over_cp)/((current_state%surface_pressure/current_state%surface_reference_pressure)**r_over_cp-&amp;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                (ptop/current_state%surface_reference_pressure)**r_over_cp)</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <span class="keywordflow">do</span> k=1,current_state%local_grid%size(z_index)</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                current_state%global_grid%configuration%vertical%thref(k)=&amp;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                     current_state%global_grid%configuration%vertical%thref(k)*thfactor</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="keywordflow">            end do</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="keywordflow">if</span> (ipass .eq. 1 .and. anelastic_profile_mode .eq. 4) <span class="keywordflow">then</span>                                    </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <span class="comment">!             ! _adjust PTOP so that P0 = (fixed) PSF</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            ptop=current_state%surface_pressure**r_over_cp+ptop**r_over_cp-p0**r_over_cp</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <span class="keywordflow">if</span> (ptop .le. 0.0_default_precision .and. current_state%parallel%my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Negative ptop in setup of anelastic. Need a warmer THREF or different setup options&quot;</span>)</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            ptop=ptop**(1.0_default_precision/r_over_cp)</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="keywordflow">        end if</span>                                                                    </div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="comment">!     !---------------------------------------</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="comment">!     ! _Finally compute density from pressure</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="comment">!     !---------------------------------------</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <span class="keywordflow">do</span> k=1,current_state%local_grid%size(z_index)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        current_state%global_grid%configuration%vertical%rhon(k)=current_state%global_grid%configuration%vertical%prefn(k)&amp;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            /(r*current_state%global_grid%configuration%vertical%thref(k)*&amp;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            (current_state%global_grid%configuration%vertical%prefn(k)/current_state%surface_reference_pressure)**r_over_cp)</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">do</span> k=1,current_state%local_grid%size(z_index)-1</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        current_state%global_grid%configuration%vertical%rho(k)=sqrt(current_state%global_grid%configuration%vertical%rhon(k)*&amp;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;             current_state%global_grid%configuration%vertical%rhon(k+1))                                           </div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    current_state%global_grid%configuration%vertical%rho(current_state%local_grid%size(z_index))=&amp;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;         current_state%global_grid%configuration%vertical%rhon(current_state%local_grid%size(z_index))**2/&amp;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;         current_state%global_grid%configuration%vertical%rhon(current_state%local_grid%size(z_index)-1)    </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_ae6d17b932809a5c15d314e9cd266298b_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_ae6d17b932809a5c15d314e9cd266298b_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_ae6d17b932809a5c15d314e9cd266298b_icgraph" id="anamespacegridmanager__mod_ae6d17b932809a5c15d314e9cd266298b_icgraph">
<area shape="rect" title="Computes the anelastic pressure and density &#45; if we are using Anelastic approximation." alt="" coords="1152,5,1333,61"/>
<area shape="rect" href="namespacegridmanager__mod.html#a718c3a9ed0280fd54eae4e006f1f85e0" title="Set reference profile of potential temperature for the Boussinesq/Anelastic approximation Note that t..." alt="" coords="955,13,1104,54"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,13,907,54"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,13,685,54"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,13,435,54"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,13,208,54"/>
</map>
</div>

</div>
</div>
<a id="a505b54357dac9e98045ca14eb17e1c2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a505b54357dac9e98045ca14eb17e1c2f">&#9670;&nbsp;</a></span>compute_anelastic_pressure_profile_only()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::compute_anelastic_pressure_profile_only </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Computes the anelastic pressure only - if we are using Boussinesq approximation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00718">718</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160; </div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordtype">integer</span> :: ipass, k</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) ::    p0    &amp;<span class="comment">!pressure at z=0 adjustments made after 1st iteration so P0=PSF after 2nd iteration</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        ,   ptop  &amp;<span class="comment">!pressure at z=ZN(KKP)</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        , thprof(current_state%local_grid%size(z_index))</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">! TODO: NOTE - we are mocking in thprof at the moment, this should be read from a configuration and used here instead</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    thprof=0.0_default_precision</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    ptop=0.0_default_precision</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    current_state%global_grid%configuration%vertical%pdiff(current_state%local_grid%size(z_index))=0.0_default_precision</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordflow">do</span> ipass=1,2 <span class="comment">! _after first pass adjust PTOP</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      current_state%global_grid%configuration%vertical%prefn(current_state%local_grid%size(z_index))=&amp;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;           (ptop/current_state%surface_reference_pressure)**r_over_cp</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordflow">do</span> k=current_state%local_grid%size(z_index)-1,1,-1</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        current_state%global_grid%configuration%vertical%pdiff(k)=g*&amp;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                     current_state%global_grid%configuration%vertical%dzn(k+1)/(0.5_default_precision*cp*&amp;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                     (current_state%global_grid%configuration%vertical%thref(k)+&amp;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                     current_state%global_grid%configuration%vertical%thref(k+1)))</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordflow">do</span> k=current_state%local_grid%size(z_index)-1,1,-1</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        current_state%global_grid%configuration%vertical%prefn(k)=&amp;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;             current_state%global_grid%configuration%vertical%prefn(k+1)+&amp;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;             current_state%global_grid%configuration%vertical%pdiff(k)</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="keywordflow">do</span> k=current_state%local_grid%size(z_index),1,-1</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        current_state%global_grid%configuration%vertical%prefn(k)=current_state%surface_reference_pressure*&amp;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;             current_state%global_grid%configuration%vertical%prefn(k)**(1.0_default_precision/r_over_cp)</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      p0=0.5_default_precision*(current_state%global_grid%configuration%vertical%prefn(1)+&amp;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;             current_state%global_grid%configuration%vertical%prefn(2))</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="keywordflow">if</span> (ipass .eq. 1) <span class="keywordflow">then</span>                                                       </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        ptop=current_state%surface_pressure**r_over_cp+ptop**r_over_cp-p0**r_over_cp</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="keywordflow">if</span> (ptop .le. 0.0_default_precision .and. current_state%parallel%my_rank==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Negative ptop in setup of anelastic. Need a warmer THREF or different setup options&quot;</span>)</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        ptop=ptop**(1.0_default_precision/r_over_cp)</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a505b54357dac9e98045ca14eb17e1c2f_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a505b54357dac9e98045ca14eb17e1c2f_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a505b54357dac9e98045ca14eb17e1c2f_icgraph" id="anamespacegridmanager__mod_a505b54357dac9e98045ca14eb17e1c2f_icgraph">
<area shape="rect" title="Computes the anelastic pressure only &#45; if we are using Boussinesq approximation." alt="" coords="1152,5,1361,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a718c3a9ed0280fd54eae4e006f1f85e0" title="Set reference profile of potential temperature for the Boussinesq/Anelastic approximation Note that t..." alt="" coords="955,5,1104,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,5,907,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="af9cfe0c92dec4ecc2104d9dedf421d7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9cfe0c92dec4ecc2104d9dedf421d7c">&#9670;&nbsp;</a></span>create_linear_grid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::create_linear_grid </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>kgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>hgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ninitp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>kkp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>zztop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Creates the linear vertical grid based upon the configuration properties. </p>
<p>This will correspond the vertical k grid points to the configuration which might be only a few reference properties. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid </td></tr>
    <tr><td class="paramname">kgd</td><td>The grid heights per division </td></tr>
    <tr><td class="paramname">hgd</td><td>The real world (m) heights per division </td></tr>
    <tr><td class="paramname">kkp</td><td>Number of points in the vertical domain </td></tr>
    <tr><td class="paramname">zztop</td><td>The real world (m) height of the top of the column </td></tr>
    <tr><td class="paramname">nsmth</td><td>Number of smoothing iterations to run on the grid </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00606">606</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: kgd</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: hgd</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: ninitp, kkp</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">intent(in)</span> :: zztop</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordtype">integer</span> :: kmax, k, i</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: zmax</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    vertical_grid%z(1) = 0.0_default_precision</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    kmax=kgd(1)</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    zmax=0.0_default_precision</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordflow">if</span> (kgd(1) .gt. 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keywordflow">do</span> k=1,kgd(1)</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="comment">! Loop up to first division point</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        vertical_grid%z(k)=real(k-1, kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>)*hgd(1)/real(kgd(1)-1, kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <span class="keywordflow">do</span> i=2,ninitp</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="keywordflow">if</span>(kgd(i) .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;          kmax=kgd(i)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;          zmax=hgd(i)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;          <span class="keywordflow">do</span> k=kgd(i-1)+1,kgd(i)</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            vertical_grid%z(k)=hgd(i-1)+(hgd(i)-hgd(i-1))*real(k-kgd(i-1), kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>)&amp;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                 /real(kgd(i)-kgd(i-1), kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>)</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="keywordflow">   end if</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordflow">if</span>(kmax .lt. kkp)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="keywordflow">do</span> k=kmax,kkp</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="comment">! Handle any points above the kth max division</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        vertical_grid%z(k)=zmax+(zztop-zmax)*real(k-kmax, kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>)/real(kkp-kmax, kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>)</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="keywordflow">     end do</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_af9cfe0c92dec4ecc2104d9dedf421d7c_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_af9cfe0c92dec4ecc2104d9dedf421d7c_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_af9cfe0c92dec4ecc2104d9dedf421d7c_icgraph" id="anamespacegridmanager__mod_af9cfe0c92dec4ecc2104d9dedf421d7c_icgraph">
<area shape="rect" title="Creates the linear vertical grid based upon the configuration properties." alt="" coords="1151,5,1317,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a05f22855870eb71f65d8f178a6df5db7" title="The original vertical grid setup and smoothing as per the LEM." alt="" coords="931,5,1103,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a528bb773c3a3d670aae00cce7a19d56a" title="Sets up and smooths the vertical grid. This is based upon the grid configuration already read in." alt="" coords="733,5,883,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="aba6cf6e19cbef2f1bd32083ab240af35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba6cf6e19cbef2f1bd32083ab240af35">&#9670;&nbsp;</a></span>finalise_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::finalise_callback </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called as MONC exits, for good practice this will deallocate the memory used for the grids. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00069">69</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type) :: vertical_grid</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    vertical_grid=current_state%global_grid%configuration%vertical</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keyword">deallocate</span>(vertical_grid%z, vertical_grid%zn, vertical_grid%dz, vertical_grid%dzn, vertical_grid%czb, vertical_grid%cza, &amp;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;         vertical_grid%czg, vertical_grid%czh, vertical_grid%rdz, vertical_grid%rdzn, vertical_grid%tzc1, vertical_grid%tzc2,&amp;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;         vertical_grid%tzd1, vertical_grid%tzd2, vertical_grid%thref, vertical_grid%theta_init,  vertical_grid%temp_init, &amp;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;         vertical_grid%rh_init, vertical_grid%tref, &amp;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;         vertical_grid%prefn, vertical_grid%pdiff, vertical_grid%prefrcp, vertical_grid%rprefrcp, vertical_grid%rho, &amp;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;         vertical_grid%rhon, vertical_grid%tstarpr, vertical_grid%qsat, vertical_grid%dqsatdt, vertical_grid%qsatfac, &amp;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;         vertical_grid%dthref, vertical_grid%rneutml, vertical_grid%rneutml_sq, vertical_grid%buoy_co, &amp;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;         vertical_grid%u_init, vertical_grid%v_init, vertical_grid%q_init,                              &amp;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;         vertical_grid%q_rand, vertical_grid%theta_rand, vertical_grid%w_subs, vertical_grid%w_rand, &amp;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;         vertical_grid%q_force, vertical_grid%theta_force, vertical_grid%u_force, vertical_grid%v_force &amp;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;         )</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_aba6cf6e19cbef2f1bd32083ab240af35_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_aba6cf6e19cbef2f1bd32083ab240af35_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_aba6cf6e19cbef2f1bd32083ab240af35_icgraph" id="anamespacegridmanager__mod_aba6cf6e19cbef2f1bd32083ab240af35_icgraph">
<area shape="rect" title="Called as MONC exits, for good practice this will deallocate the memory used for the grids." alt="" coords="256,5,427,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="ad1594b9175d56289645df4961045ce14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1594b9175d56289645df4961045ce14">&#9670;&nbsp;</a></span>gridmanager_get_descriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structmonc__component__mod_1_1component__descriptor__type.html">component_descriptor_type</a>) function, public gridmanager_mod::gridmanager_get_descriptor</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Provides the descriptor back to the caller and is used in component registration. </p>
<dl class="section return"><dt>Returns</dt><dd>The GridManager component descriptor </dd></dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00037">37</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    gridmanager_get_descriptor%name=<span class="stringliteral">&quot;grid_manager&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    gridmanager_get_descriptor%version=0.1</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    gridmanager_get_descriptor%initialisation=&gt;initialise_callback</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    gridmanager_get_descriptor%finalisation=&gt;finalise_callback</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_ad1594b9175d56289645df4961045ce14_cgraph.png" border="0" usemap="#anamespacegridmanager__mod_ad1594b9175d56289645df4961045ce14_cgraph" alt=""/></div>
<map name="namespacegridmanager__mod_ad1594b9175d56289645df4961045ce14_cgraph" id="anamespacegridmanager__mod_ad1594b9175d56289645df4961045ce14_cgraph">
<area shape="rect" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,39,208,80"/>
<area shape="rect" href="namespacegridmanager__mod.html#aba6cf6e19cbef2f1bd32083ab240af35" title="Called as MONC exits, for good practice this will deallocate the memory used for the grids." alt="" coords="260,5,431,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,71,435,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#aeee220119e02496171725a55e4fda143" title="Initialises the horizontal grid configurations." alt="" coords="483,37,705,79"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="493,103,695,144"/>
<area shape="rect" href="namespacegridmanager__mod.html#af3206ebfbd969e132b9bb0da141e2c4a" title="Allocates the data required for the vertical grid configuration." alt="" coords="753,37,929,79"/>
<area shape="rect" href="namespacegridmanager__mod.html#a528bb773c3a3d670aae00cce7a19d56a" title="Sets up and smooths the vertical grid. This is based upon the grid configuration already read in." alt="" coords="767,103,916,144"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="755,331,928,372"/>
<area shape="rect" href="namespacegridmanager__mod.html#a43acffd915e44ba2a4ee85c35201258c" title="The newer vertical grid setup routine." alt="" coords="1015,103,1169,144"/>
<area shape="rect" href="namespacegridmanager__mod.html#a05f22855870eb71f65d8f178a6df5db7" title="The original vertical grid setup and smoothing as per the LEM." alt="" coords="1006,37,1178,79"/>
<area shape="rect" href="namespacegridmanager__mod.html#af9cfe0c92dec4ecc2104d9dedf421d7c" title="Creates the linear vertical grid based upon the configuration properties." alt="" coords="1276,37,1443,79"/>
<area shape="rect" href="namespacegridmanager__mod.html#a3c89fcab80ba1019407877e035e99e96" title="Calculates the initial profiles for U, V, TH &amp; Q if required." alt="" coords="1001,588,1183,629"/>
<area shape="rect" href="namespacegridmanager__mod.html#a8be24cf4b5ebf1cbbfe56a074926b3f2" title="Calculates the mixing length for the neutral case." alt="" coords="987,233,1197,275"/>
<area shape="rect" href="namespacegridmanager__mod.html#a718c3a9ed0280fd54eae4e006f1f85e0" title="Set reference profile of potential temperature for the Boussinesq/Anelastic approximation Note that t..." alt="" coords="1017,168,1167,209"/>
<area shape="rect" href="namespacegridmanager__mod.html#ab284abd10a4ca93aa7fc592fcacace02" title="Sets the buoyancy coefficient from the grid configuration and configuration." alt="" coords="1017,364,1167,405"/>
<area shape="rect" href="namespacegridmanager__mod.html#aa00d0ec2e1c1ec0d5e065004cd1d6b9f" title=" " alt="" coords="1017,299,1167,340"/>
<area shape="rect" href="namespacegridmanager__mod.html#a644550580a73a9f92ffcdfbb3e1e037e" title="Sets up the reference properties for the vertical grid at each point." alt="" coords="1015,429,1169,485"/>
<area shape="rect" href="namespacegridmanager__mod.html#ae9f6591616fcf44968eb27608ab3e793" title="Setting up reference state liquid water temperature and saturation mixing ratio on main levels." alt="" coords="977,509,1207,565"/>
<area shape="rect" href="namespacegridmanager__mod.html#a0802299155d2b12297fc904d30d32c61" title=" " alt="" coords="1276,501,1443,543"/>
<area shape="rect" href="namespacegridmanager__mod.html#a99b4427e1d4243af039b6ab0e40424bd" title=" " alt="" coords="1264,338,1455,365"/>
<area shape="rect" href="namespacegridmanager__mod.html#ae6d17b932809a5c15d314e9cd266298b" title="Computes the anelastic pressure and density &#45; if we are using Anelastic approximation." alt="" coords="1269,202,1450,258"/>
<area shape="rect" href="namespacegridmanager__mod.html#a505b54357dac9e98045ca14eb17e1c2f" title="Computes the anelastic pressure only &#45; if we are using Boussinesq approximation." alt="" coords="1255,137,1464,179"/>
</map>
</div>

</div>
</div>
<a id="accbda17db8d0527f3465f22de5befd1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accbda17db8d0527f3465f22de5befd1f">&#9670;&nbsp;</a></span>initialise_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::initialise_callback </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called during initialisation and will initialise the horizontal and vertical grid configurations Note that the model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> (from a checkpoint or external file) must have been initialised already. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00047">47</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordtype">integer</span> :: dimensions</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">if</span> (.not. current_state%initialised) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Must initialise the model state_mod before constructing the grid properties&quot;</span>)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keyword">call </span>initialise_horizontalgrid_configuration_types(current_state)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keyword">call </span>initialise_verticalgrid_configuration_type(current_state)</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    dimensions=1</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">if</span> (current_state%global_grid%active(x_index)) dimensions = dimensions+1</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">if</span> (current_state%global_grid%active(y_index)) dimensions = dimensions+1   </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">log_master_log</a>(<a class="code" href="namespacelogging__mod.html#ac7d5c1fcb00d54277580c10556aa78a8">log_info</a>, trim(conv_to_string(dimensions))//<span class="stringliteral">&quot;D system; z=&quot;</span>//&amp;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;         trim(conv_to_string(current_state%global_grid%size(z_index)))//<span class="stringliteral">&quot;, y=&quot;</span>//&amp;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;         trim(conv_to_string(current_state%global_grid%size(y_index)))//<span class="stringliteral">&quot;, x=&quot;</span>//&amp;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;         trim(conv_to_string(current_state%global_grid%size(x_index))))</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_accbda17db8d0527f3465f22de5befd1f_cgraph.png" border="0" usemap="#anamespacegridmanager__mod_accbda17db8d0527f3465f22de5befd1f_cgraph" alt=""/></div>
<map name="namespacegridmanager__mod_accbda17db8d0527f3465f22de5befd1f_cgraph" id="anamespacegridmanager__mod_accbda17db8d0527f3465f22de5befd1f_cgraph">
<area shape="rect" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="5,39,184,80"/>
<area shape="rect" href="namespacegridmanager__mod.html#aeee220119e02496171725a55e4fda143" title="Initialises the horizontal grid configurations." alt="" coords="232,5,455,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="242,71,445,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#af3206ebfbd969e132b9bb0da141e2c4a" title="Allocates the data required for the vertical grid configuration." alt="" coords="503,5,679,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a528bb773c3a3d670aae00cce7a19d56a" title="Sets up and smooths the vertical grid. This is based upon the grid configuration already read in." alt="" coords="516,71,665,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="504,299,677,340"/>
<area shape="rect" href="namespacegridmanager__mod.html#a43acffd915e44ba2a4ee85c35201258c" title="The newer vertical grid setup routine." alt="" coords="764,71,919,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#a05f22855870eb71f65d8f178a6df5db7" title="The original vertical grid setup and smoothing as per the LEM." alt="" coords="755,5,927,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#af9cfe0c92dec4ecc2104d9dedf421d7c" title="Creates the linear vertical grid based upon the configuration properties." alt="" coords="1025,5,1192,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a3c89fcab80ba1019407877e035e99e96" title="Calculates the initial profiles for U, V, TH &amp; Q if required." alt="" coords="750,556,933,597"/>
<area shape="rect" href="namespacegridmanager__mod.html#a8be24cf4b5ebf1cbbfe56a074926b3f2" title="Calculates the mixing length for the neutral case." alt="" coords="736,201,947,243"/>
<area shape="rect" href="namespacegridmanager__mod.html#a718c3a9ed0280fd54eae4e006f1f85e0" title="Set reference profile of potential temperature for the Boussinesq/Anelastic approximation Note that t..." alt="" coords="767,136,916,177"/>
<area shape="rect" href="namespacegridmanager__mod.html#ab284abd10a4ca93aa7fc592fcacace02" title="Sets the buoyancy coefficient from the grid configuration and configuration." alt="" coords="767,332,916,373"/>
<area shape="rect" href="namespacegridmanager__mod.html#aa00d0ec2e1c1ec0d5e065004cd1d6b9f" title=" " alt="" coords="767,267,916,308"/>
<area shape="rect" href="namespacegridmanager__mod.html#a644550580a73a9f92ffcdfbb3e1e037e" title="Sets up the reference properties for the vertical grid at each point." alt="" coords="765,397,918,453"/>
<area shape="rect" href="namespacegridmanager__mod.html#ae9f6591616fcf44968eb27608ab3e793" title="Setting up reference state liquid water temperature and saturation mixing ratio on main levels." alt="" coords="727,477,956,533"/>
<area shape="rect" href="namespacegridmanager__mod.html#a0802299155d2b12297fc904d30d32c61" title=" " alt="" coords="1025,469,1192,511"/>
<area shape="rect" href="namespacegridmanager__mod.html#a99b4427e1d4243af039b6ab0e40424bd" title=" " alt="" coords="1013,306,1204,333"/>
<area shape="rect" href="namespacegridmanager__mod.html#ae6d17b932809a5c15d314e9cd266298b" title="Computes the anelastic pressure and density &#45; if we are using Anelastic approximation." alt="" coords="1018,170,1199,226"/>
<area shape="rect" href="namespacegridmanager__mod.html#a505b54357dac9e98045ca14eb17e1c2f" title="Computes the anelastic pressure only &#45; if we are using Boussinesq approximation." alt="" coords="1004,105,1213,147"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_accbda17db8d0527f3465f22de5befd1f_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_accbda17db8d0527f3465f22de5befd1f_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_accbda17db8d0527f3465f22de5befd1f_icgraph" id="anamespacegridmanager__mod_accbda17db8d0527f3465f22de5befd1f_icgraph">
<area shape="rect" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="aeee220119e02496171725a55e4fda143"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeee220119e02496171725a55e4fda143">&#9670;&nbsp;</a></span>initialise_horizontalgrid_configuration_types()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::initialise_horizontalgrid_configuration_types </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialises the horizontal grid configurations. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00674">674</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    current_state%global_grid%configuration%horizontal%dx = merge(real(current_state%global_grid%resolution(x_index)), &amp;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;         default_spacing, current_state%global_grid%active(x_index))</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    current_state%global_grid%configuration%horizontal%dy = merge(real(current_state%global_grid%resolution(y_index)), &amp;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;         default_spacing, current_state%global_grid%active(y_index))</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    current_state%global_grid%configuration%horizontal%cx=1./current_state%global_grid%configuration%horizontal%dx</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    current_state%global_grid%configuration%horizontal%cy=1./current_state%global_grid%configuration%horizontal%dy</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    current_state%global_grid%configuration%horizontal%cx2=current_state%global_grid%configuration%horizontal%cx ** 2</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    current_state%global_grid%configuration%horizontal%cy2=current_state%global_grid%configuration%horizontal%cy ** 2</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    current_state%global_grid%configuration%horizontal%cxy=current_state%global_grid%configuration%horizontal%cx * &amp;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;         current_state%global_grid%configuration%horizontal%cy</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    current_state%global_grid%configuration%horizontal%tcx=&amp;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;         0.25_default_precision/current_state%global_grid%configuration%horizontal%dx</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    current_state%global_grid%configuration%horizontal%tcy=&amp;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;         0.25_default_precision/current_state%global_grid%configuration%horizontal%dy</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_aeee220119e02496171725a55e4fda143_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_aeee220119e02496171725a55e4fda143_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_aeee220119e02496171725a55e4fda143_icgraph" id="anamespacegridmanager__mod_aeee220119e02496171725a55e4fda143_icgraph">
<area shape="rect" title="Initialises the horizontal grid configurations." alt="" coords="483,5,705,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="adb240afc3ced768c76ca5a87db0bf765"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb240afc3ced768c76ca5a87db0bf765">&#9670;&nbsp;</a></span>initialise_verticalgrid_configuration_type()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::initialise_verticalgrid_configuration_type </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Will initialise the vertical grid configuration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00091">91</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keyword">call </span>allocate_vertical_grid_data(current_state%global_grid%configuration%vertical, &amp;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;       current_state%global_grid%size(z_index), current_state%number_q_fields )</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keyword">call </span>set_up_and_smooth_grid(current_state%global_grid%configuration%vertical, &amp;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;         current_state%global_grid%configuration%vertical%kgd, current_state%global_grid%configuration%vertical%hgd, &amp;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;         <span class="keyword">size</span>(current_state%global_grid%configuration%vertical%kgd), current_state%global_grid%size(z_index), &amp;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;         current_state%global_grid%top(z_index), options_get_integer(current_state%options_database, <span class="stringliteral">&quot;nsmth&quot;</span>), &amp;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;         current_state%origional_vertical_grid_setup, current_state%continuation_run)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keyword">call </span>set_vertical_reference_profile(current_state, current_state%global_grid%configuration%vertical, &amp;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;         current_state%global_grid%size(z_index))</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_adb240afc3ced768c76ca5a87db0bf765_cgraph.png" border="0" usemap="#anamespacegridmanager__mod_adb240afc3ced768c76ca5a87db0bf765_cgraph" alt=""/></div>
<map name="namespacegridmanager__mod_adb240afc3ced768c76ca5a87db0bf765_cgraph" id="anamespacegridmanager__mod_adb240afc3ced768c76ca5a87db0bf765_cgraph">
<area shape="rect" title="Will initialise the vertical grid configuration." alt="" coords="5,71,208,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#af3206ebfbd969e132b9bb0da141e2c4a" title="Allocates the data required for the vertical grid configuration." alt="" coords="256,5,432,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a528bb773c3a3d670aae00cce7a19d56a" title="Sets up and smooths the vertical grid. This is based upon the grid configuration already read in." alt="" coords="269,71,419,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="257,299,431,340"/>
<area shape="rect" href="namespacegridmanager__mod.html#a43acffd915e44ba2a4ee85c35201258c" title="The newer vertical grid setup routine." alt="" coords="517,71,672,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#a05f22855870eb71f65d8f178a6df5db7" title="The original vertical grid setup and smoothing as per the LEM." alt="" coords="509,5,681,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#af9cfe0c92dec4ecc2104d9dedf421d7c" title="Creates the linear vertical grid based upon the configuration properties." alt="" coords="779,5,945,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a3c89fcab80ba1019407877e035e99e96" title="Calculates the initial profiles for U, V, TH &amp; Q if required." alt="" coords="503,556,686,597"/>
<area shape="rect" href="namespacegridmanager__mod.html#a8be24cf4b5ebf1cbbfe56a074926b3f2" title="Calculates the mixing length for the neutral case." alt="" coords="489,201,700,243"/>
<area shape="rect" href="namespacegridmanager__mod.html#a718c3a9ed0280fd54eae4e006f1f85e0" title="Set reference profile of potential temperature for the Boussinesq/Anelastic approximation Note that t..." alt="" coords="520,136,669,177"/>
<area shape="rect" href="namespacegridmanager__mod.html#ab284abd10a4ca93aa7fc592fcacace02" title="Sets the buoyancy coefficient from the grid configuration and configuration." alt="" coords="520,332,669,373"/>
<area shape="rect" href="namespacegridmanager__mod.html#aa00d0ec2e1c1ec0d5e065004cd1d6b9f" title=" " alt="" coords="520,267,669,308"/>
<area shape="rect" href="namespacegridmanager__mod.html#a644550580a73a9f92ffcdfbb3e1e037e" title="Sets up the reference properties for the vertical grid at each point." alt="" coords="518,397,671,453"/>
<area shape="rect" href="namespacegridmanager__mod.html#ae9f6591616fcf44968eb27608ab3e793" title="Setting up reference state liquid water temperature and saturation mixing ratio on main levels." alt="" coords="480,477,709,533"/>
<area shape="rect" href="namespacegridmanager__mod.html#a0802299155d2b12297fc904d30d32c61" title=" " alt="" coords="779,469,945,511"/>
<area shape="rect" href="namespacegridmanager__mod.html#a99b4427e1d4243af039b6ab0e40424bd" title=" " alt="" coords="767,306,957,333"/>
<area shape="rect" href="namespacegridmanager__mod.html#ae6d17b932809a5c15d314e9cd266298b" title="Computes the anelastic pressure and density &#45; if we are using Anelastic approximation." alt="" coords="771,170,953,226"/>
<area shape="rect" href="namespacegridmanager__mod.html#a505b54357dac9e98045ca14eb17e1c2f" title="Computes the anelastic pressure only &#45; if we are using Boussinesq approximation." alt="" coords="757,105,967,147"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_adb240afc3ced768c76ca5a87db0bf765_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_adb240afc3ced768c76ca5a87db0bf765_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_adb240afc3ced768c76ca5a87db0bf765_icgraph" id="anamespacegridmanager__mod_adb240afc3ced768c76ca5a87db0bf765_icgraph">
<area shape="rect" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a43acffd915e44ba2a4ee85c35201258c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43acffd915e44ba2a4ee85c35201258c">&#9670;&nbsp;</a></span>new_vertical_grid_setup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::new_vertical_grid_setup </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>kgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>kkp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>zztop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The newer vertical grid setup routine. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid </td></tr>
    <tr><td class="paramname">kgd</td><td>The grid heights per division </td></tr>
    <tr><td class="paramname">kkp</td><td>Number of points in the vertical domain </td></tr>
    <tr><td class="paramname">zztop</td><td>The real world (m) height of the top of the column </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00552">552</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: kgd</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: kkp</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">intent(in)</span> :: zztop</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: a(2*kkp), r1, d1, dd, d0, a0</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordtype">logical</span> :: first_gt=.true.</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordtype">integer</span> :: k, k0</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    r1=1.10_default_precision</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    d1=10.0_default_precision</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    dd=0.5_default_precision*d1</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    d0=dd</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    a(1)=-dd</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    a(2)=0.0_default_precision</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordflow">do</span> k=3, kkp*2</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="keywordflow">if</span> (d0 .gt. dd .or. k==3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        a(k)=a(k-1)+dd</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">if</span> (.not. (dd .gt. 25.0_default_precision .and. a(k) .lt. 2000.0_default_precision)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;          <span class="keywordflow">if</span> (a(k) .lt. 2000.0_default_precision) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            dd=dd*r1</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            dd=dd*(1.0_default_precision+(r1-1.0_default_precision)/1.5_default_precision)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        d0=(zztop-a(k))/real(kkp*2-k, kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">if</span> (first_gt) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;          k0=k</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;          a0=a(k-1)+d0</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;          first_gt=.false.</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        a(k)=a0+real(k-k0, kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>)*d0</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="keywordflow">    end do</span>    </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">do</span> k=1, kkp</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      vertical_grid%z(k)=a(k*2)</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      vertical_grid%zn(k)=a(2*k-1)</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a43acffd915e44ba2a4ee85c35201258c_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a43acffd915e44ba2a4ee85c35201258c_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a43acffd915e44ba2a4ee85c35201258c_icgraph" id="anamespacegridmanager__mod_a43acffd915e44ba2a4ee85c35201258c_icgraph">
<area shape="rect" title="The newer vertical grid setup routine." alt="" coords="931,5,1085,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a528bb773c3a3d670aae00cce7a19d56a" title="Sets up and smooths the vertical grid. This is based upon the grid configuration already read in." alt="" coords="733,5,883,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a05f22855870eb71f65d8f178a6df5db7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05f22855870eb71f65d8f178a6df5db7">&#9670;&nbsp;</a></span>original_vertical_grid_setup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::original_vertical_grid_setup </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>kgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>hgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ninitp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>kkp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>zztop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nsmth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The original vertical grid setup and smoothing as per the LEM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid </td></tr>
    <tr><td class="paramname">kgd</td><td>The grid heights per division </td></tr>
    <tr><td class="paramname">hgd</td><td>The real world (m) heights per division </td></tr>
    <tr><td class="paramname">kkp</td><td>Number of points in the vertical domain </td></tr>
    <tr><td class="paramname">zztop</td><td>The real world (m) height of the top of the column </td></tr>
    <tr><td class="paramname">nsmth</td><td>Number of smoothing iterations to run on the grid </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00516">516</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: kgd</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: hgd</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: ninitp, kkp, nsmth</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">intent(in)</span> :: zztop</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordtype">integer</span> :: n, k</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keyword">call </span>create_linear_grid(vertical_grid, kgd, hgd, ninitp, kkp, zztop)</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="comment">! Smooth grid</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    vertical_grid%z(1)=0.0_default_precision</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    vertical_grid%z(kkp)=zztop</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">do</span> n=1,nsmth</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="keywordflow">do</span> k=2,kkp</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        vertical_grid%zn(k)=0.5_default_precision*(vertical_grid%z(k)+vertical_grid%z(k-1))</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      <span class="keywordflow">do</span> k=2,kkp-1</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        vertical_grid%z(k)=0.5_default_precision*(vertical_grid%zn(k)+vertical_grid%zn(k+1))</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">! Fourth order interpolation</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordflow">do</span> k=3,kkp-1</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      vertical_grid%zn(k)=0.0625_default_precision*(9.0_default_precision*&amp;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;           (vertical_grid%z(k-1)+vertical_grid%z(k))-vertical_grid%z(k+1)-vertical_grid%z(k-2))</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    vertical_grid%zn(2)=0.5_default_precision*(vertical_grid%z(1)+vertical_grid%z(2))</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    vertical_grid%zn(1)=-vertical_grid%zn(2)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    vertical_grid%zn(kkp)=0.5_default_precision*(vertical_grid%z(kkp-1)+vertical_grid%z(kkp))</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a05f22855870eb71f65d8f178a6df5db7_cgraph.png" border="0" usemap="#anamespacegridmanager__mod_a05f22855870eb71f65d8f178a6df5db7_cgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a05f22855870eb71f65d8f178a6df5db7_cgraph" id="anamespacegridmanager__mod_a05f22855870eb71f65d8f178a6df5db7_cgraph">
<area shape="rect" title="The original vertical grid setup and smoothing as per the LEM." alt="" coords="5,5,177,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#af9cfe0c92dec4ecc2104d9dedf421d7c" title="Creates the linear vertical grid based upon the configuration properties." alt="" coords="225,5,392,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a05f22855870eb71f65d8f178a6df5db7_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a05f22855870eb71f65d8f178a6df5db7_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a05f22855870eb71f65d8f178a6df5db7_icgraph" id="anamespacegridmanager__mod_a05f22855870eb71f65d8f178a6df5db7_icgraph">
<area shape="rect" title="The original vertical grid setup and smoothing as per the LEM." alt="" coords="931,5,1103,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a528bb773c3a3d670aae00cce7a19d56a" title="Sets up and smooths the vertical grid. This is based upon the grid configuration already read in." alt="" coords="733,5,883,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a718c3a9ed0280fd54eae4e006f1f85e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a718c3a9ed0280fd54eae4e006f1f85e0">&#9670;&nbsp;</a></span>set_anelastic_pressure()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::set_anelastic_pressure </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set reference profile of potential temperature for the Boussinesq/Anelastic approximation Note that this is not in general the same as the profile defining the initial vertical distribution of potential temperature for the integration. In particular, while the later may contain sharp changes in gradient representing a capping inversion or the tropopause, for example, the reference profile should be smooth. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00699">699</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordflow">if</span> (current_state%use_anelastic_equations) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keyword">call </span>compute_anelastic_pressure_profile_and_density(current_state)</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">if</span> (current_state%passive_th) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        current_state%global_grid%configuration%vertical%prefn=0.0_default_precision</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keyword">call </span>compute_anelastic_pressure_profile_only(current_state)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        current_state%global_grid%configuration%vertical%rho=current_state%rhobous</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        current_state%global_grid%configuration%vertical%rhon=current_state%rhobous</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        current_state%global_grid%configuration%vertical%pdiff=0.0_default_precision</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a718c3a9ed0280fd54eae4e006f1f85e0_cgraph.png" border="0" usemap="#anamespacegridmanager__mod_a718c3a9ed0280fd54eae4e006f1f85e0_cgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a718c3a9ed0280fd54eae4e006f1f85e0_cgraph" id="anamespacegridmanager__mod_a718c3a9ed0280fd54eae4e006f1f85e0_cgraph">
<area shape="rect" title="Set reference profile of potential temperature for the Boussinesq/Anelastic approximation Note that t..." alt="" coords="5,49,155,90"/>
<area shape="rect" href="namespacegridmanager__mod.html#ae6d17b932809a5c15d314e9cd266298b" title="Computes the anelastic pressure and density &#45; if we are using Anelastic approximation." alt="" coords="217,5,398,61"/>
<area shape="rect" href="namespacegridmanager__mod.html#a505b54357dac9e98045ca14eb17e1c2f" title="Computes the anelastic pressure only &#45; if we are using Boussinesq approximation." alt="" coords="203,85,412,126"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a718c3a9ed0280fd54eae4e006f1f85e0_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a718c3a9ed0280fd54eae4e006f1f85e0_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a718c3a9ed0280fd54eae4e006f1f85e0_icgraph" id="anamespacegridmanager__mod_a718c3a9ed0280fd54eae4e006f1f85e0_icgraph">
<area shape="rect" title="Set reference profile of potential temperature for the Boussinesq/Anelastic approximation Note that t..." alt="" coords="955,5,1104,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,5,907,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="ab284abd10a4ca93aa7fc592fcacace02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab284abd10a4ca93aa7fc592fcacace02">&#9670;&nbsp;</a></span>set_buoyancy_coefficient()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::set_buoyancy_coefficient </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>kkp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets the buoyancy coefficient from the grid configuration and configuration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid that we are working on </td></tr>
    <tr><td class="paramname">kkp</td><td>Number of grid points in a vertical column </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00366">366</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">target</span> :: current_state</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: kkp</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordtype">integer</span> :: k    </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordflow">if</span> (.not. current_state%passive_th) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="keywordflow">if</span>(current_state%use_anelastic_equations)<span class="keywordflow">then</span>                                                      </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordflow">do</span> k=1, kkp-1          </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;          vertical_grid%buoy_co(k)=cp*(vertical_grid%prefn(k)**r_over_cp-vertical_grid%prefn(k+1)**r_over_cp)/&amp;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;               ((current_state%surface_reference_pressure**r_over_cp)*vertical_grid%dzn(k+1))</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordflow">else</span>                                                                     </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        vertical_grid%buoy_co(1:kkp-1)=g/current_state%thref0        <span class="comment">! _Boussinesq</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="comment">! Dummy value at top level</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      vertical_grid%buoy_co(kkp)=0.</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      vertical_grid%buoy_co(:)=0.</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_ab284abd10a4ca93aa7fc592fcacace02_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_ab284abd10a4ca93aa7fc592fcacace02_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_ab284abd10a4ca93aa7fc592fcacace02_icgraph" id="anamespacegridmanager__mod_ab284abd10a4ca93aa7fc592fcacace02_icgraph">
<area shape="rect" title="Sets the buoyancy coefficient from the grid configuration and configuration." alt="" coords="955,5,1104,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,5,907,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="aa00d0ec2e1c1ec0d5e065004cd1d6b9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa00d0ec2e1c1ec0d5e065004cd1d6b9f">&#9670;&nbsp;</a></span>set_qv_init_from_rh()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::set_qv_init_from_rh </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00866">866</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordtype">logical</span> :: l_init_pl_rh    <span class="comment">! if .true. then initialize relative humidity field</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: zztop <span class="comment">! top of the domain</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: qsat</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: f_init_pl_rh     <span class="comment">! Initial node values for relative humidity variable</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: z_init_pl_rh     <span class="comment">! Initial node height values for relative humidity variable</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">allocatable</span> :: zgrid(:)  <span class="comment">! z grid to use in interpolation</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">allocatable</span> :: tdegk(:)  <span class="comment">! temperature in Kelvin</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordtype">integer</span> :: i,j,n, k <span class="comment">! loop counters</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordtype">integer</span> :: iq  <span class="comment">! temporary q varible index</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type) :: vertical_grid</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    vertical_grid=current_state%global_grid%configuration%vertical</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keyword">allocate</span>(zgrid(current_state%local_grid%local_domain_end_index(z_index)))</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    </div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    zztop = current_state%global_grid%top(z_index)</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160; </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    l_init_pl_rh=options_get_logical(current_state%options_database, <span class="stringliteral">&quot;l_init_pl_rh&quot;</span>) </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160; </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="keywordflow">if</span> (l_init_pl_rh)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;       <span class="keyword">allocate</span>(z_init_pl_rh(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;z_init_pl_rh&quot;</span>)), &amp;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;             f_init_pl_rh(options_get_array_size(current_state%options_database, <span class="stringliteral">&quot;f_init_pl_rh&quot;</span>)))</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;       <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;z_init_pl_rh&quot;</span>, z_init_pl_rh)</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;       <span class="keyword">call </span>options_get_real_array(current_state%options_database, <span class="stringliteral">&quot;f_init_pl_rh&quot;</span>, f_init_pl_rh)</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;       <span class="keyword">call </span>check_top(zztop, z_init_pl_rh(<span class="keyword">size</span>(z_init_pl_rh)), <span class="stringliteral">&#39;z_init_pl_rh&#39;</span>)</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;       <span class="keyword">call </span>check_input_levels(<span class="keyword">size</span>(z_init_pl_rh), <span class="keyword">size</span>(f_init_pl_rh), <span class="stringliteral">&quot;f_init_pl_rh&quot;</span>)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;       zgrid=current_state%global_grid%configuration%vertical%zn(:)</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keyword">call </span>piecewise_linear_1d(z_init_pl_rh(1:<span class="keyword">size</span>(z_init_pl_rh)), f_init_pl_rh(1:<span class="keyword">size</span>(f_init_pl_rh)), zgrid, &amp;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;           current_state%global_grid%configuration%vertical%rh_init)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      </div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="keywordflow">if</span> (.not. current_state%passive_q .and. current_state%th%active) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;         iq=get_q_index(<span class="stringliteral">&#39;vapour&#39;</span>, <span class="stringliteral">&#39;piecewise_initialization&#39;</span>)</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;         <span class="keyword">allocate</span>(tdegk(current_state%local_grid%local_domain_end_index(z_index)))</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;         tdegk(:) = current_state%global_grid%configuration%vertical%theta_init(:)* &amp;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;              (vertical_grid%prefn(:)/current_state%surface_reference_pressure)**r_over_cp</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;         <span class="keywordflow">do</span> k = current_state%local_grid%local_domain_start_index(z_index), &amp;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;              current_state%local_grid%local_domain_end_index(z_index)</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            qsat=qsaturation(tdegk(k), current_state%global_grid%configuration%vertical%prefn(k)/100.)    </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            current_state%global_grid%configuration%vertical%q_init(k, iq) = &amp; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                 (current_state%global_grid%configuration%vertical%rh_init(k)/100.0)*qsat</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            <span class="comment">!print *,  current_state%global_grid%configuration%vertical%rh_init(k), &amp;</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <span class="comment">!     current_state%global_grid%configuration%vertical%q_init(k, iq), &amp;</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <span class="comment">!     TdegK(k)</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="keywordflow">         enddo</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;         <span class="keywordflow">if</span> (.not. current_state%continuation_run) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <span class="keywordflow">do</span> i=current_state%local_grid%local_domain_start_index(x_index), &amp;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                 current_state%local_grid%local_domain_end_index(x_index)</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;               <span class="keywordflow">do</span> j=current_state%local_grid%local_domain_start_index(y_index), &amp;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                    current_state%local_grid%local_domain_end_index(y_index)</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                  current_state%q(iq)%data(:,j,i) = current_state%global_grid%configuration%vertical%q_init(:, iq)</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="keywordflow">               end do</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="keywordflow">            end do</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="keywordflow">         end if</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;         <span class="keyword">deallocate</span>(tdegk)</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;         <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">log_master_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Initialising with RH but q and/or theta passive&quot;</span>)</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      </div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      <span class="keyword">deallocate</span>(z_init_pl_rh, f_init_pl_rh)</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_aa00d0ec2e1c1ec0d5e065004cd1d6b9f_cgraph.png" border="0" usemap="#anamespacegridmanager__mod_aa00d0ec2e1c1ec0d5e065004cd1d6b9f_cgraph" alt=""/></div>
<map name="namespacegridmanager__mod_aa00d0ec2e1c1ec0d5e065004cd1d6b9f_cgraph" id="anamespacegridmanager__mod_aa00d0ec2e1c1ec0d5e065004cd1d6b9f_cgraph">
<area shape="rect" title=" " alt="" coords="5,35,155,76"/>
<area shape="rect" href="namespacegridmanager__mod.html#a0802299155d2b12297fc904d30d32c61" title=" " alt="" coords="215,5,381,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a99b4427e1d4243af039b6ab0e40424bd" title=" " alt="" coords="203,71,393,98"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_aa00d0ec2e1c1ec0d5e065004cd1d6b9f_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_aa00d0ec2e1c1ec0d5e065004cd1d6b9f_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_aa00d0ec2e1c1ec0d5e065004cd1d6b9f_icgraph" id="anamespacegridmanager__mod_aa00d0ec2e1c1ec0d5e065004cd1d6b9f_icgraph">
<area shape="rect" title=" " alt="" coords="955,5,1104,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,5,907,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a528bb773c3a3d670aae00cce7a19d56a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a528bb773c3a3d670aae00cce7a19d56a">&#9670;&nbsp;</a></span>set_up_and_smooth_grid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::set_up_and_smooth_grid </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>kgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>hgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ninitp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>kkp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), intent(in)&#160;</td>
          <td class="paramname"><em>zztop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nsmth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>origional_setup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>continuation_run</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets up and smooths the vertical grid. This is based upon the grid configuration already read in. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid </td></tr>
    <tr><td class="paramname">kgd</td><td>The grid heights per division </td></tr>
    <tr><td class="paramname">hgd</td><td>The real world (m) heights per division </td></tr>
    <tr><td class="paramname">kkp</td><td>Number of points in the vertical domain </td></tr>
    <tr><td class="paramname">zztop</td><td>The real world (m) height of the top of the column </td></tr>
    <tr><td class="paramname">nsmth</td><td>Number of smoothing iterations to run on the grid </td></tr>
    <tr><td class="paramname">origional_setup</td><td>To use the origional vertical grid setup routine or the new one </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00481">481</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: kgd</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: hgd</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: ninitp, kkp, nsmth</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>),<span class="keywordtype">intent(in)</span> :: zztop</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: origional_setup, continuation_run</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160; </div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordtype">integer</span> :: k</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordflow">if</span> (.not. continuation_run) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="keywordflow">if</span> (origional_setup) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keyword">call </span>original_vertical_grid_setup(vertical_grid, kgd, hgd, ninitp, kkp, zztop, nsmth)</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keyword">call </span>new_vertical_grid_setup(vertical_grid, kgd, kkp, zztop)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">! Regardless of the vertical grid computation method, set the level deltas</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">do</span> k=2,kkp</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;       vertical_grid%dz(k)=vertical_grid%z(k)-vertical_grid%z(k-1)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;       vertical_grid%dzn(k)= vertical_grid%zn(k)-vertical_grid%zn(k-1)                                                     </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;       vertical_grid%rdz(k)=1./vertical_grid%dz(k)                                                          </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;       vertical_grid%rdzn(k)=1./vertical_grid%dzn(k)                                                        </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    vertical_grid%dzn(1)=0.d0</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a528bb773c3a3d670aae00cce7a19d56a_cgraph.png" border="0" usemap="#anamespacegridmanager__mod_a528bb773c3a3d670aae00cce7a19d56a_cgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a528bb773c3a3d670aae00cce7a19d56a_cgraph" id="anamespacegridmanager__mod_a528bb773c3a3d670aae00cce7a19d56a_cgraph">
<area shape="rect" title="Sets up and smooths the vertical grid. This is based upon the grid configuration already read in." alt="" coords="5,39,155,80"/>
<area shape="rect" href="namespacegridmanager__mod.html#a43acffd915e44ba2a4ee85c35201258c" title="The newer vertical grid setup routine." alt="" coords="211,5,366,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a05f22855870eb71f65d8f178a6df5db7" title="The original vertical grid setup and smoothing as per the LEM." alt="" coords="203,71,375,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#af9cfe0c92dec4ecc2104d9dedf421d7c" title="Creates the linear vertical grid based upon the configuration properties." alt="" coords="423,71,589,112"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a528bb773c3a3d670aae00cce7a19d56a_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a528bb773c3a3d670aae00cce7a19d56a_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a528bb773c3a3d670aae00cce7a19d56a_icgraph" id="anamespacegridmanager__mod_a528bb773c3a3d670aae00cce7a19d56a_icgraph">
<area shape="rect" title="Sets up and smooths the vertical grid. This is based upon the grid configuration already read in." alt="" coords="733,5,883,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="a644550580a73a9f92ffcdfbb3e1e037e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a644550580a73a9f92ffcdfbb3e1e037e">&#9670;&nbsp;</a></span>set_up_vertical_reference_properties()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::set_up_vertical_reference_properties </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>kkp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets up the reference properties for the vertical grid at each point. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid that we are working on </td></tr>
    <tr><td class="paramname">kkp</td><td>The number of grid points in a vertical column </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00452">452</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: kkp</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordtype">integer</span> :: k</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160; </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">do</span> k=1,kkp</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">!       vertical_grid%thref(k)=current_state%thref0</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">!       vertical_grid%theta_init(k)=vertical_grid%thref(k) ! In LEM this can also be set from configuration (TODO)       </span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;       vertical_grid%prefn(k)=0.0_default_precision</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;       vertical_grid%pdiff(k)=0.0_default_precision</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;       vertical_grid%rho(k)=current_state%rhobous</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;       vertical_grid%rhon(k)=current_state%rhobous</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordflow">do</span> k=1,kkp-1</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      vertical_grid%dthref(k)=vertical_grid%thref(k+1)-vertical_grid%thref(k)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    vertical_grid%dthref(kkp)=0.0_default_precision</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a644550580a73a9f92ffcdfbb3e1e037e_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a644550580a73a9f92ffcdfbb3e1e037e_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a644550580a73a9f92ffcdfbb3e1e037e_icgraph" id="anamespacegridmanager__mod_a644550580a73a9f92ffcdfbb3e1e037e_icgraph">
<area shape="rect" title="Sets up the reference properties for the vertical grid at each point." alt="" coords="955,5,1108,61"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,13,907,54"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,13,685,54"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,13,435,54"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,13,208,54"/>
</map>
</div>

</div>
</div>
<a id="a4db48ff47153c3be2595066a0cfe302c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4db48ff47153c3be2595066a0cfe302c">&#9670;&nbsp;</a></span>set_vertical_reference_profile()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::set_vertical_reference_profile </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>kkp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets up the vertical grid reference profile at each point. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid that we are working on </td></tr>
    <tr><td class="paramname">kkp</td><td>Number of grid points in a vertical column </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00110">110</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: kkp</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordtype">integer</span> :: k</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keyword">call </span>calculate_initial_profiles(current_state, vertical_grid)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keyword">call </span>set_up_vertical_reference_properties(current_state, vertical_grid, current_state%global_grid%size(z_index))</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keyword">call </span>set_anelastic_pressure(current_state)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">! </span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keyword">call </span>set_qv_init_from_rh(current_state)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">do</span> k=2,kkp-1</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="comment">! for diffusion onto p-level from below</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      vertical_grid%czb(k)=(vertical_grid%rho(k-1)/vertical_grid%rhon(k))/(vertical_grid%dz(k)*vertical_grid%dzn(k))</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="comment">! for diffusion onto p-level from above</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      vertical_grid%cza(k)=(vertical_grid%rho(k)/vertical_grid%rhon(k))/(vertical_grid%dz(k)*vertical_grid%dzn(k+1))</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      vertical_grid%czg(k)=-vertical_grid%czb(k)-vertical_grid%cza(k)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">if</span> (k .gt. 2) vertical_grid%czh(k)=vertical_grid%czb(k)*vertical_grid%cza(k-1)</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">do</span> k=2,kkp-1</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="comment">! advection onto p-level from below</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      vertical_grid%tzc1(k)=0.25_default_precision*vertical_grid%rdz(k)*vertical_grid%rho(k-1)/vertical_grid%rhon(k) </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="comment">! advection onto p-level from above</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      vertical_grid%tzc2(k)=0.25_default_precision*vertical_grid%rdz(k)*vertical_grid%rho(k)/vertical_grid%rhon(k) </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">do</span> k=2,kkp-1</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <span class="comment">! advection onto w-level (K) from below</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      vertical_grid%tzd1(k)=0.25_default_precision*vertical_grid%rdzn(k+1)*vertical_grid%rhon(k)/vertical_grid%rho(k)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="comment">! advection onto w-level (K) from above</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      vertical_grid%tzd2(k)=0.25_default_precision*vertical_grid%rdzn(k+1)*vertical_grid%rhon(k+1)/vertical_grid%rho(k)</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    k=kkp</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    vertical_grid%czb(k)=(vertical_grid%rho(k-1)/vertical_grid%rhon(k))/(vertical_grid%dz(k)*vertical_grid%dzn(k))</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    vertical_grid%cza(k)=0.0_default_precision</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    vertical_grid%czg(k)=-vertical_grid%czb(k)</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    vertical_grid%czh(k)=vertical_grid%czb(k)*vertical_grid%cza(k-1)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    vertical_grid%tzc2(k)=0.25_default_precision*vertical_grid%rdz(k)*vertical_grid%rho(k)/vertical_grid%rhon(k)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    vertical_grid%tzc1(k)=0.25_default_precision*vertical_grid%rdz(k)*vertical_grid%rho(k-1)/vertical_grid%rhon(k) </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    vertical_grid%czn=vertical_grid%dzn(2)*0.5_default_precision</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    vertical_grid%zlogm=log(1.0_default_precision+vertical_grid%zn(2)/z0)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    vertical_grid%zlogth=log((vertical_grid%zn(2)+z0)/z0th)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    vertical_grid%vk_on_zlogm=von_karman_constant/vertical_grid%zlogm</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">call </span>setup_reference_state_liquid_water_temperature_and_saturation(&amp;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;         current_state, vertical_grid, current_state%global_grid%size(z_index))</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keyword">call </span>calculate_mixing_length_for_neutral_case(current_state, vertical_grid, current_state%global_grid%size(z_index))</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keyword">call </span>set_buoyancy_coefficient(current_state, vertical_grid, current_state%global_grid%size(z_index))</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a4db48ff47153c3be2595066a0cfe302c_cgraph.png" border="0" usemap="#anamespacegridmanager__mod_a4db48ff47153c3be2595066a0cfe302c_cgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a4db48ff47153c3be2595066a0cfe302c_cgraph" id="anamespacegridmanager__mod_a4db48ff47153c3be2595066a0cfe302c_cgraph">
<area shape="rect" title="Sets up the vertical grid reference profile at each point." alt="" coords="5,201,179,243"/>
<area shape="rect" href="namespacegridmanager__mod.html#a3c89fcab80ba1019407877e035e99e96" title="Calculates the initial profiles for U, V, TH &amp; Q if required." alt="" coords="250,71,433,112"/>
<area shape="rect" href="namespacegridmanager__mod.html#a8be24cf4b5ebf1cbbfe56a074926b3f2" title="Calculates the mixing length for the neutral case." alt="" coords="236,136,447,177"/>
<area shape="rect" href="namespacegridmanager__mod.html#a718c3a9ed0280fd54eae4e006f1f85e0" title="Set reference profile of potential temperature for the Boussinesq/Anelastic approximation Note that t..." alt="" coords="267,201,416,243"/>
<area shape="rect" href="namespacegridmanager__mod.html#ab284abd10a4ca93aa7fc592fcacace02" title="Sets the buoyancy coefficient from the grid configuration and configuration." alt="" coords="267,267,416,308"/>
<area shape="rect" href="namespacegridmanager__mod.html#aa00d0ec2e1c1ec0d5e065004cd1d6b9f" title=" " alt="" coords="267,5,416,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#a644550580a73a9f92ffcdfbb3e1e037e" title="Sets up the reference properties for the vertical grid at each point." alt="" coords="265,331,418,387"/>
<area shape="rect" href="namespacegridmanager__mod.html#ae9f6591616fcf44968eb27608ab3e793" title="Setting up reference state liquid water temperature and saturation mixing ratio on main levels." alt="" coords="227,411,456,467"/>
<area shape="rect" href="namespacegridmanager__mod.html#a0802299155d2b12297fc904d30d32c61" title=" " alt="" coords="525,8,692,49"/>
<area shape="rect" href="namespacegridmanager__mod.html#a99b4427e1d4243af039b6ab0e40424bd" title=" " alt="" coords="513,77,704,103"/>
<area shape="rect" href="namespacegridmanager__mod.html#ae6d17b932809a5c15d314e9cd266298b" title="Computes the anelastic pressure and density &#45; if we are using Anelastic approximation." alt="" coords="518,162,699,218"/>
<area shape="rect" href="namespacegridmanager__mod.html#a505b54357dac9e98045ca14eb17e1c2f" title="Computes the anelastic pressure only &#45; if we are using Boussinesq approximation." alt="" coords="504,241,713,283"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_a4db48ff47153c3be2595066a0cfe302c_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_a4db48ff47153c3be2595066a0cfe302c_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_a4db48ff47153c3be2595066a0cfe302c_icgraph" id="anamespacegridmanager__mod_a4db48ff47153c3be2595066a0cfe302c_icgraph">
<area shape="rect" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,5,907,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,5,685,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,5,435,47"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,5,208,47"/>
</map>
</div>

</div>
</div>
<a id="ae9f6591616fcf44968eb27608ab3e793"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9f6591616fcf44968eb27608ab3e793">&#9670;&nbsp;</a></span>setup_reference_state_liquid_water_temperature_and_saturation()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gridmanager_mod::setup_reference_state_liquid_water_temperature_and_saturation </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrids__mod_1_1vertical__grid__configuration__type.html">vertical_grid_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>vertical_grid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>kkp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Setting up reference state liquid water temperature and saturation mixing ratio on main levels. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
    <tr><td class="paramname">vertical_grid</td><td>The vertical grid that we are working on </td></tr>
    <tr><td class="paramname">kkp</td><td>Number of grid points in a vertical column </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00393">393</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordtype">type</span>(vertical_grid_configuration_type), <span class="keywordtype">intent(inout)</span> :: vertical_grid</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: kkp</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: delta_t=1.0_default_precision, qlinit, tinit, qsatin, dqsatdtin, dsatfacin</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordtype">integer</span> :: iter, k</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">do</span> k=1,kkp</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;       vertical_grid%tref(k)=vertical_grid%thref(k)*(vertical_grid%prefn(k)/current_state%surface_reference_pressure)**r_over_cp</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      vertical_grid%tstarpr(k)=0.0_default_precision</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="keywordflow">   end do</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;   <span class="keywordflow">if</span> (current_state%th%active) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <span class="comment">! PREFRCP is used and hence calculated if theta is active</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keywordflow">do</span> k = 1,kkp   </div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;         vertical_grid%prefrcp(k)=(current_state%surface_reference_pressure/vertical_grid%prefn(k))**r_over_cp</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;         vertical_grid%rprefrcp(k)=1.0_default_precision/vertical_grid%prefrcp(k)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;         <span class="comment">! Denotion between setup run and chain run in LEM - need to consider here too</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;         vertical_grid%qsat(k)=qsaturation(vertical_grid%tref(k), 0.01_default_precision*vertical_grid%prefn(k))</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;         vertical_grid%dqsatdt(k)=(qsaturation(vertical_grid%tref(k)+delta_t, 0.01_default_precision*vertical_grid%prefn(k)) -&amp;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;              qsaturation(vertical_grid%tref(k)-delta_t, 0.01_default_precision*vertical_grid%prefn(k)))/&amp;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;              (2.0_default_precision*delta_t)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;         vertical_grid%qsatfac(k)=1.0_default_precision/(1.0_default_precision+rlvap_over_cp*vertical_grid%dqsatdt(k))</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keywordflow">if</span> (current_state%calculate_th_and_q_init) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;         <span class="keywordflow">do</span> k=1,kkp</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="comment">!       !Note that at this point THETA_INIT and QINIT(IQ=1) are still</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="comment">!       !theta_l and q_t, as read in from configuration.</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="comment">!       ! start from input QL profile</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            qlinit=qinit(k, current_state%liquid_water_mixing_ratio_index)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordflow">do</span> iter=1,5</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;               <span class="comment">!         ! calculate T and thence new q_l from Taylor expansion</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;               <span class="comment">!         ! keeping theta_l and q_t fixed</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;               <span class="comment">!         ! Note theta_l = theta - (L/c_p)*q_l here</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;               tinit     = vertical_grid%theta_init(k)*vertical_grid%rprefrcp(k) + rlvap_over_cp*qlinit</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;               qsatin    = qsaturation(tinit, 0.01_default_precision*vertical_grid%prefn(k))</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;               dqsatdtin = dqwsatdt(qsatin, tinit)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;               dsatfacin=( 1.0_default_precision/(1.0_default_precision + rlvap_over_cp*dqsatdtin*vertical_grid%rprefrcp(k)))</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;               qlinit=max(0.0_default_precision, (qinit(k, current_state%water_vapour_mixing_ratio_index)-&amp;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    (qsatin+dqsatdtin*(vertical_grid%theta_init(k)*vertical_grid%rprefrcp(k)-tinit) ))*dsatfacin)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordflow">            end do</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            qinit(k, current_state%liquid_water_mixing_ratio_index)=qlinit</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            qinit(k, current_state%water_vapour_mixing_ratio_index)=qinit(k,current_state%water_vapour_mixing_ratio_index)-qlinit</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            vertical_grid%theta_init(k)=vertical_grid%theta_init(k)+rlvap_over_cp*qlinit</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="comment">! Denotion between setup run and chain run in LEM - need to consider here too</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            vertical_grid%tstarpr(k)= tinit-vertical_grid%tref(k)</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            vertical_grid%qsat(k)=qsatin</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            vertical_grid%dqsatdt(k)=dqsatdtin        </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            vertical_grid%qsatfac(k)= ( 1.0_default_precision/ ( 1.0_default_precision + rlvap_over_cp*dqsatdtin ) )</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keywordflow">         end do</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keywordflow">   end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacegridmanager__mod_ae9f6591616fcf44968eb27608ab3e793_icgraph.png" border="0" usemap="#anamespacegridmanager__mod_ae9f6591616fcf44968eb27608ab3e793_icgraph" alt=""/></div>
<map name="namespacegridmanager__mod_ae9f6591616fcf44968eb27608ab3e793_icgraph" id="anamespacegridmanager__mod_ae9f6591616fcf44968eb27608ab3e793_icgraph">
<area shape="rect" title="Setting up reference state liquid water temperature and saturation mixing ratio on main levels." alt="" coords="955,5,1184,61"/>
<area shape="rect" href="namespacegridmanager__mod.html#a4db48ff47153c3be2595066a0cfe302c" title="Sets up the vertical grid reference profile at each point." alt="" coords="733,13,907,54"/>
<area shape="rect" href="namespacegridmanager__mod.html#adb240afc3ced768c76ca5a87db0bf765" title="Will initialise the vertical grid configuration." alt="" coords="483,13,685,54"/>
<area shape="rect" href="namespacegridmanager__mod.html#accbda17db8d0527f3465f22de5befd1f" title="Called during initialisation and will initialise the horizontal and vertical grid configurations Note..." alt="" coords="256,13,435,54"/>
<area shape="rect" href="namespacegridmanager__mod.html#ad1594b9175d56289645df4961045ce14" title="Provides the descriptor back to the caller and is used in component registration." alt="" coords="5,13,208,54"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a0225dc0ad66fd99af71fb8b5e963bb40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0225dc0ad66fd99af71fb8b5e963bb40">&#9670;&nbsp;</a></span>anelastic_profile_mode</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter gridmanager_mod::anelastic_profile_mode =4</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00027">27</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: ANELASTIC_PROFILE_MODE=4</div>
</div><!-- fragment -->
</div>
</div>
<a id="af41ba8e0a62fd8dbc010bc4a24dee544"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af41ba8e0a62fd8dbc010bc4a24dee544">&#9670;&nbsp;</a></span>default_spacing</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real, parameter gridmanager_mod::default_spacing = 1.E9</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The default spacing used if no grid is active in a specific dimension. </p>

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00028">28</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">parameter</span> :: DEFAULT_SPACING = 1.e9  </div>
</div><!-- fragment -->
</div>
</div>
<a id="a0bcdfdb1f24895751f2d8adb360f5cc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bcdfdb1f24895751f2d8adb360f5cc6">&#9670;&nbsp;</a></span>qinit</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision), dimension(:,:), allocatable gridmanager_mod::qinit</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gridmanager_8F90_source.html#l00029">29</a> of file <a class="el" href="gridmanager_8F90_source.html">gridmanager.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keywordtype">  real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">allocatable</span> :: qinit</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<div class="ttc" id="anamespacelogging__mod_html_ad68309846cd8f9e77edaa6abd02f65a0"><div class="ttname"><a href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">logging_mod::log_error</a></div><div class="ttdeci">integer, parameter, public log_error</div><div class="ttdoc">Only log ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00011">logging.F90:11</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ac7d5c1fcb00d54277580c10556aa78a8"><div class="ttname"><a href="namespacelogging__mod.html#ac7d5c1fcb00d54277580c10556aa78a8">logging_mod::log_info</a></div><div class="ttdeci">integer, parameter, public log_info</div><div class="ttdoc">Log INFO, WARNING and ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00013">logging.F90:13</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ac4f13ac385499c85190cb184030e4f45"><div class="ttname"><a href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">logging_mod::log_log</a></div><div class="ttdeci">subroutine, public log_log(level, message, str)</div><div class="ttdoc">Logs a message at the specified level. If the level is above the current level then the message is ig...</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00074">logging.F90:75</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ad95937a250467334622daeb5cff78c20"><div class="ttname"><a href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">logging_mod::log_master_log</a></div><div class="ttdeci">subroutine, public log_master_log(level, message)</div><div class="ttdoc">Will log just from the master process.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00046">logging.F90:47</a></div></div>
<div class="ttc" id="anamespacedatadefn__mod_html_a39b79f8cc843d236d3b47f5c81b64368"><div class="ttname"><a href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">datadefn_mod::default_precision</a></div><div class="ttdeci">integer, parameter, public default_precision</div><div class="ttdoc">MPI communication type which we use for the prognostic and calculation data.</div><div class="ttdef"><b>Definition:</b> <a href="datadefn_8F90_source.html#l00017">datadefn.F90:17</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>

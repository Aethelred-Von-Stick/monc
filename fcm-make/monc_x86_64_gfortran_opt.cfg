$fflags_debug{?} =  -g -fcheck=all -ffpe-trap=invalid,zero,overflow -fbacktrace 
$fflags_debug_io{?} = -g -fcheck=do,array-temps,bounds,mem,pointer
$fflags_opt{?}   = -O3 
$fflags{?}       = $fflags_opt

$fflags_model_core{?} = $fflags -frecursive
$fflags_io{?} = $fflags -fPIC -frecursive
$cflags = -fPIC

$fppdefs_debug{?} =  DEBUG_MODE
$fpp_flags{?} = -E -P -traditional

$fppdefs{?} = U_ACTIVE V_ACTIVE W_ACTIVE IO_SERVER ENFORCE_THREAD_SAFETY __DARWIN
$cppdefs{?} = __DARWIN _XOPEN_SOURCE=700 ENFORCE_THREAD_SAFETY

$packages_path{?}    = /data/cr1/mhambley/modules/packages/gfortran/4.9.0

$netcdf_path{?}     = $packages_path/netcdf/4.3.2
$netcdf_inc_path{?} = $netcdf_path/include
$netcdf_lib_path{?} = $netcdf_path/lib

$fftw_path{?}       = $packages_path/fftw/3.3.4
$fftw_inc_path{?}   = $fftw_path/include
$fftw_lib_path{?}   = $fftw_path/lib

$hdf5_path{?}       = $packages_path/hdf5/1.8.12
$hdf5_lib_path{?}   = $hdf5_path/lib



steps = extract preprocess build

extract.location{primary}[monc] = https://puma.nerc.ac.uk/svn/MONC_svn/MONC

extract.ns = monc 

extract.location[monc]  = trunk

extract.location{diff}[monc]  = $HERE/..
extract.path-excl[monc] = / 
extract.path-incl[monc] = components model_core io misc testcases monc_driver.F90

preprocess.prop{file-ext.h} = .static .h
preprocess.prop{fpp.flags}  = $fpp_flags
preprocess.prop{fpp.defs}   = $fppdefs

preprocess.prop{cpp.defs} =  $cppdefs

preprocess.prop{class, no-dep.include} = argsts.h typsts.h s_scmop.h

build.target                       = monc_driver.exe
build.prop{class,no-dep.f.module}  = mpi netcdf
build.prop{class,no-dep.include}   = fftw3.f03
build.prop{class,fc.include-paths} = $netcdf_inc_path $fftw_inc_path
build.prop{class,fc}               = mpif90
build.prop{class,fc.flags}         = $fflags
build.prop{class,fc.libs}          = netcdff netcdf hdf5 hdf5_hl z fftw3 pthread
build.prop{class,fc.lib-paths}     = $netcdf_lib_path $fftw_lib_path $hdf5_lib_path	

build.prop{class,cc}          = cc

build.prop{fc.flags}[monc/model_core] = $fflags_model_core
build.prop{fc.flags}[monc/io]   = $fflags_io
build.prop{cc.flags}[monc/io]   = $cflags

build.prop{dep.o}[monc/io/src/forthread] = ft_attr.o  ft_data.o  ft_wrapper.o
build.prop{fc.flags}[monc/model_core/src/utils/conversions.F90] = $fflags_opt
build.prop{fc.flags}[monc/io/src/forthread] = $fflags_debug_io

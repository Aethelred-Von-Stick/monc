<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MONC: fftsolver_mod Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MONC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">fftsolver_mod Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Pressure solver which uses a tridiagonal algorithm operating on the pressure terms in Fourier space. It uses the pencil FFT module for 3D FFTs in pencil decomposition. These use FFTW for the actual FFT kernel.  
<a href="namespacefftsolver__mod.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:ad219c2d25fc8a8f9353c00f610f37c4b"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structmonc__component__mod_1_1component__descriptor__type.html">component_descriptor_type</a>) function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#ad219c2d25fc8a8f9353c00f610f37c4b">fftsolver_get_descriptor</a> ()</td></tr>
<tr class="memdesc:ad219c2d25fc8a8f9353c00f610f37c4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Descriptor of this component for registration.  <a href="namespacefftsolver__mod.html#ad219c2d25fc8a8f9353c00f610f37c4b">More...</a><br /></td></tr>
<tr class="separator:ad219c2d25fc8a8f9353c00f610f37c4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a2b2b221d8792a61e274193534e03bc"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a9a2b2b221d8792a61e274193534e03bc">initialisation_callback</a> (current_state)</td></tr>
<tr class="memdesc:a9a2b2b221d8792a61e274193534e03bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">This initialisation callback sets up the pencil fft module, allocates data for the fourier space pressure term (might be different size than p) and populates cos x and y.  <a href="namespacefftsolver__mod.html#a9a2b2b221d8792a61e274193534e03bc">More...</a><br /></td></tr>
<tr class="separator:a9a2b2b221d8792a61e274193534e03bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82fe1bd4173b841df2bc7651cefdf4bc"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a82fe1bd4173b841df2bc7651cefdf4bc">timestep_callback</a> (current_state)</td></tr>
<tr class="memdesc:a82fe1bd4173b841df2bc7651cefdf4bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timestep call back, which will transform to Fourier space, do a tridiagonal solve and then back into time space.  <a href="namespacefftsolver__mod.html#a82fe1bd4173b841df2bc7651cefdf4bc">More...</a><br /></td></tr>
<tr class="separator:a82fe1bd4173b841df2bc7651cefdf4bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdf834d62478f5f7799afdc2847fa587"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#acdf834d62478f5f7799afdc2847fa587">finalisation_callback</a> (current_state)</td></tr>
<tr class="memdesc:acdf834d62478f5f7799afdc2847fa587"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called at MONC finalisation, will call to the pencil fft module to clean itself up and free the pressure term.  <a href="namespacefftsolver__mod.html#acdf834d62478f5f7799afdc2847fa587">More...</a><br /></td></tr>
<tr class="separator:acdf834d62478f5f7799afdc2847fa587"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9a3338a53b29902a27e102983877e94"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#ab9a3338a53b29902a27e102983877e94">complete_psrce_calculation</a> (current_state, y_halo_size, x_halo_size)</td></tr>
<tr class="memdesc:ab9a3338a53b29902a27e102983877e94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Completes the psrce calculation by waiting on all outstanding psrce communications to complete and then combine the received values with the P field for U and V.  <a href="namespacefftsolver__mod.html#ab9a3338a53b29902a27e102983877e94">More...</a><br /></td></tr>
<tr class="separator:ab9a3338a53b29902a27e102983877e94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1adca201d5138e9e750fcd7865f6f3e3"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a1adca201d5138e9e750fcd7865f6f3e3">tridiagonal_solver</a> (current_state, pressure_term, <a class="el" href="namespacefftsolver__mod.html#a6e465fdc8e3066e3ab7e21bc2db80518">fourier_space_sizes</a>)</td></tr>
<tr class="memdesc:a1adca201d5138e9e750fcd7865f6f3e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">The tridiagonal solver which runs in Fourier space on the pressure terms. Note that because we are going from n reals to n/2+1 complex numbers (and into their reals for this solver) then there might be more data in the pressure term than in p. Therefore use the space sizes which are provided as an argument to this procedure rather than the current state local grid dimensions.  <a href="namespacefftsolver__mod.html#a1adca201d5138e9e750fcd7865f6f3e3">More...</a><br /></td></tr>
<tr class="separator:a1adca201d5138e9e750fcd7865f6f3e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fbc281dc1b4670abbc9713417550bc3"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a9fbc281dc1b4670abbc9713417550bc3">copy_p_to_halo_buffer</a> (current_state, neighbour_description, dim, source_index, pid_location, current_page, source_data)</td></tr>
<tr class="memdesc:a9fbc281dc1b4670abbc9713417550bc3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the p field data to halo buffers for a specific process in a dimension and halo cell.  <a href="namespacefftsolver__mod.html#a9fbc281dc1b4670abbc9713417550bc3">More...</a><br /></td></tr>
<tr class="separator:a9fbc281dc1b4670abbc9713417550bc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50b8c3b67d6b172f278aa26f2d5c299c"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a50b8c3b67d6b172f278aa26f2d5c299c">copy_halo_buffer_to_p</a> (current_state, neighbour_description, dim, target_index, neighbour_location, current_page, source_data)</td></tr>
<tr class="separator:a50b8c3b67d6b172f278aa26f2d5c299c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ec4b150d4fefc0abd637fe94ce88673"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a9ec4b150d4fefc0abd637fe94ce88673">perform_local_data_copy_for_p</a> (current_state, halo_depth, involve_corners, source_data)</td></tr>
<tr class="memdesc:a9ec4b150d4fefc0abd637fe94ce88673"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does local data copying for P variable halo swap.  <a href="namespacefftsolver__mod.html#a9ec4b150d4fefc0abd637fe94ce88673">More...</a><br /></td></tr>
<tr class="separator:a9ec4b150d4fefc0abd637fe94ce88673"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a93d5691a1baf056c9c68e43a9b658fb7"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision), dimension(:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a93d5691a1baf056c9c68e43a9b658fb7">cos_x</a></td></tr>
<tr class="separator:a93d5691a1baf056c9c68e43a9b658fb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98154ec2380d2cf1b11926c42f67c1b8"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision), dimension(:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a98154ec2380d2cf1b11926c42f67c1b8">cos_y</a></td></tr>
<tr class="separator:a98154ec2380d2cf1b11926c42f67c1b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adca03d66144dedfce4256f9dfd28483e"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#adca03d66144dedfce4256f9dfd28483e">pi</a></td></tr>
<tr class="separator:adca03d66144dedfce4256f9dfd28483e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68ad171760478fa0e820addd0bacaa8a"><td class="memItemLeft" align="right" valign="top">real(kind=default_precision), dimension(:,:,:), allocatable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a68ad171760478fa0e820addd0bacaa8a">pt</a></td></tr>
<tr class="separator:a68ad171760478fa0e820addd0bacaa8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e465fdc8e3066e3ab7e21bc2db80518"><td class="memItemLeft" align="right" valign="top">integer, dimension(3)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a6e465fdc8e3066e3ab7e21bc2db80518">fourier_space_sizes</a></td></tr>
<tr class="separator:a6e465fdc8e3066e3ab7e21bc2db80518"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03eb2dbfcf954511ed750458c5c79680"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structcommunication__types__mod_1_1halo__communication__type.html">halo_communication_type</a>), save&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacefftsolver__mod.html#a03eb2dbfcf954511ed750458c5c79680">halo_swap_state</a></td></tr>
<tr class="separator:a03eb2dbfcf954511ed750458c5c79680"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Pressure solver which uses a tridiagonal algorithm operating on the pressure terms in Fourier space. It uses the pencil FFT module for 3D FFTs in pencil decomposition. These use FFTW for the actual FFT kernel. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ab9a3338a53b29902a27e102983877e94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab9a3338a53b29902a27e102983877e94">&#9670;&nbsp;</a></span>complete_psrce_calculation()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine fftsolver_mod::complete_psrce_calculation </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>y_halo_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>x_halo_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Completes the psrce calculation by waiting on all outstanding psrce communications to complete and then combine the received values with the P field for U and V. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">y_halo_size</td><td>The halo size in the Y dimension </td></tr>
    <tr><td class="paramname">x_halo_size</td><td>The halo size in the X dimension </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00144">144</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: y_halo_size, x_halo_size</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">integer</span> :: ierr, combined_handles(2), i, j, k</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    combined_handles(1)=current_state%psrce_x_hs_recv_request</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    combined_handles(2)=current_state%psrce_y_hs_recv_request</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keyword">call </span>mpi_waitall(2, combined_handles, mpi_statuses_ignore, ierr)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">do</span> j=current_state%local_grid%local_domain_start_index(y_index), current_state%local_grid%local_domain_end_index(y_index)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordflow">do</span> k=2,current_state%local_grid%size(z_index)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="preprocessor">#ifdef U_ACTIVE</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor"></span>        current_state%p%data(k,j,x_halo_size+1)=current_state%p%data(k,j,x_halo_size+1)-&amp;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;               current_state%psrce_recv_buffer_x(k-1,j-x_halo_size)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef V_ACTIVE</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">if</span> (j .gt. y_halo_size+1) current_state%p%data(k, j, x_halo_size+1)=current_state%p%data(k, j, x_halo_size+1)-&amp;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;             current_state%global_grid%configuration%horizontal%cy * current_state%sv%data(k, j-1, x_halo_size+1)</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="preprocessor"></span><span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="preprocessor">#ifdef V_ACTIVE</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">do</span> i=current_state%local_grid%local_domain_start_index(x_index), current_state%local_grid%local_domain_end_index(x_index)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keywordflow">do</span> k=2,current_state%local_grid%size(z_index)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        current_state%p%data(k,y_halo_size+1,i)=current_state%p%data(k,y_halo_size+1,i)-&amp;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;             current_state%psrce_recv_buffer_y(k-1,i-y_halo_size)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    combined_handles(1)=current_state%psrce_x_hs_send_request</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    combined_handles(2)=current_state%psrce_y_hs_send_request</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keyword">call </span>mpi_waitall(2, combined_handles, mpi_statuses_ignore, ierr)</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_ab9a3338a53b29902a27e102983877e94_icgraph.png" border="0" usemap="#anamespacefftsolver__mod_ab9a3338a53b29902a27e102983877e94_icgraph" alt=""/></div>
<map name="namespacefftsolver__mod_ab9a3338a53b29902a27e102983877e94_icgraph" id="anamespacefftsolver__mod_ab9a3338a53b29902a27e102983877e94_icgraph">
<area shape="rect" title="Completes the psrce calculation by waiting on all outstanding psrce communications to complete and th..." alt="" coords="796,5,955,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#a82fe1bd4173b841df2bc7651cefdf4bc" title="Timestep call back, which will transform to Fourier space, do a tridiagonal solve and then back into ..." alt="" coords="592,5,748,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#ad219c2d25fc8a8f9353c00f610f37c4b" title="Descriptor of this component for registration." alt="" coords="392,5,544,47"/>
<area shape="rect" href="namespacetest__monc__mod.html#aff7fde9554a678aa36495a32e189f4c9" title=" " alt="" coords="176,5,344,47"/>
<area shape="rect" href="test__monc_8F90.html#a4a1c75fa47435dd0a9a6afd7068428a2" title=" " alt="" coords="5,13,128,39"/>
</map>
</div>

</div>
</div>
<a id="a50b8c3b67d6b172f278aa26f2d5c299c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50b8c3b67d6b172f278aa26f2d5c299c">&#9670;&nbsp;</a></span>copy_halo_buffer_to_p()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine fftsolver_mod::copy_halo_buffer_to_p </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1neighbour__description__type.html">neighbour_description_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>neighbour_description</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>target_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>neighbour_location</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>current_page</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1field__data__wrapper__type.html">field_data_wrapper_type</a>), dimension(:), intent(in), optional&#160;</td>
          <td class="paramname"><em>source_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00267">267</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: dim, target_index, neighbour_location</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span> :: current_page(:)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordtype">type</span>(neighbour_description_type), <span class="keywordtype">intent(inout)</span> :: neighbour_description</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordtype">type</span>(field_data_wrapper_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: source_data</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keyword">call </span>copy_buffer_to_field(current_state%local_grid, neighbour_description%recv_halo_buffer, current_state%p%data, &amp;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;         dim, target_index, current_page(neighbour_location))</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    current_page(neighbour_location)=current_page(neighbour_location)+1</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_a50b8c3b67d6b172f278aa26f2d5c299c_icgraph.png" border="0" usemap="#anamespacefftsolver__mod_a50b8c3b67d6b172f278aa26f2d5c299c_icgraph" alt=""/></div>
<map name="namespacefftsolver__mod_a50b8c3b67d6b172f278aa26f2d5c299c_icgraph" id="anamespacefftsolver__mod_a50b8c3b67d6b172f278aa26f2d5c299c_icgraph">
<area shape="rect" title=" " alt="" coords="796,5,929,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#a82fe1bd4173b841df2bc7651cefdf4bc" title="Timestep call back, which will transform to Fourier space, do a tridiagonal solve and then back into ..." alt="" coords="592,5,748,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#ad219c2d25fc8a8f9353c00f610f37c4b" title="Descriptor of this component for registration." alt="" coords="392,5,544,47"/>
<area shape="rect" href="namespacetest__monc__mod.html#aff7fde9554a678aa36495a32e189f4c9" title=" " alt="" coords="176,5,344,47"/>
<area shape="rect" href="test__monc_8F90.html#a4a1c75fa47435dd0a9a6afd7068428a2" title=" " alt="" coords="5,13,128,39"/>
</map>
</div>

</div>
</div>
<a id="a9fbc281dc1b4670abbc9713417550bc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fbc281dc1b4670abbc9713417550bc3">&#9670;&nbsp;</a></span>copy_p_to_halo_buffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine fftsolver_mod::copy_p_to_halo_buffer </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1neighbour__description__type.html">neighbour_description_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>neighbour_description</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>dim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>source_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>pid_location</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>current_page</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1field__data__wrapper__type.html">field_data_wrapper_type</a>), dimension(:), intent(in), optional&#160;</td>
          <td class="paramname"><em>source_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Copies the p field data to halo buffers for a specific process in a dimension and halo cell. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">neighbour_descriptions</td><td>Description of the neighbour halo swapping status </td></tr>
    <tr><td class="paramname">dim</td><td>Dimension to copy from </td></tr>
    <tr><td class="paramname">source_index</td><td>The source index of the dimension we are reading from in the prognostic field </td></tr>
    <tr><td class="paramname">pid_location</td><td>Location of the neighbouring process in the local stored data structures </td></tr>
    <tr><td class="paramname">current_page</td><td>The current (next) buffer page to copy into </td></tr>
    <tr><td class="paramname">source_data</td><td>Optional source data which is read from </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00248">248</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: dim, pid_location, source_index</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span> :: current_page(:)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordtype">type</span>(neighbour_description_type), <span class="keywordtype">intent(inout)</span> :: neighbour_description</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordtype">type</span>(field_data_wrapper_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: source_data</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keyword">call </span>copy_field_to_buffer(current_state%local_grid, neighbour_description%send_halo_buffer, current_state%p%data, &amp;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;         dim, source_index, current_page(pid_location))</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    current_page(pid_location)=current_page(pid_location)+1</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_a9fbc281dc1b4670abbc9713417550bc3_icgraph.png" border="0" usemap="#anamespacefftsolver__mod_a9fbc281dc1b4670abbc9713417550bc3_icgraph" alt=""/></div>
<map name="namespacefftsolver__mod_a9fbc281dc1b4670abbc9713417550bc3_icgraph" id="anamespacefftsolver__mod_a9fbc281dc1b4670abbc9713417550bc3_icgraph">
<area shape="rect" title="Copies the p field data to halo buffers for a specific process in a dimension and halo cell." alt="" coords="796,5,929,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#a82fe1bd4173b841df2bc7651cefdf4bc" title="Timestep call back, which will transform to Fourier space, do a tridiagonal solve and then back into ..." alt="" coords="592,5,748,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#ad219c2d25fc8a8f9353c00f610f37c4b" title="Descriptor of this component for registration." alt="" coords="392,5,544,47"/>
<area shape="rect" href="namespacetest__monc__mod.html#aff7fde9554a678aa36495a32e189f4c9" title=" " alt="" coords="176,5,344,47"/>
<area shape="rect" href="test__monc_8F90.html#a4a1c75fa47435dd0a9a6afd7068428a2" title=" " alt="" coords="5,13,128,39"/>
</map>
</div>

</div>
</div>
<a id="ad219c2d25fc8a8f9353c00f610f37c4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad219c2d25fc8a8f9353c00f610f37c4b">&#9670;&nbsp;</a></span>fftsolver_get_descriptor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structmonc__component__mod_1_1component__descriptor__type.html">component_descriptor_type</a>) function, public fftsolver_mod::fftsolver_get_descriptor</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Descriptor of this component for registration. </p>
<dl class="section return"><dt>Returns</dt><dd>The fft solver component descriptor </dd></dl>

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00032">32</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    fftsolver_get_descriptor%name=<span class="stringliteral">&quot;fftsolver&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    fftsolver_get_descriptor%version=0.1</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    fftsolver_get_descriptor%initialisation=&gt;initialisation_callback</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    fftsolver_get_descriptor%timestep=&gt;timestep_callback</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    fftsolver_get_descriptor%finalisation=&gt;finalisation_callback</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_ad219c2d25fc8a8f9353c00f610f37c4b_cgraph.png" border="0" usemap="#anamespacefftsolver__mod_ad219c2d25fc8a8f9353c00f610f37c4b_cgraph" alt=""/></div>
<map name="namespacefftsolver__mod_ad219c2d25fc8a8f9353c00f610f37c4b_cgraph" id="anamespacefftsolver__mod_ad219c2d25fc8a8f9353c00f610f37c4b_cgraph">
<area shape="rect" title="Descriptor of this component for registration." alt="" coords="5,71,157,112"/>
<area shape="rect" href="namespacefftsolver__mod.html#acdf834d62478f5f7799afdc2847fa587" title="Called at MONC finalisation, will call to the pencil fft module to clean itself up and free the press..." alt="" coords="209,5,376,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#a9a2b2b221d8792a61e274193534e03bc" title="This initialisation callback sets up the pencil fft module, allocates data for the fourier space pres..." alt="" coords="205,71,380,112"/>
<area shape="rect" href="namespacefftsolver__mod.html#a82fe1bd4173b841df2bc7651cefdf4bc" title="Timestep call back, which will transform to Fourier space, do a tridiagonal solve and then back into ..." alt="" coords="215,136,371,177"/>
<area shape="rect" href="namespacefftsolver__mod.html#ab9a3338a53b29902a27e102983877e94" title="Completes the psrce calculation by waiting on all outstanding psrce communications to complete and th..." alt="" coords="431,5,590,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#a50b8c3b67d6b172f278aa26f2d5c299c" title=" " alt="" coords="444,71,577,112"/>
<area shape="rect" href="namespacefftsolver__mod.html#a9fbc281dc1b4670abbc9713417550bc3" title="Copies the p field data to halo buffers for a specific process in a dimension and halo cell." alt="" coords="444,136,577,177"/>
<area shape="rect" href="namespacefftsolver__mod.html#a9ec4b150d4fefc0abd637fe94ce88673" title="Does local data copying for P variable halo swap." alt="" coords="431,201,590,243"/>
<area shape="rect" href="namespacefftsolver__mod.html#a1adca201d5138e9e750fcd7865f6f3e3" title="The tridiagonal solver which runs in Fourier space on the pressure terms. Note that because we are go..." alt="" coords="428,267,593,308"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_ad219c2d25fc8a8f9353c00f610f37c4b_icgraph.png" border="0" usemap="#anamespacefftsolver__mod_ad219c2d25fc8a8f9353c00f610f37c4b_icgraph" alt=""/></div>
<map name="namespacefftsolver__mod_ad219c2d25fc8a8f9353c00f610f37c4b_icgraph" id="anamespacefftsolver__mod_ad219c2d25fc8a8f9353c00f610f37c4b_icgraph">
<area shape="rect" title="Descriptor of this component for registration." alt="" coords="392,5,544,47"/>
<area shape="rect" href="namespacetest__monc__mod.html#aff7fde9554a678aa36495a32e189f4c9" title=" " alt="" coords="176,5,344,47"/>
<area shape="rect" href="test__monc_8F90.html#a4a1c75fa47435dd0a9a6afd7068428a2" title=" " alt="" coords="5,13,128,39"/>
</map>
</div>

</div>
</div>
<a id="acdf834d62478f5f7799afdc2847fa587"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdf834d62478f5f7799afdc2847fa587">&#9670;&nbsp;</a></span>finalisation_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine fftsolver_mod::finalisation_callback </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Called at MONC finalisation, will call to the pencil fft module to clean itself up and free the pressure term. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00130">130</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keyword">call </span>finalise_pencil_fft(current_state%parallel%monc_communicator)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keyword">deallocate</span>(pt)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(cos_x)) <span class="keyword">deallocate</span>(cos_x)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(cos_y)) <span class="keyword">deallocate</span>(cos_y)</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_acdf834d62478f5f7799afdc2847fa587_icgraph.png" border="0" usemap="#anamespacefftsolver__mod_acdf834d62478f5f7799afdc2847fa587_icgraph" alt=""/></div>
<map name="namespacefftsolver__mod_acdf834d62478f5f7799afdc2847fa587_icgraph" id="anamespacefftsolver__mod_acdf834d62478f5f7799afdc2847fa587_icgraph">
<area shape="rect" title="Called at MONC finalisation, will call to the pencil fft module to clean itself up and free the press..." alt="" coords="592,5,759,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#ad219c2d25fc8a8f9353c00f610f37c4b" title="Descriptor of this component for registration." alt="" coords="392,5,544,47"/>
<area shape="rect" href="namespacetest__monc__mod.html#aff7fde9554a678aa36495a32e189f4c9" title=" " alt="" coords="176,5,344,47"/>
<area shape="rect" href="test__monc_8F90.html#a4a1c75fa47435dd0a9a6afd7068428a2" title=" " alt="" coords="5,13,128,39"/>
</map>
</div>

</div>
</div>
<a id="a9a2b2b221d8792a61e274193534e03bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a2b2b221d8792a61e274193534e03bc">&#9670;&nbsp;</a></span>initialisation_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine fftsolver_mod::initialisation_callback </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This initialisation callback sets up the pencil fft module, allocates data for the fourier space pressure term (might be different size than p) and populates cos x and y. </p>

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00042">42</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">integer</span> :: i, my_y_start, my_x_start</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">if</span> (.not. is_component_enabled(current_state%options_database, <span class="stringliteral">&quot;diverr&quot;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">log_master_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;The FFT solver component requires the diverr component to be enabled&quot;</span>)</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keywordflow">    end if</span> </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="namespacescience__constants__mod.html#ae8033eb104cc11fddfcf12d79fae0bd1">pi</a>=4.0_default_precision*atan(1.0_default_precision)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    fourier_space_sizes=initialise_pencil_fft(current_state, my_y_start, my_x_start)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keyword">call </span>init_halo_communication(current_state, get_single_field_per_halo_cell, halo_swap_state, 1, .false.)</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keyword">allocate</span>(pt(fourier_space_sizes(z_index), fourier_space_sizes(y_index), fourier_space_sizes(x_index)))</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#ifdef U_ACTIVE</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor"></span>    <span class="keyword">allocate</span>(cos_x(fourier_space_sizes(x_index)))</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">do</span> i=1, fourier_space_sizes(x_index)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      cos_x(i)=(2.0_default_precision/(current_state%global_grid%configuration%horizontal%dx*&amp;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;           current_state%global_grid%configuration%horizontal%dx))&amp;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;           *(cos(2.0_default_precision*<a class="code" href="namespacescience__constants__mod.html#ae8033eb104cc11fddfcf12d79fae0bd1">pi</a>*real(((i-1)+(my_x_start-1))/2, kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>)/&amp;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keywordtype">           real</span>(current_state%global_grid%size(X_INDEX), kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>))-1.0_default_precision)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keywordflow">    end do</span>    </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#ifdef V_ACTIVE</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor"></span>    <span class="keyword">allocate</span>(cos_y(fourier_space_sizes(y_index)))</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">do</span> i=1, fourier_space_sizes(y_index)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      cos_y(i)=(2.0_default_precision/(current_state%global_grid%configuration%horizontal%dy*&amp;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;           current_state%global_grid%configuration%horizontal%dy))&amp;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;           *(cos(2.0_default_precision*<a class="code" href="namespacescience__constants__mod.html#ae8033eb104cc11fddfcf12d79fae0bd1">pi</a>*real(((i-1)+(my_y_start-1))/2, kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>)/&amp;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keywordtype">           real</span>(current_state%global_grid%size(Y_INDEX), kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>))-1.0_default_precision)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keywordflow">    end do</span>    </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor"></span>    current_state%psrce_x_hs_send_request=mpi_request_null</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    current_state%psrce_y_hs_send_request=mpi_request_null</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    current_state%psrce_x_hs_recv_request=mpi_request_null</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    current_state%psrce_y_hs_recv_request=mpi_request_null </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_a9a2b2b221d8792a61e274193534e03bc_icgraph.png" border="0" usemap="#anamespacefftsolver__mod_a9a2b2b221d8792a61e274193534e03bc_icgraph" alt=""/></div>
<map name="namespacefftsolver__mod_a9a2b2b221d8792a61e274193534e03bc_icgraph" id="anamespacefftsolver__mod_a9a2b2b221d8792a61e274193534e03bc_icgraph">
<area shape="rect" title="This initialisation callback sets up the pencil fft module, allocates data for the fourier space pres..." alt="" coords="592,5,767,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#ad219c2d25fc8a8f9353c00f610f37c4b" title="Descriptor of this component for registration." alt="" coords="392,5,544,47"/>
<area shape="rect" href="namespacetest__monc__mod.html#aff7fde9554a678aa36495a32e189f4c9" title=" " alt="" coords="176,5,344,47"/>
<area shape="rect" href="test__monc_8F90.html#a4a1c75fa47435dd0a9a6afd7068428a2" title=" " alt="" coords="5,13,128,39"/>
</map>
</div>

</div>
</div>
<a id="a9ec4b150d4fefc0abd637fe94ce88673"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ec4b150d4fefc0abd637fe94ce88673">&#9670;&nbsp;</a></span>perform_local_data_copy_for_p()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine fftsolver_mod::perform_local_data_copy_for_p </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>halo_depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>involve_corners</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcommunication__types__mod_1_1field__data__wrapper__type.html">field_data_wrapper_type</a>), dimension(:), intent(in), optional&#160;</td>
          <td class="paramname"><em>source_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Does local data copying for P variable halo swap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model <a class="el" href="namespacestate__mod.html" title="The model state which represents the current state of a run.">state_mod</a> </td></tr>
    <tr><td class="paramname">source_data</td><td>Optional source data which is written into </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00284">284</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: halo_depth</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: involve_corners</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordtype">type</span>(field_data_wrapper_type), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: source_data</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keyword">call </span>perform_local_data_copy_for_field(current_state%p%data, current_state%local_grid, &amp;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;         current_state%parallel%my_rank, halo_depth, involve_corners)</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_a9ec4b150d4fefc0abd637fe94ce88673_icgraph.png" border="0" usemap="#anamespacefftsolver__mod_a9ec4b150d4fefc0abd637fe94ce88673_icgraph" alt=""/></div>
<map name="namespacefftsolver__mod_a9ec4b150d4fefc0abd637fe94ce88673_icgraph" id="anamespacefftsolver__mod_a9ec4b150d4fefc0abd637fe94ce88673_icgraph">
<area shape="rect" title="Does local data copying for P variable halo swap." alt="" coords="796,5,955,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#a82fe1bd4173b841df2bc7651cefdf4bc" title="Timestep call back, which will transform to Fourier space, do a tridiagonal solve and then back into ..." alt="" coords="592,5,748,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#ad219c2d25fc8a8f9353c00f610f37c4b" title="Descriptor of this component for registration." alt="" coords="392,5,544,47"/>
<area shape="rect" href="namespacetest__monc__mod.html#aff7fde9554a678aa36495a32e189f4c9" title=" " alt="" coords="176,5,344,47"/>
<area shape="rect" href="test__monc_8F90.html#a4a1c75fa47435dd0a9a6afd7068428a2" title=" " alt="" coords="5,13,128,39"/>
</map>
</div>

</div>
</div>
<a id="a82fe1bd4173b841df2bc7651cefdf4bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82fe1bd4173b841df2bc7651cefdf4bc">&#9670;&nbsp;</a></span>timestep_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine fftsolver_mod::timestep_callback </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Timestep call back, which will transform to Fourier space, do a tridiagonal solve and then back into time space. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00086">86</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordtype">integer</span> :: start_loc(3), end_loc(3), i</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">do</span> i=1,3</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      start_loc(i)=current_state%local_grid%local_domain_start_index(i)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      end_loc(i)=current_state%local_grid%local_domain_end_index(i)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keyword">call </span>complete_psrce_calculation(current_state, current_state%local_grid%halo_size(y_index), &amp;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;         current_state%local_grid%halo_size(x_index))</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#ifdef FFT_TEST_MODE</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor"></span>    current_state%p%data=real(current_state%parallel%my_rank, kind=8) + 1.d0</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keyword">call </span>perform_forward_3dfft(current_state, current_state%p%data(start_loc(z_index):end_loc(z_index), &amp;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;         start_loc(y_index):end_loc(y_index), start_loc(x_index):end_loc(x_index)), pt)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#ifndef FFT_TEST_MODE</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>tridiagonal_solver(current_state, pt, fourier_space_sizes)</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="preprocessor"></span>    </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">! Here it is complex space, distributed as needed. The other option is real space but with +1 for the last process in Y</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">! as require that complex number - not sure the best approach. We can extract the values here from complex anyway so</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">! worth trying that first. Operating on the size of pt rather than grid sizes. Downside of real space xform is then we have +1</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">! in the forwards transformation    </span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keyword">call </span>perform_backwards_3dfft(current_state, pt, current_state%p%data(start_loc(z_index):end_loc(z_index), &amp;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;         start_loc(y_index):end_loc(y_index), start_loc(x_index):end_loc(x_index)))   </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#ifdef FFT_TEST_MODE</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> (current_state%parallel%my_rank == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="keyword">write</span>(*,*) current_state%parallel%my_rank, current_state%p%data(:,3,3)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keyword">call </span>blocking_halo_swap(current_state, halo_swap_state, copy_p_to_halo_buffer, &amp;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;         perform_local_data_copy_for_p, copy_halo_buffer_to_p)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_a82fe1bd4173b841df2bc7651cefdf4bc_cgraph.png" border="0" usemap="#anamespacefftsolver__mod_a82fe1bd4173b841df2bc7651cefdf4bc_cgraph" alt=""/></div>
<map name="namespacefftsolver__mod_a82fe1bd4173b841df2bc7651cefdf4bc_cgraph" id="anamespacefftsolver__mod_a82fe1bd4173b841df2bc7651cefdf4bc_cgraph">
<area shape="rect" title="Timestep call back, which will transform to Fourier space, do a tridiagonal solve and then back into ..." alt="" coords="5,136,161,177"/>
<area shape="rect" href="namespacefftsolver__mod.html#ab9a3338a53b29902a27e102983877e94" title="Completes the psrce calculation by waiting on all outstanding psrce communications to complete and th..." alt="" coords="213,5,371,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#a50b8c3b67d6b172f278aa26f2d5c299c" title=" " alt="" coords="225,71,359,112"/>
<area shape="rect" href="namespacefftsolver__mod.html#a9fbc281dc1b4670abbc9713417550bc3" title="Copies the p field data to halo buffers for a specific process in a dimension and halo cell." alt="" coords="225,136,359,177"/>
<area shape="rect" href="namespacefftsolver__mod.html#a9ec4b150d4fefc0abd637fe94ce88673" title="Does local data copying for P variable halo swap." alt="" coords="213,201,371,243"/>
<area shape="rect" href="namespacefftsolver__mod.html#a1adca201d5138e9e750fcd7865f6f3e3" title="The tridiagonal solver which runs in Fourier space on the pressure terms. Note that because we are go..." alt="" coords="209,267,375,308"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_a82fe1bd4173b841df2bc7651cefdf4bc_icgraph.png" border="0" usemap="#anamespacefftsolver__mod_a82fe1bd4173b841df2bc7651cefdf4bc_icgraph" alt=""/></div>
<map name="namespacefftsolver__mod_a82fe1bd4173b841df2bc7651cefdf4bc_icgraph" id="anamespacefftsolver__mod_a82fe1bd4173b841df2bc7651cefdf4bc_icgraph">
<area shape="rect" title="Timestep call back, which will transform to Fourier space, do a tridiagonal solve and then back into ..." alt="" coords="592,5,748,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#ad219c2d25fc8a8f9353c00f610f37c4b" title="Descriptor of this component for registration." alt="" coords="392,5,544,47"/>
<area shape="rect" href="namespacetest__monc__mod.html#aff7fde9554a678aa36495a32e189f4c9" title=" " alt="" coords="176,5,344,47"/>
<area shape="rect" href="test__monc_8F90.html#a4a1c75fa47435dd0a9a6afd7068428a2" title=" " alt="" coords="5,13,128,39"/>
</map>
</div>

</div>
</div>
<a id="a1adca201d5138e9e750fcd7865f6f3e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1adca201d5138e9e750fcd7865f6f3e3">&#9670;&nbsp;</a></span>tridiagonal_solver()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine fftsolver_mod::tridiagonal_solver </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structstate__mod_1_1model__state__type.html">model_state_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>current_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:,:,:), intent(inout)&#160;</td>
          <td class="paramname"><em>pressure_term</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(3), intent(in)&#160;</td>
          <td class="paramname"><em>fourier_space_sizes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The tridiagonal solver which runs in Fourier space on the pressure terms. Note that because we are going from n reals to n/2+1 complex numbers (and into their reals for this solver) then there might be more data in the pressure term than in p. Therefore use the space sizes which are provided as an argument to this procedure rather than the current state local grid dimensions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current model state </td></tr>
    <tr><td class="paramname">pressure_term</td><td>The pressure term in Fourier space </td></tr>
    <tr><td class="paramname">fourier_space_sizes</td><td>The size of the pressure term in each dimension </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00188">188</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">type</span>(model_state_type), <span class="keywordtype">target</span>, <span class="keywordtype">intent(inout)</span> :: current_state</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">intent(inout)</span> :: pressure_term</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: fourier_space_sizes(3)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">integer</span> :: i, j, k, j_start</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: b(fourier_space_sizes(z_index)), b1(fourier_space_sizes(z_index)),   &amp;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        s(fourier_space_sizes(z_index)), s1(fourier_space_sizes(z_index)), cij</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">do</span> i=1,fourier_space_sizes(x_index)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      j_start=merge(3, 1, current_state%local_grid%start(y_index) ==1 .and. current_state%local_grid%start(x_index) == 1 &amp;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;           .and. i .lt. 3)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordflow">do</span> j=j_start,fourier_space_sizes(y_index)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        cij=cos_x(i)+cos_y(j)        </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        b(2)=cij-current_state%global_grid%configuration%vertical%cza(2)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        b1(2)=1.0_default_precision/b(2)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        s1(2)=pressure_term(2,j,i)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">do</span> k=3,fourier_space_sizes(z_index)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;           b(k)=cij+current_state%global_grid%configuration%vertical%czg(k)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;           b1(k)=1.0_default_precision/(b(k)-current_state%global_grid%configuration%vertical%czh(k)*b1(k-1))</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;           s1(k)=pressure_term(k,j,i)-current_state%global_grid%configuration%vertical%czb(k)*s1(k-1)*b1(k-1)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160; </div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        pressure_term(fourier_space_sizes(z_index),j,i)=s1(fourier_space_sizes(z_index))* b1(fourier_space_sizes(z_index))</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">do</span> k=fourier_space_sizes(z_index)-1,2,-1</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;          pressure_term(k,j,i)=(s1(k)-current_state%global_grid%configuration%vertical%cza(k)*&amp;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;               pressure_term(k+1,j,i))*b1(k)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keywordflow">        end do</span>                </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keywordflow">    end do</span>    </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="comment">! Handle the zero wavenumber, which will only be on processes where the X and Y  dimension starts at 1</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">if</span> (current_state%local_grid%start(y_index) == 1 .and. current_state%local_grid%start(x_index) == 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">do</span> i=1,2</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">do</span> j=1,2</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;          s(2)=pressure_term(2,j,i)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;          pressure_term(1,j,i)=0.0_default_precision</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;          pressure_term(2,j,i)=0.0_default_precision</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;          <span class="keywordflow">do</span> k=3, fourier_space_sizes(z_index)</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            s(k)=pressure_term(k,j,i)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            pressure_term(k,j,i)=(s(k-1)-current_state%global_grid%configuration%vertical%czg(k-1)*pressure_term(k-1,j,i)-&amp;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                 current_state%global_grid%configuration%vertical%czb(k-1)*pressure_term(k-2,j,i))/&amp;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                 current_state%global_grid%configuration%vertical%cza(k-1)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keywordflow">          end do</span>          </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="keywordflow">        end do</span>        </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="keywordflow">      end do</span>           </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacefftsolver__mod_a1adca201d5138e9e750fcd7865f6f3e3_icgraph.png" border="0" usemap="#anamespacefftsolver__mod_a1adca201d5138e9e750fcd7865f6f3e3_icgraph" alt=""/></div>
<map name="namespacefftsolver__mod_a1adca201d5138e9e750fcd7865f6f3e3_icgraph" id="anamespacefftsolver__mod_a1adca201d5138e9e750fcd7865f6f3e3_icgraph">
<area shape="rect" title="The tridiagonal solver which runs in Fourier space on the pressure terms. Note that because we are go..." alt="" coords="796,5,961,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#a82fe1bd4173b841df2bc7651cefdf4bc" title="Timestep call back, which will transform to Fourier space, do a tridiagonal solve and then back into ..." alt="" coords="592,5,748,47"/>
<area shape="rect" href="namespacefftsolver__mod.html#ad219c2d25fc8a8f9353c00f610f37c4b" title="Descriptor of this component for registration." alt="" coords="392,5,544,47"/>
<area shape="rect" href="namespacetest__monc__mod.html#aff7fde9554a678aa36495a32e189f4c9" title=" " alt="" coords="176,5,344,47"/>
<area shape="rect" href="test__monc_8F90.html#a4a1c75fa47435dd0a9a6afd7068428a2" title=" " alt="" coords="5,13,128,39"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a93d5691a1baf056c9c68e43a9b658fb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93d5691a1baf056c9c68e43a9b658fb7">&#9670;&nbsp;</a></span>cos_x</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision), dimension(:), allocatable fftsolver_mod::cos_x</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00021">21</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keywordtype">  real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: cos_x, cos_y</div>
</div><!-- fragment -->
</div>
</div>
<a id="a98154ec2380d2cf1b11926c42f67c1b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98154ec2380d2cf1b11926c42f67c1b8">&#9670;&nbsp;</a></span>cos_y</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision), dimension(:), allocatable fftsolver_mod::cos_y</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00021">21</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>

</div>
</div>
<a id="a6e465fdc8e3066e3ab7e21bc2db80518"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e465fdc8e3066e3ab7e21bc2db80518">&#9670;&nbsp;</a></span>fourier_space_sizes</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, dimension(3) fftsolver_mod::fourier_space_sizes</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00024">24</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordtype">integer</span> :: fourier_space_sizes(3)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a03eb2dbfcf954511ed750458c5c79680"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03eb2dbfcf954511ed750458c5c79680">&#9670;&nbsp;</a></span>halo_swap_state</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structcommunication__types__mod_1_1halo__communication__type.html">halo_communication_type</a>), save fftsolver_mod::halo_swap_state</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00025">25</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="keywordtype">type</span>(halo_communication_type), <span class="keywordtype">save</span> :: halo_swap_state</div>
</div><!-- fragment -->
</div>
</div>
<a id="adca03d66144dedfce4256f9dfd28483e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adca03d66144dedfce4256f9dfd28483e">&#9670;&nbsp;</a></span>pi</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision) fftsolver_mod::pi</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00022">22</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keywordtype">  real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>) :: <a class="code" href="namespacescience__constants__mod.html#ae8033eb104cc11fddfcf12d79fae0bd1">pi</a></div>
</div><!-- fragment -->
</div>
</div>
<a id="a68ad171760478fa0e820addd0bacaa8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68ad171760478fa0e820addd0bacaa8a">&#9670;&nbsp;</a></span>pt</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real(kind=default_precision), dimension(:,:,:), allocatable fftsolver_mod::pt</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="fftsolver_8F90_source.html#l00023">23</a> of file <a class="el" href="fftsolver_8F90_source.html">fftsolver.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keywordtype">  real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:)</span>, <span class="keywordtype">allocatable</span> :: pt</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<div class="ttc" id="anamespacelogging__mod_html_ad68309846cd8f9e77edaa6abd02f65a0"><div class="ttname"><a href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">logging_mod::log_error</a></div><div class="ttdeci">integer, parameter, public log_error</div><div class="ttdoc">Only log ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00011">logging.F90:11</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ad95937a250467334622daeb5cff78c20"><div class="ttname"><a href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">logging_mod::log_master_log</a></div><div class="ttdeci">subroutine, public log_master_log(level, message)</div><div class="ttdoc">Will log just from the master process.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00046">logging.F90:47</a></div></div>
<div class="ttc" id="anamespacescience__constants__mod_html_ae8033eb104cc11fddfcf12d79fae0bd1"><div class="ttname"><a href="namespacescience__constants__mod.html#ae8033eb104cc11fddfcf12d79fae0bd1">science_constants_mod::pi</a></div><div class="ttdeci">real(kind=default_precision), public pi</div><div class="ttdef"><b>Definition:</b> <a href="scienceconstants_8F90_source.html#l00013">scienceconstants.F90:13</a></div></div>
<div class="ttc" id="anamespacedatadefn__mod_html_a39b79f8cc843d236d3b47f5c81b64368"><div class="ttname"><a href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">datadefn_mod::default_precision</a></div><div class="ttdeci">integer, parameter, public default_precision</div><div class="ttdoc">MPI communication type which we use for the prognostic and calculation data.</div><div class="ttdef"><b>Definition:</b> <a href="datadefn_8F90_source.html#l00017">datadefn.F90:17</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>

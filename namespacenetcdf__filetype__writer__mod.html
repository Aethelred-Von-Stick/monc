<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MONC: netcdf_filetype_writer_mod Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MONC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">netcdf_filetype_writer_mod Module Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The NetCDF file type writer which performs actual writing of NetCDF files to the parallel filesystem. These are opened by all IO servers and all IO servers can participate as variables might be located across the different IO processes.  
<a href="namespacenetcdf__filetype__writer__mod.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a8fb7c121572aa0805eb6938e83eb37d8"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a8fb7c121572aa0805eb6938e83eb37d8">initialise_netcdf_filetype</a> ()</td></tr>
<tr class="memdesc:a8fb7c121572aa0805eb6938e83eb37d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialises the NetCDF writing functionality.  <a href="namespacenetcdf__filetype__writer__mod.html#a8fb7c121572aa0805eb6938e83eb37d8">More...</a><br /></td></tr>
<tr class="separator:a8fb7c121572aa0805eb6938e83eb37d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4267425ddfb057cab9dc7c4d08087669"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a4267425ddfb057cab9dc7c4d08087669">finalise_netcdf_filetype</a> ()</td></tr>
<tr class="memdesc:a4267425ddfb057cab9dc7c4d08087669"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finalises the NetCDF writing functionality.  <a href="namespacenetcdf__filetype__writer__mod.html#a4267425ddfb057cab9dc7c4d08087669">More...</a><br /></td></tr>
<tr class="separator:a4267425ddfb057cab9dc7c4d08087669"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c970a34b31a068f500ae6a1235d9906"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906">define_netcdf_file</a> (io_configuration, file_writer_information, timestep, time, time_points, termination_write)</td></tr>
<tr class="memdesc:a6c970a34b31a068f500ae6a1235d9906"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines a NetCDF file - which creates it, defines all dimensions and variables. This must be called by all IO server processes as the NetCDF operations here are collective.  <a href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906">More...</a><br /></td></tr>
<tr class="separator:a6c970a34b31a068f500ae6a1235d9906"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab90e4b2c185d22faacd6f23c39bd9449"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#ab90e4b2c185d22faacd6f23c39bd9449">store_io_server_state</a> (io_configuration, writer_entries, time_points, file_writer_information, timestep)</td></tr>
<tr class="memdesc:ab90e4b2c185d22faacd6f23c39bd9449"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the IO server state in the NetCDF file.  <a href="namespacenetcdf__filetype__writer__mod.html#ab90e4b2c185d22faacd6f23c39bd9449">More...</a><br /></td></tr>
<tr class="separator:ab90e4b2c185d22faacd6f23c39bd9449"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9fdd5ef501b6dfc64d62898d1ef25b1b"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structwriter__types__mod_1_1writer__type.html">writer_type</a>) function, pointer, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a9fdd5ef501b6dfc64d62898d1ef25b1b">get_writer_entry_from_netcdf</a> (field_name, timestep, terminated)</td></tr>
<tr class="memdesc:a9fdd5ef501b6dfc64d62898d1ef25b1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Looks up and retrieves the writer entry that corresponds to this NetCDF file state.  <a href="namespacenetcdf__filetype__writer__mod.html#a9fdd5ef501b6dfc64d62898d1ef25b1b">More...</a><br /></td></tr>
<tr class="separator:a9fdd5ef501b6dfc64d62898d1ef25b1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c67fccb16973e19938a1be7119a0f64"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a2c67fccb16973e19938a1be7119a0f64">close_netcdf_file</a> (io_configuration, field_name, timestep)</td></tr>
<tr class="memdesc:a2c67fccb16973e19938a1be7119a0f64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call back for the inter IO reduction which actually does the NetCDF file closing which is a collective (synchronous) operation. This also cleans up the file state as it is no longer required.  <a href="namespacenetcdf__filetype__writer__mod.html#a2c67fccb16973e19938a1be7119a0f64">More...</a><br /></td></tr>
<tr class="separator:a2c67fccb16973e19938a1be7119a0f64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a797c4ff7ba5863cdff2746729ec8e1fc"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc">write_variable</a> (io_configuration, field_to_write_information, filename, timestep, time)</td></tr>
<tr class="memdesc:a797c4ff7ba5863cdff2746729ec8e1fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes the contents of a variable to the NetCDF file. This also removes the written entries from the field information type in order to conserve memory.  <a href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc">More...</a><br /></td></tr>
<tr class="separator:a797c4ff7ba5863cdff2746729ec8e1fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacc77c78537724e3eac2bfc2537d9a30"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#aacc77c78537724e3eac2bfc2537d9a30">get_dimension_identifier</a> (dim_name, is_auto_dimension)</td></tr>
<tr class="memdesc:aacc77c78537724e3eac2bfc2537d9a30"><td class="mdescLeft">&#160;</td><td class="mdescRight">Translates a dimension name to its numeric corresponding identifier.  <a href="namespacenetcdf__filetype__writer__mod.html#aacc77c78537724e3eac2bfc2537d9a30">More...</a><br /></td></tr>
<tr class="separator:aacc77c78537724e3eac2bfc2537d9a30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff299f33f5701bfddd073cd0a06be5f7"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#aff299f33f5701bfddd073cd0a06be5f7">get_dimension_original_size</a> (dim_name, dimension_store)</td></tr>
<tr class="memdesc:aff299f33f5701bfddd073cd0a06be5f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the original size of a specific dimension (which is auto)  <a href="namespacenetcdf__filetype__writer__mod.html#aff299f33f5701bfddd073cd0a06be5f7">More...</a><br /></td></tr>
<tr class="separator:aff299f33f5701bfddd073cd0a06be5f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae456ae2267a1cf3a1763d1cbd59039ab"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#ae456ae2267a1cf3a1763d1cbd59039ab">write_coordinate_variable</a> (file_state, coord_var_id, field_values)</td></tr>
<tr class="memdesc:ae456ae2267a1cf3a1763d1cbd59039ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes a coordinate variable into the NetCDF file.  <a href="namespacenetcdf__filetype__writer__mod.html#ae456ae2267a1cf3a1763d1cbd59039ab">More...</a><br /></td></tr>
<tr class="separator:ae456ae2267a1cf3a1763d1cbd59039ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a437b7c2ee1752a8c3ad3ce4797cced"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a0a437b7c2ee1752a8c3ad3ce4797cced">write_condition_variable</a> (file_state, c_var_id, field_values)</td></tr>
<tr class="memdesc:a0a437b7c2ee1752a8c3ad3ce4797cced"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes the conditional diagnostic variable names into the NetCDF file.  <a href="namespacenetcdf__filetype__writer__mod.html#a0a437b7c2ee1752a8c3ad3ce4797cced">More...</a><br /></td></tr>
<tr class="separator:a0a437b7c2ee1752a8c3ad3ce4797cced"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc1e910adcd0ef7c86299b5286fc365f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#abc1e910adcd0ef7c86299b5286fc365f">write_contiguous_collective_variable_to_diagnostics</a> (io_configuration, field_to_write_information, timestep, time, file_state)</td></tr>
<tr class="memdesc:abc1e910adcd0ef7c86299b5286fc365f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes contiguous collective variable blocks into the NetCDF files. These are blocks of data spanning multiple variables and multiple time points, the idea being to minimise the number of overall writes into the file. These variables are defined collective, so it might be that other IO servers have less contiguous data and hence more writes, therefore empty writes might need to be issued (at the end) to match up against these other servers.  <a href="namespacenetcdf__filetype__writer__mod.html#abc1e910adcd0ef7c86299b5286fc365f">More...</a><br /></td></tr>
<tr class="separator:abc1e910adcd0ef7c86299b5286fc365f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaff250f828a91818f15f82b3838701cf"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structwriter__types__mod_1_1write__field__collective__descriptor__type.html">write_field_collective_descriptor_type</a>) function, pointer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#aaff250f828a91818f15f82b3838701cf">get_next_collective_descriptor</a> (iterator)</td></tr>
<tr class="memdesc:aaff250f828a91818f15f82b3838701cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the next collective descriptor based upon the iterator.  <a href="namespacenetcdf__filetype__writer__mod.html#aaff250f828a91818f15f82b3838701cf">More...</a><br /></td></tr>
<tr class="separator:aaff250f828a91818f15f82b3838701cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef4805588ccfc47ddd145e9c20e34218"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structwriter__types__mod_1_1write__field__collective__monc__info__type.html">write_field_collective_monc_info_type</a>) function, pointer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#aef4805588ccfc47ddd145e9c20e34218">get_next_specific_monc_info</a> (iterator)</td></tr>
<tr class="memdesc:aef4805588ccfc47ddd145e9c20e34218"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the next specific monc information item from the iterator.  <a href="namespacenetcdf__filetype__writer__mod.html#aef4805588ccfc47ddd145e9c20e34218">More...</a><br /></td></tr>
<tr class="separator:aef4805588ccfc47ddd145e9c20e34218"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10f13979aff7110f8df58356fb4e398d"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a10f13979aff7110f8df58356fb4e398d">write_collective_variable_to_diagnostics</a> (io_configuration, field_to_write_information, timestep, time, file_state)</td></tr>
<tr class="memdesc:a10f13979aff7110f8df58356fb4e398d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes collective variables, where we are working with the values from multiple MONCs and storing these in their own specific relative location in the diagnostics file.  <a href="namespacenetcdf__filetype__writer__mod.html#a10f13979aff7110f8df58356fb4e398d">More...</a><br /></td></tr>
<tr class="separator:a10f13979aff7110f8df58356fb4e398d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a605f56b2d81bbaf34377388f9d3f6ec1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a605f56b2d81bbaf34377388f9d3f6ec1">write_independent_variable_to_diagnostics</a> (field_to_write_information, timestep, time, file_state)</td></tr>
<tr class="memdesc:a605f56b2d81bbaf34377388f9d3f6ec1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes independent variables to the diagnostics file. This writes the entire variable and works by writing all the memory up and then doing the write in one call.  <a href="namespacenetcdf__filetype__writer__mod.html#a605f56b2d81bbaf34377388f9d3f6ec1">More...</a><br /></td></tr>
<tr class="separator:a605f56b2d81bbaf34377388f9d3f6ec1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a646b3fed89978ea8212eece9494f7c54"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a646b3fed89978ea8212eece9494f7c54">write_out_number_values</a> (field_to_write_information, timestep, time, file_state)</td></tr>
<tr class="separator:a646b3fed89978ea8212eece9494f7c54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a527dfbc289976e0eefcc432bb077040e"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a527dfbc289976e0eefcc432bb077040e">write_out_map</a> (field_to_write_information, timestep, time, file_state)</td></tr>
<tr class="separator:a527dfbc289976e0eefcc432bb077040e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d8000c479d36f8c5c0c91aa482c9765"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a2d8000c479d36f8c5c0c91aa482c9765">write_out_options</a> (io_configuration, file_state)</td></tr>
<tr class="memdesc:a2d8000c479d36f8c5c0c91aa482c9765"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes out the options_database defining this model run.  <a href="namespacenetcdf__filetype__writer__mod.html#a2d8000c479d36f8c5c0c91aa482c9765">More...</a><br /></td></tr>
<tr class="separator:a2d8000c479d36f8c5c0c91aa482c9765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66915aa056fc8a300dbedbc0c7b0c3ca"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a66915aa056fc8a300dbedbc0c7b0c3ca">define_time_series_dimensions</a> (file_state, file_writer_information, time, time_points, termination_write)</td></tr>
<tr class="memdesc:a66915aa056fc8a300dbedbc0c7b0c3ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines dimensions for all required dimensions. This is usually the number required plus one, but in some cases is entirely required depending how the output frequency and diagnostics write times match up.  <a href="namespacenetcdf__filetype__writer__mod.html#a66915aa056fc8a300dbedbc0c7b0c3ca">More...</a><br /></td></tr>
<tr class="separator:a66915aa056fc8a300dbedbc0c7b0c3ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63ada26600230ff5a6551e3dd04736ce"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a63ada26600230ff5a6551e3dd04736ce">get_number_timeseries_entries</a> (time_points, previous_write_time, output_frequency, timestep_frequency, termination_write, last_write_entry)</td></tr>
<tr class="memdesc:a63ada26600230ff5a6551e3dd04736ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the number of timeseries entries for a specific frequency and previous write time. This is based on the range of time points that are provided to the call.  <a href="namespacenetcdf__filetype__writer__mod.html#a63ada26600230ff5a6551e3dd04736ce">More...</a><br /></td></tr>
<tr class="separator:a63ada26600230ff5a6551e3dd04736ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ce0c117e268cee4460b6385bc8629c3"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a1ce0c117e268cee4460b6385bc8629c3">define_coordinate_variable</a> (file_state, coord_name)</td></tr>
<tr class="memdesc:a1ce0c117e268cee4460b6385bc8629c3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines a coordinate variable in the NetCDF file.  <a href="namespacenetcdf__filetype__writer__mod.html#a1ce0c117e268cee4460b6385bc8629c3">More...</a><br /></td></tr>
<tr class="separator:a1ce0c117e268cee4460b6385bc8629c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb0cc64b982ca21514e74a881b1ee30f"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#adb0cc64b982ca21514e74a881b1ee30f">define_options_database_variable</a> (file_state)</td></tr>
<tr class="memdesc:adb0cc64b982ca21514e74a881b1ee30f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the options_database variable in the NetCDF file.  <a href="namespacenetcdf__filetype__writer__mod.html#adb0cc64b982ca21514e74a881b1ee30f">More...</a><br /></td></tr>
<tr class="separator:adb0cc64b982ca21514e74a881b1ee30f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58faae9f572a8860a586d47251df2ab4"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a58faae9f572a8860a586d47251df2ab4">define_variables</a> (io_configuration, file_state, file_writer_information)</td></tr>
<tr class="memdesc:a58faae9f572a8860a586d47251df2ab4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines all variables in the file writer state.  <a href="namespacenetcdf__filetype__writer__mod.html#a58faae9f572a8860a586d47251df2ab4">More...</a><br /></td></tr>
<tr class="separator:a58faae9f572a8860a586d47251df2ab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af49b3618c2fdcf04a2eef4dc5e0a7925"><td class="memItemLeft" align="right" valign="top">integer function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#af49b3618c2fdcf04a2eef4dc5e0a7925">retrieve_time_series_dimension_id_for_field</a> (file_state, file_writer_information, field_index)</td></tr>
<tr class="memdesc:af49b3618c2fdcf04a2eef4dc5e0a7925"><td class="mdescLeft">&#160;</td><td class="mdescRight">For a specific field will retrieve the NetCDF id of the time series dimension most appropriate for this field. If a dimension can not be located then an error is raised.  <a href="namespacenetcdf__filetype__writer__mod.html#af49b3618c2fdcf04a2eef4dc5e0a7925">More...</a><br /></td></tr>
<tr class="separator:af49b3618c2fdcf04a2eef4dc5e0a7925"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6da2f8c99dc13a7d24ec60861a2a48aa"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__timeseries__type.html">netcdf_diagnostics_timeseries_type</a>) function, pointer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a6da2f8c99dc13a7d24ec60861a2a48aa">get_specific_timeseries_dimension</a> (file_state, output_frequency, timestep_frequency)</td></tr>
<tr class="memdesc:a6da2f8c99dc13a7d24ec60861a2a48aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given the file state and the output frequency of a field will retrive the appropriate time series dimension entry that corresponds to this or null if none can be found.  <a href="namespacenetcdf__filetype__writer__mod.html#a6da2f8c99dc13a7d24ec60861a2a48aa">More...</a><br /></td></tr>
<tr class="separator:a6da2f8c99dc13a7d24ec60861a2a48aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9492c076905001a53f8cb3085739d6db"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a9492c076905001a53f8cb3085739d6db">define_dimensions</a> (file_state, dimension_sizing)</td></tr>
<tr class="memdesc:a9492c076905001a53f8cb3085739d6db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines spatial dimensions in the diagnostics file.  <a href="namespacenetcdf__filetype__writer__mod.html#a9492c076905001a53f8cb3085739d6db">More...</a><br /></td></tr>
<tr class="separator:a9492c076905001a53f8cb3085739d6db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb05fbdc64a670792cd9cec7f238951d"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>) function, pointer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#acb05fbdc64a670792cd9cec7f238951d">get_file_state</a> (filename, timestep, dolock)</td></tr>
<tr class="memdesc:acb05fbdc64a670792cd9cec7f238951d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves a file state based upon its timestep or null if none is found.  <a href="namespacenetcdf__filetype__writer__mod.html#acb05fbdc64a670792cd9cec7f238951d">More...</a><br /></td></tr>
<tr class="separator:acb05fbdc64a670792cd9cec7f238951d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41e86c7b84afdea863ca626a2599bf1d"><td class="memItemLeft" align="right" valign="top">character(len=string_length) function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a41e86c7b84afdea863ca626a2599bf1d">get_field_key</a> (field_to_write_information)</td></tr>
<tr class="memdesc:a41e86c7b84afdea863ca626a2599bf1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against the id in the NetCDF file state internally. This is either the field name itself or the manipulation type appended if there is duplication.  <a href="namespacenetcdf__filetype__writer__mod.html#a41e86c7b84afdea863ca626a2599bf1d">More...</a><br /></td></tr>
<tr class="separator:a41e86c7b84afdea863ca626a2599bf1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5686361108378ecc645e4240ce3c3d35"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a5686361108378ecc645e4240ce3c3d35">generate_unique_filename</a> (old_name, new_name, configured_write_time, timestep)</td></tr>
<tr class="memdesc:a5686361108378ecc645e4240ce3c3d35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a unique filename based upon the base one specified and the number of completed timesteps.  <a href="namespacenetcdf__filetype__writer__mod.html#a5686361108378ecc645e4240ce3c3d35">More...</a><br /></td></tr>
<tr class="separator:a5686361108378ecc645e4240ce3c3d35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a767df50b485665dac93bfdf57897c667"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a767df50b485665dac93bfdf57897c667">write_out_global_attributes</a> (io_configuration, ncid, file_writer_information, timestep, time)</td></tr>
<tr class="memdesc:a767df50b485665dac93bfdf57897c667"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes out global attributes into the checkpoint.  <a href="namespacenetcdf__filetype__writer__mod.html#a767df50b485665dac93bfdf57897c667">More...</a><br /></td></tr>
<tr class="separator:a767df50b485665dac93bfdf57897c667"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac84f134b670c232a7304be0210405f91"><td class="memItemLeft" align="right" valign="top">type(<a class="el" href="structcollections__mod_1_1hashmap__type.html">hashmap_type</a>), volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#ac84f134b670c232a7304be0210405f91">file_states</a></td></tr>
<tr class="separator:ac84f134b670c232a7304be0210405f91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d9b63d2ab8113abe7d1663961a0c86f"><td class="memItemLeft" align="right" valign="top">integer, volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a1d9b63d2ab8113abe7d1663961a0c86f">file_states_rwlock</a></td></tr>
<tr class="separator:a1d9b63d2ab8113abe7d1663961a0c86f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ebc93072613a3f817b29aaca86e3201"><td class="memItemLeft" align="right" valign="top">integer, volatile&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a8ebc93072613a3f817b29aaca86e3201">netcdf_mutex</a></td></tr>
<tr class="separator:a8ebc93072613a3f817b29aaca86e3201"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3250670fff4489a31671478d48983e76"><td class="memItemLeft" align="right" valign="top">logical&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a3250670fff4489a31671478d48983e76">l_nc_dim</a></td></tr>
<tr class="separator:a3250670fff4489a31671478d48983e76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba8115f7b27734ca15c13f39b364c83f"><td class="memItemLeft" align="right" valign="top">logical&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#aba8115f7b27734ca15c13f39b364c83f">l_nd_dim</a></td></tr>
<tr class="separator:aba8115f7b27734ca15c13f39b364c83f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad55950209846482af7f3903d82f99ca0"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#ad55950209846482af7f3903d82f99ca0">nc_dim_id</a></td></tr>
<tr class="separator:ad55950209846482af7f3903d82f99ca0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2b112377e2bb89a0b05075b67241d44"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#aa2b112377e2bb89a0b05075b67241d44">nd_dim_id</a></td></tr>
<tr class="separator:aa2b112377e2bb89a0b05075b67241d44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5593eb67f5a8e5a911f43457c43ab5c0"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a5593eb67f5a8e5a911f43457c43ab5c0">nopt_dim_id</a></td></tr>
<tr class="separator:a5593eb67f5a8e5a911f43457c43ab5c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e6f46caa79d2a86818dfc0e7d352237"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a0e6f46caa79d2a86818dfc0e7d352237">nc_var_id_s</a></td></tr>
<tr class="separator:a0e6f46caa79d2a86818dfc0e7d352237"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a524a6a6ad6378a78dad016e522fa0978"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a524a6a6ad6378a78dad016e522fa0978">nd_var_id_s</a></td></tr>
<tr class="separator:a524a6a6ad6378a78dad016e522fa0978"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2a168027013888ad783106a7922b529"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#ae2a168027013888ad783106a7922b529">nc_var_id_l</a></td></tr>
<tr class="separator:ae2a168027013888ad783106a7922b529"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af22935ab833d9c6294e1aee6727e08ca"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#af22935ab833d9c6294e1aee6727e08ca">nd_var_id_l</a></td></tr>
<tr class="separator:af22935ab833d9c6294e1aee6727e08ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9374f28d4bfc72530979f2f0b701abd0"><td class="memItemLeft" align="right" valign="top">integer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacenetcdf__filetype__writer__mod.html#a9374f28d4bfc72530979f2f0b701abd0">nopt_var_id</a></td></tr>
<tr class="separator:a9374f28d4bfc72530979f2f0b701abd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The NetCDF file type writer which performs actual writing of NetCDF files to the parallel filesystem. These are opened by all IO servers and all IO servers can participate as variables might be located across the different IO processes. </p>
</div><h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a2c67fccb16973e19938a1be7119a0f64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c67fccb16973e19938a1be7119a0f64">&#9670;&nbsp;</a></span>close_netcdf_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public netcdf_filetype_writer_mod::close_netcdf_file </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>io_configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=string_length)&#160;</td>
          <td class="paramname"><em>field_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>timestep</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Call back for the inter IO reduction which actually does the NetCDF file closing which is a collective (synchronous) operation. This also cleans up the file state as it is no longer required. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io_configuration</td><td>The IO server configuration </td></tr>
    <tr><td class="paramname">field_name</td><td>The field name that is being communicated </td></tr>
    <tr><td class="paramname">timestep</td><td>The write timestep </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00193">193</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">intent(inout)</span> :: io_configuration</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span> :: field_name</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">integer</span> :: timestep</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordtype">type</span>(iterator_type) :: iterator</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: generic</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">pointer</span> :: file_state</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    file_state=&gt;get_file_state(field_name, timestep, .true.)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(file_state%mutex))</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(netcdf_mutex))</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_close(file_state%ncid))</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(netcdf_mutex))</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(file_state%mutex))</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_destroy(file_state%mutex))</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">call </span>c_free(file_state%dimension_to_id)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keyword">call </span>c_free(file_state%variable_to_id)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    iterator=c_get_iterator(file_state%timeseries_dimension)</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(iterator))</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      generic=&gt;c_get_generic(c_next_mapentry(iterator))</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">select type</span>(generic)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keywordflow">      type is</span>(netcdf_diagnostics_timeseries_type)</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keyword">deallocate</span>(generic)</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keywordflow">      end select</span>      </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keywordflow">    end do</span>  </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keyword">call </span>c_free(file_state%timeseries_dimension)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_wrlock(file_states_rwlock))</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">call </span>c_remove(file_states, trim(field_name)//<span class="stringliteral">&quot;#&quot;</span>//trim(conv_to_string(timestep)))</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_unlock(file_states_rwlock))    </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacelogging__mod.html#ae0d255e756059bc76b2f4291825e59c9">log_get_logging_level</a>() .ge. <a class="code" href="namespacelogging__mod.html#aca1c925af27b4d533d548bfe69a819f3">log_debug</a> .and. log_is_master()) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">log_master_log</a>(<a class="code" href="namespacelogging__mod.html#aca1c925af27b4d533d548bfe69a819f3">log_debug</a>, <span class="stringliteral">&quot;Done physical close for NetCDF file at timestep &quot;</span>//trim(conv_to_string(timestep)))</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keywordflow">    end if</span>    </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a2c67fccb16973e19938a1be7119a0f64_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a2c67fccb16973e19938a1be7119a0f64_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a2c67fccb16973e19938a1be7119a0f64_cgraph" id="anamespacenetcdf__filetype__writer__mod_a2c67fccb16973e19938a1be7119a0f64_cgraph">
<area shape="rect" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="5,349,163,390"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="441,427,607,469"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="447,206,601,247"/>
<area shape="rect" href="namespaceforthread__mod.html#a34912c5c002de467e6b116d65d917881" title=" " alt="" coords="215,509,377,550"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="443,275,605,317"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="443,347,605,389"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="443,57,605,98"/>
<area shape="rect" href="namespaceforthread__mod.html#ab60b7d18e1d948f6b63c6cb893fad182" title=" " alt="" coords="215,574,377,615"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#acb05fbdc64a670792cd9cec7f238951d" title="Retrieves a file state based upon its timestep or null if none is found." alt="" coords="224,107,368,149"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="211,225,381,266"/>
<area shape="rect" href="namespacelogging__mod.html#ae0d255e756059bc76b2f4291825e59c9" title="Retrieves the current logging level." alt="" coords="225,639,367,681"/>
<area shape="rect" href="namespacelogging__mod.html#aa7d08e4de819bf03922844a8366c28ae" title="Determines whether the process is the master logging process. This might be preferable rather than ca..." alt="" coords="229,705,363,746"/>
<area shape="rect" href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20" title="Will log just from the master process." alt="" coords="429,5,619,32"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="211,290,381,331"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="667,213,809,240"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="857,206,1024,247"/>
<area shape="rect" href="namespaceforthread__mod.html#ace3f16636de24b1fc62de549d67476dc" title=" " alt="" coords="443,122,605,163"/>
</map>
</div>

</div>
</div>
<a id="a1ce0c117e268cee4460b6385bc8629c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ce0c117e268cee4460b6385bc8629c3">&#9670;&nbsp;</a></span>define_coordinate_variable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function netcdf_filetype_writer_mod::define_coordinate_variable </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>coord_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Defines a coordinate variable in the NetCDF file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_state</td><td>The NetCDF file state </td></tr>
    <tr><td class="paramname">coord_name</td><td>The name of the coordinate </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The resulting coordinate variable id </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00923">923</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: coord_name</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordtype">integer</span> :: field_id, dimension_ids(1)</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160; </div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    dimension_ids(1)=c_get_integer(file_state%dimension_to_id, trim(coord_name))</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_def_var(file_state%ncid, trim(coord_name), nf90_double, dimension_ids, field_id))</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    define_coordinate_variable=field_id</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a1ce0c117e268cee4460b6385bc8629c3_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a1ce0c117e268cee4460b6385bc8629c3_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a1ce0c117e268cee4460b6385bc8629c3_cgraph" id="anamespacenetcdf__filetype__writer__mod_a1ce0c117e268cee4460b6385bc8629c3_cgraph">
<area shape="rect" title="Defines a coordinate variable in the NetCDF file." alt="" coords="5,63,167,119"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="217,5,383,47"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="215,71,385,112"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="215,136,385,177"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="644,75,787,102"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="835,68,1001,109"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="437,129,592,171"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="433,64,596,105"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="433,195,596,236"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a1ce0c117e268cee4460b6385bc8629c3_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a1ce0c117e268cee4460b6385bc8629c3_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a1ce0c117e268cee4460b6385bc8629c3_icgraph" id="anamespacenetcdf__filetype__writer__mod_a1ce0c117e268cee4460b6385bc8629c3_icgraph">
<area shape="rect" title="Defines a coordinate variable in the NetCDF file." alt="" coords="3679,172,3840,228"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a9492c076905001a53f8cb3085739d6db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9492c076905001a53f8cb3085739d6db">&#9670;&nbsp;</a></span>define_dimensions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::define_dimensions </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcollections__mod_1_1map__type.html">map_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>dimension_sizing</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Defines spatial dimensions in the diagnostics file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_state</td><td>The NetCDF file state </td></tr>
    <tr><td class="paramname">dimension_sizing</td><td>All dimension name to size key value pairs </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l01139">1139</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="keywordtype">type</span>(map_type), <span class="keywordtype">intent(inout)</span> :: dimension_sizing</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="keywordtype">integer</span> :: ncdf_dimid, dim_length</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="keywordtype">type</span>(iterator_type) :: iterator</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordtype">type</span>(mapentry_type) :: map_entry</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160; </div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    iterator=c_get_iterator(dimension_sizing)</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(iterator))</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      map_entry=c_next_mapentry(iterator)</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      dim_length=c_get_integer(map_entry)</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="keywordflow">if</span> (dim_length .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_def_dim(file_state%ncid, map_entry%key, dim_length, ncdf_dimid))</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="keyword">call </span>c_put_integer(file_state%dimension_to_id, map_entry%key, ncdf_dimid)</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <span class="keywordflow">if</span> (map_entry%key == <span class="stringliteral">&quot;nc&quot;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;          nc_dim_id=ncdf_dimid</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <span class="keywordflow">if</span> (map_entry%key == <span class="stringliteral">&quot;nd&quot;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;          nd_dim_id=ncdf_dimid</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <span class="keywordflow">if</span> (map_entry%key == <span class="stringliteral">&quot;number_options&quot;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;          nopt_dim_id=ncdf_dimid</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_def_dim(file_state%ncid, <span class="stringliteral">&quot;string&quot;</span>, string_length, file_state%string_dim_id))</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_def_dim(file_state%ncid, <span class="stringliteral">&quot;kvp&quot;</span>, 2, file_state%key_value_dim_id))</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a9492c076905001a53f8cb3085739d6db_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a9492c076905001a53f8cb3085739d6db_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a9492c076905001a53f8cb3085739d6db_cgraph" id="anamespacenetcdf__filetype__writer__mod_a9492c076905001a53f8cb3085739d6db_cgraph">
<area shape="rect" title="Defines spatial dimensions in the diagnostics file." alt="" coords="5,71,172,112"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="222,5,389,47"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="220,71,391,112"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="220,136,391,177"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="649,75,792,102"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="840,68,1007,109"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="443,129,597,171"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="439,64,601,105"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="439,195,601,236"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a9492c076905001a53f8cb3085739d6db_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a9492c076905001a53f8cb3085739d6db_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a9492c076905001a53f8cb3085739d6db_icgraph" id="anamespacenetcdf__filetype__writer__mod_a9492c076905001a53f8cb3085739d6db_icgraph">
<area shape="rect" title="Defines spatial dimensions in the diagnostics file." alt="" coords="3679,179,3845,221"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a6c970a34b31a068f500ae6a1235d9906"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c970a34b31a068f500ae6a1235d9906">&#9670;&nbsp;</a></span>define_netcdf_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public netcdf_filetype_writer_mod::define_netcdf_file </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>io_configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__type.html">writer_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>file_writer_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcollections__mod_1_1map__type.html">map_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>time_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>termination_write</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Defines a NetCDF file - which creates it, defines all dimensions and variables. This must be called by all IO server processes as the NetCDF operations here are collective. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io_configuration</td><td>The IO server configuration </td></tr>
    <tr><td class="paramname">file_writer_information</td><td>The writer entry that is being written </td></tr>
    <tr><td class="paramname">timestep</td><td>The write timestep </td></tr>
    <tr><td class="paramname">time</td><td>The write time </td></tr>
  </table>
  </dd>
</dl>
<p>Isolate these writes, as they may trip over one another</p>
<p>Write conditional diagnostics descriptors to file if file contains corresponding dimension.</p>
<p>Write options_database and height coordinates to all files.</p>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00069">69</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">intent(inout)</span> :: io_configuration</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordtype">type</span>(writer_type), <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">target</span> :: file_writer_information</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">type</span>(map_type), <span class="keywordtype">intent(inout)</span> :: time_points</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: termination_write</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span> :: unique_filename</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">pointer</span> :: ncdf_writer_state</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: generic</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordtype">integer</span> :: zn_var_id</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordtype">integer</span> :: z_var_id</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    ncdf_writer_state=&gt;get_file_state(file_writer_information%filename, timestep, .true.)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(ncdf_writer_state)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_rwlock_wrlock(file_states_rwlock))</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      ncdf_writer_state=&gt;get_file_state(file_writer_information%filename, timestep, .false.)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(ncdf_writer_state)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keyword">allocate</span>(ncdf_writer_state)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        ncdf_writer_state%corresponding_writer_entry=&gt;file_writer_information</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        ncdf_writer_state%termination_write=termination_write</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_init(ncdf_writer_state%mutex, -1))</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(ncdf_writer_state%mutex))</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        generic=&gt;ncdf_writer_state</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keyword">call </span>c_put_generic(file_states, trim(file_writer_information%filename)//<span class="stringliteral">&quot;#&quot;</span>//trim(conv_to_string(timestep)), &amp;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;             generic, .false.)</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_rwlock_unlock(file_states_rwlock))</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">if</span> (file_writer_information%write_on_model_time) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;          <span class="keyword">call </span>generate_unique_filename(file_writer_information%filename, unique_filename, &amp;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;               file_writer_information%defined_write_time)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;          <span class="keyword">call </span>generate_unique_filename(file_writer_information%filename, unique_filename, timestep=timestep)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(netcdf_mutex))</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_create(unique_filename, ior(nf90_netcdf4, nf90_mpiio), ncdf_writer_state%ncid, &amp;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;             comm = io_configuration%io_communicator, info = mpi_info_null))</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keyword">call </span>write_out_global_attributes(io_configuration, ncdf_writer_state%ncid, file_writer_information, timestep, time)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keyword">call </span>define_dimensions(ncdf_writer_state, io_configuration%dimension_sizing)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keyword">call </span>define_time_series_dimensions(ncdf_writer_state, file_writer_information, time, time_points, termination_write)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keyword">call </span>define_variables(io_configuration, ncdf_writer_state, file_writer_information)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        zn_var_id = define_coordinate_variable(ncdf_writer_state,<span class="stringliteral">&quot;zn&quot;</span>)  </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        z_var_id  = define_coordinate_variable(ncdf_writer_state,<span class="stringliteral">&quot;z&quot;</span>)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        nopt_var_id = define_options_database_variable(ncdf_writer_state)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_enddef(ncdf_writer_state%ncid))</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span> (io_configuration%my_io_rank == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;          <span class="keywordflow">if</span> (l_nc_dim) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <span class="keyword">call </span>write_condition_variable(ncdf_writer_state, nc_var_id_s, cond_request)</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="keyword">call </span>write_condition_variable(ncdf_writer_state, nc_var_id_l, cond_long)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;          <span class="keywordflow">if</span> (l_nd_dim) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <span class="keyword">call </span>write_condition_variable(ncdf_writer_state, nd_var_id_s, diag_request)</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keyword">call </span>write_condition_variable(ncdf_writer_state, nd_var_id_l, diag_long)</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;          <span class="keyword">call </span>write_out_options(io_configuration, ncdf_writer_state)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;          <span class="keyword">call </span>write_coordinate_variable(ncdf_writer_state, zn_var_id, io_configuration%zn_field)</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;          <span class="keyword">call </span>write_coordinate_variable(ncdf_writer_state, z_var_id,  io_configuration%z_field)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="keywordflow">        end if</span> <span class="comment">! end write isolation</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(ncdf_writer_state%mutex))        </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(netcdf_mutex))</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_rwlock_unlock(file_states_rwlock))</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a6c970a34b31a068f500ae6a1235d9906_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a6c970a34b31a068f500ae6a1235d9906_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a6c970a34b31a068f500ae6a1235d9906_cgraph" id="anamespacenetcdf__filetype__writer__mod_a6c970a34b31a068f500ae6a1235d9906_cgraph">
<area shape="rect" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="5,741,165,782"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="478,421,645,462"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="727,515,882,557"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a1ce0c117e268cee4460b6385bc8629c3" title="Defines a coordinate variable in the NetCDF file." alt="" coords="234,573,395,629"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="476,515,647,557"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="723,743,886,785"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="476,581,647,622"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="723,893,886,934"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a9492c076905001a53f8cb3085739d6db" title="Defines spatial dimensions in the diagnostics file." alt="" coords="231,705,398,746"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#adb0cc64b982ca21514e74a881b1ee30f" title="Defines the options_database variable in the NetCDF file." alt="" coords="213,769,416,825"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a66915aa056fc8a300dbedbc0c7b0c3ca" title="Defines dimensions for all required dimensions. This is usually the number required plus one,..." alt="" coords="231,253,399,309"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a58faae9f572a8860a586d47251df2ab4" title="Defines all variables in the file writer state." alt="" coords="238,137,391,178"/>
<area shape="rect" href="namespaceforthread__mod.html#ab29785b28c1d6bcf13e844b8d1230846" title=" " alt="" coords="233,1193,396,1234"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="480,1081,643,1122"/>
<area shape="rect" href="namespaceforthread__mod.html#ab60b7d18e1d948f6b63c6cb893fad182" title=" " alt="" coords="233,1258,396,1299"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a5686361108378ecc645e4240ce3c3d35" title="Generates a unique filename based upon the base one specified and the number of completed timesteps." alt="" coords="237,1323,392,1379"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#acb05fbdc64a670792cd9cec7f238951d" title="Retrieves a file state based upon its timestep or null if none is found." alt="" coords="243,1018,387,1059"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a0a437b7c2ee1752a8c3ad3ce4797cced" title="Writes the conditional diagnostic variable names into the NetCDF file." alt="" coords="241,333,388,389"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#ae456ae2267a1cf3a1763d1cbd59039ab" title="Writes a coordinate variable into the NetCDF file." alt="" coords="237,413,392,469"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a767df50b485665dac93bfdf57897c667" title="Writes out global attributes into the checkpoint." alt="" coords="237,493,392,549"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a2d8000c479d36f8c5c0c91aa482c9765" title="Writes out the options_database defining this model run." alt="" coords="233,901,396,942"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="951,260,1093,287"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1141,253,1308,294"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a63ada26600230ff5a6551e3dd04736ce" title="Retrieves the number of timeseries entries for a specific frequency and previous write time...." alt="" coords="464,253,659,309"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a41e86c7b84afdea863ca626a2599bf1d" title="Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against..." alt="" coords="489,137,633,178"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#af49b3618c2fdcf04a2eef4dc5e0a7925" title="For a specific field will retrieve the NetCDF id of the time series dimension most appropriate for th..." alt="" coords="473,5,650,61"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6da2f8c99dc13a7d24ec60861a2a48aa" title="Given the file state and the output frequency of a field will retrive the appropriate time series dim..." alt="" coords="707,71,903,127"/>
<area shape="rect" href="namespaceforthread__mod.html#ace3f16636de24b1fc62de549d67476dc" title=" " alt="" coords="480,1015,643,1057"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#adc0a6752b379a4967ae7260e4487d049" title="Returns the ith key in the options database." alt="" coords="487,717,636,758"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#a7eeb8b8d74d261f80bb0a64db10b22e2" title="Returns the number of entries in the options database." alt="" coords="487,782,636,823"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#a2dee7871d510ec8b7e82ff936a59b443" title="Returns the value at index in the database." alt="" coords="487,847,636,889"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a6c970a34b31a068f500ae6a1235d9906_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a6c970a34b31a068f500ae6a1235d9906_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a6c970a34b31a068f500ae6a1235d9906_icgraph" id="anamespacenetcdf__filetype__writer__mod_a6c970a34b31a068f500ae6a1235d9906_icgraph">
<area shape="rect" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="adb0cc64b982ca21514e74a881b1ee30f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb0cc64b982ca21514e74a881b1ee30f">&#9670;&nbsp;</a></span>define_options_database_variable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function netcdf_filetype_writer_mod::define_options_database_variable </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Defines the options_database variable in the NetCDF file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_state</td><td>The NetCDF file state </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The resulting options_database variable id </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00939">939</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="keywordtype">integer</span> :: field_id, dimension_ids(3)</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160; </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    dimension_ids(1)=file_state%string_dim_id</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    dimension_ids(2)=file_state%key_value_dim_id</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    dimension_ids(3)=nopt_dim_id</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_def_var(file_state%ncid, <span class="stringliteral">&quot;options_database&quot;</span>, nf90_char, dimension_ids, field_id))</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    define_options_database_variable=field_id</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_adb0cc64b982ca21514e74a881b1ee30f_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_adb0cc64b982ca21514e74a881b1ee30f_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_adb0cc64b982ca21514e74a881b1ee30f_cgraph" id="anamespacenetcdf__filetype__writer__mod_adb0cc64b982ca21514e74a881b1ee30f_cgraph">
<area shape="rect" title="Defines the options_database variable in the NetCDF file." alt="" coords="5,63,208,119"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="258,5,425,47"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="256,71,427,112"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="256,136,427,177"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="685,75,828,102"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="876,68,1043,109"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="479,129,633,171"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="475,64,637,105"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="475,195,637,236"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_adb0cc64b982ca21514e74a881b1ee30f_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_adb0cc64b982ca21514e74a881b1ee30f_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_adb0cc64b982ca21514e74a881b1ee30f_icgraph" id="anamespacenetcdf__filetype__writer__mod_adb0cc64b982ca21514e74a881b1ee30f_icgraph">
<area shape="rect" title="Defines the options_database variable in the NetCDF file." alt="" coords="3679,172,3881,228"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a66915aa056fc8a300dbedbc0c7b0c3ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66915aa056fc8a300dbedbc0c7b0c3ca">&#9670;&nbsp;</a></span>define_time_series_dimensions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::define_time_series_dimensions </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__type.html">writer_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_writer_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcollections__mod_1_1map__type.html">map_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>time_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>termination_write</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Defines dimensions for all required dimensions. This is usually the number required plus one, but in some cases is entirely required depending how the output frequency and diagnostics write times match up. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_state</td><td>The state of the NetCDF file </td></tr>
    <tr><td class="paramname">file_writer_information</td><td>Writer information </td></tr>
    <tr><td class="paramname">time</td><td>The model write time </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00841">841</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    <span class="keywordtype">type</span>(writer_type), <span class="keywordtype">intent(inout)</span> :: file_writer_information</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordtype">type</span>(map_type), <span class="keywordtype">intent(inout)</span> :: time_points</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: termination_write</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span> :: dim_key</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_timeseries_type), <span class="keywordtype">pointer</span> :: timeseries_diag</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: generic</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">do</span> i=1, <span class="keyword">size</span>(file_writer_information%contents)</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">if</span> (file_writer_information%contents(i)%output_frequency .lt. 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        dim_key=<span class="stringliteral">&quot;time_series_&quot;</span>//trim(conv_to_string(file_writer_information%contents(i)%timestep_frequency))</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        dim_key=<span class="stringliteral">&quot;time_series_&quot;</span>//trim(conv_to_string(file_writer_information%contents(i)%timestep_frequency))//<span class="stringliteral">&quot;_&quot;</span>//&amp;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;             trim(conv_to_string(file_writer_information%contents(i)%output_frequency))</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="keywordflow">if</span> (.not. c_contains(file_state%timeseries_dimension, dim_key)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keyword">allocate</span>(timeseries_diag)</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        timeseries_diag%variable_written=.false.</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        timeseries_diag%num_entries=get_number_timeseries_entries(time_points, &amp;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;             file_writer_information%contents(i)%previous_tracked_write_point, &amp;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;             file_writer_information%contents(i)%output_frequency, file_writer_information%contents(i)%timestep_frequency, &amp;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;             termination_write, timeseries_diag%last_write_point)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_def_dim(file_state%ncid, dim_key, timeseries_diag%num_entries, &amp;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;             timeseries_diag%netcdf_dim_id))</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        generic=&gt;timeseries_diag</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="keyword">call </span>c_put_generic(file_state%timeseries_dimension, dim_key, generic, .false.)</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      file_writer_information%contents(i)%previous_tracked_write_point=timeseries_diag%last_write_point</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a66915aa056fc8a300dbedbc0c7b0c3ca_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a66915aa056fc8a300dbedbc0c7b0c3ca_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a66915aa056fc8a300dbedbc0c7b0c3ca_cgraph" id="anamespacenetcdf__filetype__writer__mod_a66915aa056fc8a300dbedbc0c7b0c3ca_cgraph">
<area shape="rect" title="Defines dimensions for all required dimensions. This is usually the number required plus one,..." alt="" coords="5,95,173,151"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="464,5,631,47"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a63ada26600230ff5a6551e3dd04736ce" title="Retrieves the number of timeseries entries for a specific frequency and previous write time...." alt="" coords="221,59,416,115"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="233,139,404,180"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="233,204,404,245"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="679,79,821,106"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="869,72,1036,113"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="470,139,625,180"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="466,73,629,115"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="466,204,629,245"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a66915aa056fc8a300dbedbc0c7b0c3ca_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a66915aa056fc8a300dbedbc0c7b0c3ca_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a66915aa056fc8a300dbedbc0c7b0c3ca_icgraph" id="anamespacenetcdf__filetype__writer__mod_a66915aa056fc8a300dbedbc0c7b0c3ca_icgraph">
<area shape="rect" title="Defines dimensions for all required dimensions. This is usually the number required plus one,..." alt="" coords="3679,172,3847,228"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a58faae9f572a8860a586d47251df2ab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58faae9f572a8860a586d47251df2ab4">&#9670;&nbsp;</a></span>define_variables()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::define_variables </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>io_configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__type.html">writer_type</a>), intent(in)&#160;</td>
          <td class="paramname"><em>file_writer_information</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Defines all variables in the file writer state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_state</td><td>The NetCDF file state </td></tr>
    <tr><td class="paramname">file_writer_information</td><td>The file writer information </td></tr>
  </table>
  </dd>
</dl>
<p>Only enable writing of conditional diagnostics descriptor fields to this file if there is</p>
<p>Provide conditional diagnostic descriptions if data being used in this file.</p>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00956">956</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">intent(inout)</span> :: io_configuration</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordtype">type</span>(writer_type), <span class="keywordtype">intent(in)</span> :: file_writer_information</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordtype">integer</span> :: i, j, data_type, field_id, map_dim_id</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: dimension_ids</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span> :: variable_key</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_timeseries_type), <span class="keywordtype">pointer</span> :: timeseries_diag</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: generic</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="keywordtype">type</span>(iterator_type) :: iterator</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="keywordtype">type</span>(mapentry_type) :: map_entry</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    l_nc_dim = .false.</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    l_nd_dim = .false.</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    iterator=c_get_iterator(file_state%timeseries_dimension)</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(iterator))</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      map_entry=c_next_mapentry(iterator)</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      generic=&gt;c_get_generic(map_entry)</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="keywordflow">select type</span>(generic)</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="keywordflow">        type is</span>(netcdf_diagnostics_timeseries_type)</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;          timeseries_diag=&gt;generic</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="keywordflow">      end select</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <span class="keyword">call </span>check_netcdf_status(nf90_def_var(file_state%ncid, map_entry%key, &amp;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;             nf90_double, timeseries_diag%netcdf_dim_id, timeseries_diag%netcdf_var_id))</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160; </div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">do</span> i=1, <span class="keyword">size</span>(file_writer_information%contents)</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      <span class="keywordflow">if</span> (.not. file_writer_information%contents(i)%enabled) cycle</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <span class="keywordflow">if</span> (file_writer_information%contents(i)%data_type == double_data_type) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        data_type=nf90_double</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (file_writer_information%contents(i)%data_type == integer_data_type) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        data_type=nf90_int</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (file_writer_information%contents(i)%data_type == string_data_type) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        data_type=nf90_char</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      variable_key=get_field_key(file_writer_information%contents(i))      </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordflow">if</span> (file_writer_information%contents(i)%field_type == array_field_type) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="keyword">allocate</span>(dimension_ids(file_writer_information%contents(i)%dimensions+1))</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordflow">do</span> j=1, file_writer_information%contents(i)%dimensions</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;          <span class="keywordflow">if</span> (c_contains(file_state%dimension_to_id, file_writer_information%contents(i)%dim_size_defns(j))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            dimension_ids(j)=c_get_integer(file_state%dimension_to_id, file_writer_information%contents(i)%dim_size_defns(j))</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Can not find information for dimension named &#39;&quot;</span>//&amp;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                 trim(file_writer_information%contents(i)%dim_size_defns(j))//<span class="stringliteral">&quot;&#39;&quot;</span>)</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        dimension_ids(j)=retrieve_time_series_dimension_id_for_field(file_state, file_writer_information, i)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <span class="comment">!  a data field using its dimensions.</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">if</span> (any(dimension_ids .eq. nc_dim_id) .or. any(dimension_ids .eq. nd_dim_id)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;          l_nc_dim = .true.</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;          l_nd_dim = .true.</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="keywordflow">        end if</span> </div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_def_var(file_state%ncid, variable_key, &amp;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;             data_type, dimension_ids, field_id))</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160; </div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        <span class="keywordflow">if</span> (file_writer_information%contents(i)%collective_write .and. &amp;</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;             file_writer_information%contents(i)%collective_contiguous_optimisation .and. &amp;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;             io_configuration%number_of_io_servers .gt. 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;          <span class="keyword">call </span>check_netcdf_status(nf90_def_var_fill(file_state%ncid, field_id, 1, 1))</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;          <span class="keyword">call </span>check_netcdf_status(nf90_var_par_access(file_state%ncid, field_id, nf90_collective))</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="keywordflow">        end if</span>        </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keyword">deallocate</span>(dimension_ids)</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (file_writer_information%contents(i)%field_type == scalar_field_type) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_def_var(file_state%ncid, variable_key, &amp;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;             data_type, retrieve_time_series_dimension_id_for_field(file_state, file_writer_information, i), field_id))</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (file_writer_information%contents(i)%field_type == map_field_type) <span class="keywordflow">then</span>        </div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        <span class="keyword">allocate</span>(dimension_ids(4))</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        dimension_ids(1)=file_state%string_dim_id</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        dimension_ids(2)=file_state%key_value_dim_id</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        dimension_ids(3)=c_get_integer(file_state%dimension_to_id, file_writer_information%contents(i)%dim_size_defns(1))</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        dimension_ids(4)=retrieve_time_series_dimension_id_for_field(file_state, file_writer_information, i)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_def_var(file_state%ncid, variable_key, data_type, dimension_ids, field_id))</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="keyword">deallocate</span>(dimension_ids)</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      <span class="keyword">call </span>c_put_integer(file_state%variable_to_id, variable_key, field_id)</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      <span class="keywordflow">if</span> (len_trim(file_writer_information%contents(i)%units) .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_put_att(file_state%ncid, field_id, <span class="stringliteral">&quot;units&quot;</span>, file_writer_information%contents(i)%units))</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <span class="keywordflow">if</span> (l_nc_dim) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="keyword">allocate</span>(dimension_ids(2))</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      dimension_ids(1)=file_state%string_dim_id</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      dimension_ids(2)=nc_dim_id</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <span class="keyword">call </span>check_netcdf_status(nf90_def_var(file_state%ncid, <span class="stringliteral">&quot;conditions_fields_short&quot;</span>, &amp;</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;             nf90_char, dimension_ids, nc_var_id_s))</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="keyword">call </span>check_netcdf_status(nf90_def_var(file_state%ncid, <span class="stringliteral">&quot;conditions_fields_long&quot;</span>, &amp;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;             nf90_char, dimension_ids, nc_var_id_l))</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      <span class="keyword">deallocate</span>(dimension_ids)</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordflow">if</span> (l_nd_dim) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="keyword">allocate</span>(dimension_ids(2))</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      dimension_ids(1)=file_state%string_dim_id</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      dimension_ids(2)=nd_dim_id</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="keyword">call </span>check_netcdf_status(nf90_def_var(file_state%ncid, <span class="stringliteral">&quot;diagnostics_fields_short&quot;</span>, &amp;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;             nf90_char, dimension_ids, nd_var_id_s))</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      <span class="keyword">call </span>check_netcdf_status(nf90_def_var(file_state%ncid, <span class="stringliteral">&quot;diagnostics_fields_long&quot;</span>, &amp;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;             nf90_char, dimension_ids, nd_var_id_l))</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <span class="keyword">deallocate</span>(dimension_ids)</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160; </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a58faae9f572a8860a586d47251df2ab4_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a58faae9f572a8860a586d47251df2ab4_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a58faae9f572a8860a586d47251df2ab4_cgraph" id="anamespacenetcdf__filetype__writer__mod_a58faae9f572a8860a586d47251df2ab4_cgraph">
<area shape="rect" title="Defines all variables in the file writer state." alt="" coords="5,180,159,221"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="447,408,613,449"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="676,255,819,282"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a41e86c7b84afdea863ca626a2599bf1d" title="Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against..." alt="" coords="223,147,367,188"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="210,81,381,123"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#af49b3618c2fdcf04a2eef4dc5e0a7925" title="For a specific field will retrieve the NetCDF id of the time series dimension most appropriate for th..." alt="" coords="207,277,384,333"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="210,212,381,253"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="867,248,1033,289"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="453,147,607,188"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="449,81,611,123"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6da2f8c99dc13a7d24ec60861a2a48aa" title="Given the file state and the output frequency of a field will retrive the appropriate time series dim..." alt="" coords="432,277,628,333"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="449,212,611,253"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a58faae9f572a8860a586d47251df2ab4_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a58faae9f572a8860a586d47251df2ab4_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a58faae9f572a8860a586d47251df2ab4_icgraph" id="anamespacenetcdf__filetype__writer__mod_a58faae9f572a8860a586d47251df2ab4_icgraph">
<area shape="rect" title="Defines all variables in the file writer state." alt="" coords="3679,179,3832,221"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a4267425ddfb057cab9dc7c4d08087669"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4267425ddfb057cab9dc7c4d08087669">&#9670;&nbsp;</a></span>finalise_netcdf_filetype()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public netcdf_filetype_writer_mod::finalise_netcdf_filetype</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finalises the NetCDF writing functionality. </p>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00058">58</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_destroy(file_states_rwlock))</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_destroy(netcdf_mutex))</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a4267425ddfb057cab9dc7c4d08087669_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a4267425ddfb057cab9dc7c4d08087669_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a4267425ddfb057cab9dc7c4d08087669_cgraph" id="anamespacenetcdf__filetype__writer__mod_a4267425ddfb057cab9dc7c4d08087669_cgraph">
<area shape="rect" title="Finalises the NetCDF writing functionality." alt="" coords="5,63,149,119"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="201,5,356,47"/>
<area shape="rect" href="namespaceforthread__mod.html#a34912c5c002de467e6b116d65d917881" title=" " alt="" coords="197,71,360,112"/>
<area shape="rect" href="namespaceforthread__mod.html#a1ba0d6ac9839191688aeea507ae27ec8" title=" " alt="" coords="197,136,360,177"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="408,13,551,39"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="599,5,765,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a4267425ddfb057cab9dc7c4d08087669_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a4267425ddfb057cab9dc7c4d08087669_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a4267425ddfb057cab9dc7c4d08087669_icgraph" id="anamespacenetcdf__filetype__writer__mod_a4267425ddfb057cab9dc7c4d08087669_icgraph">
<area shape="rect" title="Finalises the NetCDF writing functionality." alt="" coords="599,5,743,61"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a350033966b51a20a8a69d092a20ba774" title="Finalises the write federator and the manipulations." alt="" coords="385,13,551,54"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,20,337,47"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,20,99,47"/>
</map>
</div>

</div>
</div>
<a id="a5686361108378ecc645e4240ce3c3d35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5686361108378ecc645e4240ce3c3d35">&#9670;&nbsp;</a></span>generate_unique_filename()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::generate_unique_filename </td>
          <td>(</td>
          <td class="paramtype">character(len=string_length), intent(in)&#160;</td>
          <td class="paramname"><em>old_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=string_length), intent(out)&#160;</td>
          <td class="paramname"><em>new_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>configured_write_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional&#160;</td>
          <td class="paramname"><em>timestep</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generates a unique filename based upon the base one specified and the number of completed timesteps. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">old_name</td><td>The existing name that is used as a base </td></tr>
    <tr><td class="paramname">timestep</td><td>The current model timestep </td></tr>
    <tr><td class="paramname">new_name</td><td>The new name that is produced by this subroutine </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l01222">1222</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span>, <span class="keywordtype">intent(in)</span> :: old_name</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: configured_write_time</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>, <span class="keywordtype">optional</span> :: timestep</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span>, <span class="keywordtype">intent(out)</span> :: new_name</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160; </div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="keywordtype">integer</span> :: dot_posn</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    dot_posn=index(old_name, <span class="stringliteral">&quot;.&quot;</span>)</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="keywordflow">if</span> (dot_posn .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      new_name = old_name(1:dot_posn-1)</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      new_name=old_name</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(configured_write_time)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      new_name=trim(new_name)//<span class="stringliteral">&quot;_&quot;</span>//trim(conv_to_string(configured_write_time))</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">present</span>(timestep)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      new_name=trim(new_name)//<span class="stringliteral">&quot;_&quot;</span>//trim(conv_to_string(timestep))</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">if</span> (dot_posn .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;      new_name=trim(new_name)//old_name(dot_posn:len(old_name))</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="keywordflow">    end if</span>    </div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a5686361108378ecc645e4240ce3c3d35_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a5686361108378ecc645e4240ce3c3d35_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a5686361108378ecc645e4240ce3c3d35_icgraph" id="anamespacenetcdf__filetype__writer__mod_a5686361108378ecc645e4240ce3c3d35_icgraph">
<area shape="rect" title="Generates a unique filename based upon the base one specified and the number of completed timesteps." alt="" coords="3679,172,3833,228"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="aacc77c78537724e3eac2bfc2537d9a30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacc77c78537724e3eac2bfc2537d9a30">&#9670;&nbsp;</a></span>get_dimension_identifier()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function netcdf_filetype_writer_mod::get_dimension_identifier </td>
          <td>(</td>
          <td class="paramtype">character(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>dim_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(out), optional&#160;</td>
          <td class="paramname"><em>is_auto_dimension</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Translates a dimension name to its numeric corresponding identifier. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dim_name</td><td>The name of the dimension to look up </td></tr>
    <tr><td class="paramname">is_auto_dimension</td><td>Optional parameter determining whether dimension is auto or not </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Corresponding identifier </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00263">263</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: dim_name</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">optional</span> :: is_auto_dimension</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordtype">integer</span> :: dash_idx</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordtype">logical</span> :: is_modified_size</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    dash_idx=index(dim_name, <span class="stringliteral">&quot;_&quot;</span>)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    dash_idx=dash_idx-1</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    is_modified_size=dash_idx .ne. -1</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (.not. is_modified_size) dash_idx=len_trim(dim_name)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160; </div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span> (dim_name(:dash_idx) .eq. <span class="stringliteral">&quot;z&quot;</span> .or. dim_name(:dash_idx) .eq. <span class="stringliteral">&quot;zn&quot;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      get_dimension_identifier=z_index</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dim_name(:dash_idx) .eq. <span class="stringliteral">&quot;y&quot;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      get_dimension_identifier=y_index</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dim_name(:dash_idx) .eq. <span class="stringliteral">&quot;x&quot;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      get_dimension_identifier=x_index</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      get_dimension_identifier=-1</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(is_auto_dimension)) is_auto_dimension=is_modified_size</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_aacc77c78537724e3eac2bfc2537d9a30_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_aacc77c78537724e3eac2bfc2537d9a30_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_aacc77c78537724e3eac2bfc2537d9a30_icgraph" id="anamespacenetcdf__filetype__writer__mod_aacc77c78537724e3eac2bfc2537d9a30_icgraph">
<area shape="rect" title="Translates a dimension name to its numeric corresponding identifier." alt="" coords="4068,98,4267,139"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a10f13979aff7110f8df58356fb4e398d" title="Writes collective variables, where we are working with the values from multiple MONCs and storing the..." alt="" coords="3855,91,4020,147"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3663,98,3807,139"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,91,3615,147"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,85,2592,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,146,3423,187"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,75,1897,131"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,112,2371,168"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,112,2156,168"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,114,2801,155"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="aff299f33f5701bfddd073cd0a06be5f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff299f33f5701bfddd073cd0a06be5f7">&#9670;&nbsp;</a></span>get_dimension_original_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function netcdf_filetype_writer_mod::get_dimension_original_size </td>
          <td>(</td>
          <td class="paramtype">character(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>dim_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcollections__mod_1_1map__type.html">map_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>dimension_store</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the original size of a specific dimension (which is auto) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dim_name</td><td>The auto dimension (full) name </td></tr>
    <tr><td class="paramname">dimension_store</td><td>The map of dimensions we are looking up </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The original size of this auto dimension </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00292">292</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: dim_name</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keywordtype">type</span>(map_type), <span class="keywordtype">intent(inout)</span> :: dimension_store</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordtype">integer</span> :: dash_idx</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    dash_idx=index(dim_name, <span class="stringliteral">&quot;_&quot;</span>)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    dash_idx=dash_idx-1</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">if</span> (dash_idx .eq. -1) dash_idx=len_trim(dim_name)</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    get_dimension_original_size=c_get_integer(dimension_store, dim_name(:dash_idx))</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_aff299f33f5701bfddd073cd0a06be5f7_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_aff299f33f5701bfddd073cd0a06be5f7_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_aff299f33f5701bfddd073cd0a06be5f7_icgraph" id="anamespacenetcdf__filetype__writer__mod_aff299f33f5701bfddd073cd0a06be5f7_icgraph">
<area shape="rect" title="Retrieves the original size of a specific dimension (which is auto)" alt="" coords="4068,98,4291,139"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a10f13979aff7110f8df58356fb4e398d" title="Writes collective variables, where we are working with the values from multiple MONCs and storing the..." alt="" coords="3855,91,4020,147"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3663,98,3807,139"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,91,3615,147"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,85,2592,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,146,3423,187"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,75,1897,131"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,112,2371,168"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,112,2156,168"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,114,2801,155"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a41e86c7b84afdea863ca626a2599bf1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41e86c7b84afdea863ca626a2599bf1d">&#9670;&nbsp;</a></span>get_field_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">character(len=string_length) function netcdf_filetype_writer_mod::get_field_key </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__field__type.html">writer_field_type</a>), intent(in)&#160;</td>
          <td class="paramname"><em>field_to_write_information</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against the id in the NetCDF file state internally. This is either the field name itself or the manipulation type appended if there is duplication. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">field_to_write_information</td><td>The field to get the key from </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The field name key </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l01204">1204</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="keywordtype">type</span>(writer_field_type), <span class="keywordtype">intent(in)</span> :: field_to_write_information    </div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    </div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    get_field_key=field_to_write_information%field_name</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="keywordflow">if</span> (field_to_write_information%duplicate_field_name) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <span class="keywordflow">if</span> (field_to_write_information%time_manipulation_type == instantaneous_type) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        get_field_key=trim(get_field_key)//<span class="stringliteral">&quot;_instantaneous&quot;</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (field_to_write_information%time_manipulation_type == time_averaged_type) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        get_field_key=trim(get_field_key)//<span class="stringliteral">&quot;_timeaveraged&quot;</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a41e86c7b84afdea863ca626a2599bf1d_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a41e86c7b84afdea863ca626a2599bf1d_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a41e86c7b84afdea863ca626a2599bf1d_icgraph" id="anamespacenetcdf__filetype__writer__mod_a41e86c7b84afdea863ca626a2599bf1d_icgraph">
<area shape="rect" title="Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against..." alt="" coords="4295,183,4439,224"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a58faae9f572a8860a586d47251df2ab4" title="Defines all variables in the file writer state." alt="" coords="4089,71,4242,112"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a10f13979aff7110f8df58356fb4e398d" title="Writes collective variables, where we are working with the values from multiple MONCs and storing the..." alt="" coords="3871,125,4036,181"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#abc1e910adcd0ef7c86299b5286fc365f" title="Writes contiguous collective variable blocks into the NetCDF files. These are blocks of data spanning..." alt="" coords="3874,205,4033,276"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a527dfbc289976e0eefcc432bb077040e" title=" " alt="" coords="4093,241,4238,283"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a646b3fed89978ea8212eece9494f7c54" title=" " alt="" coords="4084,306,4247,362"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3663,69,3823,111"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,77,3423,119"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,70,3231,126"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,5,3228,47"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,70,3032,126"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,139,2801,180"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,165,2592,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,147,1897,203"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,173,2371,229"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,171,1699,212"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,143,1456,199"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,63,1240,119"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,223,1257,279"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,143,1247,199"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,223,1016,279"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,79,988,120"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,71,761,127"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,79,536,120"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,86,337,113"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,86,99,113"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,173,2156,229"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,5,2807,47"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3671,216,3815,257"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,190,3615,246"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a605f56b2d81bbaf34377388f9d3f6ec1" title="Writes independent variables to the diagnostics file. This writes the entire variable and works by wr..." alt="" coords="3871,301,4036,357"/>
</map>
</div>

</div>
</div>
<a id="acb05fbdc64a670792cd9cec7f238951d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb05fbdc64a670792cd9cec7f238951d">&#9670;&nbsp;</a></span>get_file_state()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>) function, pointer netcdf_filetype_writer_mod::get_file_state </td>
          <td>(</td>
          <td class="paramtype">character(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>dolock</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves a file state based upon its timestep or null if none is found. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>The filename to look up </td></tr>
    <tr><td class="paramname">timestep</td><td>The timestep to look up </td></tr>
    <tr><td class="paramname">dolock</td><td>Whether to issue a read lock or not </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The corresponding file state entry or null if none is found <br  />
 </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l01177">1177</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: filename</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: dolock</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">pointer</span> :: get_file_state</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160; </div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: generic</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160; </div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <span class="keywordflow">if</span> (dolock) <span class="keyword">call </span>check_thread_status(forthread_rwlock_rdlock(file_states_rwlock))</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    generic=&gt;c_get_generic(file_states, trim(filename)//<span class="stringliteral">&quot;#&quot;</span>//trim(conv_to_string(timestep)))</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <span class="keywordflow">if</span> (dolock) <span class="keyword">call </span>check_thread_status(forthread_rwlock_unlock(file_states_rwlock))</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160; </div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(generic)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <span class="keywordflow">select type</span>(generic)</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="keywordflow">      type is</span> (netcdf_diagnostics_type)      </div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        get_file_state=&gt;generic</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="keywordflow">      end select</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      get_file_state=&gt;null()</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_acb05fbdc64a670792cd9cec7f238951d_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_acb05fbdc64a670792cd9cec7f238951d_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_acb05fbdc64a670792cd9cec7f238951d_cgraph" id="anamespacenetcdf__filetype__writer__mod_acb05fbdc64a670792cd9cec7f238951d_cgraph">
<area shape="rect" title="Retrieves a file state based upon its timestep or null if none is found." alt="" coords="5,71,149,112"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="201,5,356,47"/>
<area shape="rect" href="namespaceforthread__mod.html#ace3f16636de24b1fc62de549d67476dc" title=" " alt="" coords="197,71,360,112"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="197,136,360,177"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="408,13,551,39"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="599,5,765,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_acb05fbdc64a670792cd9cec7f238951d_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_acb05fbdc64a670792cd9cec7f238951d_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_acb05fbdc64a670792cd9cec7f238951d_icgraph" id="anamespacenetcdf__filetype__writer__mod_acb05fbdc64a670792cd9cec7f238951d_icgraph">
<area shape="rect" title="Retrieves a file state based upon its timestep or null if none is found." alt="" coords="3912,165,4056,207"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a2c67fccb16973e19938a1be7119a0f64" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="3693,48,3850,89"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,100,3631,141"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a9fdd5ef501b6dfc64d62898d1ef25b1b" title="Looks up and retrieves the writer entry that corresponds to this NetCDF file state." alt="" coords="3695,230,3847,286"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#ab90e4b2c185d22faacd6f23c39bd9449" title="Stores the IO server state in the NetCDF file." alt="" coords="3679,309,3864,351"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3699,165,3843,207"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,100,3423,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,70,3231,126"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,5,3228,47"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,70,3032,126"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,135,2801,176"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,165,2592,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,147,1897,203"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,173,2371,229"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,171,1699,212"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,143,1456,199"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,63,1240,119"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,223,1257,279"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,143,1247,199"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,223,1016,279"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,79,988,120"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,71,761,127"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,79,536,120"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,86,337,113"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,86,99,113"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,173,2156,229"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,5,2807,47"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3479,165,3623,221"/>
</map>
</div>

</div>
</div>
<a id="aaff250f828a91818f15f82b3838701cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaff250f828a91818f15f82b3838701cf">&#9670;&nbsp;</a></span>get_next_collective_descriptor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structwriter__types__mod_1_1write__field__collective__descriptor__type.html">write_field_collective_descriptor_type</a>) function, pointer netcdf_filetype_writer_mod::get_next_collective_descriptor </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structcollections__mod_1_1iterator__type.html">iterator_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>iterator</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the next collective descriptor based upon the iterator. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">iterator</td><td>The iterator to retrieve from, this is updated to reference the proceeding entry </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The next collective descriptor </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00496">496</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordtype">type</span>(iterator_type), <span class="keywordtype">intent(inout)</span> :: iterator</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordtype">type</span>(write_field_collective_descriptor_type), <span class="keywordtype">pointer</span> :: get_next_collective_descriptor</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: generic</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    generic=&gt;c_next_generic(iterator)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordflow">select type</span>(generic)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="keywordflow">    type is</span> (write_field_collective_descriptor_type)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      get_next_collective_descriptor=&gt;generic</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="keywordflow">    end select</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_aaff250f828a91818f15f82b3838701cf_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_aaff250f828a91818f15f82b3838701cf_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_aaff250f828a91818f15f82b3838701cf_icgraph" id="anamespacenetcdf__filetype__writer__mod_aaff250f828a91818f15f82b3838701cf_icgraph">
<area shape="rect" title="Retrieves the next collective descriptor based upon the iterator." alt="" coords="4061,91,4232,147"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#abc1e910adcd0ef7c86299b5286fc365f" title="Writes contiguous collective variable blocks into the NetCDF files. These are blocks of data spanning..." alt="" coords="3855,83,4013,154"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3663,98,3807,139"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,91,3615,147"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,85,2592,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,146,3423,187"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,75,1897,131"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,112,2371,168"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,112,2156,168"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,114,2801,155"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="aef4805588ccfc47ddd145e9c20e34218"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef4805588ccfc47ddd145e9c20e34218">&#9670;&nbsp;</a></span>get_next_specific_monc_info()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structwriter__types__mod_1_1write__field__collective__monc__info__type.html">write_field_collective_monc_info_type</a>) function, pointer netcdf_filetype_writer_mod::get_next_specific_monc_info </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structcollections__mod_1_1iterator__type.html">iterator_type</a>)&#160;</td>
          <td class="paramname"><em>iterator</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the next specific monc information item from the iterator. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">iterator</td><td>The iterator to retrieve from, this is updated to reference the proceeding entry </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The next specific monc information item </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00512">512</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordtype">type</span>(iterator_type) :: iterator</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordtype">type</span>(write_field_collective_monc_info_type), <span class="keywordtype">pointer</span> :: get_next_specific_monc_info</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160; </div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: generic</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    generic=&gt;c_next_generic(iterator)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordflow">select type</span>(generic)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="keywordflow">    type is</span> (write_field_collective_monc_info_type)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      get_next_specific_monc_info=&gt;generic</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="keywordflow">    end select</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_aef4805588ccfc47ddd145e9c20e34218_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_aef4805588ccfc47ddd145e9c20e34218_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_aef4805588ccfc47ddd145e9c20e34218_icgraph" id="anamespacenetcdf__filetype__writer__mod_aef4805588ccfc47ddd145e9c20e34218_icgraph">
<area shape="rect" title="Retrieves the next specific monc information item from the iterator." alt="" coords="4061,91,4221,147"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#abc1e910adcd0ef7c86299b5286fc365f" title="Writes contiguous collective variable blocks into the NetCDF files. These are blocks of data spanning..." alt="" coords="3855,83,4013,154"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3663,98,3807,139"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,91,3615,147"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,85,2592,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,146,3423,187"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,75,1897,131"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,112,2371,168"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,112,2156,168"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,114,2801,155"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a63ada26600230ff5a6551e3dd04736ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63ada26600230ff5a6551e3dd04736ce">&#9670;&nbsp;</a></span>get_number_timeseries_entries()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function netcdf_filetype_writer_mod::get_number_timeseries_entries </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structcollections__mod_1_1map__type.html">map_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>time_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>previous_write_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>output_frequency</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep_frequency</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>termination_write</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>last_write_entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the number of timeseries entries for a specific frequency and previous write time. This is based on the range of time points that are provided to the call. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">time_points</td><td>The list of times that data has been sent over that is applicable to this write </td></tr>
    <tr><td class="paramname">previous_write_time</td><td>When the field was previously written </td></tr>
    <tr><td class="paramname">frequency</td><td>The frequency of outputs of the field </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00883">883</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordtype">type</span>(map_type), <span class="keywordtype">intent(inout)</span> :: time_points</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: output_frequency, previous_write_time</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep_frequency</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: termination_write</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(out)</span> :: last_write_entry</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordtype">integer</span> :: ts</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="keywordtype">    real</span> :: tp_entry, write_point</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <span class="keywordtype">type</span>(iterator_type) :: iterator</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordtype">type</span>(mapentry_type) :: map_entry</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordtype">logical</span> :: include_item</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    get_number_timeseries_entries=0</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    write_point=previous_write_time</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    iterator=c_get_iterator(time_points)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(iterator))</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      map_entry=c_next_mapentry(iterator)</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      ts=conv_to_integer(map_entry%key)</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <span class="keywordflow">if</span> (timestep_frequency .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        include_item=mod(ts, timestep_frequency) == 0</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        include_item=.false.</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="keywordflow">if</span> (include_item .or. (.not. c_has_next(iterator) .and. termination_write)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        tp_entry=c_get_real(map_entry)</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordflow">if</span> (tp_entry .ge. write_point+output_frequency) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          get_number_timeseries_entries=get_number_timeseries_entries+1</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;          write_point=tp_entry</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;          last_write_entry=tp_entry</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="keywordflow">    end do</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a63ada26600230ff5a6551e3dd04736ce_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a63ada26600230ff5a6551e3dd04736ce_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a63ada26600230ff5a6551e3dd04736ce_icgraph" id="anamespacenetcdf__filetype__writer__mod_a63ada26600230ff5a6551e3dd04736ce_icgraph">
<area shape="rect" title="Retrieves the number of timeseries entries for a specific frequency and previous write time...." alt="" coords="3895,172,4089,228"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a66915aa056fc8a300dbedbc0c7b0c3ca" title="Defines dimensions for all required dimensions. This is usually the number required plus one,..." alt="" coords="3679,172,3847,228"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a6da2f8c99dc13a7d24ec60861a2a48aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6da2f8c99dc13a7d24ec60861a2a48aa">&#9670;&nbsp;</a></span>get_specific_timeseries_dimension()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__timeseries__type.html">netcdf_diagnostics_timeseries_type</a>) function, pointer netcdf_filetype_writer_mod::get_specific_timeseries_dimension </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>output_frequency</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep_frequency</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Given the file state and the output frequency of a field will retrive the appropriate time series dimension entry that corresponds to this or null if none can be found. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_state</td><td>The NetCDF file state that is being written </td></tr>
    <tr><td class="paramname">output_frequency</td><td>Time frequency of writes </td></tr>
    <tr><td class="paramname">timestep_frequency</td><td>The timestep frequency of data arrival/generation </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The corresponding time series dimension entry or null if none is found </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l01110">1110</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: output_frequency</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep_frequency</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_timeseries_type), <span class="keywordtype">pointer</span> :: get_specific_timeseries_dimension</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span> :: dim_key</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: generic</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160; </div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordflow">if</span> (output_frequency .lt. 0.0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      dim_key=<span class="stringliteral">&quot;time_series_&quot;</span>//trim(conv_to_string(timestep_frequency))</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      dim_key=<span class="stringliteral">&quot;time_series_&quot;</span>//trim(conv_to_string(timestep_frequency))//<span class="stringliteral">&quot;_&quot;</span>// trim(conv_to_string(output_frequency))</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    generic=&gt;c_get_generic(file_state%timeseries_dimension, dim_key)</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160; </div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(generic)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      <span class="keywordflow">select type</span>(generic)</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="keywordflow">      type is</span>(netcdf_diagnostics_timeseries_type)</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        get_specific_timeseries_dimension=&gt;generic</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="keywordflow">      end select</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      get_specific_timeseries_dimension=&gt;null()</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a6da2f8c99dc13a7d24ec60861a2a48aa_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a6da2f8c99dc13a7d24ec60861a2a48aa_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a6da2f8c99dc13a7d24ec60861a2a48aa_icgraph" id="anamespacenetcdf__filetype__writer__mod_a6da2f8c99dc13a7d24ec60861a2a48aa_icgraph">
<area shape="rect" title="Given the file state and the output frequency of a field will retrive the appropriate time series dim..." alt="" coords="4309,171,4505,227"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#af49b3618c2fdcf04a2eef4dc5e0a7925" title="For a specific field will retrieve the NetCDF id of the time series dimension most appropriate for th..." alt="" coords="4084,58,4261,114"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a10f13979aff7110f8df58356fb4e398d" title="Writes collective variables, where we are working with the values from multiple MONCs and storing the..." alt="" coords="4090,138,4255,194"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#abc1e910adcd0ef7c86299b5286fc365f" title="Writes contiguous collective variable blocks into the NetCDF files. These are blocks of data spanning..." alt="" coords="3874,192,4033,263"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a646b3fed89978ea8212eece9494f7c54" title=" " alt="" coords="4091,273,4254,329"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a58faae9f572a8860a586d47251df2ab4" title="Defines all variables in the file writer state." alt="" coords="3877,68,4030,109"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,76,3631,117"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,77,3423,119"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,70,3231,126"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,5,3228,47"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,70,3032,126"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,139,2801,180"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,165,2592,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,147,1897,203"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,173,2371,229"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,171,1699,212"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,143,1456,199"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,63,1240,119"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,223,1257,279"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,143,1247,199"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,223,1016,279"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,79,988,120"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,71,761,127"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,79,536,120"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,86,337,113"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,86,99,113"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,173,2156,229"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,5,2807,47"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3679,205,3823,247"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3479,190,3623,246"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a605f56b2d81bbaf34377388f9d3f6ec1" title="Writes independent variables to the diagnostics file. This writes the entire variable and works by wr..." alt="" coords="3871,287,4036,343"/>
</map>
</div>

</div>
</div>
<a id="a9fdd5ef501b6dfc64d62898d1ef25b1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9fdd5ef501b6dfc64d62898d1ef25b1b">&#9670;&nbsp;</a></span>get_writer_entry_from_netcdf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structwriter__types__mod_1_1writer__type.html">writer_type</a>) function, pointer, public netcdf_filetype_writer_mod::get_writer_entry_from_netcdf </td>
          <td>(</td>
          <td class="paramtype">character(len=string_length)&#160;</td>
          <td class="paramname"><em>field_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(out), optional&#160;</td>
          <td class="paramname"><em>terminated</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Looks up and retrieves the writer entry that corresponds to this NetCDF file state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">field_name</td><td>The field name that is being communicated </td></tr>
    <tr><td class="paramname">timestep</td><td>The write timestep </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The writer entry </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00175">175</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span> :: field_name</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordtype">integer</span> :: timestep</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">optional</span> :: terminated</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">type</span>(writer_type), <span class="keywordtype">pointer</span> :: get_writer_entry_from_netcdf</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">pointer</span> :: file_state</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    file_state=&gt;get_file_state(field_name, timestep, .true.)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(terminated)) terminated=file_state%termination_write</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    get_writer_entry_from_netcdf=&gt;file_state%corresponding_writer_entry</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a9fdd5ef501b6dfc64d62898d1ef25b1b_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a9fdd5ef501b6dfc64d62898d1ef25b1b_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a9fdd5ef501b6dfc64d62898d1ef25b1b_cgraph" id="anamespacenetcdf__filetype__writer__mod_a9fdd5ef501b6dfc64d62898d1ef25b1b_cgraph">
<area shape="rect" title="Looks up and retrieves the writer entry that corresponds to this NetCDF file state." alt="" coords="5,63,157,119"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#acb05fbdc64a670792cd9cec7f238951d" title="Retrieves a file state based upon its timestep or null if none is found." alt="" coords="205,71,349,112"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="401,5,556,47"/>
<area shape="rect" href="namespaceforthread__mod.html#ace3f16636de24b1fc62de549d67476dc" title=" " alt="" coords="397,71,560,112"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="397,136,560,177"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="608,13,751,39"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="799,5,965,47"/>
</map>
</div>

</div>
</div>
<a id="a8fb7c121572aa0805eb6938e83eb37d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fb7c121572aa0805eb6938e83eb37d8">&#9670;&nbsp;</a></span>initialise_netcdf_filetype()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public netcdf_filetype_writer_mod::initialise_netcdf_filetype</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialises the NetCDF writing functionality. </p>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00052">52</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_rwlock_init(file_states_rwlock, -1))</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_init(netcdf_mutex, -1))</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a8fb7c121572aa0805eb6938e83eb37d8_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a8fb7c121572aa0805eb6938e83eb37d8_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a8fb7c121572aa0805eb6938e83eb37d8_cgraph" id="anamespacenetcdf__filetype__writer__mod_a8fb7c121572aa0805eb6938e83eb37d8_cgraph">
<area shape="rect" title="Initialises the NetCDF writing functionality." alt="" coords="5,63,156,119"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="208,5,363,47"/>
<area shape="rect" href="namespaceforthread__mod.html#ab29785b28c1d6bcf13e844b8d1230846" title=" " alt="" coords="204,71,367,112"/>
<area shape="rect" href="namespaceforthread__mod.html#a84f66d5153e8adc21918d4b4d627087f" title=" " alt="" coords="204,136,367,177"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="415,13,557,39"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="605,5,772,47"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a8fb7c121572aa0805eb6938e83eb37d8_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a8fb7c121572aa0805eb6938e83eb37d8_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a8fb7c121572aa0805eb6938e83eb37d8_icgraph" id="anamespacenetcdf__filetype__writer__mod_a8fb7c121572aa0805eb6938e83eb37d8_icgraph">
<area shape="rect" title="Initialises the NetCDF writing functionality." alt="" coords="605,5,756,61"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7b31bb8f9d0fb8c0768252e819b20985" title="Initialises the write federator and configures it based on the user configuration...." alt="" coords="385,13,557,54"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,20,337,47"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,20,99,47"/>
</map>
</div>

</div>
</div>
<a id="af49b3618c2fdcf04a2eef4dc5e0a7925"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af49b3618c2fdcf04a2eef4dc5e0a7925">&#9670;&nbsp;</a></span>retrieve_time_series_dimension_id_for_field()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer function netcdf_filetype_writer_mod::retrieve_time_series_dimension_id_for_field </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__type.html">writer_type</a>), intent(in)&#160;</td>
          <td class="paramname"><em>file_writer_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>field_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>For a specific field will retrieve the NetCDF id of the time series dimension most appropriate for this field. If a dimension can not be located then an error is raised. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_state</td><td>NetCDF file state </td></tr>
    <tr><td class="paramname">file_writer_information</td><td>The writer information </td></tr>
    <tr><td class="paramname">field_index</td><td>Index of the field in the writer information contents that we are writing </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The NetCDF dimension id </dd></dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l01086">1086</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordtype">type</span>(writer_type), <span class="keywordtype">intent(in)</span> :: file_writer_information</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: field_index</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160; </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_timeseries_type), <span class="keywordtype">pointer</span> :: timeseries_diag</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    timeseries_diag=&gt;get_specific_timeseries_dimension(file_state, &amp;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;         file_writer_information%contents(field_index)%output_frequency, &amp;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;         file_writer_information%contents(field_index)%timestep_frequency)</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">associated</span>(timeseries_diag)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      retrieve_time_series_dimension_id_for_field=timeseries_diag%netcdf_dim_id</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Can not find time series dimension with output frequency &quot;</span>//&amp;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;           trim(conv_to_string(file_writer_information%contents(field_index)%output_frequency)))</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_af49b3618c2fdcf04a2eef4dc5e0a7925_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_af49b3618c2fdcf04a2eef4dc5e0a7925_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_af49b3618c2fdcf04a2eef4dc5e0a7925_cgraph" id="anamespacenetcdf__filetype__writer__mod_af49b3618c2fdcf04a2eef4dc5e0a7925_cgraph">
<area shape="rect" title="For a specific field will retrieve the NetCDF id of the time series dimension most appropriate for th..." alt="" coords="5,39,183,95"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6da2f8c99dc13a7d24ec60861a2a48aa" title="Given the file state and the output frequency of a field will retrive the appropriate time series dim..." alt="" coords="231,5,427,61"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="257,85,400,112"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="475,78,641,119"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_af49b3618c2fdcf04a2eef4dc5e0a7925_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_af49b3618c2fdcf04a2eef4dc5e0a7925_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_af49b3618c2fdcf04a2eef4dc5e0a7925_icgraph" id="anamespacenetcdf__filetype__writer__mod_af49b3618c2fdcf04a2eef4dc5e0a7925_icgraph">
<area shape="rect" title="For a specific field will retrieve the NetCDF id of the time series dimension most appropriate for th..." alt="" coords="3880,172,4057,228"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a58faae9f572a8860a586d47251df2ab4" title="Defines all variables in the file writer state." alt="" coords="3679,179,3832,221"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="ab90e4b2c185d22faacd6f23c39bd9449"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab90e4b2c185d22faacd6f23c39bd9449">&#9670;&nbsp;</a></span>store_io_server_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public netcdf_filetype_writer_mod::store_io_server_state </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>io_configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__type.html">writer_type</a>), dimension(:), intent(inout), volatile&#160;</td>
          <td class="paramname"><em>writer_entries</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structcollections__mod_1_1hashmap__type.html">hashmap_type</a>), intent(inout), volatile&#160;</td>
          <td class="paramname"><em>time_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__type.html">writer_type</a>), intent(inout), target&#160;</td>
          <td class="paramname"><em>file_writer_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stores the IO server state in the NetCDF file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io_configuration</td><td>The IO server configuration </td></tr>
    <tr><td class="paramname">file_writer_information</td><td>The file writer information </td></tr>
    <tr><td class="paramname">timestep</td><td>The write timestep </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00151">151</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">intent(inout)</span> :: io_configuration</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">type</span>(writer_type), <span class="keywordtype">volatile</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(inout)</span> :: writer_entries</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordtype">type</span>(hashmap_type), <span class="keywordtype">volatile</span>, <span class="keywordtype">intent(inout)</span> :: time_points</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordtype">type</span>(writer_type), <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">target</span> :: file_writer_information</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">pointer</span> :: ncdf_writer_state</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    ncdf_writer_state=&gt;get_file_state(file_writer_information%filename, timestep, .true.)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_redef(ncdf_writer_state%ncid))</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keyword">call </span>define_io_server_state_contributions(io_configuration, writer_entries, time_points, ncdf_writer_state)</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_enddef(ncdf_writer_state%ncid))</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keyword">call </span>write_io_server_state(io_configuration, writer_entries, time_points, ncdf_writer_state)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_ab90e4b2c185d22faacd6f23c39bd9449_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_ab90e4b2c185d22faacd6f23c39bd9449_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_ab90e4b2c185d22faacd6f23c39bd9449_cgraph" id="anamespacenetcdf__filetype__writer__mod_ab90e4b2c185d22faacd6f23c39bd9449_cgraph">
<area shape="rect" title="Stores the IO server state in the NetCDF file." alt="" coords="5,607,191,649"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="781,705,947,746"/>
<area shape="rect" href="namespaceio__server__state__writer__mod.html#a52442fc6df103bdee12c9d95cc9a9a73" title="Defines the dimensions and variables in a NetCDF file that consitute the IO server current state...." alt="" coords="253,432,408,488"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="779,315,949,357"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="779,503,949,545"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#acb05fbdc64a670792cd9cec7f238951d" title="Retrieves a file state based upon its timestep or null if none is found." alt="" coords="259,1190,403,1231"/>
<area shape="rect" href="namespaceio__server__state__writer__mod.html#a6f99dece53eb5c51cf1fcbd384ea7d08" title="Packags up and writes the actual IO server state into the NetCDF file. The act of serialisation will ..." alt="" coords="239,723,423,765"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="1306,653,1449,680"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1533,646,1699,687"/>
<area shape="rect" href="namespaceio__server__state__writer__mod.html#a0bb9318bbaa968f84db7a18afa572b4a" title="Defines some state storate for a specific facet of the IO server. This creates the directory (locatio..." alt="" coords="499,439,679,481"/>
<area shape="rect" href="namespaceio__server__state__writer__mod.html#ac10efaf9ebd3eed8dc0ade5f5f503d2b" title="Will determine the size of the package for different facets of the IO server state and kick off non&#45;b..." alt="" coords="507,141,670,197"/>
<area shape="rect" href="namespacempi__communication__mod.html#a6ed06ee79c19ff1f57a344de48e53806" title="Waits for a specific MPI request to complete, either by managing thread safety and interleaving or ju..." alt="" coords="503,374,674,415"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="1053,593,1208,634"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="1049,315,1212,357"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="1049,503,1212,545"/>
<area shape="rect" href="namespaceinstantaneous__time__manipulation__mod.html#ab6d7b0d3d29ee9e9553fbe969df77953" title="Prepares to serialise the instantaneous state, both determines the byte storage size and issues any l..." alt="" coords="755,149,973,205"/>
<area shape="rect" href="namespacetimeaveraged__time__manipulation__mod.html#a4179676e0a2de676c2291590d2c0730e" title="Prepares to serialise the time averaged state values. Both determines the storage size required and a..." alt="" coords="758,229,970,285"/>
<area shape="rect" href="namespaceio__server__state__writer__mod.html#afe03a4b52220f75e323695208c28dd23" title="Prepares to serialise the writer entry time points." alt="" coords="773,5,955,61"/>
<area shape="rect" href="namespacewriter__types__mod.html#a35d2a93e9bd3dabba1dd70a9f757e9a0" title="Prepares to serialise the writer type by issuing locks and determining the size of serialised bytes n..." alt="" coords="777,85,951,126"/>
<area shape="rect" href="namespacetimeaveraged__time__manipulation__mod.html#a165774be890acb676411ddb69a06a79a" title="Prepares to serialise a time averaged completed value, both determines the storage size and also issu..." alt="" coords="1021,229,1240,285"/>
<area shape="rect" href="namespacewriter__types__mod.html#ab32d8c52b1de472472a1a3e7f6d550c9" title="Prepares to serialise a specific writer field, both determines the data size and issues any locks." alt="" coords="1033,85,1228,126"/>
<area shape="rect" href="namespacewriter__types__mod.html#a4c254cb13c3ced319ddba80cb6ebac88" title="Prepares to serialise a specific collective value, both determines the required byte storate size and..." alt="" coords="1291,111,1464,167"/>
<area shape="rect" href="namespacewriter__types__mod.html#aa4c1edaaebbfa64ad4dc2a09632cefba" title="Prepares to serialise a specific data values type, both determines the byte size required and also is..." alt="" coords="1515,86,1717,127"/>
<area shape="rect" href="namespacewriter__types__mod.html#a09de0017a289827e5b114043878ee8b2" title="Prepares a map for serialisation, both determines the size of storage required and also issues any lo..." alt="" coords="1765,86,1939,127"/>
<area shape="rect" href="namespacempi__communication__mod.html#aee6d81060fcad11a466f823627234e7c" title="Pauses for a specific number of ms to allow for MPI interleaving, this is to avoid starvation." alt="" coords="771,381,957,422"/>
<area shape="rect" href="namespaceforthread__mod.html#ace3f16636de24b1fc62de549d67476dc" title=" " alt="" coords="507,1285,670,1326"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="507,1219,670,1261"/>
<area shape="rect" href="namespaceinstantaneous__time__manipulation__mod.html#a1fb4c66a6d2a12501c7a8cafa8b61c68" title="Will serialise the state of this manipulator so that it can be later restarted. Any locks issued duri..." alt="" coords="495,775,683,831"/>
<area shape="rect" href="namespacetimeaveraged__time__manipulation__mod.html#ad4683870d908678162175c06b7402ed5" title="Serialises the state of this manipulator so that it can be restarted later on. Releases any locks iss..." alt="" coords="471,906,707,947"/>
<area shape="rect" href="namespaceio__server__state__writer__mod.html#afd94d228a13199b6665d1fdd4ed2f043" title="Serialises the writer entry time points which are held in a hashmap." alt="" coords="513,971,664,1027"/>
<area shape="rect" href="namespacewriter__types__mod.html#a8eba61b899444e7ad3d52bea630caa48" title="Serialises a specific writer type into byte data (for storage or transmission.) Releases any locks is..." alt="" coords="499,1102,678,1143"/>
<area shape="rect" href="namespaceio__server__state__writer__mod.html#af3dc548945ef0bd31291214d13c4355b" title="Writes out the state for a specific facet into the NetCDF file. Note that this uses the ISO C binding..." alt="" coords="501,658,676,699"/>
<area shape="rect" href="namespacetimeaveraged__time__manipulation__mod.html#a333024bb15a4003bee7d658b35806dd0" title="Serialises a specific time averaged completed value, releases any locks issued during preparation." alt="" coords="758,899,970,955"/>
<area shape="rect" href="namespaceio__server__client__mod.html#aa9aee7e6e5918193184b77962ba3b12e" title="Packs the data of a scalar field into a buffer." alt="" coords="791,978,937,1019"/>
<area shape="rect" href="namespacewriter__types__mod.html#a726056f310e896930290c84bd0dff389" title="Serialises a specific writer field type for storage or transmission. This releases any locks issued d..." alt="" coords="775,1219,953,1261"/>
<area shape="rect" href="namespacewriter__types__mod.html#a5d29675d56233f7bf4bf2244cc0e3873" title="Serialises collective values. This releases any locks issued during preparation." alt="" coords="1041,1249,1220,1290"/>
<area shape="rect" href="namespacewriter__types__mod.html#ab5bd556b7aece3ad191a87331c70663d" title="Serialises some data values to store or transmit. This releases any locks issued during preparation." alt="" coords="1288,1219,1467,1261"/>
<area shape="rect" href="namespacewriter__types__mod.html#a427401c0dfd6265375770ccf333f1675" title="Serialises a string map, where the values are assumed to be strings. This releases any locks issued d..." alt="" coords="1527,1219,1705,1261"/>
</map>
</div>

</div>
</div>
<a id="a10f13979aff7110f8df58356fb4e398d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10f13979aff7110f8df58356fb4e398d">&#9670;&nbsp;</a></span>write_collective_variable_to_diagnostics()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::write_collective_variable_to_diagnostics </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>io_configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__field__type.html">writer_field_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>field_to_write_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes collective variables, where we are working with the values from multiple MONCs and storing these in their own specific relative location in the diagnostics file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">field_to_write_information</td><td>The field that is going to be written </td></tr>
    <tr><td class="paramname">timestep</td><td>The write timestep </td></tr>
    <tr><td class="paramname">time</td><td>The write time </td></tr>
    <tr><td class="paramname">file_state</td><td>File storate state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00531">531</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">intent(inout)</span> :: io_configuration</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordtype">type</span>(writer_field_type), <span class="keywordtype">intent(inout)</span> :: field_to_write_information</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keywordtype">    real</span> :: value_to_test</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordtype">integer</span> :: i, k, included_num, field_id, start(field_to_write_information%dimensions+1), &amp;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;         count(field_to_write_information%dimensions+1), monc_location, dim_identifier, auto_period, dim_start</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: generic</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordtype">type</span>(write_field_collective_values_type), <span class="keywordtype">pointer</span> :: multi_monc_entries</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordtype">logical</span> :: is_auto_dimension</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: timeseries_time_to_write</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: items_to_remove</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordtype">type</span>(data_values_type), <span class="keywordtype">pointer</span> :: data_value</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_timeseries_type), <span class="keywordtype">pointer</span> :: timeseries_diag</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordtype">type</span>(iterator_type) :: value_to_write_iterator, monc_entries_iterator</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordtype">type</span>(mapentry_type) :: value_to_write_map_entry, monc_entries_map_entry</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    timeseries_diag=&gt;get_specific_timeseries_dimension(file_state, field_to_write_information%output_frequency, &amp;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;         field_to_write_information%timestep_frequency)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span> (.not. timeseries_diag%variable_written) <span class="keyword">allocate</span>(timeseries_time_to_write(timeseries_diag%num_entries))</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keyword">allocate</span>(items_to_remove(timeseries_diag%num_entries))</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    included_num=1</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    field_id=c_get_integer(file_state%variable_to_id, get_field_key(field_to_write_information))</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    value_to_write_iterator=c_get_iterator(field_to_write_information%values_to_write)</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(value_to_write_iterator))</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      value_to_write_map_entry=c_next_mapentry(value_to_write_iterator)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      value_to_test=conv_to_real(value_to_write_map_entry%key)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keywordflow">if</span> (value_to_test .le. time .and. value_to_test .gt. field_to_write_information%previous_write_time) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="keywordflow">if</span> (included_num .le. timeseries_diag%num_entries) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(timeseries_time_to_write)) timeseries_time_to_write(included_num)=value_to_test</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;          generic=&gt;c_get_generic(value_to_write_map_entry)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;          <span class="keywordflow">select type</span>(generic)</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="keywordflow">          type is</span>(write_field_collective_values_type)</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            multi_monc_entries=&gt;generic</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="keywordflow">          end select</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;          monc_entries_iterator=c_get_iterator(multi_monc_entries%monc_values)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          <span class="keywordflow">do</span> <span class="keywordflow">while</span>(c_has_next(monc_entries_iterator))</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            monc_entries_map_entry=c_next_mapentry(monc_entries_iterator)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            data_value=&gt;get_data_value_by_field_name(multi_monc_entries%monc_values, monc_entries_map_entry%key)           </div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            monc_location=c_get_integer(io_configuration%monc_to_index, monc_entries_map_entry%key)</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="keywordflow">do</span> k=1, field_to_write_information%dimensions</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;              dim_identifier=get_dimension_identifier(field_to_write_information%dim_size_defns(k), is_auto_dimension)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;              <span class="keywordflow">if</span> (dim_identifier .gt. -1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                start(k)=io_configuration%registered_moncs(monc_location)%local_dim_starts(dim_identifier)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                count(k)=io_configuration%registered_moncs(monc_location)%local_dim_sizes(dim_identifier)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                <span class="keywordflow">if</span> (is_auto_dimension) <span class="keywordflow">then</span>              </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                  auto_period=ceiling(real(get_dimension_original_size(field_to_write_information%dim_size_defns(k), &amp;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                       io_configuration%dimension_sizing))/field_to_write_information%actual_dim_size(k))</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                  start(k)=(start(k)/auto_period)+1</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                  <span class="keywordflow">if</span> (io_configuration%registered_moncs(monc_location)%local_dim_starts(dim_identifier)==1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                    dim_start=1</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                    dim_start=auto_period - &amp;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                         mod(io_configuration%registered_moncs(monc_location)%local_dim_starts(dim_identifier)-2, auto_period)</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="keywordflow">                  end if</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                  count(k)=ceiling(real(io_configuration%registered_moncs(monc_location)%local_dim_sizes(dim_identifier) - &amp;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                       (dim_start-1))/auto_period)</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">log_error</a>, <span class="stringliteral">&quot;Can not locate dimension &quot;</span>//trim(field_to_write_information%dim_size_defns(k)))</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="keywordflow">              end if</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keywordflow">            end do</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            start(field_to_write_information%dimensions+1) = included_num</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            count(field_to_write_information%dimensions+1) = 1</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(file_state%mutex))</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(netcdf_mutex))</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, field_id, data_value%values, start=start, count=count))</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(netcdf_mutex))</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(file_state%mutex))</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <span class="keyword">deallocate</span>(data_value%values)</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keyword">deallocate</span>(data_value)</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;          items_to_remove(included_num)=value_to_write_map_entry%key</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;          included_num=included_num+1</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;          <span class="keyword">call </span>c_free(multi_monc_entries%monc_values)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;          <span class="keyword">deallocate</span>(multi_monc_entries)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">log_warn</a>, <span class="stringliteral">&quot;Omitted time entry of field &#39;&quot;</span>//trim(field_to_write_information%field_name)//&amp;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;               <span class="stringliteral">&quot;&#39; as past dimension length at time &quot;</span>//conv_to_string(value_to_test))</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordflow">if</span> (included_num-1 .ne. timeseries_diag%num_entries) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">log_warn</a>, <span class="stringliteral">&quot;Miss match of time entries for field &#39;&quot;</span>//trim(field_to_write_information%field_name)//&amp;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;           <span class="stringliteral">&quot;&#39;, included entries=&quot;</span>//trim(conv_to_string(included_num-1))//<span class="stringliteral">&quot; but expected entries=&quot;</span>//&amp;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;           trim(conv_to_string(timeseries_diag%num_entries)))</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(timeseries_time_to_write)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(netcdf_mutex))</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, timeseries_diag%netcdf_var_id, &amp;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;           timeseries_time_to_write, count=(/ timeseries_diag%num_entries /)))</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(netcdf_mutex))</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      timeseries_diag%variable_written=.true.</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">if</span> (included_num .gt. 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keywordflow">do</span> i=1, included_num-1</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keyword">call </span>c_remove(field_to_write_information%values_to_write, items_to_remove(i))</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keyword">deallocate</span>(items_to_remove)</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(timeseries_time_to_write)) <span class="keyword">deallocate</span>(timeseries_time_to_write)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a10f13979aff7110f8df58356fb4e398d_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a10f13979aff7110f8df58356fb4e398d_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a10f13979aff7110f8df58356fb4e398d_cgraph" id="anamespacenetcdf__filetype__writer__mod_a10f13979aff7110f8df58356fb4e398d_cgraph">
<area shape="rect" title="Writes collective variables, where we are working with the values from multiple MONCs and storing the..." alt="" coords="5,290,171,346"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="489,5,656,47"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="704,71,847,98"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="495,135,650,176"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="491,224,654,265"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="491,336,654,377"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#aacc77c78537724e3eac2bfc2537d9a30" title="Translates a dimension name to its numeric corresponding identifier." alt="" coords="231,407,429,448"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#aff299f33f5701bfddd073cd0a06be5f7" title="Retrieves the original size of a specific dimension (which is auto)" alt="" coords="219,472,441,513"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a41e86c7b84afdea863ca626a2599bf1d" title="Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against..." alt="" coords="258,537,402,579"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6da2f8c99dc13a7d24ec60861a2a48aa" title="Given the file state and the output frequency of a field will retrive the appropriate time series dim..." alt="" coords="232,602,428,658"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="245,173,415,215"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="245,239,415,280"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="895,64,1061,105"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a10f13979aff7110f8df58356fb4e398d_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a10f13979aff7110f8df58356fb4e398d_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a10f13979aff7110f8df58356fb4e398d_icgraph" id="anamespacenetcdf__filetype__writer__mod_a10f13979aff7110f8df58356fb4e398d_icgraph">
<area shape="rect" title="Writes collective variables, where we are working with the values from multiple MONCs and storing the..." alt="" coords="3855,91,4020,147"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3663,98,3807,139"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,91,3615,147"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,85,2592,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,146,3423,187"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,75,1897,131"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,112,2371,168"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,112,2156,168"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,114,2801,155"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a0a437b7c2ee1752a8c3ad3ce4797cced"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a437b7c2ee1752a8c3ad3ce4797cced">&#9670;&nbsp;</a></span>write_condition_variable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::write_condition_variable </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>c_var_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=string_length), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>field_values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes the conditional diagnostic variable names into the NetCDF file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_state</td><td>The NetCDF file state </td></tr>
    <tr><td class="paramname">c_var_id</td><td>The variable id in the file </td></tr>
    <tr><td class="paramname">field_values</td><td>The field values to write </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00326">326</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: c_var_id </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: field_values</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordtype">integer</span> :: count_to_write(2), start_pos(2)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="keywordtype">integer</span> :: pos, string_size</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span> :: dum_string</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    count_to_write(2)=1    <span class="comment">! element count</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    start_pos(1)=1         <span class="comment">! string character start position</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">do</span> pos=1,<span class="keyword">size</span>(field_values)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      dum_string = trim(field_values(pos))</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      count_to_write(1) = len(trim(field_values(pos)))</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      start_pos(2)=pos</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, c_var_id, dum_string, &amp;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                               start=start_pos, count=count_to_write))</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a0a437b7c2ee1752a8c3ad3ce4797cced_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a0a437b7c2ee1752a8c3ad3ce4797cced_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a0a437b7c2ee1752a8c3ad3ce4797cced_cgraph" id="anamespacenetcdf__filetype__writer__mod_a0a437b7c2ee1752a8c3ad3ce4797cced_cgraph">
<area shape="rect" title="Writes the conditional diagnostic variable names into the NetCDF file." alt="" coords="5,63,152,119"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="202,5,369,47"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="200,71,371,112"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="200,136,371,177"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="629,75,772,102"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="820,68,987,109"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="423,129,577,171"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="419,64,581,105"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="419,195,581,236"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a0a437b7c2ee1752a8c3ad3ce4797cced_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a0a437b7c2ee1752a8c3ad3ce4797cced_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a0a437b7c2ee1752a8c3ad3ce4797cced_icgraph" id="anamespacenetcdf__filetype__writer__mod_a0a437b7c2ee1752a8c3ad3ce4797cced_icgraph">
<area shape="rect" title="Writes the conditional diagnostic variable names into the NetCDF file." alt="" coords="3679,172,3825,228"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="abc1e910adcd0ef7c86299b5286fc365f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc1e910adcd0ef7c86299b5286fc365f">&#9670;&nbsp;</a></span>write_contiguous_collective_variable_to_diagnostics()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::write_contiguous_collective_variable_to_diagnostics </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>io_configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__field__type.html">writer_field_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>field_to_write_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes contiguous collective variable blocks into the NetCDF files. These are blocks of data spanning multiple variables and multiple time points, the idea being to minimise the number of overall writes into the file. These variables are defined collective, so it might be that other IO servers have less contiguous data and hence more writes, therefore empty writes might need to be issued (at the end) to match up against these other servers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io_configuration</td><td>The IO server configuration </td></tr>
    <tr><td class="paramname">field_to_write_information</td><td>The field to write </td></tr>
    <tr><td class="paramname">timestep</td><td>The current model timestep </td></tr>
    <tr><td class="paramname">time</td><td>The current model time </td></tr>
    <tr><td class="paramname">file_state</td><td>Specific file state descriptor </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00357">357</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">intent(inout)</span> :: io_configuration</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordtype">type</span>(writer_field_type), <span class="keywordtype">intent(inout)</span> :: field_to_write_information</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="keywordtype">    real</span> :: value_to_test</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:,:,:,:)</span>, <span class="keywordtype">allocatable</span> :: contiguous_values</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordtype">type</span>(hashset_type) :: items_to_remove</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: timeseries_time_to_write</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordtype">type</span>(iterator_type) :: value_to_write_iterator, collective_descriptor_iterator, monc_iterator, value_to_remove_iterator</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordtype">type</span>(mapentry_type) :: value_to_write_map_entry</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: generic</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordtype">type</span>(write_field_collective_descriptor_type), <span class="keywordtype">pointer</span> :: collective_descriptor</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_timeseries_type), <span class="keywordtype">pointer</span> :: timeseries_diag</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordtype">type</span>(write_field_collective_monc_info_type), <span class="keywordtype">pointer</span> :: monc_descriptor</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordtype">type</span>(write_field_collective_values_type), <span class="keywordtype">pointer</span> :: multi_monc_entries</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordtype">type</span>(data_values_type), <span class="keywordtype">pointer</span> :: data_value</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keywordtype">integer</span> :: number_time_entries, i, start(4), count(4), field_id, ierr</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span> :: removal_key</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    timeseries_diag=&gt;get_specific_timeseries_dimension(file_state, field_to_write_information%output_frequency, &amp;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;         field_to_write_information%timestep_frequency)</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    field_id=c_get_integer(file_state%variable_to_id, get_field_key(field_to_write_information))</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">if</span> (.not. timeseries_diag%variable_written) <span class="keyword">allocate</span>(timeseries_time_to_write(timeseries_diag%num_entries))</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    number_time_entries=0</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    value_to_write_iterator=c_get_iterator(field_to_write_information%values_to_write)</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(value_to_write_iterator))</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      value_to_write_map_entry=c_next_mapentry(value_to_write_iterator)</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      value_to_test=conv_to_real(value_to_write_map_entry%key)</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keywordflow">if</span> (value_to_test .le. time .and. value_to_test .gt. field_to_write_information%previous_write_time) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        number_time_entries=number_time_entries+1</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keyword">call </span>c_add_string(items_to_remove, value_to_write_map_entry%key)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span> (number_time_entries .ne. timeseries_diag%num_entries) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">log_warn</a>, <span class="stringliteral">&quot;Expected &quot;</span>//trim(conv_to_string(timeseries_diag%num_entries))//&amp;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;           <span class="stringliteral">&quot; but have &quot;</span>//trim(conv_to_string(number_time_entries)))</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordflow">if</span> (number_time_entries .gt. timeseries_diag%num_entries) number_time_entries=timeseries_diag%num_entries</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    collective_descriptor_iterator=c_get_iterator(field_to_write_information%collective_descriptors)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(collective_descriptor_iterator))</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      collective_descriptor=&gt;get_next_collective_descriptor(collective_descriptor_iterator) </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="keyword">allocate</span>(contiguous_values(collective_descriptor%count(1), collective_descriptor%count(2), &amp;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;           collective_descriptor%count(3), number_time_entries))</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      monc_iterator=c_get_iterator(collective_descriptor%specific_monc_info)</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(monc_iterator))</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        monc_descriptor=&gt;get_next_specific_monc_info(monc_iterator)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        value_to_write_iterator=c_get_iterator(field_to_write_information%values_to_write)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        i=0</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(value_to_write_iterator))</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          value_to_write_map_entry=c_next_mapentry(value_to_write_iterator)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;          value_to_test=conv_to_real(value_to_write_map_entry%key)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;          <span class="keywordflow">if</span> (value_to_test .le. time .and. value_to_test .gt. field_to_write_information%previous_write_time) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            i=i+1</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(timeseries_time_to_write)) timeseries_time_to_write(i)=value_to_test</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            generic=&gt;c_get_generic(value_to_write_map_entry)</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <span class="keywordflow">select type</span>(generic)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="keywordflow">            type is</span>(write_field_collective_values_type)</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;              multi_monc_entries=&gt;generic</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="keywordflow">            end select</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            data_value=&gt;get_data_value_by_field_name(multi_monc_entries%monc_values, &amp;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                 trim(conv_to_string(monc_descriptor%monc_source)))</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">if</span> (collective_descriptor%split_dim == y_index) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;              contiguous_values(:,monc_descriptor%relative_dimension_start:monc_descriptor%relative_dimension_start+&amp;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                   monc_descriptor%counts(y_index)-1,:,i)=reshape(data_value%values, (/ monc_descriptor%counts(z_index), &amp;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                   monc_descriptor%counts(y_index), monc_descriptor%counts(x_index)/))</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;              contiguous_values(:,:,monc_descriptor%relative_dimension_start:monc_descriptor%relative_dimension_start+&amp;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                   monc_descriptor%counts(x_index)-1,i)=reshape(data_value%values, (/ monc_descriptor%counts(z_index), &amp;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                   monc_descriptor%counts(y_index), monc_descriptor%counts(x_index)/))</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <span class="keyword">deallocate</span>(data_value%values)</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            <span class="keyword">deallocate</span>(data_value)            </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      count(1:3)=collective_descriptor%count</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      count(4)=number_time_entries</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      start(1:3)=collective_descriptor%absolute_start</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      start(4)=1</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(file_state%mutex))</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(netcdf_mutex))</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, field_id, contiguous_values, start=start, count=count))</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(netcdf_mutex))</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(file_state%mutex))</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="keyword">deallocate</span>(contiguous_values)</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(timeseries_time_to_write)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(netcdf_mutex))</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, timeseries_diag%netcdf_var_id, &amp;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;             timeseries_time_to_write, count=(/ timeseries_diag%num_entries /)))</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(netcdf_mutex))</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        timeseries_diag%variable_written=.true.</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keyword">deallocate</span>(timeseries_time_to_write)</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="keywordflow">if</span> (.not. c_is_empty(items_to_remove)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      value_to_remove_iterator=c_get_iterator(items_to_remove)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(value_to_remove_iterator))</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        removal_key=c_next_string(value_to_remove_iterator)</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        generic=&gt;c_get_generic(field_to_write_information%values_to_write, removal_key)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">select type</span>(generic)</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="keywordflow">        type is</span>(write_field_collective_values_type)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;          multi_monc_entries=&gt;generic</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="keywordflow">        end select</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keyword">call </span>c_free(multi_monc_entries%monc_values)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="keyword">deallocate</span>(multi_monc_entries)</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keyword">call </span>c_remove(field_to_write_information%values_to_write, removal_key)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="keyword">call </span>c_free(items_to_remove)</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">if</span> (field_to_write_information%max_num_collective_writes_request_handle .ne. mpi_request_null) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keyword">call </span>wait_for_mpi_request(field_to_write_information%max_num_collective_writes_request_handle)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (c_size(field_to_write_information%collective_descriptors) .lt. field_to_write_information%max_num_collective_writes) <span class="keywordflow">then</span>      </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(file_state%mutex))</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(netcdf_mutex))</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keywordflow">do</span> i=c_size(field_to_write_information%collective_descriptors), field_to_write_information%max_num_collective_writes-1        </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, field_id, (/1.0/), start=(/1/), count=(/0/)))</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(netcdf_mutex))</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(file_state%mutex))</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_abc1e910adcd0ef7c86299b5286fc365f_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_abc1e910adcd0ef7c86299b5286fc365f_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_abc1e910adcd0ef7c86299b5286fc365f_cgraph" id="anamespacenetcdf__filetype__writer__mod_abc1e910adcd0ef7c86299b5286fc365f_cgraph">
<area shape="rect" title="Writes contiguous collective variable blocks into the NetCDF files. These are blocks of data spanning..." alt="" coords="5,319,164,389"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="466,5,633,47"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="901,71,1044,98"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="695,135,849,176"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="691,225,853,267"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="691,359,853,400"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a41e86c7b84afdea863ca626a2599bf1d" title="Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against..." alt="" coords="238,472,382,513"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#aaff250f828a91818f15f82b3838701cf" title="Retrieves the next collective descriptor based upon the iterator." alt="" coords="225,537,395,593"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#aef4805588ccfc47ddd145e9c20e34218" title="Retrieves the next specific monc information item from the iterator." alt="" coords="230,617,390,673"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6da2f8c99dc13a7d24ec60861a2a48aa" title="Given the file state and the output frequency of a field will retrive the appropriate time series dim..." alt="" coords="212,697,408,753"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="464,173,635,215"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="464,304,635,345"/>
<area shape="rect" href="namespacempi__communication__mod.html#a6ed06ee79c19ff1f57a344de48e53806" title="Waits for a specific MPI request to complete, either by managing thread safety and interleaving or ju..." alt="" coords="225,244,395,285"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1092,64,1259,105"/>
<area shape="rect" href="namespacempi__communication__mod.html#aee6d81060fcad11a466f823627234e7c" title="Pauses for a specific number of ms to allow for MPI interleaving, this is to avoid starvation." alt="" coords="456,239,643,280"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_abc1e910adcd0ef7c86299b5286fc365f_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_abc1e910adcd0ef7c86299b5286fc365f_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_abc1e910adcd0ef7c86299b5286fc365f_icgraph" id="anamespacenetcdf__filetype__writer__mod_abc1e910adcd0ef7c86299b5286fc365f_icgraph">
<area shape="rect" title="Writes contiguous collective variable blocks into the NetCDF files. These are blocks of data spanning..." alt="" coords="3855,83,4013,154"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3663,98,3807,139"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,91,3615,147"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,85,2592,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,146,3423,187"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,75,1897,131"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,112,2371,168"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,112,2156,168"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,114,2801,155"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="ae456ae2267a1cf3a1763d1cbd59039ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae456ae2267a1cf3a1763d1cbd59039ab">&#9670;&nbsp;</a></span>write_coordinate_variable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::write_coordinate_variable </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>coord_var_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind=default_precision), dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>field_values</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes a coordinate variable into the NetCDF file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_state</td><td>The NetCDF file state </td></tr>
    <tr><td class="paramname">coord_var_id</td><td>The coordinate variable id in the file </td></tr>
    <tr><td class="paramname">field_values</td><td>The field values to write </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00309">309</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: coord_var_id</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(in)</span> :: field_values</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordtype">integer</span> :: count_to_write(1)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    count_to_write(1)=<span class="keyword">size</span>(field_values)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, coord_var_id, field_values, count=count_to_write))</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_ae456ae2267a1cf3a1763d1cbd59039ab_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_ae456ae2267a1cf3a1763d1cbd59039ab_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_ae456ae2267a1cf3a1763d1cbd59039ab_cgraph" id="anamespacenetcdf__filetype__writer__mod_ae456ae2267a1cf3a1763d1cbd59039ab_cgraph">
<area shape="rect" title="Writes a coordinate variable into the NetCDF file." alt="" coords="5,63,160,119"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="210,5,377,47"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="208,71,379,112"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="208,136,379,177"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="637,75,780,102"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="828,68,995,109"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="431,129,585,171"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="427,64,589,105"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="427,195,589,236"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_ae456ae2267a1cf3a1763d1cbd59039ab_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_ae456ae2267a1cf3a1763d1cbd59039ab_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_ae456ae2267a1cf3a1763d1cbd59039ab_icgraph" id="anamespacenetcdf__filetype__writer__mod_ae456ae2267a1cf3a1763d1cbd59039ab_icgraph">
<area shape="rect" title="Writes a coordinate variable into the NetCDF file." alt="" coords="3679,172,3833,228"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a605f56b2d81bbaf34377388f9d3f6ec1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a605f56b2d81bbaf34377388f9d3f6ec1">&#9670;&nbsp;</a></span>write_independent_variable_to_diagnostics()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::write_independent_variable_to_diagnostics </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__field__type.html">writer_field_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>field_to_write_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes independent variables to the diagnostics file. This writes the entire variable and works by writing all the memory up and then doing the write in one call. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">field_to_write_information</td><td>The field that is going to be written </td></tr>
    <tr><td class="paramname">timestep</td><td>The write timestep </td></tr>
    <tr><td class="paramname">time</td><td>The write time </td></tr>
    <tr><td class="paramname">file_state</td><td>File storate state </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00648">648</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordtype">type</span>(writer_field_type), <span class="keywordtype">intent(inout)</span> :: field_to_write_information</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">if</span> (field_to_write_information%field_type == array_field_type .or. &amp;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;         field_to_write_information%field_type == scalar_field_type) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="keywordflow">if</span> (field_to_write_information%data_type == double_data_type .or. &amp;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;           field_to_write_information%data_type == integer_data_type) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="keyword">call </span>write_out_number_values(field_to_write_information, timestep, time, file_state)</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (field_to_write_information%field_type == map_field_type) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="keyword">call </span>write_out_map(field_to_write_information, timestep, time, file_state)</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a605f56b2d81bbaf34377388f9d3f6ec1_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a605f56b2d81bbaf34377388f9d3f6ec1_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a605f56b2d81bbaf34377388f9d3f6ec1_cgraph" id="anamespacenetcdf__filetype__writer__mod_a605f56b2d81bbaf34377388f9d3f6ec1_cgraph">
<area shape="rect" title="Writes independent variables to the diagnostics file. This writes the entire variable and works by wr..." alt="" coords="5,294,171,350"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a527dfbc289976e0eefcc432bb077040e" title=" " alt="" coords="227,178,373,219"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a646b3fed89978ea8212eece9494f7c54" title=" " alt="" coords="219,356,381,412"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="444,210,611,251"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="677,339,832,380"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="673,404,836,446"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="673,274,836,315"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a41e86c7b84afdea863ca626a2599bf1d" title="Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against..." alt="" coords="455,144,599,186"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="442,392,613,434"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="442,275,613,316"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="884,346,1027,373"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1075,339,1241,380"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6da2f8c99dc13a7d24ec60861a2a48aa" title="Given the file state and the output frequency of a field will retrive the appropriate time series dim..." alt="" coords="429,457,625,513"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a605f56b2d81bbaf34377388f9d3f6ec1_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a605f56b2d81bbaf34377388f9d3f6ec1_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a605f56b2d81bbaf34377388f9d3f6ec1_icgraph" id="anamespacenetcdf__filetype__writer__mod_a605f56b2d81bbaf34377388f9d3f6ec1_icgraph">
<area shape="rect" title="Writes independent variables to the diagnostics file. This writes the entire variable and works by wr..." alt="" coords="3855,91,4020,147"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3663,98,3807,139"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,91,3615,147"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,85,2592,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,146,3423,187"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,75,1897,131"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,112,2371,168"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,112,2156,168"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,114,2801,155"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a767df50b485665dac93bfdf57897c667"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a767df50b485665dac93bfdf57897c667">&#9670;&nbsp;</a></span>write_out_global_attributes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::write_out_global_attributes </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>io_configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>ncid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__type.html">writer_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_writer_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes out global attributes into the checkpoint. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ncid</td><td>NetCDF file id </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l01248">1248</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">intent(inout)</span> :: io_configuration</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: ncid, timestep</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <span class="keywordtype">type</span>(writer_type), <span class="keywordtype">intent(inout)</span> :: file_writer_information</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160; </div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="keywordtype">integer</span> :: date_values(8), ierr</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keywordtype">character(len=50)</span> :: date_time</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <span class="keyword">call </span>date_and_time(values=date_values)</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="keyword">call </span>mpi_bcast(date_values, 8, mpi_int, 0, io_configuration%io_communicator, ierr)</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    date_time=trim(conv_to_string(date_values(3)))//<span class="stringliteral">&quot;/&quot;</span>//&amp;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;         trim(conv_to_string(date_values(2)))//<span class="stringliteral">&quot;/&quot;</span>//trim(conv_to_string(date_values(1)))//<span class="stringliteral">&quot; &quot;</span>//trim(conv_to_string(&amp;</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;         date_values(5)))// <span class="stringliteral">&quot;:&quot;</span>//trim(conv_to_string(date_values(6)))//<span class="stringliteral">&quot;:&quot;</span>//trim(conv_to_string(date_values(7)))</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160; </div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_put_att(ncid, nf90_global, <span class="stringliteral">&quot;title&quot;</span>, file_writer_information%title))</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_put_att(ncid, nf90_global, <span class="stringliteral">&quot;created&quot;</span>, date_time))</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_put_att(ncid, nf90_global, <span class="stringliteral">&quot;MONC time&quot;</span>, trim(conv_to_string(time))))</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_put_att(ncid, nf90_global, <span class="stringliteral">&quot;MONC timestep&quot;</span>, trim(conv_to_string(timestep))))</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_put_att(ncid, nf90_global, <span class="stringliteral">&quot;Diagnostic write frequency&quot;</span>, &amp;</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;         trim(conv_to_string(file_writer_information%write_time_frequency))))</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_put_att(ncid, nf90_global, <span class="stringliteral">&quot;Previous diagnostic write at&quot;</span>, &amp;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;         trim(conv_to_string(file_writer_information%previous_write_time))))</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a767df50b485665dac93bfdf57897c667_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a767df50b485665dac93bfdf57897c667_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a767df50b485665dac93bfdf57897c667_cgraph" id="anamespacenetcdf__filetype__writer__mod_a767df50b485665dac93bfdf57897c667_cgraph">
<area shape="rect" title="Writes out global attributes into the checkpoint." alt="" coords="5,63,160,119"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="210,5,377,47"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="208,71,379,112"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="208,136,379,177"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="637,75,780,102"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="828,68,995,109"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="431,129,585,171"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="427,64,589,105"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="427,195,589,236"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a767df50b485665dac93bfdf57897c667_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a767df50b485665dac93bfdf57897c667_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a767df50b485665dac93bfdf57897c667_icgraph" id="anamespacenetcdf__filetype__writer__mod_a767df50b485665dac93bfdf57897c667_icgraph">
<area shape="rect" title="Writes out global attributes into the checkpoint." alt="" coords="3679,172,3833,228"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a527dfbc289976e0eefcc432bb077040e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a527dfbc289976e0eefcc432bb077040e">&#9670;&nbsp;</a></span>write_out_map()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::write_out_map </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__field__type.html">writer_field_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>field_to_write_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00749">749</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordtype">type</span>(writer_field_type), <span class="keywordtype">intent(inout)</span> :: field_to_write_information</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordtype">integer</span> :: i, j, field_id, included_num</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="keywordtype">    real</span> :: value_to_test</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordtype">type</span>(iterator_type) :: iterator, map_data_iterator</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordtype">type</span>(mapentry_type) :: map_entry, map_data_entry</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="keywordtype">type</span>(data_values_type), <span class="keywordtype">pointer</span> :: data_value</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: items_to_remove</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160; </div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    field_id=c_get_integer(file_state%variable_to_id, get_field_key(field_to_write_information))</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    included_num=1</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    j=1</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keyword">allocate</span>(items_to_remove(c_size(field_to_write_information%values_to_write)))</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    iterator=c_get_iterator(field_to_write_information%values_to_write)</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(iterator))</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      map_entry=c_next_mapentry(iterator)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      value_to_test=conv_to_real(map_entry%key)</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">if</span> (value_to_test .le. time .and. value_to_test .gt. field_to_write_information%previous_write_time) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        items_to_remove(included_num)=map_entry%key</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        included_num=included_num+1</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        data_value=&gt;get_data_value_by_field_name(field_to_write_information%values_to_write, map_entry%key)</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;        map_data_iterator=c_get_iterator(data_value%map_values)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        i=1</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(file_state%mutex))</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(netcdf_mutex))</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(map_data_iterator))</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;          map_data_entry=c_next_mapentry(map_data_iterator)          </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;          <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, field_id, trim(map_data_entry%key), (/ 1, 1, i, j /)))</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;          <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, field_id, trim(c_get_string(map_data_entry)), (/ 1, 2, i, j /)))</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          <span class="keyword">call </span>c_remove(data_value%map_values, map_data_entry%key)</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;          i=i+1</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(netcdf_mutex))</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(file_state%mutex))</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keyword">call </span>c_free(data_value%map_values)</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        j=j+1</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">if</span> (included_num .gt. 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;      <span class="keywordflow">do</span> i=1, included_num-1</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keyword">call </span>c_remove(field_to_write_information%values_to_write, items_to_remove(i))</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="keywordflow">      end do</span>      </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keyword">deallocate</span>(items_to_remove)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a527dfbc289976e0eefcc432bb077040e_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a527dfbc289976e0eefcc432bb077040e_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a527dfbc289976e0eefcc432bb077040e_cgraph" id="anamespacenetcdf__filetype__writer__mod_a527dfbc289976e0eefcc432bb077040e_cgraph">
<area shape="rect" title=" " alt="" coords="5,168,151,209"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="417,5,584,47"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="423,80,578,121"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="419,164,582,205"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="419,255,582,296"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a41e86c7b84afdea863ca626a2599bf1d" title="Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against..." alt="" coords="212,344,356,385"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="199,109,369,151"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="199,227,369,268"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="632,50,775,77"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="823,43,989,84"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a527dfbc289976e0eefcc432bb077040e_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a527dfbc289976e0eefcc432bb077040e_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a527dfbc289976e0eefcc432bb077040e_icgraph" id="anamespacenetcdf__filetype__writer__mod_a527dfbc289976e0eefcc432bb077040e_icgraph">
<area shape="rect" title=" " alt="" coords="4068,98,4213,139"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a605f56b2d81bbaf34377388f9d3f6ec1" title="Writes independent variables to the diagnostics file. This writes the entire variable and works by wr..." alt="" coords="3855,91,4020,147"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3663,98,3807,139"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,91,3615,147"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,85,2592,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,146,3423,187"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,75,1897,131"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,112,2371,168"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,112,2156,168"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,114,2801,155"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a646b3fed89978ea8212eece9494f7c54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a646b3fed89978ea8212eece9494f7c54">&#9670;&nbsp;</a></span>write_out_number_values()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::write_out_number_values </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__field__type.html">writer_field_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>field_to_write_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00665">665</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordtype">type</span>(writer_field_type), <span class="keywordtype">intent(inout)</span> :: field_to_write_information</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="keywordtype">    real</span>(kind=<a class="code" href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">default_precision</a>), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: values_to_write, timeseries_time_to_write</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="keywordtype">    real</span> :: value_to_test</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordtype">integer</span> :: i, field_id, next_entry_index, array_size, included_num</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: count_to_write</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordtype">type</span>(iterator_type) :: iterator</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordtype">type</span>(mapentry_type) :: map_entry</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordtype">type</span>(data_values_type), <span class="keywordtype">pointer</span> :: data_value</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: items_to_remove</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_timeseries_type), <span class="keywordtype">pointer</span> :: timeseries_diag</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    timeseries_diag=&gt;get_specific_timeseries_dimension(file_state, field_to_write_information%output_frequency, &amp;</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;         field_to_write_information%timestep_frequency)</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    next_entry_index=1</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    included_num=1</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    array_size=1</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordflow">if</span> (.not. timeseries_diag%variable_written) <span class="keyword">allocate</span>(timeseries_time_to_write(timeseries_diag%num_entries))</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keyword">allocate</span>(count_to_write(field_to_write_information%dimensions+1))</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">if</span> (field_to_write_information%dimensions .gt. 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">do</span> i=1, field_to_write_information%dimensions</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        array_size=array_size*field_to_write_information%actual_dim_size(i)</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        count_to_write(i)=field_to_write_information%actual_dim_size(i)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keyword">allocate</span>(values_to_write(array_size*timeseries_diag%num_entries))</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keyword">allocate</span>(items_to_remove(timeseries_diag%num_entries))</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    iterator=c_get_iterator(field_to_write_information%values_to_write)</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (c_has_next(iterator))</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      map_entry=c_next_mapentry(iterator)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      value_to_test=conv_to_real(map_entry%key)</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keywordflow">if</span> (value_to_test .le. time .and. value_to_test .gt. field_to_write_information%previous_write_time) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        data_value=&gt;get_data_value_by_field_name(field_to_write_information%values_to_write, map_entry%key)</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">size</span>(values_to_write) .ge. next_entry_index+<span class="keyword">size</span>(data_value%values)-1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;          values_to_write(next_entry_index: next_entry_index+<span class="keyword">size</span>(data_value%values)-1)=data_value%values(:)</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;          next_entry_index=next_entry_index+<span class="keyword">size</span>(data_value%values)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;          <span class="keyword">deallocate</span>(data_value%values)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;          <span class="keyword">deallocate</span>(data_value)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;          items_to_remove(included_num)=map_entry%key</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(timeseries_time_to_write)) timeseries_time_to_write(included_num)=value_to_test</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;          included_num=included_num+1</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">log_warn</a>, <span class="stringliteral">&quot;Omitted time entry of field &#39;&quot;</span>//trim(field_to_write_information%field_name)//&amp;</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;               <span class="stringliteral">&quot;&#39; as past time dimension length&quot;</span>)</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    count_to_write(<span class="keyword">size</span>(count_to_write))=included_num-1</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    field_id=c_get_integer(file_state%variable_to_id, get_field_key(field_to_write_information))</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="keywordflow">if</span> (included_num-1 .ne. timeseries_diag%num_entries) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">log_log</a>(<a class="code" href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">log_warn</a>, <span class="stringliteral">&quot;Miss match of time entries for field &#39;&quot;</span>//trim(field_to_write_information%field_name)//&amp;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;           <span class="stringliteral">&quot;&#39;, included entries=&quot;</span>//trim(conv_to_string(included_num-1))//<span class="stringliteral">&quot; but expected entries=&quot;</span>//&amp;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;           trim(conv_to_string(timeseries_diag%num_entries)))</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(file_state%mutex))</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_lock(netcdf_mutex))</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, field_id, values_to_write, count=count_to_write))</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(timeseries_time_to_write)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, timeseries_diag%netcdf_var_id, &amp;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;           timeseries_time_to_write, count=(/ timeseries_diag%num_entries /)))</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      timeseries_diag%variable_written=.true.</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(netcdf_mutex))</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    <span class="keyword">call </span>check_thread_status(forthread_mutex_unlock(file_state%mutex))</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keyword">deallocate</span>(values_to_write)</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keywordflow">if</span> (included_num .gt. 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="keywordflow">do</span> i=1, included_num-1</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="keyword">call </span>c_remove(field_to_write_information%values_to_write, items_to_remove(i))</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keyword">deallocate</span>(items_to_remove)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">allocated</span>(timeseries_time_to_write)) <span class="keyword">deallocate</span>(timeseries_time_to_write)</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a646b3fed89978ea8212eece9494f7c54_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a646b3fed89978ea8212eece9494f7c54_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a646b3fed89978ea8212eece9494f7c54_cgraph" id="anamespacenetcdf__filetype__writer__mod_a646b3fed89978ea8212eece9494f7c54_cgraph">
<area shape="rect" title=" " alt="" coords="5,231,168,287"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="460,5,627,47"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="675,71,817,98"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="466,135,621,176"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="462,224,625,265"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="462,336,625,377"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a41e86c7b84afdea863ca626a2599bf1d" title="Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against..." alt="" coords="242,407,386,448"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6da2f8c99dc13a7d24ec60861a2a48aa" title="Given the file state and the output frequency of a field will retrive the appropriate time series dim..." alt="" coords="216,471,412,527"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="229,173,399,215"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="229,239,399,280"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="865,64,1032,105"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a646b3fed89978ea8212eece9494f7c54_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a646b3fed89978ea8212eece9494f7c54_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a646b3fed89978ea8212eece9494f7c54_icgraph" id="anamespacenetcdf__filetype__writer__mod_a646b3fed89978ea8212eece9494f7c54_icgraph">
<area shape="rect" title=" " alt="" coords="4068,91,4231,147"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a605f56b2d81bbaf34377388f9d3f6ec1" title="Writes independent variables to the diagnostics file. This writes the entire variable and works by wr..." alt="" coords="3855,91,4020,147"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a797c4ff7ba5863cdff2746729ec8e1fc" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3663,98,3807,139"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,91,3615,147"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,85,2592,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,146,3423,187"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,75,1897,131"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,112,2371,168"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,112,2156,168"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,114,2801,155"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a2d8000c479d36f8c5c0c91aa482c9765"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d8000c479d36f8c5c0c91aa482c9765">&#9670;&nbsp;</a></span>write_out_options()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine netcdf_filetype_writer_mod::write_out_options </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>io_configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1netcdf__diagnostics__type.html">netcdf_diagnostics_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>file_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes out the options_database defining this model run. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">io_configuration</td><td>The configuration of the IO server </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00803">803</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">intent(inout)</span> :: io_configuration</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">intent(inout)</span> :: file_state</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordtype">integer</span> :: i</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordtype">character(len=STRING_LENGTH)</span>, <span class="keywordtype">pointer</span> :: sized_raw_character</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordtype">class</span>(*), <span class="keywordtype">pointer</span> :: raw_data, raw_to_string</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keyword">call </span>lock_mpi()</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">do</span> i=1,options_size(io_configuration%options_database)</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      raw_data=&gt; options_value_at(io_configuration%options_database, i)</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      raw_to_string=&gt;raw_data</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, nopt_var_id, &amp;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;           trim(options_key_at(io_configuration%options_database, i)), (/ 1, 1, i /)))</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keywordflow">select type</span> (raw_data)</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="keywordflow">      type is</span>(integer)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, nopt_var_id, trim(conv_to_string(raw_data)), (/ 1, 2, i /)))</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="keywordflow">      type is</span>(real(kind=single_precision))</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, nopt_var_id, trim(conv_to_string(raw_data)), (/ 1, 2, i /)))</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="keywordflow">      type is</span>(real(kind=double_precision))</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, nopt_var_id, trim(conv_to_string(raw_data)), (/ 1, 2, i /)))</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="keywordflow">      type is</span>(logical)</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, nopt_var_id, trim(conv_to_string(raw_data)), (/ 1, 2, i /)))</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="keywordflow">      type is</span>(<span class="keywordtype">character</span>(len=*))</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        <span class="comment">! Done this way to give the character size information and keep the (unsafe) cast in the conversion module</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        sized_raw_character=&gt;conv_to_string(raw_to_string, .false., string_length)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keyword">call </span>check_netcdf_status(nf90_put_var(file_state%ncid, nopt_var_id, trim(sized_raw_character), (/ 1, 2, i /)))</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="keywordflow">      end select</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keyword">call </span>unlock_mpi()</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; </div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a2d8000c479d36f8c5c0c91aa482c9765_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a2d8000c479d36f8c5c0c91aa482c9765_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a2d8000c479d36f8c5c0c91aa482c9765_cgraph" id="anamespacenetcdf__filetype__writer__mod_a2d8000c479d36f8c5c0c91aa482c9765_cgraph">
<area shape="rect" title="Writes out the options_database defining this model run." alt="" coords="5,167,168,208"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="435,5,601,47"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="216,68,387,109"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#adc0a6752b379a4967ae7260e4487d049" title="Returns the ith key in the options database." alt="" coords="227,133,376,175"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#a7eeb8b8d74d261f80bb0a64db10b22e2" title="Returns the number of entries in the options database." alt="" coords="227,199,376,240"/>
<area shape="rect" href="namespaceoptionsdatabase__mod.html#a2dee7871d510ec8b7e82ff936a59b443" title="Returns the value at index in the database." alt="" coords="227,264,376,305"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="216,329,387,371"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="649,78,792,105"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="840,71,1007,112"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="441,136,595,177"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="437,71,599,112"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="437,329,599,371"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a2d8000c479d36f8c5c0c91aa482c9765_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a2d8000c479d36f8c5c0c91aa482c9765_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a2d8000c479d36f8c5c0c91aa482c9765_icgraph" id="anamespacenetcdf__filetype__writer__mod_a2d8000c479d36f8c5c0c91aa482c9765_icgraph">
<area shape="rect" title="Writes out the options_database defining this model run." alt="" coords="3679,179,3841,221"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6c970a34b31a068f500ae6a1235d9906" title="Defines a NetCDF file &#45; which creates it, defines all dimensions and variables. This must be called b..." alt="" coords="3471,179,3631,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,179,3423,221"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,133,2801,174"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,125,2592,181"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,101,1897,157"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,144,2371,200"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,144,2156,200"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<a id="a797c4ff7ba5863cdff2746729ec8e1fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a797c4ff7ba5863cdff2746729ec8e1fc">&#9670;&nbsp;</a></span>write_variable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public netcdf_filetype_writer_mod::write_variable </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structconfiguration__parser__mod_1_1io__configuration__type.html">io_configuration_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>io_configuration</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structwriter__types__mod_1_1writer__field__type.html">writer_field_type</a>), intent(inout)&#160;</td>
          <td class="paramname"><em>field_to_write_information</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>timestep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes the contents of a variable to the NetCDF file. This also removes the written entries from the field information type in order to conserve memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">field_to_write_information</td><td>The field that is going to be written </td></tr>
    <tr><td class="paramname">filename</td><td>The name of the diagnostics file </td></tr>
    <tr><td class="paramname">timestep</td><td>The write timestep </td></tr>
    <tr><td class="paramname">time</td><td>The write time </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00237">237</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">type</span>(io_configuration_type), <span class="keywordtype">intent(inout)</span> :: io_configuration</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordtype">type</span>(writer_field_type), <span class="keywordtype">intent(inout)</span> :: field_to_write_information</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: filename</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: timestep</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="keywordtype">    real</span>, <span class="keywordtype">intent(in)</span> :: time</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordtype">type</span>(netcdf_diagnostics_type), <span class="keywordtype">pointer</span> :: file_state</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            </div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    file_state=&gt;get_file_state(filename, timestep, .true.)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">if</span> (field_to_write_information%collective_write) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordflow">if</span> (field_to_write_information%collective_contiguous_optimisation) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keyword">call </span>write_contiguous_collective_variable_to_diagnostics(io_configuration, field_to_write_information, &amp;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;             timestep, time, file_state)</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keyword">call </span>write_collective_variable_to_diagnostics(io_configuration, field_to_write_information, timestep, time, file_state)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      <span class="keyword">call </span>write_independent_variable_to_diagnostics(field_to_write_information, timestep, time, file_state)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keywordflow">    end if</span></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a797c4ff7ba5863cdff2746729ec8e1fc_cgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a797c4ff7ba5863cdff2746729ec8e1fc_cgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a797c4ff7ba5863cdff2746729ec8e1fc_cgraph" id="anamespacenetcdf__filetype__writer__mod_a797c4ff7ba5863cdff2746729ec8e1fc_cgraph">
<area shape="rect" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="5,652,149,693"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#acb05fbdc64a670792cd9cec7f238951d" title="Retrieves a file state based upon its timestep or null if none is found." alt="" coords="208,151,352,192"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a10f13979aff7110f8df58356fb4e398d" title="Writes collective variables, where we are working with the values from multiple MONCs and storing the..." alt="" coords="413,518,579,574"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#abc1e910adcd0ef7c86299b5286fc365f" title="Writes contiguous collective variable blocks into the NetCDF files. These are blocks of data spanning..." alt="" coords="201,764,359,835"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a605f56b2d81bbaf34377388f9d3f6ec1" title="Writes independent variables to the diagnostics file. This writes the entire variable and works by wr..." alt="" coords="197,1026,363,1082"/>
<area shape="rect" href="namespacethreadpool__mod.html#a64977cc4d8fab28cdbfabd03b5f28d3a" title="Checks the error status of any thread operation and reports an error if it failed." alt="" coords="904,768,1059,809"/>
<area shape="rect" href="namespaceforthread__mod.html#ace3f16636de24b1fc62de549d67476dc" title=" " alt="" coords="415,71,577,112"/>
<area shape="rect" href="namespaceforthread__mod.html#a846b04ba75a5d5f20d8d38a7cab93da1" title=" " alt="" coords="415,5,577,47"/>
<area shape="rect" href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45" title="Logs a message at the specified level. If the level is above the current level then the message is ig..." alt="" coords="1111,775,1253,802"/>
<area shape="rect" href="namespacelogging__mod.html#ac5c3277c18a4c378f0024c555cb5680a" title="Returns the string preamble that applies to the specific logging level." alt="" coords="1301,768,1468,809"/>
<area shape="rect" href="namespacenetcdf__misc__mod.html#a159f13789af0cecc704b47fde431b241" title="Will check a NetCDF status and write to log_log error any decoded statuses. Can be used to decode whe..." alt="" coords="657,1320,824,1361"/>
<area shape="rect" href="namespaceforthread__mod.html#a9101345b87d2c0e18fb020677cf767b9" title=" " alt="" coords="900,1001,1063,1043"/>
<area shape="rect" href="namespaceforthread__mod.html#a6068972cad8d59eb6b29c8301d331090" title=" " alt="" coords="900,1067,1063,1108"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#aacc77c78537724e3eac2bfc2537d9a30" title="Translates a dimension name to its numeric corresponding identifier." alt="" coords="641,340,840,381"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#aff299f33f5701bfddd073cd0a06be5f7" title="Retrieves the original size of a specific dimension (which is auto)" alt="" coords="629,405,852,447"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a41e86c7b84afdea863ca626a2599bf1d" title="Retrieves the field key, corresponding to the field name in the NetCDF file and what we store against..." alt="" coords="669,899,813,940"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a6da2f8c99dc13a7d24ec60861a2a48aa" title="Given the file state and the output frequency of a field will retrive the appropriate time series dim..." alt="" coords="643,623,839,679"/>
<area shape="rect" href="namespacempi__communication__mod.html#a44ac4f74cb4daf89481da8df1dabc10d" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then locks MPI." alt="" coords="655,768,826,809"/>
<area shape="rect" href="namespacempi__communication__mod.html#aad52010c006d90df6c097898ebdf4487" title="If we are explicitly managing MPI thread safety (SERIALIZED mode) then unlocks MPI." alt="" coords="655,833,826,875"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#aaff250f828a91818f15f82b3838701cf" title="Retrieves the next collective descriptor based upon the iterator." alt="" coords="411,699,581,755"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#aef4805588ccfc47ddd145e9c20e34218" title="Retrieves the next specific monc information item from the iterator." alt="" coords="416,946,576,1002"/>
<area shape="rect" href="namespacempi__communication__mod.html#a6ed06ee79c19ff1f57a344de48e53806" title="Waits for a specific MPI request to complete, either by managing thread safety and interleaving or ju..." alt="" coords="411,779,581,820"/>
<area shape="rect" href="namespacempi__communication__mod.html#aee6d81060fcad11a466f823627234e7c" title="Pauses for a specific number of ms to allow for MPI interleaving, this is to avoid starvation." alt="" coords="647,703,834,744"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a527dfbc289976e0eefcc432bb077040e" title=" " alt="" coords="423,1108,569,1149"/>
<area shape="rect" href="namespacenetcdf__filetype__writer__mod.html#a646b3fed89978ea8212eece9494f7c54" title=" " alt="" coords="415,1026,577,1082"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="namespacenetcdf__filetype__writer__mod_a797c4ff7ba5863cdff2746729ec8e1fc_icgraph.png" border="0" usemap="#anamespacenetcdf__filetype__writer__mod_a797c4ff7ba5863cdff2746729ec8e1fc_icgraph" alt=""/></div>
<map name="namespacenetcdf__filetype__writer__mod_a797c4ff7ba5863cdff2746729ec8e1fc_icgraph" id="anamespacenetcdf__filetype__writer__mod_a797c4ff7ba5863cdff2746729ec8e1fc_icgraph">
<area shape="rect" title="Writes the contents of a variable to the NetCDF file. This also removes the written entries from the ..." alt="" coords="3663,98,3807,139"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a3df9fda1cc189c370e8599947191e559" title="Determines if a file can be written to its overarching write representation. If so then a write is is..." alt="" coords="3471,91,3615,147"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a303133afee5100e6a9b0b19ead391dfa" title="For a specific field wil determine and handle any outstanding fields writes until an outstanding writ..." alt="" coords="2419,85,2592,141"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9271347f390a41c78caacc174002d0b4" title="Issues the actual file creation, write of available fields and closure if all completed." alt="" coords="3279,146,3423,187"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a7149ce030c6fa05c7789b5e1e10be905" title=" " alt="" coords="1747,75,1897,131"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4d77a55167cf260497e14e1f86a8e54b" title="Provides a single ordered field, i.e. Q fields have been split by this point." alt="" coords="2204,112,2371,168"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#abdd6a0f59e9d20b22f8dad6922d86998" title="Processes queued up items for a specific field&#39;s ordering. This will send any available fields to the..." alt="" coords="1504,130,1699,171"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a0edc2294f387e9906c4b106396415b63" title="Provides a field to the write federator (a collective diagnostic or prognostic)" alt="" coords="1305,85,1456,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#ae55118a13d09d6d75229e0cc6f748e31" title="Provides a field to the write federator with no source (a none collective diagnostic)" alt="" coords="1081,5,1240,61"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a61030ab70e43ed5b49c6ca3900d9bfb3" title=" " alt="" coords="1064,85,1257,141"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#acfd94b193f4f73b22d6a48314f7fd2e0" title="Data communicated from MONC is provided to this write federator and then included if the configuratio..." alt="" coords="1074,165,1247,221"/>
<area shape="rect" href="namespacewriter__field__manager__mod.html#a7c173bbbc4904ac12141d3ca6c494e38" title=" " alt="" coords="809,85,1016,141"/>
<area shape="rect" href="namespaceio__server__mod.html#a96c2285d5c9b5badb426a0e065abdf4a" title="Handles the command for data download from a specific process. This will allocate the receive buffer ..." alt="" coords="837,205,988,246"/>
<area shape="rect" href="namespaceio__server__mod.html#a153d99e94dcccfaea63104af86095dce" title="Retrieves the message from MONC off the data channel and throws this to a thread in the thread pool t..." alt="" coords="584,197,761,253"/>
<area shape="rect" href="namespaceio__server__mod.html#ab843eee74fe31492952c1c88304730d7" title="Called to handle a specific command that has been recieved." alt="" coords="385,205,536,246"/>
<area shape="rect" href="namespaceio__server__mod.html#ac818aa1985977c9887acda6315139114" title="Called to start the IO server and once this subroutine returns then it indicates that the IO server h..." alt="" coords="147,212,337,239"/>
<area shape="rect" href="monc__driver_8F90.html#a38fac04eb034f0802b465898f3976e17" title="MONC program entry point which simply calls the main procedure in the MONC module." alt="" coords="5,212,99,239"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9b04288042049d5e432068c5923b026d" title="Provides fields (either diagnostics or prognostics) to the write federator which will action these as..." alt="" coords="1945,112,2156,168"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a4e6cf3c74ee165c8ece3735913e75e0a" title="Will check whether there are any pending writes and if so will issue a chain write for this." alt="" coords="3080,107,3231,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a977faf0b0a12f54b8002555e6f791856" title="Checks a writer trigger and issues a file creation along with field write if the conditions (time or ..." alt="" coords="3083,238,3228,279"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a9ec7f85e388c7212a8aa98acefc2b9d0" title="Call back for the inter IO reduction which actually does the NetCDF file closing which is a collectiv..." alt="" coords="2855,107,3032,163"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a37589f9aced0f51f811ed15c462d33cb" title="Closes the diagnostics file, this is done via a global callback to issue the closes synchronously (co..." alt="" coords="2646,114,2801,155"/>
<area shape="rect" href="namespacewriter__federator__mod.html#a1af403ddb2a3d977bfc3f81a6f834488" title="Checks all writer entries for any trigger fires and issues the underlying file storage." alt="" coords="2640,238,2807,279"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ac84f134b670c232a7304be0210405f91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac84f134b670c232a7304be0210405f91">&#9670;&nbsp;</a></span>file_states</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">type(<a class="el" href="structcollections__mod_1_1hashmap__type.html">hashmap_type</a>), volatile netcdf_filetype_writer_mod::file_states</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00040">40</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordtype">type</span>(hashmap_type), <span class="keywordtype">volatile</span> :: file_states</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1d9b63d2ab8113abe7d1663961a0c86f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d9b63d2ab8113abe7d1663961a0c86f">&#9670;&nbsp;</a></span>file_states_rwlock</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, volatile netcdf_filetype_writer_mod::file_states_rwlock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00041">41</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">volatile</span> :: file_states_rwlock, netcdf_mutex</div>
</div><!-- fragment -->
</div>
</div>
<a id="a3250670fff4489a31671478d48983e76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3250670fff4489a31671478d48983e76">&#9670;&nbsp;</a></span>l_nc_dim</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical netcdf_filetype_writer_mod::l_nc_dim</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00043">43</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordtype">logical</span> :: l_nc_dim, l_nd_dim</div>
</div><!-- fragment -->
</div>
</div>
<a id="aba8115f7b27734ca15c13f39b364c83f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba8115f7b27734ca15c13f39b364c83f">&#9670;&nbsp;</a></span>l_nd_dim</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical netcdf_filetype_writer_mod::l_nd_dim</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00043">43</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>

</div>
</div>
<a id="ad55950209846482af7f3903d82f99ca0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad55950209846482af7f3903d82f99ca0">&#9670;&nbsp;</a></span>nc_dim_id</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer netcdf_filetype_writer_mod::nc_dim_id</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00044">44</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordtype">integer</span> :: nc_dim_id, nd_dim_id, nopt_dim_id</div>
</div><!-- fragment -->
</div>
</div>
<a id="ae2a168027013888ad783106a7922b529"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2a168027013888ad783106a7922b529">&#9670;&nbsp;</a></span>nc_var_id_l</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer netcdf_filetype_writer_mod::nc_var_id_l</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00045">45</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>

</div>
</div>
<a id="a0e6f46caa79d2a86818dfc0e7d352237"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e6f46caa79d2a86818dfc0e7d352237">&#9670;&nbsp;</a></span>nc_var_id_s</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer netcdf_filetype_writer_mod::nc_var_id_s</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00045">45</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordtype">integer</span> :: nc_var_id_s, nd_var_id_s, nc_var_id_l, nd_var_id_l, nopt_var_id</div>
</div><!-- fragment -->
</div>
</div>
<a id="aa2b112377e2bb89a0b05075b67241d44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2b112377e2bb89a0b05075b67241d44">&#9670;&nbsp;</a></span>nd_dim_id</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer netcdf_filetype_writer_mod::nd_dim_id</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00044">44</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>

</div>
</div>
<a id="af22935ab833d9c6294e1aee6727e08ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af22935ab833d9c6294e1aee6727e08ca">&#9670;&nbsp;</a></span>nd_var_id_l</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer netcdf_filetype_writer_mod::nd_var_id_l</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00045">45</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>

</div>
</div>
<a id="a524a6a6ad6378a78dad016e522fa0978"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a524a6a6ad6378a78dad016e522fa0978">&#9670;&nbsp;</a></span>nd_var_id_s</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer netcdf_filetype_writer_mod::nd_var_id_s</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00045">45</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>

</div>
</div>
<a id="a8ebc93072613a3f817b29aaca86e3201"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ebc93072613a3f817b29aaca86e3201">&#9670;&nbsp;</a></span>netcdf_mutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer, volatile netcdf_filetype_writer_mod::netcdf_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00041">41</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>

</div>
</div>
<a id="a5593eb67f5a8e5a911f43457c43ab5c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5593eb67f5a8e5a911f43457c43ab5c0">&#9670;&nbsp;</a></span>nopt_dim_id</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer netcdf_filetype_writer_mod::nopt_dim_id</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00044">44</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>

</div>
</div>
<a id="a9374f28d4bfc72530979f2f0b701abd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9374f28d4bfc72530979f2f0b701abd0">&#9670;&nbsp;</a></span>nopt_var_id</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">integer netcdf_filetype_writer_mod::nopt_var_id</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="netcdf__filetype_8F90_source.html#l00045">45</a> of file <a class="el" href="netcdf__filetype_8F90_source.html">netcdf_filetype.F90</a>.</p>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="anamespacelogging__mod_html_ad68309846cd8f9e77edaa6abd02f65a0"><div class="ttname"><a href="namespacelogging__mod.html#ad68309846cd8f9e77edaa6abd02f65a0">logging_mod::log_error</a></div><div class="ttdeci">integer, parameter, public log_error</div><div class="ttdoc">Only log ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00011">logging.F90:11</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_a10e28447dd10ef9f92d205bc98fb26d3"><div class="ttname"><a href="namespacelogging__mod.html#a10e28447dd10ef9f92d205bc98fb26d3">logging_mod::log_warn</a></div><div class="ttdeci">integer, parameter, public log_warn</div><div class="ttdoc">Log WARNING and ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00012">logging.F90:12</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ac4f13ac385499c85190cb184030e4f45"><div class="ttname"><a href="namespacelogging__mod.html#ac4f13ac385499c85190cb184030e4f45">logging_mod::log_log</a></div><div class="ttdeci">subroutine, public log_log(level, message, str)</div><div class="ttdoc">Logs a message at the specified level. If the level is above the current level then the message is ig...</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00074">logging.F90:75</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ae0d255e756059bc76b2f4291825e59c9"><div class="ttname"><a href="namespacelogging__mod.html#ae0d255e756059bc76b2f4291825e59c9">logging_mod::log_get_logging_level</a></div><div class="ttdeci">integer function, public log_get_logging_level()</div><div class="ttdoc">Retrieves the current logging level.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00121">logging.F90:122</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_aca1c925af27b4d533d548bfe69a819f3"><div class="ttname"><a href="namespacelogging__mod.html#aca1c925af27b4d533d548bfe69a819f3">logging_mod::log_debug</a></div><div class="ttdeci">integer, parameter, public log_debug</div><div class="ttdoc">Log DEBUG, INFO, WARNING and ERROR messages.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00014">logging.F90:14</a></div></div>
<div class="ttc" id="anamespacelogging__mod_html_ad95937a250467334622daeb5cff78c20"><div class="ttname"><a href="namespacelogging__mod.html#ad95937a250467334622daeb5cff78c20">logging_mod::log_master_log</a></div><div class="ttdeci">subroutine, public log_master_log(level, message)</div><div class="ttdoc">Will log just from the master process.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8F90_source.html#l00046">logging.F90:47</a></div></div>
<div class="ttc" id="anamespacedatadefn__mod_html_a39b79f8cc843d236d3b47f5c81b64368"><div class="ttname"><a href="namespacedatadefn__mod.html#a39b79f8cc843d236d3b47f5c81b64368">datadefn_mod::default_precision</a></div><div class="ttdeci">integer, parameter, public default_precision</div><div class="ttdoc">MPI communication type which we use for the prognostic and calculation data.</div><div class="ttdef"><b>Definition:</b> <a href="datadefn_8F90_source.html#l00017">datadefn.F90:17</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
